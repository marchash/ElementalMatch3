;(function() {var w=window;
w.BUILD_TARGET="native-ios";
w.BUILD_ENV="native";
w.DEBUG=true;
w.CONFIG={"appID":"0ff631e18c3f4fd594f2b9a96682cdbf","ios":{},"supportedOrientations":["portrait","landscape"],"shortName":"ElementalMatch3","title":"ElementalMatch3","disableNativeViews":false,"useDOM":false,"packageName":"com.example.studio.ElementalMatch3","bundleID":"com.example.studio.ElementalMatch3","target":"native-ios","serverName":"local","localServerURL":"192.168.1.39:9200","version":"debug","sdkVersion":"3.1.3","splash":{"autoHide":true},"useWebGL":false};
})();;CACHE={"spritesheets/map.json":"{\"spritesheets/resources-images-ui1.png\":[{\"f\":\"resources/images/ui/titlescreen.png\",\"x\":0,\"y\":0,\"w\":576,\"h\":1024},{\"f\":\"resources/images/ui/header.png\",\"x\":580,\"y\":0,\"w\":249,\"h\":166}],\"spritesheets/resources-images-ui2.png\":[{\"f\":\"resources/images/ui/background.png\",\"x\":0,\"y\":0,\"w\":576,\"h\":1024}],\"spritesheets/resources-images-particles1.png\":[{\"f\":\"resources/images/particles/gem_02_gleam.png\",\"x\":0,\"y\":0,\"w\":57,\"h\":58},{\"f\":\"resources/images/particles/gem_05_gleam.png\",\"x\":62,\"y\":0,\"w\":57,\"h\":57},{\"f\":\"resources/images/particles/gem_04_gleam.png\",\"x\":124,\"y\":0,\"w\":57,\"h\":57},{\"f\":\"resources/images/particles/gem_03_gleam.png\",\"x\":186,\"y\":0,\"w\":57,\"h\":57},{\"f\":\"resources/images/particles/gem_01_gleam.png\",\"x\":248,\"y\":0,\"w\":57,\"h\":57},{\"f\":\"resources/images/particles/gem_04_round.png\",\"x\":310,\"y\":0,\"w\":30,\"h\":30},{\"f\":\"resources/images/particles/gem_03_round.png\",\"x\":344,\"y\":0,\"w\":30,\"h\":30},{\"f\":\"resources/images/particles/gem_01_round.png\",\"x\":378,\"y\":0,\"w\":30,\"h\":30},{\"f\":\"resources/images/particles/gem_05_round.png\",\"x\":412,\"y\":0,\"w\":30,\"h\":29},{\"f\":\"resources/images/particles/gem_02_round.png\",\"x\":446,\"y\":0,\"w\":30,\"h\":29}],\"spritesheets/resources-images-misc1.png\":[{\"f\":\"resources/images/misc/score_bar.png\",\"x\":0,\"y\":0,\"w\":200,\"h\":15}],\"spritesheets/resources-images-gems1.png\":[{\"f\":\"resources/images/gems/gem_05.png\",\"x\":0,\"y\":0,\"w\":132,\"h\":132},{\"f\":\"resources/images/gems/gem_04.png\",\"x\":136,\"y\":0,\"w\":132,\"h\":132},{\"f\":\"resources/images/gems/gem_03.png\",\"x\":272,\"y\":0,\"w\":132,\"h\":132},{\"f\":\"resources/images/gems/gem_02.png\",\"x\":408,\"y\":0,\"w\":132,\"h\":132},{\"f\":\"resources/images/gems/gem_01.png\",\"x\":544,\"y\":0,\"w\":132,\"h\":132}],\"spritesheets/resources-images-cursors1.png\":[{\"f\":\"resources/images/cursors/selected.png\",\"x\":0,\"y\":0,\"w\":140,\"h\":140}]}","resources/sound-map.json":"{}"};
// this file is included at the end of the embedded JS

/* globals NATIVE, JSIO_ENV_CTOR: true */

// it's responsible for initializing the js.io environment
var util = {};
var formatRegExp = /%[sdj%]/g;
util.format = function(f) {
  if (!isString(f)) {
    var objects = [];
    for (var i = 0; i < arguments.length; i++) {
      objects.push(inspect(arguments[i]));
    }
    return objects.join(' ');
  }

  var i = 1;
  var args = arguments;
  var len = args.length;
  var str = String(f).replace(formatRegExp, function(x) {
    if (x === '%%') return '%';
    if (i >= len) return x;
    switch (x) {
      case '%s': return String(args[i++]);
      case '%d': return Number(args[i++]);
      case '%j':
        try {
          return JSON.stringify(args[i++]);
        } catch (_) {
          return '[Circular]';
        }
      default:
        return x;
    }
  });
  for (var x = args[i]; i < len; x = args[++i]) {
    if (isNull(x) || !isObject(x)) {
      str += ' ' + x;
    } else {
      str += ' ' + inspect(x);
    }
  }
  return str;
};



var debugs = {};
var debugEnviron;
util.debuglog = function(set) {
  if (isUndefined(debugEnviron))
    debugEnviron = process.env.NODE_DEBUG || '';
  set = set.toUpperCase();
  if (!debugs[set]) {
    if (new RegExp('\\b' + set + '\\b', 'i').test(debugEnviron)) {
      var pid = process.pid;
      debugs[set] = function() {
        var msg = util.format.apply(util, arguments);
        console.error('%s %d: %s', set, pid, msg);
      };
    } else {
      debugs[set] = function() {};
    }
  }
  return debugs[set];
};


/**
 * Echos the value of a value. Trys to print the value out
 * in the best way possible given the different types.
 *
 * @param {Object} obj The object to print out.
 * @param {Object} opts Optional options object that alters the output.
 */
/* legacy: obj, showHidden, depth, colors*/
function inspect(obj, opts) {
  // default options
  var ctx = {
    seen: [],
    stylize: stylizeNoColor
  };
  // legacy...
  if (arguments.length >= 3) ctx.depth = arguments[2];
  if (arguments.length >= 4) ctx.colors = arguments[3];
  if (isBoolean(opts)) {
    // legacy...
    ctx.showHidden = opts;
  } else if (opts) {
    // got an "options" object
    util._extend(ctx, opts);
  }
  // set default options
  if (isUndefined(ctx.showHidden)) ctx.showHidden = false;
  if (isUndefined(ctx.depth)) ctx.depth = 2;
  if (isUndefined(ctx.colors)) ctx.colors = false;
  if (isUndefined(ctx.customInspect)) ctx.customInspect = true;
  if (ctx.colors) ctx.stylize = stylizeWithColor;
  return formatValue(ctx, obj, ctx.depth);
}
util.inspect = inspect;


// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics
inspect.colors = {
  'bold' : [1, 22],
  'italic' : [3, 23],
  'underline' : [4, 24],
  'inverse' : [7, 27],
  'white' : [37, 39],
  'grey' : [90, 39],
  'black' : [30, 39],
  'blue' : [34, 39],
  'cyan' : [36, 39],
  'green' : [32, 39],
  'magenta' : [35, 39],
  'red' : [31, 39],
  'yellow' : [33, 39]
};

// Don't use 'blue' not visible on cmd.exe
inspect.styles = {
  'special': 'cyan',
  'number': 'yellow',
  'boolean': 'yellow',
  'undefined': 'grey',
  'null': 'bold',
  'string': 'green',
  'date': 'magenta',
  // "name": intentionally not styling
  'regexp': 'red'
};


function stylizeWithColor(str, styleType) {
  var style = inspect.styles[styleType];

  if (style) {
    return '\u001b[' + inspect.colors[style][0] + 'm' + str +
           '\u001b[' + inspect.colors[style][1] + 'm';
  } else {
    return str;
  }
}


function stylizeNoColor(str, styleType) {
  return str;
}


function arrayToHash(array) {
  var hash = {};

  array.forEach(function(val, idx) {
    hash[val] = true;
  });

  return hash;
}


function formatValue(ctx, value, recurseTimes) {
  // Provide a hook for user-specified inspect functions.
  // Check that value is an object with an inspect function on it
  if (ctx.customInspect &&
      value &&
      isFunction(value.inspect) &&
      // Filter out the util module, it's inspect function is special
      value.inspect !== util.inspect &&
      // Also filter out any prototype objects using the circular check.
      !(value.constructor && value.constructor.prototype === value)) {
    var ret = value.inspect(recurseTimes, ctx);
    if (!isString(ret)) {
      ret = formatValue(ctx, ret, recurseTimes);
    }
    return ret;
  }

  // Primitive types cannot have properties
  var primitive = formatPrimitive(ctx, value);
  if (primitive) {
    return primitive;
  }

  // Look up the keys of the object.
  var keys = Object.keys(value);
  var visibleKeys = arrayToHash(keys);

  if (ctx.showHidden) {
    keys = Object.getOwnPropertyNames(value);
  }

  // This could be a boxed primitive (new String(), etc.), check valueOf()
  // NOTE: Avoid calling `valueOf` on `Date` instance because it will return
  // a number which, when object has some additional user-stored `keys`,
  // will be printed out.
  var formatted;
  var raw = value;
  try {
    // the .valueOf() call can fail for a multitude of reasons
    if (!isDate(value))
      raw = value.valueOf();
  } catch (e) {
    // ignore...
  }

  if (isString(raw)) {
    // for boxed Strings, we have to remove the 0-n indexed entries,
    // since they just noisey up the output and are redundant
    keys = keys.filter(function(key) {
      return !(key >= 0 && key < raw.length);
    });
  }

  // Some type of object without properties can be shortcutted.
  if (keys.length === 0) {
    if (isFunction(value)) {
      var name = value.name ? ': ' + value.name : '';
      return ctx.stylize('[Function' + name + ']', 'special');
    }
    if (isRegExp(value)) {
      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');
    }
    if (isDate(value)) {
      return ctx.stylize(Date.prototype.toString.call(value), 'date');
    }
    if (isError(value)) {
      return formatError(value);
    }
    // now check the `raw` value to handle boxed primitives
    if (isString(raw)) {
      formatted = formatPrimitiveNoColor(ctx, raw);
      return ctx.stylize('[String: ' + formatted + ']', 'string');
    }
    if (isNumber(raw)) {
      formatted = formatPrimitiveNoColor(ctx, raw);
      return ctx.stylize('[Number: ' + formatted + ']', 'number');
    }
    if (isBoolean(raw)) {
      formatted = formatPrimitiveNoColor(ctx, raw);
      return ctx.stylize('[Boolean: ' + formatted + ']', 'boolean');
    }
  }

  var base = '', array = false, braces = ['{', '}'];

  // Make Array say that they are Array
  if (isArray(value)) {
    array = true;
    braces = ['[', ']'];
  }

  // Make functions say that they are functions
  if (isFunction(value)) {
    var n = value.name ? ': ' + value.name : '';
    base = ' [Function' + n + ']';
  }

  // Make RegExps say that they are RegExps
  if (isRegExp(value)) {
    base = ' ' + RegExp.prototype.toString.call(value);
  }

  // Make dates with properties first say the date
  if (isDate(value)) {
    base = ' ' + Date.prototype.toUTCString.call(value);
  }

  // Make error with message first say the error
  if (isError(value)) {
    base = ' ' + formatError(value);
  }

  // Make boxed primitive Strings look like such
  if (isString(raw)) {
    formatted = formatPrimitiveNoColor(ctx, raw);
    base = ' ' + '[String: ' + formatted + ']';
  }

  // Make boxed primitive Numbers look like such
  if (isNumber(raw)) {
    formatted = formatPrimitiveNoColor(ctx, raw);
    base = ' ' + '[Number: ' + formatted + ']';
  }

  // Make boxed primitive Booleans look like such
  if (isBoolean(raw)) {
    formatted = formatPrimitiveNoColor(ctx, raw);
    base = ' ' + '[Boolean: ' + formatted + ']';
  }

  if (keys.length === 0 && (!array || value.length == 0)) {
    return braces[0] + base + braces[1];
  }

  if (recurseTimes < 0) {
    if (isRegExp(value)) {
      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');
    } else {
      return ctx.stylize('[Object]', 'special');
    }
  }

  ctx.seen.push(value);

  var output;
  if (array) {
    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);
  } else {
    output = keys.map(function(key) {
      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);
    });
  }

  ctx.seen.pop();

  return reduceToSingleString(output, base, braces);
}


function formatPrimitive(ctx, value) {
  if (isUndefined(value))
    return ctx.stylize('undefined', 'undefined');
  if (isString(value)) {
    var simple = '\'' + JSON.stringify(value).replace(/^"|"$/g, '')
                                             .replace(/'/g, "\\'")
                                             .replace(/\\"/g, '"') + '\'';
    return ctx.stylize(simple, 'string');
  }
  if (isNumber(value)) {
    // Format -0 as '-0'. Strict equality won't distinguish 0 from -0,
    // so instead we use the fact that 1 / -0 < 0 whereas 1 / 0 > 0 .
    if (value === 0 && 1 / value < 0)
      return ctx.stylize('-0', 'number');
    return ctx.stylize('' + value, 'number');
  }
  if (isBoolean(value))
    return ctx.stylize('' + value, 'boolean');
  // For some reason typeof null is "object", so special case here.
  if (isNull(value))
    return ctx.stylize('null', 'null');
}


function formatPrimitiveNoColor(ctx, value) {
  var stylize = ctx.stylize;
  ctx.stylize = stylizeNoColor;
  var str = formatPrimitive(ctx, value);
  ctx.stylize = stylize;
  return str;
}


function formatError(value) {
  return '[' + Error.prototype.toString.call(value) + ']';
}


function formatArray(ctx, value, recurseTimes, visibleKeys, keys) {
  var output = [];
  for (var i = 0, l = value.length; i < l; ++i) {
    if (hasOwnProperty(value, String(i))) {
      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,
          String(i), true));
    } else {
      output.push('');
    }
  }
  keys.forEach(function(key) {
    if (!key.match(/^\d+$/)) {
      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,
          key, true));
    }
  });
  return output;
}


function formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {
  var name, str, desc;
  desc = Object.getOwnPropertyDescriptor(value, key) || { value: value[key] };
  if (desc.get) {
    if (desc.set) {
      str = ctx.stylize('[Getter/Setter]', 'special');
    } else {
      str = ctx.stylize('[Getter]', 'special');
    }
  } else {
    if (desc.set) {
      str = ctx.stylize('[Setter]', 'special');
    }
  }
  if (!hasOwnProperty(visibleKeys, key)) {
    name = '[' + key + ']';
  }
  if (!str) {
    if (ctx.seen.indexOf(desc.value) < 0) {
      if (isNull(recurseTimes)) {
        str = formatValue(ctx, desc.value, null);
      } else {
        str = formatValue(ctx, desc.value, recurseTimes - 1);
      }
      if (str.indexOf('\n') > -1) {
        if (array) {
          str = str.split('\n').map(function(line) {
            return '  ' + line;
          }).join('\n').substr(2);
        } else {
          str = '\n' + str.split('\n').map(function(line) {
            return '   ' + line;
          }).join('\n');
        }
      }
    } else {
      str = ctx.stylize('[Circular]', 'special');
    }
  }
  if (isUndefined(name)) {
    if (array && key.match(/^\d+$/)) {
      return str;
    }
    name = JSON.stringify('' + key);
    if (name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)) {
      name = name.substr(1, name.length - 2);
      name = ctx.stylize(name, 'name');
    } else {
      name = name.replace(/'/g, "\\'")
                 .replace(/\\"/g, '"')
                 .replace(/(^"|"$)/g, "'")
                 .replace(/\\\\/g, '\\');
      name = ctx.stylize(name, 'string');
    }
  }

  return name + ': ' + str;
}


function reduceToSingleString(output, base, braces) {
  var length = output.reduce(function(prev, cur) {
    return prev + cur.replace(/\u001b\[\d\d?m/g, '').length + 1;
  }, 0);

  if (length > 60) {
    return braces[0] +
           (base === '' ? '' : base + '\n ') +
           ' ' +
           output.join(',\n  ') +
           ' ' +
           braces[1];
  }

  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];
}


// NOTE: These type checking functions intentionally don't use `instanceof`
// because it is fragile and can be easily faked with `Object.create()`.
function isArray(ar) {
  return Array.isArray(ar);
}
util.isArray = isArray;

function isBoolean(arg) {
  return typeof arg === 'boolean';
}
util.isBoolean = isBoolean;

function isNull(arg) {
  return arg === null;
}
util.isNull = isNull;

function isNullOrUndefined(arg) {
  return arg == null;
}
util.isNullOrUndefined = isNullOrUndefined;

function isNumber(arg) {
  return typeof arg === 'number';
}
util.isNumber = isNumber;

function isString(arg) {
  return typeof arg === 'string';
}
util.isString = isString;

function isSymbol(arg) {
  return typeof arg === 'symbol';
}
util.isSymbol = isSymbol;

function isUndefined(arg) {
  return arg === void 0;
}
util.isUndefined = isUndefined;

function isRegExp(re) {
  return isObject(re) && objectToString(re) === '[object RegExp]';
}
util.isRegExp = isRegExp;

function isObject(arg) {
  return typeof arg === 'object' && arg !== null;
}
util.isObject = isObject;

function isDate(d) {
  return isObject(d) && objectToString(d) === '[object Date]';
}
util.isDate = isDate;

function isError(e) {
  return isObject(e) &&
      (objectToString(e) === '[object Error]' || e instanceof Error);
}
util.isError = isError;

function isFunction(arg) {
  return typeof arg === 'function';
}
util.isFunction = isFunction;

function isBuffer(arg) {
  return arg instanceof Buffer;
}
util.isBuffer = isBuffer;

function objectToString(o) {
  return Object.prototype.toString.call(o);
}


function pad(n) {
  return n < 10 ? '0' + n.toString(10) : n.toString(10);
}


var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep',
              'Oct', 'Nov', 'Dec'];

// 26 Feb 16:19:34
function timestamp() {
  var d = new Date();
  var time = [pad(d.getHours()),
              pad(d.getMinutes()),
              pad(d.getSeconds())].join(':');
  return [d.getDate(), months[d.getMonth()], time].join(' ');
}

util.getLogger = function(baseLogFn) {
    return function() {
      var args = Array.prototype.slice.call(arguments);
      args.unshift(timestamp());
      baseLogFn(util.format.apply(util, args));
    }
}

util._extend = function(origin, add) {
  // Don't do anything if add isn't an object
  if (!add || !isObject(add)) return origin;

  var keys = Object.keys(add);
  var i = keys.length;
  while (i--) {
    origin[keys[i]] = add[keys[i]];
  }
  return origin;
};

function hasOwnProperty(obj, prop) {
  return Object.prototype.hasOwnProperty.call(obj, prop);
}


var uv;
util._errnoException = function(err, syscall, original) {
  if (isUndefined(uv)) uv = process.binding('uv');
  var errname = uv.errname(err);
  var message = syscall + ' ' + errname;
  if (original)
    message += ' ' + original;
  var e = new Error(message);
  e.code = errname;
  e.errno = errname;
  e.syscall = syscall;
  return e;
};

JSIO_ENV_CTOR = function() {
  this.name = /android/i.test(GLOBAL.userAgent) ? 'android' : 'ios';

  this.global = GLOBAL;
  this.log = util.getLogger(NATIVE.console.log);
  this.getCwd = getCwd;

  function getCwd() { return NATIVE.location; }

  this.debugPath = function (path) { return path; };
  this.getPath = function() { return '/'; };
  this.eval = function(code, path) { return NATIVE.eval(code, this.debugPath(path)); };
  this.fetch = function(filePath) { return false; };
};

NATIVE.console.log(NATIVE.location);
;
jsio=(function init(cloneFrom) {
    // We expect this code to be minified before production use, so we may
    // write code slightly more verbosely than we otherwise would.

    var INITIAL_FILE = '<initial file>';
    var MODULE_NOT_FOUND = 'MODULE_NOT_FOUND';

    // Should we parse syntax errors in the browser?
    var DEBUG = true;

    // Store a reference to the slice function for converting objects of
    // type arguments to type array.
    var SLICE = Array.prototype.slice;

    // js.io supports multiple JavaScript environments such as node.js and
    // most web browsers (IE, Firefox, WebKit).  The ENV object wraps
    // any utility functions that contain environment-specific code (e.g.
    // reading a file using node's `fs` library or a browser's
    // `XMLHttpRequest`).  Running js.io in other JavaScript environments
    // is as easy as implementing an environment object that conforms to
    // the abstract interface for an environment (provided below) and
    // calling `jsio.setEnv()`.
    var ENV;

    // Checks if the last character in a string is `/`.
    var rexpEndSlash = /(\/|\\)$/;

    function getModuleDef (path) {
      path += '.js';
      return jsio.__modules[path] || new ModuleDef(path);
    }

    // Creates an object containing metadata about a module.
    function ModuleDef (path) {
      this.path = path;
      this.friendlyPath = path;

      util.splitPath(path, this);
      this.directory = util.resolve(ENV.getCwd(), this.directory);
    }

    ModuleDef.prototype.setBase = function (baseMod, basePath) {
      this.baseMod = baseMod;
      this.basePath = basePath + '/' + baseMod;
    };

    var HOST = /^([a-z][a-z0-9+\-\.]*:\/\/.*?\/)(.*)$/;
    var PROTOCOL = /^[a-z][a-z0-9+\-\.]*:/;

    // Utility functions
    var util = {
        // `util.bind` returns a function that, when called, will execute
        // the method passed in with the provided context and any additional
        // arguments passed to `util.bind`.
        //       util.bind(obj, 'f', a) -> function() { return obj.f(a); }
        //       util.bind(obj, g, a, b, c) -> function() { return g.call(g, a, b, c); }
        bind: function(context, method/*, args... */) {
          var args = SLICE.call(arguments, 2);
          return function () {
            method = (typeof method == 'string' ? context[method] : method);
            return method.apply(context, args.concat(SLICE.call(arguments, 0)));
          };
        },

        // `util.addEndSlash` accepts a string.  That string is returned with a `/`
        // appended if the string did not already end in a `/`.
        addEndSlash: function(str) {
          return rexpEndSlash.test(str) ? str : str + '/';
        },

        // `util.removeEndSlash` accepts a string.  It removes a trailing `/` if
        // one is found.
        removeEndSlash: function(str) {
          return str.replace(rexpEndSlash, '');
        },

        // `util.relative` accepts two paths (strings) and returns the second path
        // relative to the first.
        //
        //  - if `path` starts with `relativeTo`, then strip `path` off the
        //    `relativeTo` part
        //
        //         util.relative('abc/def/', 'abc') -> 'def'
        //
        //  - if `path` starts with some substring of `relativeTo`, remove
        //    this substring and add `../` for each remaining segment of
        //    `relativeTo`.
        //
        //         util.relative('abc/def/', 'abc/hij') -> '../def'
        //
        relative: function (relativeTo, path) {
          var len = relativeTo.length;
          if (path.substring(0, len) == relativeTo) {
            // if the relative path now starts with a path separator
            // either (/ or \), remove it
            /* Note: we're casting a boolean to an int by adding len to it */
            return path.slice(len + /[\/\\]/.test(path.charAt(len)));
          }

          var sA = util.removeEndSlash(path).split(ENV.pathSep),
            sB = util.removeEndSlash(relativeTo).split(ENV.pathSep),
            i = 0;

          /* Count how many segments match. */
          while(sA[i] == sB[i]) { ++i; }

          if (i) {
            /* If at least some segments matched, remove them.  The result is our new path. */
            path = sA.slice(i).join(ENV.pathSep);

            /* Prepend `../` for each segment remaining in `relativeTo`. */
            for (var j = sB.length - i; j > 0; --j) { path = '../' + path; }
          }

          return path;
        },

        // `buildPath` accepts an arbitrary number of string arguments to concatenate into a path.
        //     util.buildPath('a', 'b', 'c/', 'd/') -> 'a/b/c/d/'
        buildPath: function() {
          var pieces = [];
          for (var i = 0, n = arguments.length; i < n; ++i) {
            var piece = arguments[i];
            if (PROTOCOL.test(piece)) {
              pieces.length = 0;
            }

            if (piece != '.' && piece != './' && piece) {
              pieces.push(piece);
            }
          }

          return util.resolveRelativePath(pieces.join('/'));
        },

        // `resolveRelativePath` removes relative path indicators.  For example:
        //     util.resolveRelativePath('a/../b') -> b
        resolveRelativePath: function(path) {
          /* If the path starts with a protocol+host, store it and remove it (add it
             back later) so we don't accidently modify it. */
          var protocol = path.match(HOST);
          if (protocol) { path = protocol[2]; }

          /* Remove multiple slashes and trivial dots (`/./ -> /`). */
          path = path.replace(/\/+/g, '/').replace(/\/\.\//g, '/');

          /* Loop to collapse instances of `../` in the path by matching a previous
             path segment.  Essentially, we find substrings of the form `/abc/../`
             where abc is not `.` or `..` and replace the substrings with `/`.
             We loop until the string no longer changes since after collapsing
             possible instances once, we may have created more instances that can
             be collapsed.
          */
          var o;
          while((o = path) != (path = path.replace(/(^|\/)(?!\.?\.\/)([^\/]+)\/\.\.\//g, '$1'))) {}
          /* Don't forget to prepend any protocol we might have removed earlier. */
          return protocol ? protocol[1] + path.replace(/^\//, '') : path;
        },

        isAbsolutePath: function (path) {
          return /^\//.test(path) || PROTOCOL.test(path) || ENV.isWindowsNode && /^[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+/.test(path);
        },

        resolve: function (from, to) {
          return this.isAbsolutePath(to) ? util.resolveRelativePath(to) : util.buildPath(from, to);
        },

        resolveRelativeModule: function (modulePath, directory) {
          var result = [],
            parts = modulePath.split('.'),
            len = parts.length,
            relative = (len > 1 && !parts[0]),
            i = relative ? 0 : -1;

          while(++i < len) { result.push(parts[i] ? parts[i] : '..'); }
          return util.buildPath(relative ? directory : '', result.join('/'));
        },
        resolveModulePath: function (modulePath, directory) {
          // resolve relative paths
          if (modulePath.charAt(0) == '.') {
            return [
              getModuleDef(util.resolveRelativeModule(modulePath, directory)),
              getModuleDef(util.resolveRelativeModule(modulePath + '.index', directory))
            ];
          }

          // resolve absolute paths with respect to jsio packages/
          var pathSegments = modulePath.split('.');
          var n = pathSegments.length;
          for (var i = n; i > 0; --i) {
            var subpath = pathSegments.slice(0, i).join('.');
            var value = jsioPath.cache[subpath];
            var pathString = pathSegments.slice(i).join('/');
            if (value) {
              return [
                getModuleDef(util.buildPath(value, pathString)),
                getModuleDef(util.buildPath(value, pathString + '/index'))
              ];
            }
          }

          var baseMod = pathSegments[0];
          var pathString = pathSegments.join('/');
          var defs = [];
          var paths = jsioPath.get();
          var len = paths.length;
          for (var i = 0; i < len; ++i) {
            var base = paths[i];
            var path = util.buildPath(base, pathString);

            var moduleDef = getModuleDef(path);
            moduleDef.setBase(baseMod, base);
            defs.push(moduleDef);

            var moduleDef = getModuleDef(path + '/index');
            moduleDef.setBase(baseMod, base);
            defs.push(moduleDef);
          }
          return defs;
        },
        splitPath: function(path, result) {
          if (!result) { result = {}; }
          var i = Math.max(path.lastIndexOf('/'), path.lastIndexOf('\\')) + 1;
          result.directory = path.substring(0, i);
          result.filename = path.substring(i);
          return result;
        }
      };

    // construct the top-level jsio object
    var jsio = util.bind(this, _require, null, null, null);

    jsio.__util = util;
    jsio.__init__ = init;

    var srcCache;
    jsio.setCache = function(cache) { srcCache = jsio.__srcCache = cache; };
    jsio.setCache(cloneFrom && cloneFrom.__srcCache || {});

    jsio.setCachedSrc = function(path, src, locked) {
      if (srcCache[path] && srcCache[path].locked) {
        console.warn('Cache is ignoring (already present and locked) src ' + path);
        return;
      }
      srcCache[path] = { path: path, src: src, locked: locked };
    };
    jsio.getCachedSrc = function(path) { return srcCache[path]; };

    jsio.__filename = 'jsio.js';
    jsio.__cmds = [];
    jsio.__jsio = jsio;
    jsio.__require = _require;
    jsio.__modules = {preprocessors:{}};
    var jsioPath = {
        set: function(path) {
          this.value = [];
          (typeof path == 'string' ? [path] : path).map(this.add, this);
        },
        get: function() { return jsioPath.value.slice(0); },
        add: function (path) {
          if (arguments.length == 2) {
            var from = arguments[0];
            var to = util.resolve(ENV.getCwd(), arguments[1]);
            this.cache[from] = to;
          } else {
            path = util.resolve(ENV.getCwd(), path);
            var v = jsioPath.value, len = v.length;
            for (var i = 0; i < len; ++i) {
              if (v[i] == path) { return; }
            }
            v.push(path);
          }
        },
        remove: function(path) {
          var v = jsioPath.value, len = v.length;
          for (var i = 0; i < len; ++i) {
            if (v[i] == path) {
              v.splice(i, 1);
            }
          }
        },
        value: [],
        cache: {}
      };

    jsio.path = jsioPath;
    jsio.addPath = util.bind(jsioPath, 'add');
    jsio.addCmd = util.bind(jsio.__cmds, 'push');

    jsio.setEnv = function(envCtor) {
      if (!envCtor && cloneFrom) {
        ENV = new cloneFrom.__env.constructor(util);
      } else {
        if (typeof envCtor == 'string') {
          envCtor = ({
              node: ENV_node,
              browser: ENV_browser
            })[envCtor] || ENV_browser;
        }

        ENV = new envCtor(util);
      }

      this.__env = ENV;
      this.__dir = ENV.getCwd();

      if (!ENV.loadModule) {
        ENV.loadModule = loadModule;
      }

      jsio.path.cache['jsio'] = cloneFrom ? cloneFrom.path.cache.jsio : ENV.getPath();
      if (envCtor == ENV_browser) {
        jsio.path.set(ENV.getPath());
      }
    };

    if (cloneFrom) {
      jsio.setEnv();
    } else if (typeof JSIO_ENV_CTOR !== 'undefined') {
      jsio.setEnv(JSIO_ENV_CTOR);
    } else if (typeof process !== 'undefined' && process.version) {
      jsio.setEnv('node');
    } else if (typeof XMLHttpRequest != 'undefined' || typeof ActiveXObject != 'undefined') {
      jsio.setEnv('browser');
    }

    jsio.main = ENV && ENV.main;

    var boundJsio;
    var localJsio = function (req) {
      if (!boundJsio) {
        boundJsio = util.bind(this, _require, {}, ENV.getPath(), 'jsio.js');
      }

      return boundJsio(req, {dontExport: true, dontPreprocess: true});
    };

    /*
    function ENV_abstract() {
      this.global = null;
      this.getCwd = function() {};
      this.getPath = function() {};
      this.eval = function(code, path) {};
      this.fetch = function(path) { return contentsOfPath; };
      this.log = function(args...) {};
    }
    */

    function ENV_node() {
      var Module = module.constructor;

      var parent = module.parent;
      var req = util.bind(parent, parent && parent.require || require);

      var fs = req('fs');
      var path = req('path');
      var vm = req('vm');

      this.requireCache = require.cache;
      this.main = require.main;
      this.name = 'node';
      this.global = global;
      this.isWindowsNode = (process.platform === 'win32');

      var _cwd = process.cwd();
      this.setCwd = function (cwd) { _cwd = path.resolve(_cwd, cwd); };
      this.getCwd = function () { return _cwd; };

      this.pathSep = path.sep;

      // var parentPath = util.splitPath(module.parent.filename);
      // module.parent.require = function(request, opts) {
      //   if (!opts) { opts = {}; }
      //   opts.dontExport = true;
      //   return _require({}, parentPath.directory, parentPath.filename, request, opts);
      // };

      this.log = function() {
        var msg;
        try {
          msg = Array.prototype.map.call(arguments, function(a) {
              if ((a instanceof Error) && a.message) {
                return 'Error:' + a.message + '\nStack:' + a.stack + '\nArguments:' + a.arguments;
              }
              return (typeof a == 'string' ? a : JSON.stringify(a));
            }).join(' ') + '\n';
        } catch(e) {
          msg = Array.prototype.join.call(arguments, ' ') + '\n';
        }

        process.stderr.write(msg);
        return msg;
      };

      this.getPath = function() {
        return __dirname;
      };

      this.eval = function (code, path) {
        return vm.runInThisContext(code, path, true);
      };

      this.fetch = function (p) {
        p = util.resolve(this.getCwd(), p);

        var filename, lowercaseFilename, files;
        try {
          var dirname = path.dirname(p);
          filename = path.basename(p);
          lowercaseFilename = filename.toLowerCase();
          files = fs.readdirSync(dirname);
        } catch (e) {
          return false;
        }

        for (var i = 0, testName; testName = files[i]; ++i) {
          if (testName.toLowerCase() == lowercaseFilename && testName != filename) {
            throw "Invalid case when importing [" + p + "].  You probably meant" + testName;
          }
        }

        try {
          return fs.readFileSync(p, 'utf8');
        } catch(e) {
          return false;
        }
      };

      var stackRe = /\((?!module.js)(?:file:\/\/)?(.*?)(:\d+)(:\d+)\)/g;
      this.loadModule = function (baseLoader, fromDir, fromFile, item, opts) {
        if (fromFile == INITIAL_FILE && !opts.initialImport) {
          var stack = new Error().stack;
          var match;
          stackRe.lastIndex = 0;
          do {
            match = stackRe.exec(stack);
          } while (match && /jsio\.js$/.test(match[1]));

          if (match) {
            fromDir = path.dirname(match[1]);
            fromFile = path.basename(match[1]);
          }
        }

        try {
          return baseLoader(null, fromDir, fromFile, item, opts);
        } catch(e) {
          if (e.code == MODULE_NOT_FOUND) {
            var require = req;
            // lookup node module for relative imports
            var module;
            var filename = path.join(fromDir, fromFile);
            module = this.requireCache[filename];
            if (!module) {
              module = new Module(filename);
              module.filename = filename;
              module.paths = Module._nodeModulePaths(path.dirname(filename));
            }
            var request = item.original || item.from;
            try {
              return {
                exports: module ? module.require(request) : require(request),
                path: item.from
              };
            } catch (e2) {
              if (e2.code == MODULE_NOT_FOUND) {
                throw e;
              }

              throw e2;
            }
          } else {
            throw e;
          }
        }
      };
    }

    function ENV_browser() {
      var XHR = window.XMLHttpRequest || function() { return new ActiveXObject("Msxml2.XMLHTTP"); },
        cwd = null,
        path = null,
        JOIN = Array.prototype.join;

      this.name = 'browser';
      this.global = window;
      this.pathSep = "/";

      if (!this.global.jsio) { this.global.jsio = jsio; }

      if (window.console && console.log) {
        if (!console.log.apply || /Android|iPhone|iPad|iPod/.test(navigator.userAgent)) {
          this.log = function () {
            var args = JOIN.call(arguments, ' ');
            console.log(args);
            return args;
          };
        } else {
          this.log = function () {
            console.log.apply(console, arguments);
            return JOIN.call(arguments, ' ');
          };
        }
      } else {
        this.log = function () { return JOIN.call(arguments, ' '); };
      }

      this.getCwd = function() {
        if(!cwd) {
          var loc = window.location, path = loc.pathname;
          cwd = loc.protocol + '//' + loc.host + path.substring(0, path.lastIndexOf('/') + 1);
        }
        return cwd;
      };

      this.getPath = function() {
        if(!path) {
          try {
            var filename = new RegExp('(.*?)' + jsio.__filename + '(\\?.*)?$'),
              scripts = document.getElementsByTagName('script');

            for (var i = 0, script; script = scripts[i]; ++i) {
              var result = script.src.match(filename);
              if (result) {
                path = result[1];
                if (/^[A-Za-z]*:\/\//.test(path)) { path = util.relative(this.getCwd(), path); }
                break;
              }
            }
          } catch(e) {}

          if(!path) { path = '.'; }
        }
        return path;
      };

      var debugHost = location.protocol + '//' + location.host + '/';
      var debugPath = location.pathname;
      this.debugPath = function (path) {
        return util.buildPath(debugHost, path[0] != '/' && debugPath, path);
      };

      // IE6 won't return an anonymous function from eval, so use the function constructor instead
      var rawEval = typeof eval('(function(){})') == 'undefined'
        ? function(src, path) { return (new Function('return ' + src))(); }
        : function(src, path) { var src = src + '\n//# sourceURL=' + path; return window.eval(src); };

      // provide an eval with reasonable debugging
      this.eval = function(code, path, origCode) {
        try {
          return rawEval(code, this.debugPath(path));
        } catch(e) {
          if(e instanceof SyntaxError) {
            if (DEBUG && this.checkSyntax) {
              this.checkSyntax(origCode, path);
            }
          }
          throw e;
        }
      };

      this.checkSyntax = function(code, path) {
        try {
          var syntax = jsio('import jsio.util.syntax', {suppressErrors: true, dontExport: true});
          syntax(code, path);
        } catch(e) {}
      };

      this.fetch = function(path) {
        var xhr = new XHR();
        try {
          xhr.open('GET', path, false);
          xhr.send(null);
        } catch(e) {
          ENV.log('e:', e);
          return false; // firefox file://
        }

        if (xhr.status == 404 || // all browsers, http://
          xhr.status == -1100 || // safari file://
          // XXX: We have no way to tell in opera if a file exists and is empty, or is 404
          // XXX: Use flash?
          //(!failed && xhr.status == 0 && !xhr.responseText && EXISTS)) // opera
          false)
        {
          return false;
        }

        return xhr.responseText;
      };
    };

    var failedFetch = {};

    function findModule(possibilities) {
      var src;
      for (var i = 0, possible; possible = possibilities[i]; ++i) {
        var path = possible.path,
          cachedVersion = srcCache[path];

        if (cachedVersion) {
          // extract a non-absolute dirname from the cache key: absolute paths
          // built into the cache are made relative during compile time since
          // absolute paths won't match between host and target device. Use
          // the cache key as the relative path so future imports can also
          // successfully lookup paths in the cache.
          var match = path.match(/^(.*\/)[^\\\/]+$/);
          possible.directory = match && match[1] || "";
          possible.src = cachedVersion.src;
          possible.pre = true;
          return possible;
        }

        /*if (/^\.\//.test(path)) {
          // remove one path segment for each dot from the cwd
          path = addEndSlash(ENV.getCwd()) + path;
        }*/

        src = ENV.fetch(path);

        if (src !== false) {
          possible.src = src;
          return possible;
        } else {
          failedFetch[path] = true;
        }
      }

      return false;
    }

    function processStack() {
      return importStack.map(function (item, index) {
        var stack = index == 0 ? new Error().stack : importStack[index - 1].stack;
        var i = stack.indexOf(item.path);
        if (i >= 0) {
          item.line = ':' + parseInt(stack.substring(i + item.path.length + 1));
        }

        return (index + 1) + ': "' + item.friendlyPath + '" ' + item.path + (item.line || '');
      });
    }

    // load a module from a file
    function loadModule (baseLoader, fromDir, fromFile, item, opts) {
      var modulePath = item.from;
      var possibilities = util.resolveModulePath(modulePath, fromDir);
      for (var i = 0, p; p = possibilities[i]; ++i) {
        var path = possibilities[i].path;
        if (!opts.reload && (path in jsio.__modules)) {
          return possibilities[i];
        }

        if (path in failedFetch) { possibilities.splice(i--, 1); }
      }

      if (!possibilities.length) {
        if (opts.suppressErrors) { return false; }
        var e = new Error('Could not import `' + item.from + '`'
            + "\tImport Stack:\n"
            + "\t\t" + processStack().join("\n\t\t"));
        e.jsioLogged = true;
        e.code = MODULE_NOT_FOUND;
        throw e;
      }

      var moduleDef = findModule(possibilities);
      if (!moduleDef) {
        if (opts.suppressErrors) { return false; }
        var paths = [];
        for (var i = 0, p; p = possibilities[i]; ++i) { paths.push(p.path); }
        var e = new Error("Could not import `" + modulePath + "`\n"
          + "\tlooked in:\n"
            + "\t\t" + paths.join('\n\t\t') + "\n"
            + "\tImport Stack:\n"
            + "\t\t" + processStack().join("\n\t\t"));
        e.code = MODULE_NOT_FOUND;
        throw e;
      }

      // a (potentially) nicer way to refer to a module -- how it was referenced in code when it was first imported
      moduleDef.friendlyPath = modulePath;

      // cache the base module's path in the path cache so we don't have to
      // try out all paths the next time we see the same base module.
      if (moduleDef.baseMod && !(moduleDef.baseMod in jsioPath.cache)) {
        jsioPath.cache[moduleDef.baseMod] = moduleDef.basePath;
      }

      // don't apply the standard preprocessors to base.js.  If we're reloading
      // the source code, always apply them.  We also don't want to run them
      // if they've been run once -- moduleDef.pre is set to true already
      // if we're reading the code from the source cache.
      if (modulePath != 'base' && (opts.reload || !opts.dontPreprocess && !moduleDef.pre)) {
        moduleDef.pre = true;

        applyPreprocessors(fromDir, moduleDef, ["import", "inlineSlice"], opts);
      }

      // any additional preprocessors?
      if (opts.preprocessors) {
        applyPreprocessors(fromDir, moduleDef, opts.preprocessors, opts);
      }

      return moduleDef;
    }

    function applyPreprocessors(path, moduleDef, names, opts) {
      for (var i = 0, len = names.length; i < len; ++i) {
        var p = getPreprocessor(names[i]);

        // if we have a recursive import and p isn't a function, just
        // skip it (handles the case where a preprocessor imports
        // other modules).
        if (p && typeof p == 'function') {
          p(path, moduleDef, opts);
        }
      }
    }

    function getPreprocessor(name) {
      var module = jsio.__modules['jsio.preprocessors.' + name];
      return typeof name == 'function'
        ? name
        : (module && module.exports
          || localJsio('import jsio.preprocessors.' + name));
    }

    function execModuleDef(context, moduleDef) {
      var src = moduleDef.src;
      delete moduleDef.src;

      var code = "(function(_){with(_){delete _;return function $$" + moduleDef.friendlyPath.replace(/[\:\\\/.-]/g, '_') + "(){" + src + "\n}}})";

      var exports = moduleDef.exports = context.exports;

      var fn = ENV.eval(code, moduleDef.path, src);
      fn = fn(context);

      fn.call(exports);

      if (exports != context.module.exports) {
        // Emulate node.js-style ability to reassign module.exports:
        //   module.exports = ...
        //
        // Note that in node.js and js.io, setting `module.exports` invalidates
        // the context's `exports` alias. See
        // http://nodejs.org/api/modules.html#modules_exports_alias for more
        moduleDef.exports = context.module.exports;
      } else {
        // js.io-style ability to override exports directly (`exports = `)
        moduleDef.exports = context.exports;
      }
    }

    function resolveImportRequest(context, request, opts) {
      var cmds = jsio.__cmds,
        imports = [],
        result = false;

      for (var i = 0, imp; imp = cmds[i]; ++i) {
        if ((result = imp(context, request, opts, imports))) { break; }
      }

      if (result !== true) {
        throw new (typeof SyntaxError != 'undefined' ? SyntaxError : Error)(String(result || 'invalid jsio command: jsio(\'' + request + '\')'));
      }

      return imports;
    }

    function makeContext(ctx, modulePath, moduleDef, dontAddBase) {
      if (!ctx) { ctx = {}; }
      if (!ctx.exports) { ctx.exports = {}; }

      ctx.jsio = util.bind(this, _require, ctx, moduleDef.directory, moduleDef.filename);
      ctx.require = function(request, opts) {
        if (!opts) { opts = {}; }
        opts.dontExport = true;
        return ctx.jsio(request, opts);
      };

      ctx.require.main = ENV.main;

      ctx.module = {id: modulePath, exports: ctx.exports};
      if (!dontAddBase && modulePath != 'jsio.base') {
        ctx.jsio('from jsio.base import *', {dontPreprocess: true});
        ctx.logging.__create(modulePath, ctx);
      }

      // TODO: FIX for "trailing ." case
      ctx.jsio.__jsio = jsio;
      ctx.jsio.__env = jsio.__env;
      ctx.jsio.__dir = moduleDef.directory;
      ctx.jsio.__filename = moduleDef.filename;
      ctx.jsio.path = jsioPath;

      ctx.__dirname = moduleDef.directory;
      ctx.__filename = util.buildPath(ctx.__dirname, moduleDef.filename);
      return ctx;
    }

    var importStack = [];
    function _require(boundContext, fromDir, fromFile, request, opts) {
      opts = opts || {};
      fromDir = fromDir || './';
      fromFile = fromFile || INITIAL_FILE;

      // require is bound to a module's (or global) context -- we can override this
      // by using opts.exportInto
      var exportInto = opts.exportInto || boundContext || ENV.global;

      // parse the import request(s)
      var imports = resolveImportRequest(exportInto, request, opts),
        numImports = imports.length,
        retVal = numImports > 1 ? {} : null;

      // import each requested item
      for (var i = 0; i < numImports; ++i) {
        var item = imports[i];
        var modulePath = item.from;
        var modules = jsio.__modules;
        var path;
        var moduleDef;
        var err;

        try {
          moduleDef = jsio.__env.loadModule(loadModule, fromDir, fromFile, item, opts);
        } catch(e) {
          err = e;
        }

        if (moduleDef) {
          path = moduleDef.path;
        } else if (moduleDef === false) {
          return false;
        }

        if (err) {
          if (opts.suppressErrors) { return false; }
          if (!err.jsioLogged) {
            ENV.log(
              '\nError loading module:\n',
              '    [[', request, ']]\n',
              '    requested by:', fromDir + fromFile, '\n',
              '    current directory:', jsio.__env.getCwd(), '\n',
              '  ' + err.stack.split('\n').join('\n  '));
            err.jsioLogged = true;
          }

          throw err;
        }

        if (moduleDef) {
          importStack.push({
            friendlyPath: moduleDef.friendlyPath,
            path: moduleDef.path,
            stack: new Error().stack
          });
        }

        // eval any packages that we don't know about already
        if (!(path in modules)) {
          modules[path] = moduleDef;
        }

        if (!moduleDef.exports) {
          var newContext = makeContext(opts.context, modulePath, moduleDef, item.dontAddBase);
          if (item.dontUseExports) {
            var src = [';(function(){'], k = 1;
            for (var j in item['import']) {
              newContext.exports[j] = undefined;
              src[k++] = 'if(typeof '+j+'!="undefined"&&exports.'+j+'==undefined)exports.'+j+'='+j+';';
            }
            src[k] = '})();';
            moduleDef.src += src.join('');
          }

          execModuleDef(newContext, moduleDef);
        }

        importStack.pop();

        var module = moduleDef.exports;

        // return the module if we're only importing one module
        if (numImports == 1) { retVal = module; }

        if (!opts.dontExport) {
          // add the module to the current context
          if (item.as) {
            // remove trailing/leading dots
            var as = item.as.match(/^\.*(.*?)\.*$/)[1],
              segments = as.split('.'),
              kMax = segments.length - 1,
              c = exportInto;

            // build the object in the context
            for(var k = 0; k < kMax; ++k) {
              var segment = segments[k];
              if (!segment) continue;
              if (!c[segment]) { c[segment] = {}; }
              c = c[segment];
            }

            c[segments[kMax]] = module;

            // there can be multiple module imports with this syntax (import foo, bar)
            if (numImports > 1) {
              retVal[as] = module;
            }
          } else if (item['import']) {
            // there can only be one module import with this syntax
            // (from foo import bar), so retVal will already be set here
            if (item['import']['*']) {
              for (var k in modules[path].exports) { exportInto[k] = module[k]; }
            } else {
              for (var k in item['import']) { exportInto[item['import'][k]] = module[k]; }
            }
          }
        }
      }

      return retVal;
    }

    // DEFINE SYNTAX FOR JSIO('cmd')

    // from myPackage import myFunc
    // external myPackage import myFunc
    jsio.addCmd(function(context, request, opts, imports) {
      var match = request.match(/^\s*(from|external)\s+([\w.\-$]+)\s+(import|grab)\s+(.*)$/);
      if(match) {
        imports.push({
          from: match[2],
          dontAddBase: match[1] == 'external',
          dontUseExports: match[3] == 'grab' || match[1] == 'external',
          'import': {}
        });

        match[4].replace(/\s*([\w.\-$*]+)(?:\s+as\s+([\w.\-$]+))?/g, function(_, item, as) {
          imports[0]['import'][item] = as || item;
        });
        return true;
      }
    });

    // import myPackage
    jsio.addCmd(function(context, request, opts, imports) {
      var match = request.match(/^\s*import\s+(.*)$/);
      if (match) {
        match[1].replace(/\s*([\w.\-$]+)(?:\s+as\s+([\w.\-$]+))?,?/g, function(_, fullPath, as) {
          imports.push(
            as ? {
              from: fullPath,
              as: as
            } : {
              from: fullPath,
              as: fullPath
            });
        });
        return true;
      }
    });

    // CommonJS syntax
    jsio.addCmd(function(context, request, opts, imports) {

      //    ./../b -> ..b
      //    ../../b -> ...b
      //    ../b -> ..b
      //    ./b -> .b

      var match = request.match(/^\s*[\w.0-9$\/\-:\\]+\s*$/);
      if (match) {

        var req = util.resolveRelativePath(match[0]),
          isRelative = req.charAt(0) == '.';

        req = req
          // .replace(/^\//, '') // remove any leading slash
          .replace(/\.\.\//g, '.') // replace relative path indicators with dots
          .replace(/\.\//g, '')
          .replace(/\/+$/g, '');

        if (ENV.pathSep === '\\' && req.match(/^[a-zA-Z]:.*/)) {
          // leave absolute windows paths (start with drive letter) alone
        } else {
          // any remaining slashes are path separators
         req = req.replace(/\//g, '.');
        }

        imports[0] = { from: (isRelative ? '.' : '') + req, original: request };
        return true;
      }
    });

    jsio.install = function() {
      jsio('from .base import *');
      GLOBAL['logger'] = logging.get('jsiocore');
    };

    jsio.eval = function (src, path) {
      path = ENV.getCwd() || '/';
      var moduleDef = new ModuleDef(path);
      moduleDef.src = src;
      applyPreprocessors(path, moduleDef, ["import", "cls"], {});
      execModuleDef(ENV.global, moduleDef);
    };

    jsio.clone = util.bind(null, init, jsio);

    // in node, defines jsio as a module that can be imported
    var moduleInfo = util.resolveModulePath('jsio')[0];
    if (moduleInfo) {
      jsio.__modules[moduleInfo.path] = new ModuleDef(moduleInfo.path);
      jsio.__modules[moduleInfo.path].exports = jsio;
    }

    return jsio;
  })();jsio.path.set(["modules/devkit-core/node_modules/jsio/packages","","lib","modules/devkit-core/src/clientapi/api","modules/devkit-core/modules/timestep/src"]);jsio.path.cache={"jsio":"modules/devkit-core/node_modules/jsio/packages","devkit":"modules/devkit-core/src/clientapi","squill":"modules/devkit-core/modules/squill","Promise":"modules/devkit-core/src/clientapi/api/Promise","platforms":"modules/devkit-core/modules/timestep/src/platforms","std":"modules/devkit-core/node_modules/jsio/packages/std","util":"modules/devkit-core/node_modules/jsio/packages/util","lib":"modules/devkit-core/node_modules/jsio/packages/lib","device":"modules/devkit-core/modules/timestep/src/device","userAgent":"modules/devkit-core/modules/timestep/src/userAgent","event":"modules/devkit-core/modules/timestep/src/event","ui":"modules/devkit-core/modules/timestep/src/ui","animate":"modules/devkit-core/modules/timestep/src/animate","timer":"modules/devkit-core/modules/timestep/src/timer","ObjectPool":"modules/devkit-core/modules/timestep/src/ObjectPool","math":"modules/devkit-core/node_modules/jsio/packages/math","AudioManager":"modules/devkit-core/modules/timestep/src/AudioManager","cache":"modules/devkit-core/modules/timestep/src/cache","src":"src"};jsio.setCache({"modules/devkit-core/node_modules/jsio/packages/base.js":{"path":"modules/devkit-core/node_modules/jsio/packages/base.js","friendlyPath":"jsio.base","directory":"modules/devkit-core/node_modules/jsio/packages/","filename":"base.js","src":"/**\n * base.js\n * This file contains all global functions provided by js.io.\n */\n\nexports.log = jsio.__env.log;\nexports.GLOBAL = jsio.__env.global;\n\n/**\n * Various polyfill methods to ensure js.io implementations provide\n * a baseline of JavaScript functionality. Feature compatibility (localStorage,\n * etc.) should be provided elsewhere.\n */\n\n// Array.isArray\n// Not available before ECMAScript 5.\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/isArray\n\nif (!Array.isArray) {\n\tArray.isArray = function (arg) {\n\t\treturn Object.prototype.toString.call(arg) === '[object Array]';\n\t}\n};\n\n// Function.prototype.bind\n// Not available before ECMAScript 5.\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Function/bind\n\nif (!Function.prototype.bind) {\n  Function.prototype.bind = function (oThis) {\n    if (typeof this !== \"function\") {\n      // closest thing possible to the ECMAScript 5 internal IsCallable function\n      throw new TypeError(\"Function.prototype.bind - what is trying to be bound is not callable\");\n    }\n\n    var aArgs = Array.prototype.slice.call(arguments, 1),\n        fToBind = this,\n        fNOP = function () {},\n        fBound = function () {\n          return fToBind.apply(this instanceof fNOP\n                                 ? this\n                                 : oThis,\n                               aArgs.concat(Array.prototype.slice.call(arguments)));\n        };\n\n    fNOP.prototype = this.prototype;\n    fBound.prototype = new fNOP();\n\n    return fBound;\n  };\n}\n\n/**\n * DEPRECATED. Old js.io polyfills.\n */\n\nvar SLICE = Array.prototype.slice;\n\n/* Use native isArray if available\n */\nif (typeof Array.isArray === 'function') {\n\texports.isArray = Array.isArray;\n} else {\n\texports.isArray = function (obj) {\n\t\treturn Object.prototype.toString.call(obj) === '[object Array]';\n\t}\n}\n\nexports.bind = function(context, method /*, VARGS*/) {\n\tif(arguments.length > 2) {\n\t\tvar args = SLICE.call(arguments, 2);\n\t\treturn typeof method == 'string'\n\t\t\t? function __bound() {\n\t\t\t\tif (context[method]) {\n\t\t\t\t\treturn context[method].apply(context, args.concat(SLICE.call(arguments, 0)));\n\t\t\t\t} else {\n\t\t\t\t\tthrow logger.error('No method:', method, 'for context', context);\n\t\t\t\t}\n\t\t\t}\n\t\t\t: function __bound() { return method.apply(context, args.concat(SLICE.call(arguments, 0))); }\n\t} else {\n\t\treturn typeof method == 'string'\n\t\t\t? function __bound() {\n\t\t\t\tif (context[method]) {\n\t\t\t\t\treturn context[method].apply(context, arguments);\n\t\t\t\t} else {\n\t\t\t\t\tthrow logger.error('No method:', method, 'for context', context);\n\t\t\t\t}\n\t\t\t}\n\t\t\t: function __bound() { return method.apply(context, arguments); }\n\t}\n}\n\n/**\n * Class constructor.\n */\n\nexports.Class = function(name, parent, proto) {\n\treturn exports.__class__(function() { return this.init && this.init.apply(this, arguments); }, name, parent, proto);\n}\n\nexports.__class__ = function (cls, name, parent, proto) {\n\tvar clsProto = function () {};\n\tvar logger;\n\n\tif (typeof name != 'string') {\n\t\tproto = parent;\n\t\tparent = name;\n\t\tname = null;\n\t}\n\n\tif (name) {\n\t\tlogger = exports.logging.get(name);\n\t}\n\n\tif (!parent) { throw new Error('parent or prototype not provided'); }\n\tif (!proto) { proto = parent; parent = null; }\n\n\tif (parent) {\n\t\tif (exports.isArray(parent)) { // multiple inheritance, use at your own risk =)\n\t\t\tclsProto.prototype = {};\n\t\t\tfor(var i = 0, p; p = parent[i]; ++i) {\n\t\t\t\tif (p == Error && ErrorParentClass) { p = ErrorParentClass; }\n\t\t\t\tfor (var item in p.prototype) {\n\t\t\t\t\tif (!(item in clsProto.prototype)) {\n\t\t\t\t\t\tclsProto.prototype[item] = p.prototype[item];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tparent = parent[0];\n\t\t} else {\n\t\t\tif (parent == Error && ErrorParentClass) { parent = ErrorParentClass; }\n\t\t\tclsProto.prototype = parent.prototype;\n\t\t}\n\t}\n\n\tvar supr = parent ? function(context, method, args) {\n\t\t\tvar f = parent.prototype[method];\n\t\t\tif (!f) { throw new Error('method ' + method + ' does not exist'); }\n\t\t\treturn f.apply(context, args || []);\n\t\t} : null;\n\n\tvar p = cls.prototype = new clsProto();\n\tp.constructor = cls;\n\tp.__parentClass__ = parent;\n\tif (name) { p.__class__ = name; }\n\tproto.call(p, logger || supr, logger && supr);\n\treturn cls;\n}\n\nvar ErrorParentClass = exports.__class__(function ErrorCls() {\n\t\tvar err = Error.prototype.constructor.apply(this, arguments);\n\t\tfor (var prop in err) {\n\t\t\tif (err.hasOwnProperty(prop)) {\n\t\t\t\tthis[prop] = err[prop];\n\t\t\t}\n\t\t}\n\t}, function() {});\n\n/**\n * Merge two objects together.\n */\n\nexports.Class.defaults =\nexports.merge = function(base, extra) {\n\tbase = base || {};\n\n\tfor (var i = 1, len = arguments.length; i < len; ++i) {\n\t\tvar copyFrom = arguments[i];\n\t\tfor (var key in copyFrom) {\n\t\t\tif (copyFrom.hasOwnProperty(key) && !base.hasOwnProperty(key)) {\n\t\t\t\tbase[key] = copyFrom[key];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn base;\n}\n\n/**\n * Create a timer delay.\n */\n\nexports.delay = function(orig, timeout) {\n\tvar _timer = null;\n\tvar ctx, args;\n\tvar f = function() { orig.apply(ctx, args); }\n\treturn function() {\n\t\tctx = this;\n\t\targs = arguments;\n\t\tif (_timer) { clearTimeout(_timer); }\n\t\t_timer = setTimeout(f, timeout || 0);\n\t}\n}\n\n/**\n * Log constructor and default \"logger\".\n */\n\nexports.logging = (function() {\n\n\t// logging namespace, this is what is exported\n\tvar logging = {\n\t\t\tDEBUG: 1,\n\t\t\tLOG: 2,\n\t\t\tINFO: 3,\n\t\t\tWARN: 4,\n\t\t\tERROR: 5,\n\t\t\tNONE: 10\n\t\t};\n\n\tvar _loggers = {}; // all loggers\n\tvar _production = false;\n\tvar _prefix = '';\n\n\tlogging.setPrefix = function(prefix) { _prefix = prefix + ' '; }\n\n\tlogging.setProduction = function(prod) {\n\t\t_production = !!prod;\n\t\tfor (var key in _loggers) {\n\t\t\t_loggers[key].setProduction(_production);\n\t\t}\n\t}\n\n\tlogging.get = function(name) {\n\t\tvar logger = name in _loggers ? _loggers[name] :\n\t\t\t(_loggers[name] = new Logger(name));\n\t\tlogger.setProduction(_production);\n\t\treturn logger;\n\t}\n\n\tlogging.set = function(name, logger) {\n\t\t_loggers[name] = logger;\n\t}\n\n\tlogging.getAll = function() { return _loggers; }\n\n\tlogging.__create = function(pkg, ctx) { ctx.logger = logging.get(pkg); }\n\n\tvar Logger = exports.__class__(\n\t\tfunction Logger(name, level) {\n\t\t\tthis._name = name;\n\t\t\tthis._isProduction = _production;\n\n\t\t\tthis.setLevel(level || logging.LOG);\n\t\t},\n\t\tfunction () {\n\t\t\tthis.setProduction = function (isProduction) {\n\t\t\t\tthis._isProduction = isProduction;\n\t\t\t\tisProduction && this.setLevel(logging.NONE);\n\t\t\t}\n\n\t\t\tthis.setLevel = function(level) {\n\t\t\t\tthis._level = level;\n\n\t\t\t\tif (this._isProduction) {\n\t\t\t\t\tlevel = logging.NONE;\n\t\t\t\t}\n\n\t\t\t\tthis.DEBUG = level <= logging.DEBUG;\n\t\t\t\tthis.LOG   = level <= logging.LOG;\n\t\t\t\tthis.INFO  = level <= logging.INFO;\n\t\t\t\tthis.WARN  = level <= logging.WARN;\n\t\t\t\tthis.ERROR = level <= logging.ERROR;\n\t\t\t}\n\n\t\t\tfunction makeLogger(type) {\n\t\t\t\tvar level = logging[type];\n\t\t\t\treturn function() {\n\t\t\t\t\tif (!this._isProduction && level >= this._level) {\n\t\t\t\t\t\tvar prefix = type + ' ' + _prefix + this._name;\n\t\t\t\t\t\tvar listener = this._listener || exports.log;\n\n\t\t\t\t\t\treturn listener && listener.apply(this._listener, [prefix].concat(SLICE.call(arguments)));\n\t\t\t\t\t}\n\t\t\t\t\treturn arguments[0];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setListener = function(listener) { this._listener = listener; }\n\n\t\t\tthis.debug = makeLogger(\"DEBUG\");\n\t\t\tthis.log = makeLogger(\"LOG\");\n\t\t\tthis.info = makeLogger(\"INFO\");\n\t\t\tthis.warn = makeLogger(\"WARN\");\n\t\t\tthis.error = makeLogger(\"ERROR\");\n\t\t});\n\n\treturn logging;\n})();\n\nvar logger = exports.logging.get('jsiocore');\n\n","pre":true},"modules/devkit-core/src/clientapi/native/launchClient.js":{"path":"modules/devkit-core/src/clientapi/native/launchClient.js","friendlyPath":"devkit.native.launchClient","directory":"modules/devkit-core/src/clientapi/native/","filename":"launchClient.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/* globals jsio, logging, logger, CONFIG, DEBUG */\n\nvar env = jsio.__env;\nenv.debugPath = function (path) {\n  var protocol = 'http:';\n  var domain = env.name == 'android' ? CONFIG.packageName : CONFIG.bundleID;\n  return protocol + '//' + domain + '/' + path.replace(/^[.\\/\\\\]+/, '');\n};\n\nGLOBAL.console = logging.get('console');\nwindow.self = window;\n\n// add bluebird promise implementation to global scope\njsio('import Promise');\nGLOBAL.Promise = Promise;\n\n// initialize native JS API wrappers\njsio('import platforms.native.initialize');\n\njsio('import device');\ndevice.init();\n\njsio('import .common');\ncommon.install();\n\nstartApp();\n\n/**\n * Anonymous statistics, this information helps us improve the DevKit by\n * providing us information about which versions are out there.\n *\n * You can remove this or replace it with your own analytics if you like.\n */\nfunction analytics () {\n  var config = GLOBAL.CONFIG;\n  var params = 'appID:' + encodeURIComponent(config.appID || '') + '&' +\n      'bundleID:' + encodeURIComponent(config.bundleID || '') + '&' +\n      'appleID:' + encodeURIComponent(config.appleID || '') + '&' +\n      'version:' + encodeURIComponent(config.version || '') + '&' +\n      'sdkVersion:' + encodeURIComponent(config.sdkVersion || '') + '&' +\n      'isAndroid:' + (device.isAndroid ? 1 : 0) + '&' +\n      'isIOS:' + (device.isIOS ? 1 : 0);\n\n  var xhr = new XMLHttpRequest();\n  xhr.open('GET', 'http://www.gameclosure.com/analytics?' + params, true);\n  xhr.send();\n}\n\nfunction startApp() {\n  jsio('import devkit');\n  GLOBAL.GC = new devkit.ClientAPI();\n\n  analytics();\n  GLOBAL.GC.buildApp('launchUI');\n}\n\n","pre":true},"modules/devkit-core/src/clientapi/api/Promise.js":{"path":"modules/devkit-core/src/clientapi/api/Promise.js","friendlyPath":"Promise","directory":"modules/devkit-core/src/clientapi/api/","filename":"Promise.js","baseMod":"Promise","basePath":"/Users/marcelo.hashimoto/Desktop/gamedev/ElementalMatch3/modules/devkit-core/src/clientapi/api/Promise","src":"/* @preserve\n * The MIT License (MIT)\n *\n * Copyright (c) 2014 Petka Antonov\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\n/**\n * bluebird build version 2.9.6\n * Features enabled: core, map, nodeify, promisify, reduce, progress, cancel, filter, each, timers\n * Features disabled: race, call_get, generators, props, settle, some, using, any\n*/\n!function(e){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=e();else if(\"function\"==typeof define&&define.amd)define([],e);else{var f;\"undefined\"!=typeof window?f=window:\"undefined\"!=typeof global?f=global:\"undefined\"!=typeof self&&(f=self),f.Promise=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof _dereq_==\"function\"&&_dereq_;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof _dereq_==\"function\"&&_dereq_;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){\n\"use strict\";\nvar firstLineError;\ntry {throw new Error(); } catch (e) {firstLineError = e;}\nvar schedule = _dereq_(\"./schedule.js\");\nvar Queue = _dereq_(\"./queue.js\");\nvar _process = typeof process !== \"undefined\" ? process : undefined;\n\nfunction Async() {\n    this._isTickUsed = false;\n    this._lateQueue = new Queue(16);\n    this._normalQueue = new Queue(16);\n    var self = this;\n    this.drainQueues = function () {\n        self._drainQueues();\n    };\n    this._schedule =\n        schedule.isStatic ? schedule(this.drainQueues) : schedule;\n}\n\nAsync.prototype.haveItemsQueued = function () {\n    return this._normalQueue.length() > 0;\n};\n\nAsync.prototype._withDomain = function(fn) {\n    if (_process !== undefined &&\n        _process.domain != null &&\n        !fn.domain) {\n        fn = _process.domain.bind(fn);\n    }\n    return fn;\n};\n\nAsync.prototype.throwLater = function(fn, arg) {\n    if (arguments.length === 1) {\n        arg = fn;\n        fn = function () { throw arg; };\n    }\n    fn = this._withDomain(fn);\n    if (typeof setTimeout !== \"undefined\") {\n        setTimeout(function() {\n            fn(arg);\n        }, 0);\n    } else try {\n        this._schedule(function() {\n            fn(arg);\n        });\n    } catch (e) {\n        throw new Error(\"No async scheduler available\\u000a\\u000a    See http://goo.gl/m3OTXk\\u000a\");\n    }\n};\n\nAsync.prototype.invokeLater = function (fn, receiver, arg) {\n    fn = this._withDomain(fn);\n    this._lateQueue.push(fn, receiver, arg);\n    this._queueTick();\n};\n\nAsync.prototype.invokeFirst = function (fn, receiver, arg) {\n    fn = this._withDomain(fn);\n    this._normalQueue.unshift(fn, receiver, arg);\n    this._queueTick();\n};\n\nAsync.prototype.invoke = function (fn, receiver, arg) {\n    fn = this._withDomain(fn);\n    this._normalQueue.push(fn, receiver, arg);\n    this._queueTick();\n};\n\nAsync.prototype.settlePromises = function(promise) {\n    this._normalQueue._pushOne(promise);\n    this._queueTick();\n};\n\nAsync.prototype._drainQueue = function(queue) {\n    while (queue.length() > 0) {\n        var fn = queue.shift();\n        if (typeof fn !== \"function\") {\n            fn._settlePromises();\n            continue;\n        }\n        var receiver = queue.shift();\n        var arg = queue.shift();\n        fn.call(receiver, arg);\n    }\n};\n\nAsync.prototype._drainQueues = function () {\n    this._drainQueue(this._normalQueue);\n    this._reset();\n    this._drainQueue(this._lateQueue);\n};\n\nAsync.prototype._queueTick = function () {\n    if (!this._isTickUsed) {\n        this._isTickUsed = true;\n        this._schedule(this.drainQueues);\n    }\n};\n\nAsync.prototype._reset = function () {\n    this._isTickUsed = false;\n};\n\nmodule.exports = new Async();\nmodule.exports.firstLineError = firstLineError;\n\n},{\"./queue.js\":24,\"./schedule.js\":26}],2:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL, tryConvertToPromise) {\nfunction returnThis() { return this.value; }\nfunction throwThis() { throw this.reason; }\nfunction awaitBindingThenResolve(value) {\n    return this._then(returnThis, null, null, {value: value}, undefined);\n}\nfunction awaitBindingThenReject(reason) {\n    return this._then(throwThis, throwThis, null, {reason: reason}, undefined);\n}\nfunction setBinding(binding) { this._setBoundTo(binding); }\nPromise.prototype.bind = function (thisArg) {\n    var maybePromise = tryConvertToPromise(thisArg);\n    if (maybePromise instanceof Promise) {\n        if (maybePromise.isFulfilled()) {\n            thisArg = maybePromise.value();\n        } else if (maybePromise.isRejected()) {\n            return Promise.reject(maybePromise.reason());\n        } else {\n            var ret = this.then();\n            var parent = ret;\n            ret = ret._then(awaitBindingThenResolve,\n                            awaitBindingThenReject,\n                            null, maybePromise, undefined);\n            maybePromise._then(setBinding, ret._reject, null, ret, null);\n            if (!ret._cancellable()) ret._setPendingCancellationParent(parent);\n            return ret;\n        }\n    }\n    var ret = this.then();\n    ret._setBoundTo(thisArg);\n    return ret;\n};\n\nPromise.bind = function (thisArg, value) {\n    return Promise.resolve(value).bind(thisArg);\n};\n\nPromise.prototype._setPendingCancellationParent = function(parent) {\n    this._settledValue = parent;\n};\n\nPromise.prototype._pendingCancellationParent = function() {\n    if (this.isPending() && this._settledValue !== undefined) {\n        var ret = this._settledValue;\n        ret.cancellable();\n        this._settledValue = undefined;\n        return ret;\n    }\n};\n\nPromise.prototype._setIsMigratingBinding = function () {\n    this._bitField = this._bitField | 8388608;\n};\n\nPromise.prototype._unsetIsMigratingBinding = function () {\n    this._bitField = this._bitField & (~8388608);\n};\n\nPromise.prototype._isMigratingBinding = function () {\n    return (this._bitField & 8388608) === 8388608;\n};\n\nPromise.prototype._setBoundTo = function (obj) {\n    this._boundTo = obj;\n};\n\nPromise.prototype._isBound = function () {\n    return this._boundTo !== undefined;\n};\n};\n\n},{}],3:[function(_dereq_,module,exports){\n\"use strict\";\nvar old;\nif (typeof Promise !== \"undefined\") old = Promise;\nfunction noConflict() {\n    try { if (Promise === bluebird) Promise = old; }\n    catch (e) {}\n    return bluebird;\n}\nvar bluebird = _dereq_(\"./promise.js\")();\nbluebird.noConflict = noConflict;\nmodule.exports = bluebird;\n\n},{\"./promise.js\":20}],4:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise) {\nvar errors = _dereq_(\"./errors.js\");\nvar async = _dereq_(\"./async.js\");\nvar CancellationError = errors.CancellationError;\n\nPromise.prototype._cancel = function (reason) {\n    if (!this.isCancellable()) return this;\n    var parent;\n    var promiseToReject = this;\n    while ((parent = promiseToReject._cancellationParent) !== undefined &&\n        parent.isCancellable()) {\n        promiseToReject = parent;\n    }\n    this._unsetCancellable();\n    promiseToReject._target()._rejectCallback(reason, false, true);\n};\n\nPromise.prototype.cancel = function (reason) {\n    if (!this.isCancellable()) return this;\n    if (reason === undefined) reason = new CancellationError();\n    async.invokeLater(this._cancel, this, reason);\n    return this;\n};\n\nPromise.prototype.cancellable = function () {\n    if (this._cancellable()) return this;\n    this._setCancellable();\n    this._cancellationParent = this._pendingCancellationParent();\n    return this;\n};\n\nPromise.prototype.uncancellable = function () {\n    var ret = this.then();\n    ret._unsetCancellable();\n    return ret;\n};\n\nPromise.prototype.fork = function (didFulfill, didReject, didProgress) {\n    var ret = this._then(didFulfill, didReject, didProgress,\n                         undefined, undefined);\n\n    ret._setCancellable();\n    ret._cancellationParent = undefined;\n    return ret;\n};\n};\n\n},{\"./async.js\":1,\"./errors.js\":11}],5:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function() {\nvar async = _dereq_(\"./async.js\");\nvar util = _dereq_(\"./util.js\");\nvar bluebirdFramePattern =\n    /[\\\\\\/]bluebird[\\\\\\/]js[\\\\\\/](main|debug|zalgo|instrumented)/;\nvar stackFramePattern = null;\nvar formatStack = null;\nvar indentStackFrames = false;\n\nfunction CapturedTrace(parent) {\n    this._parent = parent;\n    var length = this._length = 1 + (parent === undefined ? 0 : parent._length);\n    captureStackTrace(this, CapturedTrace);\n    if (length > 32) this.uncycle();\n}\nutil.inherits(CapturedTrace, Error);\n\nCapturedTrace.prototype.uncycle = function() {\n    var length = this._length;\n    if (length < 2) return;\n    var nodes = [];\n    var stackToIndex = {};\n\n    for (var i = 0, node = this; node !== undefined; ++i) {\n        nodes.push(node);\n        node = node._parent;\n    }\n    length = this._length = i;\n    for (var i = length - 1; i >= 0; --i) {\n        var stack = nodes[i].stack;\n        if (stackToIndex[stack] === undefined) {\n            stackToIndex[stack] = i;\n        }\n    }\n    for (var i = 0; i < length; ++i) {\n        var currentStack = nodes[i].stack;\n        var index = stackToIndex[currentStack];\n        if (index !== undefined && index !== i) {\n            if (index > 0) {\n                nodes[index - 1]._parent = undefined;\n                nodes[index - 1]._length = 1;\n            }\n            nodes[i]._parent = undefined;\n            nodes[i]._length = 1;\n            var cycleEdgeNode = i > 0 ? nodes[i - 1] : this;\n\n            if (index < length - 1) {\n                cycleEdgeNode._parent = nodes[index + 1];\n                cycleEdgeNode._parent.uncycle();\n                cycleEdgeNode._length =\n                    cycleEdgeNode._parent._length + 1;\n            } else {\n                cycleEdgeNode._parent = undefined;\n                cycleEdgeNode._length = 1;\n            }\n            var currentChildLength = cycleEdgeNode._length + 1;\n            for (var j = i - 2; j >= 0; --j) {\n                nodes[j]._length = currentChildLength;\n                currentChildLength++;\n            }\n            return;\n        }\n    }\n};\n\nCapturedTrace.prototype.parent = function() {\n    return this._parent;\n};\n\nCapturedTrace.prototype.hasParent = function() {\n    return this._parent !== undefined;\n};\n\nCapturedTrace.prototype.attachExtraTrace = function(error) {\n    if (error.__stackCleaned__) return;\n    this.uncycle();\n    var parsed = CapturedTrace.parseStackAndMessage(error);\n    var message = parsed.message;\n    var stacks = [parsed.stack];\n\n    var trace = this;\n    while (trace !== undefined) {\n        stacks.push(cleanStack(trace.stack.split(\"\\n\")));\n        trace = trace._parent;\n    }\n    removeCommonRoots(stacks);\n    removeDuplicateOrEmptyJumps(stacks);\n    error.stack = reconstructStack(message, stacks);\n    error.__stackCleaned__ = true;\n};\n\nfunction reconstructStack(message, stacks) {\n    for (var i = 0; i < stacks.length - 1; ++i) {\n        stacks[i].push(\"From previous event:\");\n        stacks[i] = stacks[i].join(\"\\n\");\n    }\n    if (i < stacks.length) {\n        stacks[i] = stacks[i].join(\"\\n\");\n    }\n    return message + \"\\n\" + stacks.join(\"\\n\");\n}\n\nfunction removeDuplicateOrEmptyJumps(stacks) {\n    for (var i = 0; i < stacks.length; ++i) {\n        if (stacks[i].length === 0 ||\n            ((i + 1 < stacks.length) && stacks[i][0] === stacks[i+1][0])) {\n            stacks.splice(i, 1);\n            i--;\n        }\n    }\n}\n\nfunction removeCommonRoots(stacks) {\n    var current = stacks[0];\n    for (var i = 1; i < stacks.length; ++i) {\n        var prev = stacks[i];\n        var currentLastIndex = current.length - 1;\n        var currentLastLine = current[currentLastIndex];\n        var commonRootMeetPoint = -1;\n\n        for (var j = prev.length - 1; j >= 0; --j) {\n            if (prev[j] === currentLastLine) {\n                commonRootMeetPoint = j;\n                break;\n            }\n        }\n\n        for (var j = commonRootMeetPoint; j >= 0; --j) {\n            var line = prev[j];\n            if (current[currentLastIndex] === line) {\n                current.pop();\n                currentLastIndex--;\n            } else {\n                break;\n            }\n        }\n        current = prev;\n    }\n}\n\nfunction cleanStack(stack) {\n    var ret = [];\n    for (var i = 0; i < stack.length; ++i) {\n        var line = stack[i];\n        var isTraceLine = stackFramePattern.test(line) ||\n            \"    (No stack trace)\" === line;\n        var isInternalFrame = isTraceLine && shouldIgnore(line);\n        if (isTraceLine && !isInternalFrame) {\n            if (indentStackFrames && line.charAt(0) !== \" \") {\n                line = \"    \" + line;\n            }\n            ret.push(line);\n        }\n    }\n    return ret;\n}\n\nfunction stackFramesAsArray(error) {\n    var stack = error.stack.replace(/\\s+$/g, \"\").split(\"\\n\");\n    for (var i = 0; i < stack.length; ++i) {\n        var line = stack[i];\n        if (\"    (No stack trace)\" === line || stackFramePattern.test(line)) {\n            break;\n        }\n    }\n    if (i > 0) {\n        stack = stack.slice(i);\n    }\n    return stack;\n}\n\nCapturedTrace.parseStackAndMessage = function(error) {\n    var stack = error.stack;\n    var message = error.toString();\n    stack = typeof stack === \"string\" && stack.length > 0\n                ? stackFramesAsArray(error) : [\"    (No stack trace)\"];\n    return {\n        message: message,\n        stack: cleanStack(stack)\n    };\n};\n\nCapturedTrace.formatAndLogError = function(error, title) {\n    if (typeof console === \"object\") {\n        var message;\n        if (typeof error === \"object\" || typeof error === \"function\") {\n            var stack = error.stack;\n            message = title + formatStack(stack, error);\n        } else {\n            message = title + String(error);\n        }\n        if (typeof console.warn === \"function\" ||\n            typeof console.warn === \"object\") {\n            console.warn(message);\n        } else if (typeof console.log === \"function\" ||\n            typeof console.log === \"object\") {\n            console.log(message);\n        }\n    }\n};\n\nCapturedTrace.unhandledRejection = function (reason) {\n    CapturedTrace.formatAndLogError(reason, \"^--- With additional stack trace: \");\n};\n\nCapturedTrace.isSupported = function () {\n    return typeof captureStackTrace === \"function\";\n};\n\nCapturedTrace.fireRejectionEvent =\nfunction(name, localHandler, reason, promise) {\n    var localEventFired = false;\n    try {\n        if (typeof localHandler === \"function\") {\n            localEventFired = true;\n            if (name === \"rejectionHandled\") {\n                localHandler(promise);\n            } else {\n                localHandler(reason, promise);\n            }\n        }\n    } catch (e) {\n        async.throwLater(e);\n    }\n\n    var globalEventFired = false;\n    try {\n        globalEventFired = fireGlobalEvent(name, reason, promise);\n    } catch (e) {\n        globalEventFired = true;\n        async.throwLater(e);\n    }\n\n    var domEventFired = false;\n    if (fireDomEvent) {\n        try {\n            domEventFired = fireDomEvent(name.toLowerCase(), {\n                reason: reason,\n                promise: promise\n            });\n        } catch (e) {\n            domEventFired = true;\n            async.throwLater(e);\n        }\n    }\n\n    if (!globalEventFired && !localEventFired && !domEventFired &&\n        name === \"unhandledRejection\") {\n        CapturedTrace.formatAndLogError(reason, \"Possibly unhandled \");\n    }\n};\n\nfunction formatNonError(obj) {\n    var str;\n    if (typeof obj === \"function\") {\n        str = \"[function \" +\n            (obj.name || \"anonymous\") +\n            \"]\";\n    } else {\n        str = obj.toString();\n        var ruselessToString = /\\[object [a-zA-Z0-9$_]+\\]/;\n        if (ruselessToString.test(str)) {\n            try {\n                var newStr = JSON.stringify(obj);\n                str = newStr;\n            }\n            catch(e) {\n\n            }\n        }\n        if (str.length === 0) {\n            str = \"(empty array)\";\n        }\n    }\n    return (\"(<\" + snip(str) + \">, no stack trace)\");\n}\n\nfunction snip(str) {\n    var maxChars = 41;\n    if (str.length < maxChars) {\n        return str;\n    }\n    return str.substr(0, maxChars - 3) + \"...\";\n}\n\nvar shouldIgnore = function() { return false; };\nvar parseLineInfoRegex = /[\\/<\\(]([^:\\/]+):(\\d+):(?:\\d+)\\)?\\s*$/;\nfunction parseLineInfo(line) {\n    var matches = line.match(parseLineInfoRegex);\n    if (matches) {\n        return {\n            fileName: matches[1],\n            line: parseInt(matches[2], 10)\n        };\n    }\n}\nCapturedTrace.setBounds = function(firstLineError, lastLineError) {\n    if (!CapturedTrace.isSupported()) return;\n    var firstStackLines = firstLineError.stack.split(\"\\n\");\n    var lastStackLines = lastLineError.stack.split(\"\\n\");\n    var firstIndex = -1;\n    var lastIndex = -1;\n    var firstFileName;\n    var lastFileName;\n    for (var i = 0; i < firstStackLines.length; ++i) {\n        var result = parseLineInfo(firstStackLines[i]);\n        if (result) {\n            firstFileName = result.fileName;\n            firstIndex = result.line;\n            break;\n        }\n    }\n    for (var i = 0; i < lastStackLines.length; ++i) {\n        var result = parseLineInfo(lastStackLines[i]);\n        if (result) {\n            lastFileName = result.fileName;\n            lastIndex = result.line;\n            break;\n        }\n    }\n    if (firstIndex < 0 || lastIndex < 0 || !firstFileName || !lastFileName ||\n        firstFileName !== lastFileName || firstIndex >= lastIndex) {\n        return;\n    }\n\n    shouldIgnore = function(line) {\n        if (bluebirdFramePattern.test(line)) return true;\n        var info = parseLineInfo(line);\n        if (info) {\n            if (info.fileName === firstFileName &&\n                (firstIndex <= info.line && info.line <= lastIndex)) {\n                return true;\n            }\n        }\n        return false;\n    };\n};\n\nvar captureStackTrace = (function stackDetection() {\n    var v8stackFramePattern = /^\\s*at\\s*/;\n    var v8stackFormatter = function(stack, error) {\n        if (typeof stack === \"string\") return stack;\n\n        if (error.name !== undefined &&\n            error.message !== undefined) {\n            return error.toString();\n        }\n        return formatNonError(error);\n    };\n\n    if (typeof Error.stackTraceLimit === \"number\" &&\n        typeof Error.captureStackTrace === \"function\") {\n        Error.stackTraceLimit = Error.stackTraceLimit + 6;\n        stackFramePattern = v8stackFramePattern;\n        formatStack = v8stackFormatter;\n        var captureStackTrace = Error.captureStackTrace;\n\n        shouldIgnore = function(line) {\n            return bluebirdFramePattern.test(line);\n        };\n        return function(receiver, ignoreUntil) {\n            Error.stackTraceLimit = Error.stackTraceLimit + 6;\n            captureStackTrace(receiver, ignoreUntil);\n            Error.stackTraceLimit = Error.stackTraceLimit - 6;\n        };\n    }\n    var err = new Error();\n\n    if (typeof err.stack === \"string\" &&\n        err.stack.split(\"\\n\")[0].indexOf(\"stackDetection@\") >= 0) {\n        stackFramePattern = /@/;\n        formatStack = v8stackFormatter;\n        indentStackFrames = true;\n        return function captureStackTrace(o) {\n            o.stack = new Error().stack;\n        };\n    }\n\n    var hasStackAfterThrow;\n    try { throw new Error(); }\n    catch(e) {\n        hasStackAfterThrow = (\"stack\" in e);\n    }\n    if (!(\"stack\" in err) && hasStackAfterThrow) {\n        stackFramePattern = v8stackFramePattern;\n        formatStack = v8stackFormatter;\n        return function captureStackTrace(o) {\n            Error.stackTraceLimit = Error.stackTraceLimit + 6;\n            try { throw new Error(); }\n            catch(e) { o.stack = e.stack; }\n            Error.stackTraceLimit = Error.stackTraceLimit - 6;\n        };\n    }\n\n    formatStack = function(stack, error) {\n        if (typeof stack === \"string\") return stack;\n\n        if ((typeof error === \"object\" ||\n            typeof error === \"function\") &&\n            error.name !== undefined &&\n            error.message !== undefined) {\n            return error.toString();\n        }\n        return formatNonError(error);\n    };\n\n    return null;\n\n})([]);\n\nvar fireDomEvent;\nvar fireGlobalEvent = (function() {\n    if (util.isNode) {\n        return function(name, reason, promise) {\n            if (name === \"rejectionHandled\") {\n                return process.emit(name, promise);\n            } else {\n                return process.emit(name, reason, promise);\n            }\n        };\n    } else {\n        var customEventWorks = false;\n        var anyEventWorks = true;\n        try {\n            var ev = new self.CustomEvent(\"test\");\n            customEventWorks = ev instanceof CustomEvent;\n        } catch (e) {}\n        if (!customEventWorks) {\n            try {\n                var event = document.createEvent(\"CustomEvent\");\n                event.initCustomEvent(\"testingtheevent\", false, true, {});\n                self.dispatchEvent(event);\n            } catch (e) {\n                anyEventWorks = false;\n            }\n        }\n        if (anyEventWorks) {\n            fireDomEvent = function(type, detail) {\n                var event;\n                if (customEventWorks) {\n                    event = new self.CustomEvent(type, {\n                        detail: detail,\n                        bubbles: false,\n                        cancelable: true\n                    });\n                } else if (self.dispatchEvent) {\n                    event = document.createEvent(\"CustomEvent\");\n                    event.initCustomEvent(type, false, true, detail);\n                }\n\n                return event ? !self.dispatchEvent(event) : false;\n            };\n        }\n\n        var toWindowMethodNameMap = {};\n        toWindowMethodNameMap[\"unhandledRejection\"] = (\"on\" +\n            \"unhandledRejection\").toLowerCase();\n        toWindowMethodNameMap[\"rejectionHandled\"] = (\"on\" +\n            \"rejectionHandled\").toLowerCase();\n\n        return function(name, reason, promise) {\n            var methodName = toWindowMethodNameMap[name];\n            var method = self[methodName];\n            if (!method) return false;\n            if (name === \"rejectionHandled\") {\n                method.call(self, promise);\n            } else {\n                method.call(self, reason, promise);\n            }\n            return true;\n        };\n    }\n})();\n\nreturn CapturedTrace;\n};\n\n},{\"./async.js\":1,\"./util.js\":30}],6:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(NEXT_FILTER) {\nvar util = _dereq_(\"./util.js\");\nvar errors = _dereq_(\"./errors.js\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar keys = _dereq_(\"./es5.js\").keys;\nvar TypeError = errors.TypeError;\n\nfunction CatchFilter(instances, callback, promise) {\n    this._instances = instances;\n    this._callback = callback;\n    this._promise = promise;\n}\n\nfunction safePredicate(predicate, e) {\n    var safeObject = {};\n    var retfilter = tryCatch(predicate).call(safeObject, e);\n\n    if (retfilter === errorObj) return retfilter;\n\n    var safeKeys = keys(safeObject);\n    if (safeKeys.length) {\n        errorObj.e = new TypeError(\"Catch filter must inherit from Error or be a simple predicate function\\u000a\\u000a    See http://goo.gl/o84o68\\u000a\");\n        return errorObj;\n    }\n    return retfilter;\n}\n\nCatchFilter.prototype.doFilter = function (e) {\n    var cb = this._callback;\n    var promise = this._promise;\n    var boundTo = promise._boundTo;\n    for (var i = 0, len = this._instances.length; i < len; ++i) {\n        var item = this._instances[i];\n        var itemIsErrorType = item === Error ||\n            (item != null && item.prototype instanceof Error);\n\n        if (itemIsErrorType && e instanceof item) {\n            var ret = tryCatch(cb).call(boundTo, e);\n            if (ret === errorObj) {\n                NEXT_FILTER.e = ret.e;\n                return NEXT_FILTER;\n            }\n            return ret;\n        } else if (typeof item === \"function\" && !itemIsErrorType) {\n            var shouldHandle = safePredicate(item, e);\n            if (shouldHandle === errorObj) {\n                e = errorObj.e;\n                break;\n            } else if (shouldHandle) {\n                var ret = tryCatch(cb).call(boundTo, e);\n                if (ret === errorObj) {\n                    NEXT_FILTER.e = ret.e;\n                    return NEXT_FILTER;\n                }\n                return ret;\n            }\n        }\n    }\n    NEXT_FILTER.e = e;\n    return NEXT_FILTER;\n};\n\nreturn CatchFilter;\n};\n\n},{\"./errors.js\":11,\"./es5.js\":12,\"./util.js\":30}],7:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, CapturedTrace, isDebugging) {\nvar contextStack = [];\nfunction Context() {\n    this._trace = new CapturedTrace(peekContext());\n}\nContext.prototype._pushContext = function () {\n    if (!isDebugging()) return;\n    if (this._trace !== undefined) {\n        contextStack.push(this._trace);\n    }\n};\n\nContext.prototype._popContext = function () {\n    if (!isDebugging()) return;\n    if (this._trace !== undefined) {\n        contextStack.pop();\n    }\n};\n\nfunction createContext() {\n    if (isDebugging()) return new Context();\n}\n\nfunction peekContext() {\n    var lastIndex = contextStack.length - 1;\n    if (lastIndex >= 0) {\n        return contextStack[lastIndex];\n    }\n    return undefined;\n}\n\nPromise.prototype._peekContext = peekContext;\nPromise.prototype._pushContext = Context.prototype._pushContext;\nPromise.prototype._popContext = Context.prototype._popContext;\n\nreturn createContext;\n};\n\n},{}],8:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, CapturedTrace) {\nvar async = _dereq_(\"./async.js\");\nvar Warning = _dereq_(\"./errors.js\").Warning;\nvar util = _dereq_(\"./util.js\");\nvar canAttachTrace = util.canAttachTrace;\nvar unhandledRejectionHandled;\nvar possiblyUnhandledRejection;\nvar debugging = false || (util.isNode &&\n                    (!!process.env[\"BLUEBIRD_DEBUG\"] ||\n                     process.env[\"NODE_ENV\"] === \"development\"));\n\nPromise.prototype._ensurePossibleRejectionHandled = function () {\n    this._setRejectionIsUnhandled();\n    async.invokeLater(this._notifyUnhandledRejection, this, undefined);\n};\n\nPromise.prototype._notifyUnhandledRejectionIsHandled = function () {\n    CapturedTrace.fireRejectionEvent(\"rejectionHandled\",\n                                  unhandledRejectionHandled, undefined, this);\n};\n\nPromise.prototype._notifyUnhandledRejection = function () {\n    if (this._isRejectionUnhandled()) {\n        var reason = this._getCarriedStackTrace() || this._settledValue;\n        this._setUnhandledRejectionIsNotified();\n        CapturedTrace.fireRejectionEvent(\"unhandledRejection\",\n                                      possiblyUnhandledRejection, reason, this);\n    }\n};\n\nPromise.prototype._setUnhandledRejectionIsNotified = function () {\n    this._bitField = this._bitField | 524288;\n};\n\nPromise.prototype._unsetUnhandledRejectionIsNotified = function () {\n    this._bitField = this._bitField & (~524288);\n};\n\nPromise.prototype._isUnhandledRejectionNotified = function () {\n    return (this._bitField & 524288) > 0;\n};\n\nPromise.prototype._setRejectionIsUnhandled = function () {\n    this._bitField = this._bitField | 2097152;\n};\n\nPromise.prototype._unsetRejectionIsUnhandled = function () {\n    this._bitField = this._bitField & (~2097152);\n    if (this._isUnhandledRejectionNotified()) {\n        this._unsetUnhandledRejectionIsNotified();\n        this._notifyUnhandledRejectionIsHandled();\n    }\n};\n\nPromise.prototype._isRejectionUnhandled = function () {\n    return (this._bitField & 2097152) > 0;\n};\n\nPromise.prototype._setCarriedStackTrace = function (capturedTrace) {\n    this._bitField = this._bitField | 1048576;\n    this._fulfillmentHandler0 = capturedTrace;\n};\n\nPromise.prototype._isCarryingStackTrace = function () {\n    return (this._bitField & 1048576) > 0;\n};\n\nPromise.prototype._getCarriedStackTrace = function () {\n    return this._isCarryingStackTrace()\n        ? this._fulfillmentHandler0\n        : undefined;\n};\n\nPromise.prototype._captureStackTrace = function () {\n    if (debugging) {\n        this._trace = new CapturedTrace(this._peekContext());\n    }\n    return this;\n};\n\nPromise.prototype._attachExtraTrace = function (error, ignoreSelf) {\n    if (debugging && canAttachTrace(error)) {\n        var trace = this._trace;\n        if (trace !== undefined) {\n            if (ignoreSelf) trace = trace._parent;\n        }\n        if (trace !== undefined) {\n            trace.attachExtraTrace(error);\n        } else if (!error.__stackCleaned__) {\n            var parsed = CapturedTrace.parseStackAndMessage(error);\n            error.stack = parsed.stack.join(\"\\n\");\n            error.__stackCleaned__ = true;\n        }\n    }\n};\n\nPromise.prototype._warn = function(message) {\n    var warning = new Warning(message);\n    var ctx = this._peekContext();\n    if (ctx) {\n        ctx.attachExtraTrace(warning);\n    } else {\n        var parsed = CapturedTrace.parseStackAndMessage(warning);\n        warning.stack = parsed.message + \"\\n\" + parsed.stack.join(\"\\n\");\n    }\n    CapturedTrace.formatAndLogError(warning, \"\");\n};\n\nPromise.onPossiblyUnhandledRejection = function (fn) {\n    possiblyUnhandledRejection = typeof fn === \"function\" ? fn : undefined;\n};\n\nPromise.onUnhandledRejectionHandled = function (fn) {\n    unhandledRejectionHandled = typeof fn === \"function\" ? fn : undefined;\n};\n\nPromise.longStackTraces = function () {\n    if (async.haveItemsQueued() &&\n        debugging === false\n   ) {\n        throw new Error(\"cannot enable long stack traces after promises have been created\\u000a\\u000a    See http://goo.gl/DT1qyG\\u000a\");\n    }\n    debugging = CapturedTrace.isSupported();\n};\n\nPromise.hasLongStackTraces = function () {\n    return debugging && CapturedTrace.isSupported();\n};\n\nif (!CapturedTrace.isSupported()) {\n    Promise.longStackTraces = function(){};\n    debugging = false;\n}\n\nreturn function() {\n    return debugging;\n};\n};\n\n},{\"./async.js\":1,\"./errors.js\":11,\"./util.js\":30}],9:[function(_dereq_,module,exports){\n\"use strict\";\nvar util = _dereq_(\"./util.js\");\nvar isPrimitive = util.isPrimitive;\nvar wrapsPrimitiveReceiver = util.wrapsPrimitiveReceiver;\n\nmodule.exports = function(Promise) {\nvar returner = function () {\n    return this;\n};\nvar thrower = function () {\n    throw this;\n};\n\nvar wrapper = function (value, action) {\n    if (action === 1) {\n        return function () {\n            throw value;\n        };\n    } else if (action === 2) {\n        return function () {\n            return value;\n        };\n    }\n};\n\n\nPromise.prototype[\"return\"] =\nPromise.prototype.thenReturn = function (value) {\n    if (wrapsPrimitiveReceiver && isPrimitive(value)) {\n        return this._then(\n            wrapper(value, 2),\n            undefined,\n            undefined,\n            undefined,\n            undefined\n       );\n    }\n    return this._then(returner, undefined, undefined, value, undefined);\n};\n\nPromise.prototype[\"throw\"] =\nPromise.prototype.thenThrow = function (reason) {\n    if (wrapsPrimitiveReceiver && isPrimitive(reason)) {\n        return this._then(\n            wrapper(reason, 1),\n            undefined,\n            undefined,\n            undefined,\n            undefined\n       );\n    }\n    return this._then(thrower, undefined, undefined, reason, undefined);\n};\n};\n\n},{\"./util.js\":30}],10:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar PromiseReduce = Promise.reduce;\n\nPromise.prototype.each = function (fn) {\n    return PromiseReduce(this, fn, null, INTERNAL);\n};\n\nPromise.each = function (promises, fn) {\n    return PromiseReduce(promises, fn, null, INTERNAL);\n};\n};\n\n},{}],11:[function(_dereq_,module,exports){\n\"use strict\";\nvar Objectfreeze = _dereq_(\"./es5.js\").freeze;\nvar util = _dereq_(\"./util.js\");\nvar inherits = util.inherits;\nvar notEnumerableProp = util.notEnumerableProp;\n\nfunction subError(nameProperty, defaultMessage) {\n    function SubError(message) {\n        if (!(this instanceof SubError)) return new SubError(message);\n        notEnumerableProp(this, \"message\",\n            typeof message === \"string\" ? message : defaultMessage);\n        notEnumerableProp(this, \"name\", nameProperty);\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, this.constructor);\n        } else {\n            Error.call(this);\n        }\n    }\n    inherits(SubError, Error);\n    return SubError;\n}\n\nvar _TypeError, _RangeError;\nvar Warning = subError(\"Warning\", \"warning\");\nvar CancellationError = subError(\"CancellationError\", \"cancellation error\");\nvar TimeoutError = subError(\"TimeoutError\", \"timeout error\");\nvar AggregateError = subError(\"AggregateError\", \"aggregate error\");\ntry {\n    _TypeError = TypeError;\n    _RangeError = RangeError;\n} catch(e) {\n    _TypeError = subError(\"TypeError\", \"type error\");\n    _RangeError = subError(\"RangeError\", \"range error\");\n}\n\nvar methods = (\"join pop push shift unshift slice filter forEach some \" +\n    \"every map indexOf lastIndexOf reduce reduceRight sort reverse\").split(\" \");\n\nfor (var i = 0; i < methods.length; ++i) {\n    if (typeof Array.prototype[methods[i]] === \"function\") {\n        AggregateError.prototype[methods[i]] = Array.prototype[methods[i]];\n    }\n}\n\nAggregateError.prototype.length = 0;\nAggregateError.prototype[\"isOperational\"] = true;\nvar level = 0;\nAggregateError.prototype.toString = function() {\n    var indent = Array(level * 4 + 1).join(\" \");\n    var ret = \"\\n\" + indent + \"AggregateError of:\" + \"\\n\";\n    level++;\n    indent = Array(level * 4 + 1).join(\" \");\n    for (var i = 0; i < this.length; ++i) {\n        var str = this[i] === this ? \"[Circular AggregateError]\" : this[i] + \"\";\n        var lines = str.split(\"\\n\");\n        for (var j = 0; j < lines.length; ++j) {\n            lines[j] = indent + lines[j];\n        }\n        str = lines.join(\"\\n\");\n        ret += str + \"\\n\";\n    }\n    level--;\n    return ret;\n};\n\nfunction OperationalError(message) {\n    if (!(this instanceof OperationalError))\n        return new OperationalError(message);\n    notEnumerableProp(this, \"name\", \"OperationalError\");\n    notEnumerableProp(this, \"message\", message);\n    this.cause = message;\n    this[\"isOperational\"] = true;\n\n    if (message instanceof Error) {\n        notEnumerableProp(this, \"message\", message.message);\n        notEnumerableProp(this, \"stack\", message.stack);\n    } else if (Error.captureStackTrace) {\n        Error.captureStackTrace(this, this.constructor);\n    }\n\n}\ninherits(OperationalError, Error);\n\nvar errorTypes = Error[\"__BluebirdErrorTypes__\"];\nif (!errorTypes) {\n    errorTypes = Objectfreeze({\n        CancellationError: CancellationError,\n        TimeoutError: TimeoutError,\n        OperationalError: OperationalError,\n        RejectionError: OperationalError,\n        AggregateError: AggregateError\n    });\n    notEnumerableProp(Error, \"__BluebirdErrorTypes__\", errorTypes);\n}\n\nmodule.exports = {\n    Error: Error,\n    TypeError: _TypeError,\n    RangeError: _RangeError,\n    CancellationError: errorTypes.CancellationError,\n    OperationalError: errorTypes.OperationalError,\n    TimeoutError: errorTypes.TimeoutError,\n    AggregateError: errorTypes.AggregateError,\n    Warning: Warning\n};\n\n},{\"./es5.js\":12,\"./util.js\":30}],12:[function(_dereq_,module,exports){\nvar isES5 = (function(){\n    \"use strict\";\n    return this === undefined;\n})();\n\nif (isES5) {\n    module.exports = {\n        freeze: Object.freeze,\n        defineProperty: Object.defineProperty,\n        keys: Object.keys,\n        getPrototypeOf: Object.getPrototypeOf,\n        isArray: Array.isArray,\n        isES5: isES5,\n        propertyIsWritable: function(obj, prop) {\n            var descriptor = Object.getOwnPropertyDescriptor(obj, prop);\n            return !!(!descriptor || descriptor.writable || descriptor.set);\n        }\n    };\n} else {\n    var has = {}.hasOwnProperty;\n    var str = {}.toString;\n    var proto = {}.constructor.prototype;\n\n    var ObjectKeys = function (o) {\n        var ret = [];\n        for (var key in o) {\n            if (has.call(o, key)) {\n                ret.push(key);\n            }\n        }\n        return ret;\n    };\n\n    var ObjectDefineProperty = function (o, key, desc) {\n        o[key] = desc.value;\n        return o;\n    };\n\n    var ObjectFreeze = function (obj) {\n        return obj;\n    };\n\n    var ObjectGetPrototypeOf = function (obj) {\n        try {\n            return Object(obj).constructor.prototype;\n        }\n        catch (e) {\n            return proto;\n        }\n    };\n\n    var ArrayIsArray = function (obj) {\n        try {\n            return str.call(obj) === \"[object Array]\";\n        }\n        catch(e) {\n            return false;\n        }\n    };\n\n    module.exports = {\n        isArray: ArrayIsArray,\n        keys: ObjectKeys,\n        defineProperty: ObjectDefineProperty,\n        freeze: ObjectFreeze,\n        getPrototypeOf: ObjectGetPrototypeOf,\n        isES5: isES5,\n        propertyIsWritable: function() {\n            return true;\n        }\n    };\n}\n\n},{}],13:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar PromiseMap = Promise.map;\n\nPromise.prototype.filter = function (fn, options) {\n    return PromiseMap(this, fn, options, INTERNAL);\n};\n\nPromise.filter = function (promises, fn, options) {\n    return PromiseMap(promises, fn, options, INTERNAL);\n};\n};\n\n},{}],14:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, NEXT_FILTER, tryConvertToPromise) {\nvar util = _dereq_(\"./util.js\");\nvar wrapsPrimitiveReceiver = util.wrapsPrimitiveReceiver;\nvar isPrimitive = util.isPrimitive;\nvar thrower = util.thrower;\n\nfunction returnThis() {\n    return this;\n}\nfunction throwThis() {\n    throw this;\n}\nfunction return$(r) {\n    return function() {\n        return r;\n    };\n}\nfunction throw$(r) {\n    return function() {\n        throw r;\n    };\n}\nfunction promisedFinally(ret, reasonOrValue, isFulfilled) {\n    var then;\n    if (wrapsPrimitiveReceiver && isPrimitive(reasonOrValue)) {\n        then = isFulfilled ? return$(reasonOrValue) : throw$(reasonOrValue);\n    } else {\n        then = isFulfilled ? returnThis : throwThis;\n    }\n    return ret._then(then, thrower, undefined, reasonOrValue, undefined);\n}\n\nfunction finallyHandler(reasonOrValue) {\n    var promise = this.promise;\n    var handler = this.handler;\n\n    var ret = promise._isBound()\n                    ? handler.call(promise._boundTo)\n                    : handler();\n\n    if (ret !== undefined) {\n        var maybePromise = tryConvertToPromise(ret, promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            return promisedFinally(maybePromise, reasonOrValue,\n                                    promise.isFulfilled());\n        }\n    }\n\n    if (promise.isRejected()) {\n        NEXT_FILTER.e = reasonOrValue;\n        return NEXT_FILTER;\n    } else {\n        return reasonOrValue;\n    }\n}\n\nfunction tapHandler(value) {\n    var promise = this.promise;\n    var handler = this.handler;\n\n    var ret = promise._isBound()\n                    ? handler.call(promise._boundTo, value)\n                    : handler(value);\n\n    if (ret !== undefined) {\n        var maybePromise = tryConvertToPromise(ret, promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            return promisedFinally(maybePromise, value, true);\n        }\n    }\n    return value;\n}\n\nPromise.prototype._passThroughHandler = function (handler, isFinally) {\n    if (typeof handler !== \"function\") return this.then();\n\n    var promiseAndHandler = {\n        promise: this,\n        handler: handler\n    };\n\n    return this._then(\n            isFinally ? finallyHandler : tapHandler,\n            isFinally ? finallyHandler : undefined, undefined,\n            promiseAndHandler, undefined);\n};\n\nPromise.prototype.lastly =\nPromise.prototype[\"finally\"] = function (handler) {\n    return this._passThroughHandler(handler, true);\n};\n\nPromise.prototype.tap = function (handler) {\n    return this._passThroughHandler(handler, false);\n};\n};\n\n},{\"./util.js\":30}],15:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports =\nfunction(Promise, PromiseArray, tryConvertToPromise, INTERNAL) {\nvar util = _dereq_(\"./util.js\");\nvar canEvaluate = util.canEvaluate;\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar reject;\n\nif (!true) {\nif (canEvaluate) {\n    var thenCallback = function(i) {\n        return new Function(\"value\", \"holder\", \"                             \\n\\\n            'use strict';                                                    \\n\\\n            holder.pIndex = value;                                           \\n\\\n            holder.checkFulfillment(this);                                   \\n\\\n            \".replace(/Index/g, i));\n    };\n\n    var caller = function(count) {\n        var values = [];\n        for (var i = 1; i <= count; ++i) values.push(\"holder.p\" + i);\n        return new Function(\"holder\", \"                                      \\n\\\n            'use strict';                                                    \\n\\\n            var callback = holder.fn;                                        \\n\\\n            return callback(values);                                         \\n\\\n            \".replace(/values/g, values.join(\", \")));\n    };\n    var thenCallbacks = [];\n    var callers = [undefined];\n    for (var i = 1; i <= 5; ++i) {\n        thenCallbacks.push(thenCallback(i));\n        callers.push(caller(i));\n    }\n\n    var Holder = function(total, fn) {\n        this.p1 = this.p2 = this.p3 = this.p4 = this.p5 = null;\n        this.fn = fn;\n        this.total = total;\n        this.now = 0;\n    };\n\n    Holder.prototype.callers = callers;\n    Holder.prototype.checkFulfillment = function(promise) {\n        var now = this.now;\n        now++;\n        var total = this.total;\n        if (now >= total) {\n            var handler = this.callers[total];\n            promise._pushContext();\n            var ret = tryCatch(handler)(this);\n            promise._popContext();\n            if (ret === errorObj) {\n                promise._rejectCallback(ret.e, false, true);\n            } else {\n                promise._resolveCallback(ret);\n            }\n        } else {\n            this.now = now;\n        }\n    };\n\n    var reject = function (reason) {\n        this._reject(reason);\n    };\n}\n}\n\nPromise.join = function () {\n    var last = arguments.length - 1;\n    var fn;\n    if (last > 0 && typeof arguments[last] === \"function\") {\n        fn = arguments[last];\n        if (!true) {\n            if (last < 6 && canEvaluate) {\n                var ret = new Promise(INTERNAL);\n                ret._captureStackTrace();\n                var holder = new Holder(last, fn);\n                var callbacks = thenCallbacks;\n                for (var i = 0; i < last; ++i) {\n                    var maybePromise = tryConvertToPromise(arguments[i], ret);\n                    if (maybePromise instanceof Promise) {\n                        maybePromise = maybePromise._target();\n                        if (maybePromise._isPending()) {\n                            maybePromise._then(callbacks[i], reject,\n                                               undefined, ret, holder);\n                        } else if (maybePromise._isFulfilled()) {\n                            callbacks[i].call(ret,\n                                              maybePromise._value(), holder);\n                        } else {\n                            ret._reject(maybePromise._reason());\n                        }\n                    } else {\n                        callbacks[i].call(ret, maybePromise, holder);\n                    }\n                }\n                return ret;\n            }\n        }\n    }\n    var $_len = arguments.length;var args = new Array($_len); for(var $_i = 0; $_i < $_len; ++$_i) {args[$_i] = arguments[$_i];}\n    if (fn) args.pop();\n    var ret = new PromiseArray(args).promise();\n    return fn !== undefined ? ret.spread(fn) : ret;\n};\n\n};\n\n},{\"./util.js\":30}],16:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise,\n                          PromiseArray,\n                          apiRejection,\n                          tryConvertToPromise,\n                          INTERNAL) {\nvar util = _dereq_(\"./util.js\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar PENDING = {};\nvar EMPTY_ARRAY = [];\n\nfunction MappingPromiseArray(promises, fn, limit, _filter) {\n    this.constructor$(promises);\n    this._promise._setIsSpreadable();\n    this._promise._captureStackTrace();\n    this._callback = fn;\n    this._preservedValues = _filter === INTERNAL\n        ? new Array(this.length())\n        : null;\n    this._limit = limit;\n    this._inFlight = 0;\n    this._queue = limit >= 1 ? [] : EMPTY_ARRAY;\n    this._init$(undefined, -2);\n}\nutil.inherits(MappingPromiseArray, PromiseArray);\n\nMappingPromiseArray.prototype._init = function () {};\n\nMappingPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    var values = this._values;\n    var length = this.length();\n    var preservedValues = this._preservedValues;\n    var limit = this._limit;\n    if (values[index] === PENDING) {\n        values[index] = value;\n        if (limit >= 1) {\n            this._inFlight--;\n            this._drainQueue();\n            if (this._isResolved()) return;\n        }\n    } else {\n        if (limit >= 1 && this._inFlight >= limit) {\n            values[index] = value;\n            this._queue.push(index);\n            return;\n        }\n        if (preservedValues !== null) preservedValues[index] = value;\n\n        var callback = this._callback;\n        var receiver = this._promise._boundTo;\n        this._promise._pushContext();\n        var ret = tryCatch(callback).call(receiver, value, index, length);\n        this._promise._popContext();\n        if (ret === errorObj) return this._reject(ret.e);\n\n        var maybePromise = tryConvertToPromise(ret, this._promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            if (maybePromise._isPending()) {\n                if (limit >= 1) this._inFlight++;\n                values[index] = PENDING;\n                return maybePromise._proxyPromiseArray(this, index);\n            } else if (maybePromise._isFulfilled()) {\n                ret = maybePromise._value();\n            } else {\n                return this._reject(maybePromise._reason());\n            }\n        }\n        values[index] = ret;\n    }\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= length) {\n        if (preservedValues !== null) {\n            this._filter(values, preservedValues);\n        } else {\n            this._resolve(values);\n        }\n\n    }\n};\n\nMappingPromiseArray.prototype._drainQueue = function () {\n    var queue = this._queue;\n    var limit = this._limit;\n    var values = this._values;\n    while (queue.length > 0 && this._inFlight < limit) {\n        if (this._isResolved()) return;\n        var index = queue.pop();\n        this._promiseFulfilled(values[index], index);\n    }\n};\n\nMappingPromiseArray.prototype._filter = function (booleans, values) {\n    var len = values.length;\n    var ret = new Array(len);\n    var j = 0;\n    for (var i = 0; i < len; ++i) {\n        if (booleans[i]) ret[j++] = values[i];\n    }\n    ret.length = j;\n    this._resolve(ret);\n};\n\nMappingPromiseArray.prototype.preservedValues = function () {\n    return this._preservedValues;\n};\n\nfunction map(promises, fn, options, _filter) {\n    var limit = typeof options === \"object\" && options !== null\n        ? options.concurrency\n        : 0;\n    limit = typeof limit === \"number\" &&\n        isFinite(limit) && limit >= 1 ? limit : 0;\n    return new MappingPromiseArray(promises, fn, limit, _filter);\n}\n\nPromise.prototype.map = function (fn, options) {\n    if (typeof fn !== \"function\") return apiRejection(\"fn must be a function\\u000a\\u000a    See http://goo.gl/916lJJ\\u000a\");\n\n    return map(this, fn, options, null).promise();\n};\n\nPromise.map = function (promises, fn, options, _filter) {\n    if (typeof fn !== \"function\") return apiRejection(\"fn must be a function\\u000a\\u000a    See http://goo.gl/916lJJ\\u000a\");\n    return map(promises, fn, options, _filter).promise();\n};\n\n\n};\n\n},{\"./util.js\":30}],17:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports =\nfunction(Promise, INTERNAL, tryConvertToPromise, apiRejection) {\nvar util = _dereq_(\"./util.js\");\nvar tryCatch = util.tryCatch;\n\nPromise.method = function (fn) {\n    if (typeof fn !== \"function\") {\n        throw new Promise.TypeError(\"fn must be a function\\u000a\\u000a    See http://goo.gl/916lJJ\\u000a\");\n    }\n    return function () {\n        var ret = new Promise(INTERNAL);\n        ret._captureStackTrace();\n        ret._pushContext();\n        var value = tryCatch(fn).apply(this, arguments);\n        ret._popContext();\n        ret._resolveFromSyncValue(value);\n        return ret;\n    };\n};\n\nPromise.attempt = Promise[\"try\"] = function (fn, args, ctx) {\n    if (typeof fn !== \"function\") {\n        return apiRejection(\"fn must be a function\\u000a\\u000a    See http://goo.gl/916lJJ\\u000a\");\n    }\n    var ret = new Promise(INTERNAL);\n    ret._captureStackTrace();\n    ret._pushContext();\n    var value = util.isArray(args)\n        ? tryCatch(fn).apply(ctx, args)\n        : tryCatch(fn).call(ctx, args);\n    ret._popContext();\n    ret._resolveFromSyncValue(value);\n    return ret;\n};\n\nPromise.prototype._resolveFromSyncValue = function (value) {\n    if (value === util.errorObj) {\n        this._rejectCallback(value.e, false, true);\n    } else {\n        this._resolveCallback(value, true);\n    }\n};\n};\n\n},{\"./util.js\":30}],18:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise) {\nvar util = _dereq_(\"./util.js\");\nvar async = _dereq_(\"./async.js\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\n\nfunction spreadAdapter(val, nodeback) {\n    var promise = this;\n    if (!util.isArray(val)) return successAdapter.call(promise, val, nodeback);\n    var ret = tryCatch(nodeback).apply(promise._boundTo, [null].concat(val));\n    if (ret === errorObj) {\n        async.throwLater(ret.e);\n    }\n}\n\nfunction successAdapter(val, nodeback) {\n    var promise = this;\n    var receiver = promise._boundTo;\n    var ret = val === undefined\n        ? tryCatch(nodeback).call(receiver, null)\n        : tryCatch(nodeback).call(receiver, null, val);\n    if (ret === errorObj) {\n        async.throwLater(ret.e);\n    }\n}\nfunction errorAdapter(reason, nodeback) {\n    var promise = this;\n    if (!reason) {\n        var target = promise._target();\n        var newReason = target._getCarriedStackTrace();\n        newReason.cause = reason;\n        reason = newReason;\n    }\n    var ret = tryCatch(nodeback).call(promise._boundTo, reason);\n    if (ret === errorObj) {\n        async.throwLater(ret.e);\n    }\n}\n\nPromise.prototype.nodeify = function (nodeback, options) {\n    if (typeof nodeback == \"function\") {\n        var adapter = successAdapter;\n        if (options !== undefined && Object(options).spread) {\n            adapter = spreadAdapter;\n        }\n        this._then(\n            adapter,\n            errorAdapter,\n            undefined,\n            this,\n            nodeback\n        );\n    }\n    return this;\n};\n};\n\n},{\"./async.js\":1,\"./util.js\":30}],19:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, PromiseArray) {\nvar util = _dereq_(\"./util.js\");\nvar async = _dereq_(\"./async.js\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\n\nPromise.prototype.progressed = function (handler) {\n    return this._then(undefined, undefined, handler, undefined, undefined);\n};\n\nPromise.prototype._progress = function (progressValue) {\n    if (this._isFollowingOrFulfilledOrRejected()) return;\n    this._target()._progressUnchecked(progressValue);\n\n};\n\nPromise.prototype._progressHandlerAt = function (index) {\n    return index === 0\n        ? this._progressHandler0\n        : this[(index << 2) + index - 5 + 2];\n};\n\nPromise.prototype._doProgressWith = function (progression) {\n    var progressValue = progression.value;\n    var handler = progression.handler;\n    var promise = progression.promise;\n    var receiver = progression.receiver;\n\n    var ret = tryCatch(handler).call(receiver, progressValue);\n    if (ret === errorObj) {\n        if (ret.e != null &&\n            ret.e.name !== \"StopProgressPropagation\") {\n            var trace = util.canAttachTrace(ret.e)\n                ? ret.e : new Error(util.toString(ret.e));\n            promise._attachExtraTrace(trace);\n            promise._progress(ret.e);\n        }\n    } else if (ret instanceof Promise) {\n        ret._then(promise._progress, null, null, promise, undefined);\n    } else {\n        promise._progress(ret);\n    }\n};\n\n\nPromise.prototype._progressUnchecked = function (progressValue) {\n    var len = this._length();\n    var progress = this._progress;\n    for (var i = 0; i < len; i++) {\n        var handler = this._progressHandlerAt(i);\n        var promise = this._promiseAt(i);\n        if (!(promise instanceof Promise)) {\n            var receiver = this._receiverAt(i);\n            if (typeof handler === \"function\") {\n                handler.call(receiver, progressValue, promise);\n            } else if (receiver instanceof PromiseArray &&\n                       !receiver._isResolved()) {\n                receiver._promiseProgressed(progressValue, promise);\n            }\n            continue;\n        }\n\n        if (typeof handler === \"function\") {\n            async.invoke(this._doProgressWith, this, {\n                handler: handler,\n                promise: promise,\n                receiver: this._receiverAt(i),\n                value: progressValue\n            });\n        } else {\n            async.invoke(progress, promise, progressValue);\n        }\n    }\n};\n};\n\n},{\"./async.js\":1,\"./util.js\":30}],20:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function() {\nvar makeSelfResolutionError = function () {\n    return new TypeError(\"circular promise resolution chain\\u000a\\u000a    See http://goo.gl/LhFpo0\\u000a\");\n};\nvar reflect = function() {\n    return new Promise.PromiseInspection(this._target());\n};\nvar apiRejection = function(msg) {\n    return Promise.reject(new TypeError(msg));\n};\nvar util = _dereq_(\"./util.js\");\nvar async = _dereq_(\"./async.js\");\nvar errors = _dereq_(\"./errors.js\");\nvar TypeError = Promise.TypeError = errors.TypeError;\nPromise.RangeError = errors.RangeError;\nPromise.CancellationError = errors.CancellationError;\nPromise.TimeoutError = errors.TimeoutError;\nPromise.OperationalError = errors.OperationalError;\nPromise.RejectionError = errors.OperationalError;\nPromise.AggregateError = errors.AggregateError;\nvar INTERNAL = function(){};\nvar APPLY = {};\nvar NEXT_FILTER = {e: null};\nvar tryConvertToPromise = _dereq_(\"./thenables.js\")(Promise, INTERNAL);\nvar PromiseArray =\n    _dereq_(\"./promise_array.js\")(Promise, INTERNAL,\n                                    tryConvertToPromise, apiRejection);\nvar CapturedTrace = _dereq_(\"./captured_trace.js\")();\nvar isDebugging = _dereq_(\"./debuggability.js\")(Promise, CapturedTrace);\n /*jshint unused:false*/\nvar createContext =\n    _dereq_(\"./context.js\")(Promise, CapturedTrace, isDebugging);\nvar CatchFilter = _dereq_(\"./catch_filter.js\")(NEXT_FILTER);\nvar PromiseResolver = _dereq_(\"./promise_resolver.js\");\nvar nodebackForPromise = PromiseResolver._nodebackForPromise;\nvar errorObj = util.errorObj;\nvar tryCatch = util.tryCatch;\nfunction Promise(resolver) {\n    if (typeof resolver !== \"function\") {\n        throw new TypeError(\"the promise constructor requires a resolver function\\u000a\\u000a    See http://goo.gl/EC22Yn\\u000a\");\n    }\n    if (this.constructor !== Promise) {\n        throw new TypeError(\"the promise constructor cannot be invoked directly\\u000a\\u000a    See http://goo.gl/KsIlge\\u000a\");\n    }\n    this._bitField = 0;\n    this._fulfillmentHandler0 = undefined;\n    this._rejectionHandler0 = undefined;\n    this._progressHandler0 = undefined;\n    this._promise0 = undefined;\n    this._receiver0 = undefined;\n    this._settledValue = undefined;\n    this._boundTo = undefined;\n    if (resolver !== INTERNAL) this._resolveFromResolver(resolver);\n}\n\nPromise.prototype.toString = function () {\n    return \"[object Promise]\";\n};\n\nPromise.prototype.caught = Promise.prototype[\"catch\"] = function (fn) {\n    var len = arguments.length;\n    if (len > 1) {\n        var catchInstances = new Array(len - 1),\n            j = 0, i;\n        for (i = 0; i < len - 1; ++i) {\n            var item = arguments[i];\n            if (typeof item === \"function\") {\n                catchInstances[j++] = item;\n            } else {\n                return Promise.reject(\n                    new TypeError(\"Catch filter must inherit from Error or be a simple predicate function\\u000a\\u000a    See http://goo.gl/o84o68\\u000a\"));\n            }\n        }\n        catchInstances.length = j;\n        fn = arguments[i];\n        var catchFilter = new CatchFilter(catchInstances, fn, this);\n        return this._then(undefined, catchFilter.doFilter, undefined,\n            catchFilter, undefined);\n    }\n    return this._then(undefined, fn, undefined, undefined, undefined);\n};\n\nPromise.prototype.reflect = function () {\n    return this._then(reflect, reflect, undefined, this, undefined);\n};\n\nPromise.prototype.then = function (didFulfill, didReject, didProgress) {\n    if (isDebugging() && arguments.length > 0 &&\n        typeof didFulfill !== \"function\" &&\n        typeof didReject !== \"function\") {\n        var msg = \".then() only accepts functions but was passed: \" +\n                util.classString(didFulfill);\n        if (arguments.length > 1) {\n            msg += \", \" + util.classString(didReject);\n        }\n        this._warn(msg);\n    }\n    return this._then(didFulfill, didReject, didProgress,\n        undefined, undefined);\n};\n\nPromise.prototype.done = function (didFulfill, didReject, didProgress) {\n    var promise = this._then(didFulfill, didReject, didProgress,\n        undefined, undefined);\n    promise._setIsFinal();\n};\n\nPromise.prototype.spread = function (didFulfill, didReject) {\n    var followee = this._target();\n    var target = followee._isSpreadable()\n        ? (followee === this ? this : this.then())\n        : this.all();\n    return target._then(didFulfill, didReject, undefined, APPLY, undefined);\n};\n\nPromise.prototype.isCancellable = function () {\n    return !this.isResolved() &&\n        this._cancellable();\n};\n\nPromise.prototype.toJSON = function () {\n    var ret = {\n        isFulfilled: false,\n        isRejected: false,\n        fulfillmentValue: undefined,\n        rejectionReason: undefined\n    };\n    if (this.isFulfilled()) {\n        ret.fulfillmentValue = this.value();\n        ret.isFulfilled = true;\n    } else if (this.isRejected()) {\n        ret.rejectionReason = this.reason();\n        ret.isRejected = true;\n    }\n    return ret;\n};\n\nPromise.prototype.all = function () {\n    var ret = new PromiseArray(this).promise();\n    ret._setIsSpreadable();\n    return ret;\n};\n\nPromise.prototype.error = function (fn) {\n    return this.caught(util.originatesFromRejection, fn);\n};\n\nPromise.is = function (val) {\n    return val instanceof Promise;\n};\n\nPromise.fromNode = function(fn) {\n    var ret = new Promise(INTERNAL);\n    var result = tryCatch(fn)(nodebackForPromise(ret));\n    if (result === errorObj) {\n        ret._rejectCallback(result.e, true, true);\n    }\n    return ret;\n};\n\nPromise.all = function (promises) {\n    var ret = new PromiseArray(promises).promise();\n    ret._setIsSpreadable();\n    return ret;\n};\n\nPromise.defer = Promise.pending = function () {\n    var promise = new Promise(INTERNAL);\n    return new PromiseResolver(promise);\n};\n\nPromise.cast = function (obj) {\n    var ret = tryConvertToPromise(obj);\n    if (!(ret instanceof Promise)) {\n        var val = ret;\n        ret = new Promise(INTERNAL);\n        ret._fulfillUnchecked(val);\n    }\n    return ret;\n};\n\nPromise.resolve = Promise.fulfilled = Promise.cast;\n\nPromise.reject = Promise.rejected = function (reason) {\n    var ret = new Promise(INTERNAL);\n    ret._captureStackTrace();\n    ret._rejectCallback(reason, true);\n    return ret;\n};\n\nPromise.setScheduler = function(fn) {\n    if (typeof fn !== \"function\") throw new TypeError(\"fn must be a function\\u000a\\u000a    See http://goo.gl/916lJJ\\u000a\");\n    var prev = async._schedule;\n    async._schedule = fn;\n    return prev;\n};\n\nPromise.prototype._then = function (\n    didFulfill,\n    didReject,\n    didProgress,\n    receiver,\n    internalData\n) {\n    var haveInternalData = internalData !== undefined;\n    var ret = haveInternalData ? internalData : new Promise(INTERNAL);\n\n    if (!haveInternalData) {\n        ret._propagateFrom(this, 4 | 1);\n        ret._captureStackTrace();\n    }\n\n    var target = this._target();\n    if (target !== this) {\n        if (!haveInternalData) {\n            ret._setIsMigrated();\n            if (receiver === undefined) {\n                ret._setIsMigratingBinding();\n                receiver = this;\n            }\n        }\n    }\n\n    var callbackIndex =\n        target._addCallbacks(didFulfill, didReject, didProgress, ret, receiver);\n\n    if (target._isResolved() && !target._isSettlePromisesQueued()) {\n        async.invoke(\n            target._settlePromiseAtPostResolution, target, callbackIndex);\n    }\n\n    return ret;\n};\n\nPromise.prototype._settlePromiseAtPostResolution = function (index) {\n    if (this._isRejectionUnhandled()) this._unsetRejectionIsUnhandled();\n    this._settlePromiseAt(index);\n};\n\nPromise.prototype._length = function () {\n    return this._bitField & 131071;\n};\n\nPromise.prototype._isFollowingOrFulfilledOrRejected = function () {\n    return (this._bitField & 939524096) > 0;\n};\n\nPromise.prototype._isFollowing = function () {\n    return (this._bitField & 536870912) === 536870912;\n};\n\nPromise.prototype._setLength = function (len) {\n    this._bitField = (this._bitField & -131072) |\n        (len & 131071);\n};\n\nPromise.prototype._setFulfilled = function () {\n    this._bitField = this._bitField | 268435456;\n};\n\nPromise.prototype._setRejected = function () {\n    this._bitField = this._bitField | 134217728;\n};\n\nPromise.prototype._setFollowing = function () {\n    this._bitField = this._bitField | 536870912;\n};\n\nPromise.prototype._setIsFinal = function () {\n    this._bitField = this._bitField | 33554432;\n};\n\nPromise.prototype._isFinal = function () {\n    return (this._bitField & 33554432) > 0;\n};\n\nPromise.prototype._cancellable = function () {\n    return (this._bitField & 67108864) > 0;\n};\n\nPromise.prototype._setCancellable = function () {\n    this._bitField = this._bitField | 67108864;\n};\n\nPromise.prototype._unsetCancellable = function () {\n    this._bitField = this._bitField & (~67108864);\n};\n\nPromise.prototype._isSpreadable = function () {\n    return (this._bitField & 131072) > 0;\n};\n\nPromise.prototype._setIsSpreadable = function () {\n    this._bitField = this._bitField | 131072;\n};\n\nPromise.prototype._setIsMigrated = function () {\n    this._bitField = this._bitField | 4194304;\n};\n\nPromise.prototype._unsetIsMigrated = function () {\n    this._bitField = this._bitField & (~4194304);\n};\n\nPromise.prototype._isMigrated = function () {\n    return (this._bitField & 4194304) > 0;\n};\n\nPromise.prototype._receiverAt = function (index) {\n    var ret = index === 0\n        ? this._receiver0\n        : this[\n            index * 5 - 5 + 4];\n    if (this._isBound() && ret === undefined) {\n        return this._boundTo;\n    }\n    return ret;\n};\n\nPromise.prototype._promiseAt = function (index) {\n    return index === 0\n        ? this._promise0\n        : this[index * 5 - 5 + 3];\n};\n\nPromise.prototype._fulfillmentHandlerAt = function (index) {\n    return index === 0\n        ? this._fulfillmentHandler0\n        : this[index * 5 - 5 + 0];\n};\n\nPromise.prototype._rejectionHandlerAt = function (index) {\n    return index === 0\n        ? this._rejectionHandler0\n        : this[index * 5 - 5 + 1];\n};\n\nPromise.prototype._migrateCallbacks = function (follower, index) {\n    var fulfill = follower._fulfillmentHandlerAt(index);\n    var reject = follower._rejectionHandlerAt(index);\n    var progress = follower._progressHandlerAt(index);\n    var promise = follower._promiseAt(index);\n    var receiver = follower._receiverAt(index);\n    if (promise instanceof Promise) {\n        promise._setIsMigrated();\n        if (receiver === undefined) {\n            receiver = follower;\n            promise._setIsMigratingBinding();\n        }\n    }\n    this._addCallbacks(fulfill, reject, progress, promise, receiver);\n};\n\nPromise.prototype._addCallbacks = function (\n    fulfill,\n    reject,\n    progress,\n    promise,\n    receiver\n) {\n    var index = this._length();\n\n    if (index >= 131071 - 5) {\n        index = 0;\n        this._setLength(0);\n    }\n\n    if (index === 0) {\n        this._promise0 = promise;\n        if (receiver !== undefined) this._receiver0 = receiver;\n        if (typeof fulfill === \"function\" && !this._isCarryingStackTrace())\n            this._fulfillmentHandler0 = fulfill;\n        if (typeof reject === \"function\") this._rejectionHandler0 = reject;\n        if (typeof progress === \"function\") this._progressHandler0 = progress;\n    } else {\n        var base = index * 5 - 5;\n        this[base + 3] = promise;\n        this[base + 4] = receiver;\n        if (typeof fulfill === \"function\")\n            this[base + 0] = fulfill;\n        if (typeof reject === \"function\")\n            this[base + 1] = reject;\n        if (typeof progress === \"function\")\n            this[base + 2] = progress;\n    }\n    this._setLength(index + 1);\n    return index;\n};\n\nPromise.prototype._setProxyHandlers = function (receiver, promiseSlotValue) {\n    var index = this._length();\n\n    if (index >= 131071 - 5) {\n        index = 0;\n        this._setLength(0);\n    }\n    if (index === 0) {\n        this._promise0 = promiseSlotValue;\n        this._receiver0 = receiver;\n    } else {\n        var base = index * 5 - 5;\n        this[base + 3] = promiseSlotValue;\n        this[base + 4] = receiver;\n    }\n    this._setLength(index + 1);\n};\n\nPromise.prototype._proxyPromiseArray = function (promiseArray, index) {\n    this._setProxyHandlers(promiseArray, index);\n};\n\nPromise.prototype._resolveCallback = function(value, shouldBind) {\n    if (this._isFollowingOrFulfilledOrRejected()) return;\n    if (value === this)\n        return this._rejectCallback(makeSelfResolutionError(), false, true);\n    var maybePromise = tryConvertToPromise(value, this);\n    if (!(maybePromise instanceof Promise)) return this._fulfill(value);\n\n    var propagationFlags = 1 | (shouldBind ? 4 : 0);\n    this._propagateFrom(maybePromise, propagationFlags);\n    var promise = maybePromise._target();\n    if (promise._isPending()) {\n        var len = this._length();\n        for (var i = 0; i < len; ++i) {\n            promise._migrateCallbacks(this, i);\n        }\n        this._setFollowing();\n        this._setLength(0);\n        this._setFollowee(promise);\n    } else if (promise._isFulfilled()) {\n        this._fulfillUnchecked(promise._value());\n    } else {\n        this._rejectUnchecked(promise._reason(),\n            promise._getCarriedStackTrace());\n    }\n};\n\nPromise.prototype._rejectCallback =\nfunction(reason, synchronous, shouldNotMarkOriginatingFromRejection) {\n    if (!shouldNotMarkOriginatingFromRejection) {\n        util.markAsOriginatingFromRejection(reason);\n    }\n    var trace = util.ensureErrorObject(reason);\n    var hasStack = util.canAttachTrace(reason) &&\n        typeof trace.stack === \"string\" && trace.stack.length > 0;\n    this._attachExtraTrace(trace, synchronous ? hasStack : false);\n    this._reject(reason, trace === reason ? undefined : trace);\n};\n\nPromise.prototype._resolveFromResolver = function (resolver) {\n    var promise = this;\n    this._captureStackTrace();\n    this._pushContext();\n    var synchronous = true;\n    var r = tryCatch(resolver)(function(value) {\n        if (promise === null) return;\n        promise._resolveCallback(value);\n        promise = null;\n    }, function (reason) {\n        if (promise === null) return;\n        promise._rejectCallback(reason, synchronous);\n        promise = null;\n    });\n    synchronous = false;\n    this._popContext();\n\n    if (r !== undefined && r === errorObj && promise !== null) {\n        promise._rejectCallback(r.e, true, true);\n        promise = null;\n    }\n};\n\nPromise.prototype._settlePromiseFromHandler = function (\n    handler, receiver, value, promise\n) {\n    if (promise._isRejected()) return;\n    promise._pushContext();\n    var x;\n    if (receiver === APPLY && !this._isRejected()) {\n        x = tryCatch(handler).apply(this._boundTo, value);\n    } else {\n        x = tryCatch(handler).call(receiver, value);\n    }\n    promise._popContext();\n\n    if (x === errorObj || x === promise || x === NEXT_FILTER) {\n        var err = x === promise ? makeSelfResolutionError() : x.e;\n        promise._rejectCallback(err, false, true);\n    } else {\n        promise._resolveCallback(x);\n    }\n};\n\nPromise.prototype._target = function() {\n    var ret = this;\n    while (ret._isFollowing()) ret = ret._followee();\n    return ret;\n};\n\nPromise.prototype._followee = function() {\n    return this._rejectionHandler0;\n};\n\nPromise.prototype._setFollowee = function(promise) {\n    this._rejectionHandler0 = promise;\n};\n\nPromise.prototype._cleanValues = function () {\n    if (this._cancellable()) {\n        this._cancellationParent = undefined;\n    }\n};\n\nPromise.prototype._propagateFrom = function (parent, flags) {\n    if ((flags & 1) > 0 && parent._cancellable()) {\n        this._setCancellable();\n        this._cancellationParent = parent;\n    }\n    if ((flags & 4) > 0) {\n        this._setBoundTo(parent._boundTo);\n    }\n};\n\nPromise.prototype._fulfill = function (value) {\n    if (this._isFollowingOrFulfilledOrRejected()) return;\n    this._fulfillUnchecked(value);\n};\n\nPromise.prototype._reject = function (reason, carriedStackTrace) {\n    if (this._isFollowingOrFulfilledOrRejected()) return;\n    this._rejectUnchecked(reason, carriedStackTrace);\n};\n\nPromise.prototype._settlePromiseAt = function (index) {\n    var promise = this._promiseAt(index);\n    var isPromise = promise instanceof Promise;\n\n    if (isPromise && promise._isMigrated()) {\n        promise._unsetIsMigrated();\n        return async.invoke(this._settlePromiseAt, this, index);\n    }\n    var handler = this._isFulfilled()\n        ? this._fulfillmentHandlerAt(index)\n        : this._rejectionHandlerAt(index);\n\n    var carriedStackTrace =\n        this._isCarryingStackTrace() ? this._getCarriedStackTrace() : undefined;\n    var value = this._settledValue;\n    var receiver = this._receiverAt(index);\n    if (isPromise && promise._isMigratingBinding()) {\n        promise._unsetIsMigratingBinding();\n        receiver = receiver._boundTo;\n    }\n\n    this._clearCallbackDataAtIndex(index);\n\n    if (typeof handler === \"function\") {\n        if (!isPromise) {\n            handler.call(receiver, value, promise);\n        } else {\n            this._settlePromiseFromHandler(handler, receiver, value, promise);\n        }\n    } else if (receiver instanceof PromiseArray) {\n        if (!receiver._isResolved()) {\n            if (this._isFulfilled()) {\n                receiver._promiseFulfilled(value, promise);\n            }\n            else {\n                receiver._promiseRejected(value, promise);\n            }\n        }\n    } else if (isPromise) {\n        if (this._isFulfilled()) {\n            promise._fulfill(value);\n        } else {\n            promise._reject(value, carriedStackTrace);\n        }\n    }\n\n    if (index >= 4 && (index & 31) === 4)\n        async.invokeLater(this._setLength, this, 0);\n};\n\nPromise.prototype._clearCallbackDataAtIndex = function(index) {\n    if (index === 0) {\n        if (!this._isCarryingStackTrace()) {\n            this._fulfillmentHandler0 = undefined;\n        }\n        this._rejectionHandler0 =\n        this._progressHandler0 =\n        this._receiver0 =\n        this._promise0 = undefined;\n    } else {\n        var base = index * 5 - 5;\n        this[base + 3] =\n        this[base + 4] =\n        this[base + 0] =\n        this[base + 1] =\n        this[base + 2] = undefined;\n    }\n};\n\nPromise.prototype._isSettlePromisesQueued = function () {\n    return (this._bitField &\n            -1073741824) === -1073741824;\n};\n\nPromise.prototype._setSettlePromisesQueued = function () {\n    this._bitField = this._bitField | -1073741824;\n};\n\nPromise.prototype._unsetSettlePromisesQueued = function () {\n    this._bitField = this._bitField & (~-1073741824);\n};\n\nPromise.prototype._queueSettlePromises = function() {\n    async.settlePromises(this);\n    this._setSettlePromisesQueued();\n};\n\nPromise.prototype._fulfillUnchecked = function (value) {\n    if (value === this) {\n        var err = makeSelfResolutionError();\n        this._attachExtraTrace(err);\n        return this._rejectUnchecked(err, undefined);\n    }\n    this._setFulfilled();\n    this._settledValue = value;\n    this._cleanValues();\n\n    if (this._length() > 0) {\n        this._queueSettlePromises();\n    }\n};\n\nPromise.prototype._rejectUncheckedCheckError = function (reason) {\n    var trace = util.ensureErrorObject(reason);\n    this._rejectUnchecked(reason, trace === reason ? undefined : trace);\n};\n\nPromise.prototype._rejectUnchecked = function (reason, trace) {\n    if (reason === this) {\n        var err = makeSelfResolutionError();\n        this._attachExtraTrace(err);\n        return this._rejectUnchecked(err);\n    }\n    this._setRejected();\n    this._settledValue = reason;\n    this._cleanValues();\n\n    if (this._isFinal()) {\n        async.throwLater(function(e) {\n            if (\"stack\" in e) {\n                async.invokeFirst(\n                    CapturedTrace.unhandledRejection, undefined, e);\n            }\n            throw e;\n        }, trace === undefined ? reason : trace);\n        return;\n    }\n\n    if (trace !== undefined && trace !== reason) {\n        this._setCarriedStackTrace(trace);\n    }\n\n    if (this._length() > 0) {\n        this._queueSettlePromises();\n    } else {\n        this._ensurePossibleRejectionHandled();\n    }\n};\n\nPromise.prototype._settlePromises = function () {\n    this._unsetSettlePromisesQueued();\n    var len = this._length();\n    for (var i = 0; i < len; i++) {\n        this._settlePromiseAt(i);\n    }\n};\n\nPromise._makeSelfResolutionError = makeSelfResolutionError;\n_dereq_(\"./method.js\")(Promise, INTERNAL, tryConvertToPromise, apiRejection);\n_dereq_(\"./bind.js\")(Promise, INTERNAL, tryConvertToPromise);\n_dereq_(\"./finally.js\")(Promise, NEXT_FILTER, tryConvertToPromise);\n_dereq_(\"./direct_resolve.js\")(Promise);\n_dereq_(\"./synchronous_inspection.js\")(Promise);\n_dereq_(\"./join.js\")(Promise, PromiseArray, tryConvertToPromise, INTERNAL);\n\nutil.toFastProperties(Promise);\nutil.toFastProperties(Promise.prototype);\nPromise.Promise = Promise;\nCapturedTrace.setBounds(async.firstLineError, util.lastLineError);\n_dereq_('./cancel.js')(Promise);\n_dereq_('./map.js')(Promise, PromiseArray, apiRejection, tryConvertToPromise, INTERNAL);\n_dereq_('./nodeify.js')(Promise);\n_dereq_('./progress.js')(Promise, PromiseArray);\n_dereq_('./promisify.js')(Promise, INTERNAL);\n_dereq_('./reduce.js')(Promise, PromiseArray, apiRejection, tryConvertToPromise, INTERNAL);\n_dereq_('./timers.js')(Promise, INTERNAL);\n_dereq_('./each.js')(Promise, INTERNAL);\n_dereq_('./filter.js')(Promise, INTERNAL);\n\nPromise.prototype = Promise.prototype;\nreturn Promise;\n\n};\n\n},{\"./async.js\":1,\"./bind.js\":2,\"./cancel.js\":4,\"./captured_trace.js\":5,\"./catch_filter.js\":6,\"./context.js\":7,\"./debuggability.js\":8,\"./direct_resolve.js\":9,\"./each.js\":10,\"./errors.js\":11,\"./filter.js\":13,\"./finally.js\":14,\"./join.js\":15,\"./map.js\":16,\"./method.js\":17,\"./nodeify.js\":18,\"./progress.js\":19,\"./promise_array.js\":21,\"./promise_resolver.js\":22,\"./promisify.js\":23,\"./reduce.js\":25,\"./synchronous_inspection.js\":27,\"./thenables.js\":28,\"./timers.js\":29,\"./util.js\":30}],21:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL, tryConvertToPromise,\n    apiRejection) {\nvar util = _dereq_(\"./util.js\");\nvar isArray = util.isArray;\n\nfunction toResolutionValue(val) {\n    switch(val) {\n    case -2: return [];\n    case -3: return {};\n    }\n}\n\nfunction PromiseArray(values) {\n    var promise = this._promise = new Promise(INTERNAL);\n    var parent;\n    if (values instanceof Promise) {\n        parent = values;\n        promise._propagateFrom(parent, 1 | 4);\n    }\n    this._values = values;\n    this._length = 0;\n    this._totalResolved = 0;\n    this._init(undefined, -2);\n}\nPromiseArray.prototype.length = function () {\n    return this._length;\n};\n\nPromiseArray.prototype.promise = function () {\n    return this._promise;\n};\n\nPromiseArray.prototype._init = function init(_, resolveValueIfEmpty) {\n    var values = tryConvertToPromise(this._values, this._promise);\n    if (values instanceof Promise) {\n        values._setBoundTo(this._promise._boundTo);\n        values = values._target();\n        this._values = values;\n        if (values._isFulfilled()) {\n            values = values._value();\n            if (!isArray(values)) {\n                var err = new Promise.TypeError(\"expecting an array, a promise or a thenable\\u000a\\u000a    See http://goo.gl/s8MMhc\\u000a\");\n                this.__hardReject__(err);\n                return;\n            }\n        } else if (values._isPending()) {\n            values._then(\n                init,\n                this._reject,\n                undefined,\n                this,\n                resolveValueIfEmpty\n           );\n            return;\n        } else {\n            this._reject(values._reason());\n            return;\n        }\n    } else if (!isArray(values)) {\n        this._promise._reject(apiRejection(\"expecting an array, a promise or a thenable\\u000a\\u000a    See http://goo.gl/s8MMhc\\u000a\")._reason());\n        return;\n    }\n\n    if (values.length === 0) {\n        if (resolveValueIfEmpty === -5) {\n            this._resolveEmptyArray();\n        }\n        else {\n            this._resolve(toResolutionValue(resolveValueIfEmpty));\n        }\n        return;\n    }\n    var len = this.getActualLength(values.length);\n    this._length = len;\n    this._values = this.shouldCopyValues() ? new Array(len) : this._values;\n    var promise = this._promise;\n    for (var i = 0; i < len; ++i) {\n        var isResolved = this._isResolved();\n        var maybePromise = tryConvertToPromise(values[i], promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            if (isResolved) {\n                maybePromise._unsetRejectionIsUnhandled();\n            } else if (maybePromise._isPending()) {\n                maybePromise._proxyPromiseArray(this, i);\n            } else if (maybePromise._isFulfilled()) {\n                this._promiseFulfilled(maybePromise._value(), i);\n            } else {\n                this._promiseRejected(maybePromise._reason(), i);\n            }\n        } else if (!isResolved) {\n            this._promiseFulfilled(maybePromise, i);\n        }\n    }\n};\n\nPromiseArray.prototype._isResolved = function () {\n    return this._values === null;\n};\n\nPromiseArray.prototype._resolve = function (value) {\n    this._values = null;\n    this._promise._fulfill(value);\n};\n\nPromiseArray.prototype.__hardReject__ =\nPromiseArray.prototype._reject = function (reason) {\n    this._values = null;\n    this._promise._rejectCallback(reason, false, true);\n};\n\nPromiseArray.prototype._promiseProgressed = function (progressValue, index) {\n    this._promise._progress({\n        index: index,\n        value: progressValue\n    });\n};\n\n\nPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    this._values[index] = value;\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= this._length) {\n        this._resolve(this._values);\n    }\n};\n\nPromiseArray.prototype._promiseRejected = function (reason, index) {\n    this._totalResolved++;\n    this._reject(reason);\n};\n\nPromiseArray.prototype.shouldCopyValues = function () {\n    return true;\n};\n\nPromiseArray.prototype.getActualLength = function (len) {\n    return len;\n};\n\nreturn PromiseArray;\n};\n\n},{\"./util.js\":30}],22:[function(_dereq_,module,exports){\n\"use strict\";\nvar util = _dereq_(\"./util.js\");\nvar maybeWrapAsError = util.maybeWrapAsError;\nvar errors = _dereq_(\"./errors.js\");\nvar TimeoutError = errors.TimeoutError;\nvar OperationalError = errors.OperationalError;\nvar haveGetters = util.haveGetters;\nvar es5 = _dereq_(\"./es5.js\");\n\nfunction isUntypedError(obj) {\n    return obj instanceof Error &&\n        es5.getPrototypeOf(obj) === Error.prototype;\n}\n\nvar rErrorKey = /^(?:name|message|stack|cause)$/;\nfunction wrapAsOperationalError(obj) {\n    var ret;\n    if (isUntypedError(obj)) {\n        ret = new OperationalError(obj);\n        ret.name = obj.name;\n        ret.message = obj.message;\n        ret.stack = obj.stack;\n        var keys = es5.keys(obj);\n        for (var i = 0; i < keys.length; ++i) {\n            var key = keys[i];\n            if (!rErrorKey.test(key)) {\n                ret[key] = obj[key];\n            }\n        }\n        return ret;\n    }\n    util.markAsOriginatingFromRejection(obj);\n    return obj;\n}\n\nfunction nodebackForPromise(promise) {\n    return function(err, value) {\n        if (promise === null) return;\n\n        if (err) {\n            var wrapped = wrapAsOperationalError(maybeWrapAsError(err));\n            promise._attachExtraTrace(wrapped);\n            promise._reject(wrapped);\n        } else if (arguments.length > 2) {\n            var $_len = arguments.length;var args = new Array($_len - 1); for(var $_i = 1; $_i < $_len; ++$_i) {args[$_i - 1] = arguments[$_i];}\n            promise._fulfill(args);\n        } else {\n            promise._fulfill(value);\n        }\n\n        promise = null;\n    };\n}\n\n\nvar PromiseResolver;\nif (!haveGetters) {\n    PromiseResolver = function (promise) {\n        this.promise = promise;\n        this.asCallback = nodebackForPromise(promise);\n        this.callback = this.asCallback;\n    };\n}\nelse {\n    PromiseResolver = function (promise) {\n        this.promise = promise;\n    };\n}\nif (haveGetters) {\n    var prop = {\n        get: function() {\n            return nodebackForPromise(this.promise);\n        }\n    };\n    es5.defineProperty(PromiseResolver.prototype, \"asCallback\", prop);\n    es5.defineProperty(PromiseResolver.prototype, \"callback\", prop);\n}\n\nPromiseResolver._nodebackForPromise = nodebackForPromise;\n\nPromiseResolver.prototype.toString = function () {\n    return \"[object PromiseResolver]\";\n};\n\nPromiseResolver.prototype.resolve =\nPromiseResolver.prototype.fulfill = function (value) {\n    if (!(this instanceof PromiseResolver)) {\n        throw new TypeError(\"Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\\u000a\\u000a    See http://goo.gl/sdkXL9\\u000a\");\n    }\n    this.promise._resolveCallback(value);\n};\n\nPromiseResolver.prototype.reject = function (reason) {\n    if (!(this instanceof PromiseResolver)) {\n        throw new TypeError(\"Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\\u000a\\u000a    See http://goo.gl/sdkXL9\\u000a\");\n    }\n    this.promise._rejectCallback(reason);\n};\n\nPromiseResolver.prototype.progress = function (value) {\n    if (!(this instanceof PromiseResolver)) {\n        throw new TypeError(\"Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\\u000a\\u000a    See http://goo.gl/sdkXL9\\u000a\");\n    }\n    this.promise._progress(value);\n};\n\nPromiseResolver.prototype.cancel = function (err) {\n    this.promise.cancel(err);\n};\n\nPromiseResolver.prototype.timeout = function () {\n    this.reject(new TimeoutError(\"timeout\"));\n};\n\nPromiseResolver.prototype.isResolved = function () {\n    return this.promise.isResolved();\n};\n\nPromiseResolver.prototype.toJSON = function () {\n    return this.promise.toJSON();\n};\n\nmodule.exports = PromiseResolver;\n\n},{\"./errors.js\":11,\"./es5.js\":12,\"./util.js\":30}],23:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar THIS = {};\nvar util = _dereq_(\"./util.js\");\nvar nodebackForPromise = _dereq_(\"./promise_resolver.js\")\n    ._nodebackForPromise;\nvar withAppended = util.withAppended;\nvar maybeWrapAsError = util.maybeWrapAsError;\nvar canEvaluate = util.canEvaluate;\nvar TypeError = _dereq_(\"./errors\").TypeError;\nvar defaultSuffix = \"Async\";\nvar defaultFilter = function(name, func) {\n    return util.isIdentifier(name) &&\n        name.charAt(0) !== \"_\" &&\n        !util.isClass(func);\n};\nvar defaultPromisified = {__isPromisified__: true};\n\nfunction isPromisified(fn) {\n    try {\n        return fn.__isPromisified__ === true;\n    }\n    catch (e) {\n        return false;\n    }\n}\n\nfunction hasPromisified(obj, key, suffix) {\n    var val = util.getDataPropertyOrDefault(obj, key + suffix,\n                                            defaultPromisified);\n    return val ? isPromisified(val) : false;\n}\nfunction checkValid(ret, suffix, suffixRegexp) {\n    for (var i = 0; i < ret.length; i += 2) {\n        var key = ret[i];\n        if (suffixRegexp.test(key)) {\n            var keyWithoutAsyncSuffix = key.replace(suffixRegexp, \"\");\n            for (var j = 0; j < ret.length; j += 2) {\n                if (ret[j] === keyWithoutAsyncSuffix) {\n                    throw new TypeError(\"Cannot promisify an API that has normal methods with '%s'-suffix\\u000a\\u000a    See http://goo.gl/iWrZbw\\u000a\"\n                        .replace(\"%s\", suffix));\n                }\n            }\n        }\n    }\n}\n\nfunction promisifiableMethods(obj, suffix, suffixRegexp, filter) {\n    var keys = util.inheritedDataKeys(obj);\n    var ret = [];\n    for (var i = 0; i < keys.length; ++i) {\n        var key = keys[i];\n        var value = obj[key];\n        var passesDefaultFilter = filter === defaultFilter\n            ? true : defaultFilter(key, value, obj);\n        if (typeof value === \"function\" &&\n            !isPromisified(value) &&\n            !hasPromisified(obj, key, suffix) &&\n            filter(key, value, obj, passesDefaultFilter)) {\n            ret.push(key, value);\n        }\n    }\n    checkValid(ret, suffix, suffixRegexp);\n    return ret;\n}\n\nvar escapeIdentRegex = function(str) {\n    return str.replace(/([$])/, \"\\\\$\");\n};\n\nvar makeNodePromisifiedEval;\nif (!true) {\nvar switchCaseArgumentOrder = function(likelyArgumentCount) {\n    var ret = [likelyArgumentCount];\n    var min = Math.max(0, likelyArgumentCount - 1 - 5);\n    for(var i = likelyArgumentCount - 1; i >= min; --i) {\n        ret.push(i);\n    }\n    for(var i = likelyArgumentCount + 1; i <= 5; ++i) {\n        ret.push(i);\n    }\n    return ret;\n};\n\nvar argumentSequence = function(argumentCount) {\n    return util.filledRange(argumentCount, \"arguments[\", \"]\");\n};\n\nvar parameterDeclaration = function(parameterCount) {\n    return util.filledRange(parameterCount, \"_arg\", \"\");\n};\n\nvar parameterCount = function(fn) {\n    if (typeof fn.length === \"number\") {\n        return Math.max(Math.min(fn.length, 1023 + 1), 0);\n    }\n    return 0;\n};\n\nvar generatePropertyAccess = function(key) {\n    if (util.isIdentifier(key)) {\n        return \".\" + key;\n    }\n    else return \"['\" + key.replace(/(['\\\\])/g, \"\\\\$1\") + \"']\";\n};\n\nmakeNodePromisifiedEval =\nfunction(callback, receiver, originalName, fn, suffix) {\n    var newParameterCount = Math.max(0, parameterCount(fn) - 1);\n    var argumentOrder = switchCaseArgumentOrder(newParameterCount);\n    var callbackName =\n        (typeof originalName === \"string\" && util.isIdentifier(originalName)\n            ? originalName + suffix\n            : \"promisified\");\n\n    function generateCallForArgumentCount(count) {\n        var args = argumentSequence(count).join(\", \");\n        var comma = count > 0 ? \", \" : \"\";\n        var ret;\n        if (typeof callback === \"string\") {\n            ret = \"                                                          \\n\\\n                this.method({{args}}, fn);                                   \\n\\\n                break;                                                       \\n\\\n            \".replace(\".method\", generatePropertyAccess(callback));\n        } else if (receiver === THIS) {\n            ret =  \"                                                         \\n\\\n                callback.call(this, {{args}}, fn);                           \\n\\\n                break;                                                       \\n\\\n            \";\n        } else if (receiver !== undefined) {\n            ret =  \"                                                         \\n\\\n                callback.call(receiver, {{args}}, fn);                       \\n\\\n                break;                                                       \\n\\\n            \";\n        } else {\n            ret =  \"                                                         \\n\\\n                callback({{args}}, fn);                                      \\n\\\n                break;                                                       \\n\\\n            \";\n        }\n        return ret.replace(\"{{args}}\", args).replace(\", \", comma);\n    }\n\n    function generateArgumentSwitchCase() {\n        var ret = \"\";\n        for(var i = 0; i < argumentOrder.length; ++i) {\n            ret += \"case \" + argumentOrder[i] +\":\" +\n                generateCallForArgumentCount(argumentOrder[i]);\n        }\n        var codeForCall;\n        if (typeof callback === \"string\") {\n            codeForCall = \"                                                  \\n\\\n                this.property.apply(this, args);                             \\n\\\n            \"\n                .replace(\".property\", generatePropertyAccess(callback));\n        } else if (receiver === THIS) {\n            codeForCall = \"                                                  \\n\\\n                callback.apply(this, args);                                  \\n\\\n            \";\n        } else {\n            codeForCall = \"                                                  \\n\\\n                callback.apply(receiver, args);                              \\n\\\n            \";\n        }\n\n        ret += \"                                                             \\n\\\n        default:                                                             \\n\\\n            var args = new Array(len + 1);                                   \\n\\\n            var i = 0;                                                       \\n\\\n            for (var i = 0; i < len; ++i) {                                  \\n\\\n               args[i] = arguments[i];                                       \\n\\\n            }                                                                \\n\\\n            args[i] = fn;                                                    \\n\\\n            [CodeForCall]                                                    \\n\\\n            break;                                                           \\n\\\n        \".replace(\"[CodeForCall]\", codeForCall);\n        return ret;\n    }\n\n    return new Function(\"Promise\",\n                        \"callback\",\n                        \"receiver\",\n                        \"withAppended\",\n                        \"maybeWrapAsError\",\n                        \"nodebackForPromise\",\n                        \"INTERNAL\",\"                                         \\n\\\n        var ret = function (Parameters) {                        \\n\\\n            'use strict';                                                    \\n\\\n            var len = arguments.length;                                      \\n\\\n            var promise = new Promise(INTERNAL);                             \\n\\\n            promise._captureStackTrace();                                    \\n\\\n            promise._setIsSpreadable();                                      \\n\\\n            var fn = nodebackForPromise(promise);                            \\n\\\n            try {                                                            \\n\\\n                switch(len) {                                                \\n\\\n                    [CodeForSwitchCase]                                      \\n\\\n                }                                                            \\n\\\n            } catch (e) {                                                    \\n\\\n                var wrapped = maybeWrapAsError(e);                           \\n\\\n                promise._attachExtraTrace(wrapped);                          \\n\\\n                promise._reject(wrapped);                                    \\n\\\n            }                                                                \\n\\\n            return promise;                                                  \\n\\\n        };                                                                   \\n\\\n        ret.__isPromisified__ = true;                                        \\n\\\n        return ret;                                                          \\n\\\n        \"\n        .replace(\"FunctionName\", callbackName)\n        .replace(\"Parameters\", parameterDeclaration(newParameterCount))\n        .replace(\"[CodeForSwitchCase]\", generateArgumentSwitchCase()))(\n            Promise,\n            callback,\n            receiver,\n            withAppended,\n            maybeWrapAsError,\n            nodebackForPromise,\n            INTERNAL\n        );\n};\n}\n\nfunction makeNodePromisifiedClosure(callback, receiver) {\n    function promisified() {\n        var _receiver = receiver;\n        if (receiver === THIS) _receiver = this;\n        if (typeof callback === \"string\") {\n            callback = _receiver[callback];\n        }\n        var promise = new Promise(INTERNAL);\n        promise._captureStackTrace();\n        promise._setIsSpreadable();\n        var fn = nodebackForPromise(promise);\n        try {\n            callback.apply(_receiver, withAppended(arguments, fn));\n        } catch(e) {\n            var wrapped = maybeWrapAsError(e);\n            promise._attachExtraTrace(wrapped);\n            promise._reject(wrapped);\n        }\n        return promise;\n    }\n    promisified.__isPromisified__ = true;\n    return promisified;\n}\n\nvar makeNodePromisified = canEvaluate\n    ? makeNodePromisifiedEval\n    : makeNodePromisifiedClosure;\n\nfunction promisifyAll(obj, suffix, filter, promisifier) {\n    var suffixRegexp = new RegExp(escapeIdentRegex(suffix) + \"$\");\n    var methods =\n        promisifiableMethods(obj, suffix, suffixRegexp, filter);\n\n    for (var i = 0, len = methods.length; i < len; i+= 2) {\n        var key = methods[i];\n        var fn = methods[i+1];\n        var promisifiedKey = key + suffix;\n        obj[promisifiedKey] = promisifier === makeNodePromisified\n                ? makeNodePromisified(key, THIS, key, fn, suffix)\n                : promisifier(fn, function() {\n                    return makeNodePromisified(key, THIS, key, fn, suffix);\n                });\n    }\n    util.toFastProperties(obj);\n    return obj;\n}\n\nfunction promisify(callback, receiver) {\n    return makeNodePromisified(callback, receiver, undefined, callback);\n}\n\nPromise.promisify = function (fn, receiver) {\n    if (typeof fn !== \"function\") {\n        throw new TypeError(\"fn must be a function\\u000a\\u000a    See http://goo.gl/916lJJ\\u000a\");\n    }\n    if (isPromisified(fn)) {\n        return fn;\n    }\n    return promisify(fn, arguments.length < 2 ? THIS : receiver);\n};\n\nPromise.promisifyAll = function (target, options) {\n    if (typeof target !== \"function\" && typeof target !== \"object\") {\n        throw new TypeError(\"the target of promisifyAll must be an object or a function\\u000a\\u000a    See http://goo.gl/9ITlV0\\u000a\");\n    }\n    options = Object(options);\n    var suffix = options.suffix;\n    if (typeof suffix !== \"string\") suffix = defaultSuffix;\n    var filter = options.filter;\n    if (typeof filter !== \"function\") filter = defaultFilter;\n    var promisifier = options.promisifier;\n    if (typeof promisifier !== \"function\") promisifier = makeNodePromisified;\n\n    if (!util.isIdentifier(suffix)) {\n        throw new RangeError(\"suffix must be a valid identifier\\u000a\\u000a    See http://goo.gl/8FZo5V\\u000a\");\n    }\n\n    var keys = util.inheritedDataKeys(target, {includeHidden: true});\n    for (var i = 0; i < keys.length; ++i) {\n        var value = target[keys[i]];\n        if (keys[i] !== \"constructor\" &&\n            util.isClass(value)) {\n            promisifyAll(value.prototype, suffix, filter, promisifier);\n            promisifyAll(value, suffix, filter, promisifier);\n        }\n    }\n\n    return promisifyAll(target, suffix, filter, promisifier);\n};\n};\n\n\n},{\"./errors\":11,\"./promise_resolver.js\":22,\"./util.js\":30}],24:[function(_dereq_,module,exports){\n\"use strict\";\nfunction arrayMove(src, srcIndex, dst, dstIndex, len) {\n    for (var j = 0; j < len; ++j) {\n        dst[j + dstIndex] = src[j + srcIndex];\n        src[j + srcIndex] = void 0;\n    }\n}\n\nfunction Queue(capacity) {\n    this._capacity = capacity;\n    this._length = 0;\n    this._front = 0;\n}\n\nQueue.prototype._willBeOverCapacity = function (size) {\n    return this._capacity < size;\n};\n\nQueue.prototype._pushOne = function (arg) {\n    var length = this.length();\n    this._checkCapacity(length + 1);\n    var i = (this._front + length) & (this._capacity - 1);\n    this[i] = arg;\n    this._length = length + 1;\n};\n\nQueue.prototype._unshiftOne = function(value) {\n    var capacity = this._capacity;\n    this._checkCapacity(this.length() + 1);\n    var front = this._front;\n    var i = (((( front - 1 ) &\n                    ( capacity - 1) ) ^ capacity ) - capacity );\n    this[i] = value;\n    this._front = i;\n    this._length = this.length() + 1;\n};\n\nQueue.prototype.unshift = function(fn, receiver, arg) {\n    this._unshiftOne(arg);\n    this._unshiftOne(receiver);\n    this._unshiftOne(fn);\n};\n\nQueue.prototype.push = function (fn, receiver, arg) {\n    var length = this.length() + 3;\n    if (this._willBeOverCapacity(length)) {\n        this._pushOne(fn);\n        this._pushOne(receiver);\n        this._pushOne(arg);\n        return;\n    }\n    var j = this._front + length - 3;\n    this._checkCapacity(length);\n    var wrapMask = this._capacity - 1;\n    this[(j + 0) & wrapMask] = fn;\n    this[(j + 1) & wrapMask] = receiver;\n    this[(j + 2) & wrapMask] = arg;\n    this._length = length;\n};\n\nQueue.prototype.shift = function () {\n    var front = this._front,\n        ret = this[front];\n\n    this[front] = undefined;\n    this._front = (front + 1) & (this._capacity - 1);\n    this._length--;\n    return ret;\n};\n\nQueue.prototype.length = function () {\n    return this._length;\n};\n\nQueue.prototype._checkCapacity = function (size) {\n    if (this._capacity < size) {\n        this._resizeTo(this._capacity << 1);\n    }\n};\n\nQueue.prototype._resizeTo = function (capacity) {\n    var oldCapacity = this._capacity;\n    this._capacity = capacity;\n    var front = this._front;\n    var length = this._length;\n    var moveItemsCount = (front + length) & (oldCapacity - 1);\n    arrayMove(this, 0, this, oldCapacity, moveItemsCount);\n};\n\nmodule.exports = Queue;\n\n},{}],25:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise,\n                          PromiseArray,\n                          apiRejection,\n                          tryConvertToPromise,\n                          INTERNAL) {\nvar util = _dereq_(\"./util.js\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nfunction ReductionPromiseArray(promises, fn, accum, _each) {\n    this.constructor$(promises);\n    this._promise._captureStackTrace();\n    this._preservedValues = _each === INTERNAL ? [] : null;\n    this._zerothIsAccum = (accum === undefined);\n    this._gotAccum = false;\n    this._reducingIndex = (this._zerothIsAccum ? 1 : 0);\n    this._valuesPhase = undefined;\n    var maybePromise = tryConvertToPromise(accum, this._promise);\n    var rejected = false;\n    var isPromise = maybePromise instanceof Promise;\n    if (isPromise) {\n        maybePromise = maybePromise._target();\n        if (maybePromise._isPending()) {\n            maybePromise._proxyPromiseArray(this, -1);\n        } else if (maybePromise._isFulfilled()) {\n            accum = maybePromise._value();\n            this._gotAccum = true;\n        } else {\n            this._reject(maybePromise._reason());\n            rejected = true;\n        }\n    }\n    if (!(isPromise || this._zerothIsAccum)) this._gotAccum = true;\n    this._callback = fn;\n    this._accum = accum;\n    if (!rejected) this._init$(undefined, -5);\n}\nutil.inherits(ReductionPromiseArray, PromiseArray);\n\nReductionPromiseArray.prototype._init = function () {};\n\nReductionPromiseArray.prototype._resolveEmptyArray = function () {\n    if (this._gotAccum || this._zerothIsAccum) {\n        this._resolve(this._preservedValues !== null\n                        ? [] : this._accum);\n    }\n};\n\nReductionPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    var values = this._values;\n    values[index] = value;\n    var length = this.length();\n    var preservedValues = this._preservedValues;\n    var isEach = preservedValues !== null;\n    var gotAccum = this._gotAccum;\n    var valuesPhase = this._valuesPhase;\n    var valuesPhaseIndex;\n    if (!valuesPhase) {\n        valuesPhase = this._valuesPhase = new Array(length);\n        for (valuesPhaseIndex=0; valuesPhaseIndex<length; ++valuesPhaseIndex) {\n            valuesPhase[valuesPhaseIndex] = 0;\n        }\n    }\n    valuesPhaseIndex = valuesPhase[index];\n\n    if (index === 0 && this._zerothIsAccum) {\n        this._accum = value;\n        this._gotAccum = gotAccum = true;\n        valuesPhase[index] = ((valuesPhaseIndex === 0)\n            ? 1 : 2);\n    } else if (index === -1) {\n        this._accum = value;\n        this._gotAccum = gotAccum = true;\n    } else {\n        if (valuesPhaseIndex === 0) {\n            valuesPhase[index] = 1;\n        } else {\n            valuesPhase[index] = 2;\n            this._accum = value;\n        }\n    }\n    if (!gotAccum) return;\n\n    var callback = this._callback;\n    var receiver = this._promise._boundTo;\n    var ret;\n\n    for (var i = this._reducingIndex; i < length; ++i) {\n        valuesPhaseIndex = valuesPhase[i];\n        if (valuesPhaseIndex === 2) {\n            this._reducingIndex = i + 1;\n            continue;\n        }\n        if (valuesPhaseIndex !== 1) return;\n        value = values[i];\n        this._promise._pushContext();\n        if (isEach) {\n            preservedValues.push(value);\n            ret = tryCatch(callback).call(receiver, value, i, length);\n        }\n        else {\n            ret = tryCatch(callback)\n                .call(receiver, this._accum, value, i, length);\n        }\n        this._promise._popContext();\n\n        if (ret === errorObj) return this._reject(ret.e);\n\n        var maybePromise = tryConvertToPromise(ret, this._promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            if (maybePromise._isPending()) {\n                valuesPhase[i] = 4;\n                return maybePromise._proxyPromiseArray(this, i);\n            } else if (maybePromise._isFulfilled()) {\n                ret = maybePromise._value();\n            } else {\n                return this._reject(maybePromise._reason());\n            }\n        }\n\n        this._reducingIndex = i + 1;\n        this._accum = ret;\n    }\n\n    this._resolve(isEach ? preservedValues : this._accum);\n};\n\nfunction reduce(promises, fn, initialValue, _each) {\n    if (typeof fn !== \"function\") return apiRejection(\"fn must be a function\\u000a\\u000a    See http://goo.gl/916lJJ\\u000a\");\n    var array = new ReductionPromiseArray(promises, fn, initialValue, _each);\n    return array.promise();\n}\n\nPromise.prototype.reduce = function (fn, initialValue) {\n    return reduce(this, fn, initialValue, null);\n};\n\nPromise.reduce = function (promises, fn, initialValue, _each) {\n    return reduce(promises, fn, initialValue, _each);\n};\n};\n\n},{\"./util.js\":30}],26:[function(_dereq_,module,exports){\n\"use strict\";\nvar schedule;\nif (_dereq_(\"./util.js\").isNode) {\n    var version = process.version.split(\".\").map(Number);\n    schedule = (version[0] === 0 && version[1] > 10) || (version[0] > 0)\n        ? global.setImmediate : process.nextTick;\n}\nelse if (typeof MutationObserver !== \"undefined\") {\n    schedule = function(fn) {\n        var div = document.createElement(\"div\");\n        var observer = new MutationObserver(fn);\n        observer.observe(div, {attributes: true});\n        return function() { div.classList.toggle(\"foo\"); };\n    };\n    schedule.isStatic = true;\n}\nelse if (typeof setTimeout !== \"undefined\") {\n    schedule = function (fn) {\n        setTimeout(fn, 0);\n    };\n}\nelse {\n    schedule = function() {\n        throw new Error(\"No async scheduler available\\u000a\\u000a    See http://goo.gl/m3OTXk\\u000a\");\n    };\n}\nmodule.exports = schedule;\n\n},{\"./util.js\":30}],27:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise) {\nfunction PromiseInspection(promise) {\n    if (promise !== undefined) {\n        promise = promise._target();\n        this._bitField = promise._bitField;\n        this._settledValue = promise._settledValue;\n    }\n    else {\n        this._bitField = 0;\n        this._settledValue = undefined;\n    }\n}\n\nPromiseInspection.prototype.value = function () {\n    if (!this.isFulfilled()) {\n        throw new TypeError(\"cannot get fulfillment value of a non-fulfilled promise\\u000a\\u000a    See http://goo.gl/hc1DLj\\u000a\");\n    }\n    return this._settledValue;\n};\n\nPromiseInspection.prototype.error =\nPromiseInspection.prototype.reason = function () {\n    if (!this.isRejected()) {\n        throw new TypeError(\"cannot get rejection reason of a non-rejected promise\\u000a\\u000a    See http://goo.gl/hPuiwB\\u000a\");\n    }\n    return this._settledValue;\n};\n\nPromiseInspection.prototype.isFulfilled =\nPromise.prototype._isFulfilled = function () {\n    return (this._bitField & 268435456) > 0;\n};\n\nPromiseInspection.prototype.isRejected =\nPromise.prototype._isRejected = function () {\n    return (this._bitField & 134217728) > 0;\n};\n\nPromiseInspection.prototype.isPending =\nPromise.prototype._isPending = function () {\n    return (this._bitField & 402653184) === 0;\n};\n\nPromiseInspection.prototype.isResolved =\nPromise.prototype._isResolved = function () {\n    return (this._bitField & 402653184) > 0;\n};\n\nPromise.prototype.isPending = function() {\n    return this._target()._isPending();\n};\n\nPromise.prototype.isRejected = function() {\n    return this._target()._isRejected();\n};\n\nPromise.prototype.isFulfilled = function() {\n    return this._target()._isFulfilled();\n};\n\nPromise.prototype.isResolved = function() {\n    return this._target()._isResolved();\n};\n\nPromise.prototype._value = function() {\n    return this._settledValue;\n};\n\nPromise.prototype._reason = function() {\n    this._unsetRejectionIsUnhandled();\n    return this._settledValue;\n};\n\nPromise.prototype.value = function() {\n    var target = this._target();\n    if (!target.isFulfilled()) {\n        throw new TypeError(\"cannot get fulfillment value of a non-fulfilled promise\\u000a\\u000a    See http://goo.gl/hc1DLj\\u000a\");\n    }\n    return target._settledValue;\n};\n\nPromise.prototype.reason = function() {\n    var target = this._target();\n    if (!target.isRejected()) {\n        throw new TypeError(\"cannot get rejection reason of a non-rejected promise\\u000a\\u000a    See http://goo.gl/hPuiwB\\u000a\");\n    }\n    target._unsetRejectionIsUnhandled();\n    return target._settledValue;\n};\n\n\nPromise.PromiseInspection = PromiseInspection;\n};\n\n},{}],28:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar util = _dereq_(\"./util.js\");\nvar errorObj = util.errorObj;\nvar isObject = util.isObject;\n\nfunction tryConvertToPromise(obj, context) {\n    if (isObject(obj)) {\n        if (obj instanceof Promise) {\n            return obj;\n        }\n        else if (isAnyBluebirdPromise(obj)) {\n            var ret = new Promise(INTERNAL);\n            obj._then(\n                ret._fulfillUnchecked,\n                ret._rejectUncheckedCheckError,\n                ret._progressUnchecked,\n                ret,\n                null\n            );\n            return ret;\n        }\n        var then = util.tryCatch(getThen)(obj);\n        if (then === errorObj) {\n            if (context) context._pushContext();\n            var ret = Promise.reject(then.e);\n            if (context) context._popContext();\n            return ret;\n        } else if (typeof then === \"function\") {\n            return doThenable(obj, then, context);\n        }\n    }\n    return obj;\n}\n\nfunction getThen(obj) {\n    return obj.then;\n}\n\nvar hasProp = {}.hasOwnProperty;\nfunction isAnyBluebirdPromise(obj) {\n    return hasProp.call(obj, \"_promise0\");\n}\n\nfunction doThenable(x, then, context) {\n    var promise = new Promise(INTERNAL);\n    var ret = promise;\n    if (context) context._pushContext();\n    promise._captureStackTrace();\n    if (context) context._popContext();\n    var synchronous = true;\n    var result = util.tryCatch(then).call(x,\n                                        resolveFromThenable,\n                                        rejectFromThenable,\n                                        progressFromThenable);\n    synchronous = false;\n    if (promise && result === errorObj) {\n        promise._rejectCallback(result.e, true, true);\n        promise = null;\n    }\n\n    function resolveFromThenable(value) {\n        if (!promise) return;\n        if (x === value) {\n            promise._rejectCallback(\n                Promise._makeSelfResolutionError(), false, true);\n        } else {\n            promise._resolveCallback(value);\n        }\n        promise = null;\n    }\n\n    function rejectFromThenable(reason) {\n        if (!promise) return;\n        promise._rejectCallback(reason, synchronous, true);\n        promise = null;\n    }\n\n    function progressFromThenable(value) {\n        if (!promise) return;\n        if (typeof promise._progress === \"function\") {\n            promise._progress(value);\n        }\n    }\n    return ret;\n}\n\nreturn tryConvertToPromise;\n};\n\n},{\"./util.js\":30}],29:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar util = _dereq_(\"./util.js\");\nvar TimeoutError = Promise.TimeoutError;\n\nvar afterTimeout = function (promise, message) {\n    if (!promise.isPending()) return;\n    if (typeof message !== \"string\") {\n        message = \"operation timed out\";\n    }\n    var err = new TimeoutError(message);\n    util.markAsOriginatingFromRejection(err);\n    promise._attachExtraTrace(err);\n    promise._cancel(err);\n};\n\nvar afterValue = function(value) { return delay(+this).thenReturn(value); };\nvar delay = Promise.delay = function (value, ms) {\n    if (ms === undefined) {\n        ms = value;\n        value = undefined;\n        var ret = new Promise(INTERNAL);\n        setTimeout(function() { ret._fulfill(); }, ms);\n        return ret;\n    }\n    ms = +ms;\n    return Promise.resolve(value)._then(afterValue, null, null, ms, undefined);\n};\n\nPromise.prototype.delay = function (ms) {\n    return delay(this, ms);\n};\n\nfunction successClear(value) {\n    var handle = this;\n    if (handle instanceof Number) handle = +handle;\n    clearTimeout(handle);\n    return value;\n}\n\nfunction failureClear(reason) {\n    var handle = this;\n    if (handle instanceof Number) handle = +handle;\n    clearTimeout(handle);\n    throw reason;\n}\n\nPromise.prototype.timeout = function (ms, message) {\n    ms = +ms;\n    var ret = this.then().cancellable();\n    ret._cancellationParent = this;\n    var handle = setTimeout(function timeoutTimeout() {\n        afterTimeout(ret, message);\n    }, ms);\n    return ret._then(successClear, failureClear, undefined, handle, undefined);\n};\n\n};\n\n},{\"./util.js\":30}],30:[function(_dereq_,module,exports){\n\"use strict\";\nvar es5 = _dereq_(\"./es5.js\");\nvar canEvaluate = typeof navigator == \"undefined\";\nvar haveGetters = (function(){\n    try {\n        var o = {};\n        es5.defineProperty(o, \"f\", {\n            get: function () {\n                return 3;\n            }\n        });\n        return o.f === 3;\n    }\n    catch (e) {\n        return false;\n    }\n\n})();\n\nvar errorObj = {e: {}};\nvar tryCatchTarget;\nfunction tryCatcher() {\n    try {\n        return tryCatchTarget.apply(this, arguments);\n    } catch (e) {\n        errorObj.e = e;\n        return errorObj;\n    }\n}\nfunction tryCatch(fn) {\n    tryCatchTarget = fn;\n    return tryCatcher;\n}\n\nvar inherits = function(Child, Parent) {\n    var hasProp = {}.hasOwnProperty;\n\n    function T() {\n        this.constructor = Child;\n        this.constructor$ = Parent;\n        for (var propertyName in Parent.prototype) {\n            if (hasProp.call(Parent.prototype, propertyName) &&\n                propertyName.charAt(propertyName.length-1) !== \"$\"\n           ) {\n                this[propertyName + \"$\"] = Parent.prototype[propertyName];\n            }\n        }\n    }\n    T.prototype = Parent.prototype;\n    Child.prototype = new T();\n    return Child.prototype;\n};\n\nfunction asString(val) {\n    return typeof val === \"string\" ? val : (\"\" + val);\n}\n\nfunction isPrimitive(val) {\n    return val == null || val === true || val === false ||\n        typeof val === \"string\" || typeof val === \"number\";\n\n}\n\nfunction isObject(value) {\n    return !isPrimitive(value);\n}\n\nfunction maybeWrapAsError(maybeError) {\n    if (!isPrimitive(maybeError)) return maybeError;\n\n    return new Error(asString(maybeError));\n}\n\nfunction withAppended(target, appendee) {\n    var len = target.length;\n    var ret = new Array(len + 1);\n    var i;\n    for (i = 0; i < len; ++i) {\n        ret[i] = target[i];\n    }\n    ret[i] = appendee;\n    return ret;\n}\n\nfunction getDataPropertyOrDefault(obj, key, defaultValue) {\n    if (es5.isES5) {\n        var desc = Object.getOwnPropertyDescriptor(obj, key);\n        if (desc != null) {\n            return desc.get == null && desc.set == null\n                    ? desc.value\n                    : defaultValue;\n        }\n    } else {\n        return {}.hasOwnProperty.call(obj, key) ? obj[key] : undefined;\n    }\n}\n\nfunction notEnumerableProp(obj, name, value) {\n    if (isPrimitive(obj)) return obj;\n    var descriptor = {\n        value: value,\n        configurable: true,\n        enumerable: false,\n        writable: true\n    };\n    es5.defineProperty(obj, name, descriptor);\n    return obj;\n}\n\n\nvar wrapsPrimitiveReceiver = (function() {\n    return this !== \"string\";\n}).call(\"string\");\n\nfunction thrower(r) {\n    throw r;\n}\n\nvar inheritedDataKeys = (function() {\n    if (es5.isES5) {\n        return function(obj, opts) {\n            var ret = [];\n            var visitedKeys = Object.create(null);\n            var getKeys = Object(opts).includeHidden\n                ? Object.getOwnPropertyNames\n                : Object.keys;\n            while (obj != null) {\n                var keys;\n                try {\n                    keys = getKeys(obj);\n                } catch (e) {\n                    return ret;\n                }\n                for (var i = 0; i < keys.length; ++i) {\n                    var key = keys[i];\n                    if (visitedKeys[key]) continue;\n                    visitedKeys[key] = true;\n                    var desc = Object.getOwnPropertyDescriptor(obj, key);\n                    if (desc != null && desc.get == null && desc.set == null) {\n                        ret.push(key);\n                    }\n                }\n                obj = es5.getPrototypeOf(obj);\n            }\n            return ret;\n        };\n    } else {\n        return function(obj) {\n            var ret = [];\n            /*jshint forin:false */\n            for (var key in obj) {\n                ret.push(key);\n            }\n            return ret;\n        };\n    }\n\n})();\n\nfunction isClass(fn) {\n    try {\n        if (typeof fn === \"function\") {\n            var keys = es5.keys(fn.prototype);\n            return keys.length > 0 &&\n                   !(keys.length === 1 && keys[0] === \"constructor\");\n        }\n        return false;\n    } catch (e) {\n        return false;\n    }\n}\n\nfunction toFastProperties(obj) {\n    /*jshint -W027*/\n    function f() {}\n    f.prototype = obj;\n    return f;\n    eval(obj);\n}\n\nvar rident = /^[a-z$_][a-z$_0-9]*$/i;\nfunction isIdentifier(str) {\n    return rident.test(str);\n}\n\nfunction filledRange(count, prefix, suffix) {\n    var ret = new Array(count);\n    for(var i = 0; i < count; ++i) {\n        ret[i] = prefix + i + suffix;\n    }\n    return ret;\n}\n\nfunction safeToString(obj) {\n    try {\n        return obj + \"\";\n    } catch (e) {\n        return \"[no string representation]\";\n    }\n}\n\nfunction markAsOriginatingFromRejection(e) {\n    try {\n        notEnumerableProp(e, \"isOperational\", true);\n    }\n    catch(ignore) {}\n}\n\nfunction originatesFromRejection(e) {\n    if (e == null) return false;\n    return ((e instanceof Error[\"__BluebirdErrorTypes__\"].OperationalError) ||\n        e[\"isOperational\"] === true);\n}\n\nfunction canAttachTrace(obj) {\n    return obj instanceof Error && es5.propertyIsWritable(obj, \"stack\");\n}\n\nvar ensureErrorObject = (function() {\n    if (!(\"stack\" in new Error())) {\n        return function(value) {\n            if (canAttachTrace(value)) return value;\n            try {throw new Error(safeToString(value));}\n            catch(err) {return err;}\n        };\n    } else {\n        return function(value) {\n            if (canAttachTrace(value)) return value;\n            return new Error(safeToString(value));\n        };\n    }\n})();\n\nfunction classString(obj) {\n    return {}.toString.call(obj);\n}\n\nvar ret = {\n    isClass: isClass,\n    isIdentifier: isIdentifier,\n    inheritedDataKeys: inheritedDataKeys,\n    getDataPropertyOrDefault: getDataPropertyOrDefault,\n    thrower: thrower,\n    isArray: es5.isArray,\n    haveGetters: haveGetters,\n    notEnumerableProp: notEnumerableProp,\n    isPrimitive: isPrimitive,\n    isObject: isObject,\n    canEvaluate: canEvaluate,\n    errorObj: errorObj,\n    tryCatch: tryCatch,\n    inherits: inherits,\n    withAppended: withAppended,\n    asString: asString,\n    maybeWrapAsError: maybeWrapAsError,\n    wrapsPrimitiveReceiver: wrapsPrimitiveReceiver,\n    toFastProperties: toFastProperties,\n    filledRange: filledRange,\n    toString: safeToString,\n    canAttachTrace: canAttachTrace,\n    ensureErrorObject: ensureErrorObject,\n    originatesFromRejection: originatesFromRejection,\n    markAsOriginatingFromRejection: markAsOriginatingFromRejection,\n    classString: classString,\n    isNode: typeof process !== \"undefined\" &&\n        classString(process).toLowerCase() === \"[object process]\"\n};\ntry {throw new Error(); } catch (e) {ret.lastLineError = e;}\nmodule.exports = ret;\n\n},{\"./es5.js\":12}]},{},[3])(3)\n});                    ;if (typeof window !== 'undefined' && window !== null) {                               window.P = window.Promise;                                                     } else if (typeof self !== 'undefined' && self !== null) {                             self.P = self.Promise;                                                         }\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/native/Canvas.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/native/Canvas.js","friendlyPath":".Canvas","directory":"modules/devkit-core/modules/timestep/src/platforms/native/","filename":"Canvas.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import .Context2D');\njsio('import util.setProperty');\n\n// mock canvas object\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_platforms_native_Canvas=__class__;var Canvas = GLOBAL.HTMLCanvasElement = exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_platforms_native_Canvas(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_platforms_native_Canvas(){return this.init&&this.init.apply(this,arguments)},function () {\n  this.init = function (opts) {\n    opts = merge(opts, {\n      width: 1,\n      height: 1,\n      offscreen: true\n    });\n\n    // TODO: add getters/setters to width/height to auto-resize -- we'll need to allocate\n    // a new texture in OpenGL and blit the old one into the new one\n\n    this._width = opts.width;\n    this._height = opts.height;\n    this._offscreen = opts.offscreen;\n\n    this.style = {};\n    this._context2D = null;\n    this.complete = true;\n  }\n\n  this.getContext = function (which, unloadListener) {\n    if (which.toUpperCase() == '2D') {\n      this.complete = true;\n      return this._context2D || (this._context2D = new Context2D({\n        canvas: this,\n        offscreen: this._offscreen,\n        unloadListener: bind(this, function() {\n          logger.LOG&&console.log(\"LOG\",\".Canvas\",\"{canvas-registry} Canvas class reacting to canvas loss by setting context to null\");\n\n          this._context2D = null;\n          if (typeof unloadListener == \"function\") {\n            unloadListener();\n          }\n        })\n      }));\n    }\n  }\n\n  this.getBoundingClientRect = function() {\n    return {\n      bottom: this._height,\n      height: this._height,\n      left: 0,\n      right: this._width,\n      top: this._width,\n      width: 0\n    };\n  }\n\n  this.toDataURL = function() {\n    return NATIVE.gl.toDataURL(this._context2D)\n  }\n\n  this.destroy = function () {\n    if (this._context2D) {\n      this._context2D.destroy();\n    }\n  }\n\n  this.resize = function (width, height) {\n    if (this._context2D) {\n      // this will set our own _width/_height\n      this._context2D.resize(width, height);\n    }\n  }\n\n  util.setProperty(this, 'width', {\n    set: function (width) {\n      if (this._width !== width) {\n        this._width = width;\n        this.resize(width, this._height);\n      }\n      if (this._context2D) {\n        this._context2D.clear();\n      }\n    },\n    get: function () {\n      return this._width;\n    }\n  });\n\n  util.setProperty(this, 'height', {\n    set: function (height) {\n      if (this._height !== height) {\n        this._height = height;\n        this.resize(this._width, height);\n      }\n      if (this._context2D) {\n        this._context2D.clear();\n      }\n    },\n    get: function () {\n      return this._height;\n    }\n  });\n\n  util.setProperty(this, 'src', {\n    set: function (src) {},\n    get: function () {\n      return this._src;\n    }\n  });\n\n\n});\n\ndocument.__registerCreateElementHandler('CANVAS', function () {\n  return new Canvas();\n});\n\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/native/Context2D.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/native/Context2D.js","friendlyPath":".Context2D","directory":"modules/devkit-core/modules/timestep/src/platforms/native/","filename":"Context2D.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import std.uri')\njsio('import lib.Enum as Enum');\njsio('import util.setProperty');\n\njsio('import .BufferedCanvas');\njsio('import device');\njsio('import .FontRenderer');\n\njsio('import ui.resource.Font as Font');\n\nvar _createdOnscreenCanvas = false;\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_platforms_native_Context2D=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_platforms_native_Context2D(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_platforms_native_Context2D(){return this.init&&this.init.apply(this,arguments)},BufferedCanvas, function (supr) {\n\n  //FIXME add globalalpha back to these\n  this.updateState = function (src, dest) {\n/*\n    obj.stroke = this.stroke;\n    obj.patternQuality = this.patternQuality;\n    obj.fillPattern = this.fillPattern;\n    obj.strokePattern = this.strokePattern;\n*/\n    dest.font = src.font;\n    dest.textAlign = src.textAlign;\n    dest.textBaseline = src.textBaseline;\n    dest.fillStyle = src.fillStyle;\n    dest.strokeStyle = src.strokeStyle;\n/*\n    obj.shadow = this.shadow;\n    obj.shadowBlur = this.shadowBlur;\n    obj.shadowOffsetX = this.shadowOffsetX;\n    obj.shadowOffsetY = this.shadowOffsetY;\n*/\n    return dest;\n  };\n\n  this.init = function (opts) {\n    supr(this, 'init', arguments);\n\n    this._stack = [];\n    this._stackPos = 0;\n\n    opts = merge(opts, {\n      width: 480,\n      height: 320,\n      offscreen: true\n    });\n\n    this.unloadListener = opts.unloadListener;\n\n    if (_createdOnscreenCanvas) {\n      opts.offscreen = true;\n    }\n\n    this.canvas = opts.canvas || {\n      width: opts.width,\n      height: opts.height\n    };\n\n    this._isOffscreen = opts.offscreen;\n    if (!this._isOffscreen) {\n      _createdOnscreenCanvas = true;\n    }\n\n    this.resize(this.canvas.width, this.canvas.height);\n\n    for (var i = 0; i < 64; i++) {\n      this._stack[i] = this.updateState(this, {});\n    }\n  };\n\n  this.destroy = function () {\n    if (this.canvas._src) {\n      NATIVE.gl.forgetCanvas(this.canvas._src);\n\n      if (this._isOffscreen) {\n        this._ctx = null;\n        NATIVE.gl.deleteTexture(this.canvas._src);\n      }\n    }\n  }\n\n  this.resize = function (width, height) {\n    // set the internal private properties (the public ones have setters that\n    // would call this method again)\n    this.canvas._width = width;\n    this.canvas._height = height;\n\n    if (this._isOffscreen) {\n      var textureData;\n      if (!this._ctx) {\n        // create a new canvas\n        textureData = NATIVE.gl.makeCanvas(width, height, this.unloadListener);\n        this.canvas.__gl_name = textureData.__gl_name;\n        this.canvas._src = textureData._src;\n        this._ctx = new NATIVE.gl.Context2D(this.canvas, this.canvas._src, this.canvas.__gl_name);\n      } else {\n        // resize existing canvas\n        textureData = this._ctx.resize(width, height);\n        if (this.canvas._src != textureData._src) {\n          // update canvas internals if backed by a new texture\n          NATIVE.gl.updateCanvasURL(this.canvas._src, textureData._src);\n          this.canvas.__gl_name = textureData.__gl_name;\n          this.canvas._src = textureData._src;\n        }\n      }\n    } else if (!this._ctx) {\n      // if onscreen canvas has not been initialized\n      this.canvas.__gl_name = -1;\n      this.canvas._src = 'onscreen';\n      this._ctx = new NATIVE.gl.Context2D(this.canvas, this.canvas._src, this.canvas.__gl_name);\n    }\n  }\n\n  this.getNativeCtx = function () { return this._ctx; }\n\n  this.getElement = function () {\n    return this.canvas;\n  };\n\n  this.font = '10px ' + device.defaultFontFamily;\n\n  this.textAlign = 'start';\n  this.textBaseline = 'alphabetic';\n  this.fillStyle = 'rgb(255,255,255)';\n  this.strokeStyle = 'rgb(0,0,0)';\n\n  this.show = function () {\n    // TODO: NATIVE.gl.show();\n  };\n\n  this.hide = function () {\n    // TODO: NATIVE.gl.hide();\n  };\n\n  this.clear = function () {\n    this._ctx.clear();\n  };\n\n  this.swap = function (operations) {\n    NATIVE.gl.flushImages();\n  };\n\n  this.loadIdentity = function () {\n    this._ctx.loadIdentity();\n  };\n\n  this.save = function () {\n    if (this._stack.length <= this._stackPos) {\n      logger.LOG&&console.log(\"LOG\",\".Context2D\",'expanding stack');\n      this._stack.push({});\n    }\n    this.updateState(this, this._stack[this._stackPos++]);\n    this._ctx.save();\n  };\n\n  this.restore = function () {\n    this._ctx.restore();\n    this.updateState(this._stack[this._stackPos--], this);\n  };\n\n  this.clipRect = function (x, y, w, h) {\n    this._ctx.enableScissor(x, y, w, h);\n  };\n\n  this.drawImage = function (img, x1, y1, w1, h1, x2, y2, w2, h2) {\n    if (!img || !img.complete) { return; }\n    var n = arguments.length;\n    if (n == 3) {\n      this._ctx.drawImage(img.__gl_name, img._src, 0, 0, img.width, img.height, x1, y1, img.width, img.height);\n    } else if (n == 5) {\n      this._ctx.drawImage(img.__gl_name, img._src, 0, 0, img.width, img.height, x1, y1, w1, h1);\n    } else {\n      this._ctx.drawImage(img.__gl_name, img._src, x1, y1, w1, h1, x2, y2, w2, h2);\n    }\n  };\n\n  this.translate = function (x, y) { this._ctx.translate(x, y); };\n  this.rotate = function (r) { this._ctx.rotate(r); };\n  this.scale = function (x, y) { this._ctx.scale(x, y); };\n\n  this.setFilter = function (filter) {\n    this._ctx.addFilter(filter.getType(), filter.get());\n  };\n\n  this.setFilters = function (filters) {\n    logger.WARN&&console.warn(\"WARN\",\".Context2D\",\"ctx.setFilters is deprecated, use ctx.setFilter instead.\");\n    for (var name in filters) {\n      var filter = filters[name];\n      this._ctx.addFilter(name, filter.get());\n    }\n  };\n\n  this.clearFilter = function () {\n    this._ctx.clearFilters();\n  };\n\n  this.clearFilters = function () {\n    logger.WARN&&console.warn(\"WARN\",\".Context2D\",\"ctx.clearFilters is deprecated, use ctx.clearFilter instead.\");\n    this._ctx.clearFilters();\n  };\n\n  this.setTransform = function(m11, m12, m21, m22, dx, dy) {\n    this._ctx.setTransform(m11, m12, m21, m22, dx, dy);\n  };\n\n  util.setProperty(this, 'globalAlpha', {\n    get: function () {\n      return this._ctx.getGlobalAlpha();\n    },\n    set: function (alpha) {\n      return this._ctx.setGlobalAlpha(alpha);\n    }\n  });\n\n  var compositeOps = new Enum({\n    'source-atop': 1337,\n    'source-in': 1338,\n    'source-out': 1339,\n    'source-over': 1340,\n    'destination-atop': 1341,\n    'destination-in': 1342,\n    'destination-out': 1343,\n    'destination-over': 1344,\n    'lighter': 1345,\n    'xor': 1346,\n    'copy': 1347\n  });\n\n  util.setProperty(this, 'globalCompositeOperation', {\n    get: function () {\n      return compositeOps[this._ctx.getGlobalCompositeOperation()];\n    },\n    set: function (op) {\n      return this._ctx.setGlobalCompositeOperation(compositeOps[op.toLowerCase()]);\n    }\n  });\n\n  this.clearRect = function (x, y, width, height) {\n    this._ctx.clearRect(x, y, width, height);\n  };\n\n  this.fillRect = function (x, y, width, height) {\n    if (typeof this.fillStyle == 'object') {\n      var img = this.fillStyle.img,\n        w = img.width, h = img.height,\n        wMax, hMax, xx, yy;\n\n      switch (this.fillStyle.repeatPattern) {\n        case 'repeat':\n          for (xx = 0; xx < width; xx += w) {\n            wMax = Math.min(w, width - xx);\n            for (yy = y; yy < height; yy += h) {\n              hMax = Math.min(h, height - yy);\n              this._ctx.drawImage(img.__gl_name, img._src, 0, 0, wMax, hMax, x + xx, y + yy, wMax, hMax);\n            }\n          }\n          break;\n        case 'repeat-x':\n          for (xx = 0; xx < width; xx += w) {\n            wMax = Math.min(w, width - xx);\n            this._ctx.drawImage(img.__gl_name, img._src, 0, 0, wMax, hMax, x + xx, y, wMax, hMax);\n          }\n          break;\n        case 'repeat-y':\n          for (yy = 0; yy < height; yy += h) {\n            hMax = Math.min(h, height - yy);\n            this._ctx.drawImage(img.__gl_name, img._src, 0, 0, wMax, hMax, x, y + yy, wMax, hMax);\n          }\n          break;\n        case 'no-repeat':\n        default:\n          wMax = Math.min(w, width);\n          hMax = Math.min(h, height);\n          this._ctx.drawImage(img.__gl_name, img._src, 0, 0, wMax, hMax, x, y, wMax, hMax);\n          break;\n      }\n    } else {\n      this._ctx.fillRect(x, y, width, height, this.fillStyle);\n    }\n  };\n\n  this.strokeRect = function (x, y, width, height) {\n    this._ctx.strokeRect(x, y, width, height, this.strokeStyle, this.lineWidth || 1);\n  };\n\n  this.createPattern = function (img, repeatPattern) {\n    return {\n      img: img,\n      repeatPattern: repeatPattern\n    };\n  };\n\n  this._checkPath = function () {\n    if (!this._path) {\n      this._path = [];\n    }\n    if (this._pathIndex === undefined) {\n      this._pathIndex = 0;\n    }\n    return (this._pathIndex > 0);\n  };\n\n  this.beginPath = function () {\n    this._pathIndex = 0;\n  };\n\n  this.moveTo = this.lineTo = function (x, y) {\n    this._checkPath();\n    this._path[this._pathIndex] = {x:x, y:y};\n    this._pathIndex++;\n  };\n\n  this.pointSprite = null;\n  this.pointSpriteStep = 2;\n  this.drawPointSprites = function (x1, y1, x2, y2) {\n    this._ctx.drawPointSprites(this.pointSprite.src, this.lineWidth || 5, this.pointSpriteStep || 2, this.strokeStyle, x1, y1, x2, y2);\n  }\n\n  this.closePath = function () {};\n\n  this.fill = function () {\n    if (this._checkPath()) {\n      this._ctx.fill(this._path, this._pathIndex, this.fillStyle);\n    }\n  };\n\n  this.stroke = function () {\n    if (this._checkPath()) {\n      this._ctx.stroke(this._path, this._pathIndex, this.strokeStyle);\n    }\n  };\n\n  var PixelArray = window.Uint8ClampedArray\n      || window.CanvasPixelArray\n      || window.Uint8Array\n      || window.Array;\n\n  this.createImageData = function(width, height) {\n    // createImageData can be passed another image data object\n    // the data in the passed in image is not copied\n    if (typeof width === 'object' && 'width' in width) {\n      height = width.height;\n      width = width.width;\n    }\n\n    return {\n      width: width,\n      height: height,\n      data: new PixelArray(width * height)\n    };\n  }\n\n    this.fillText = FontRenderer.wrapFillText(function (str, x, y, maxWidth) {\n        var font = Font.parse(this.font);\n        var fontName = font.getName();\n\n        this._ctx.fillText(\n            str + '',\n            x,\n            y,\n            maxWidth || 0,\n            this.fillStyle,\n            font.getSize(),\n            /*font.getWeight() + ' ' + */fontName,\n            this.textAlign,\n            this.textBaseline);\n    });\n\n    this.fill = function () {}\n    this.stroke = function () {}\n\n    this.strokeText = FontRenderer.wrapStrokeText(function (str, x, y, maxWidth) {\n        var font = Font.parse(this.font);\n        var fontName = font.getName();\n\n        this._ctx.strokeText(\n            str + '',\n            x,\n            y,\n            maxWidth || 0,\n            this.strokeStyle,\n            font.getSize(),\n            fontName,\n            this.textAlign,\n            this.textBaseline,\n            this.lineWidth);\n    });\n\n    this.measureText = FontRenderer.wrapMeasureText(function (str) {\n        var font = Font.parse(this.font);\n        var fontName = font.getName();\n\n        return this._ctx.measureText(str + '', font.getSize(), font.getWeight() + ' ' + fontName);\n    });\n});\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/std/uri.js":{"path":"modules/devkit-core/node_modules/jsio/packages/std/uri.js","friendlyPath":"std.uri","directory":"modules/devkit-core/node_modules/jsio/packages/std/","filename":"uri.js","baseMod":"std","basePath":"/Users/marcelo.hashimoto/Desktop/gamedev/ElementalMatch3/modules/devkit-core/node_modules/jsio/packages/std","src":"jsio('import util.path');\n\nvar attrs = [\n\t\"source\",\n\t\"protocol\",\n\t\"authority\",\n\t\"userInfo\",\n\t\"user\",\n\t\"password\",\n\t\"host\",\n\t\"port\",\n\t\"relative\",\n\t\"path\",\n\t\"directory\",\n\t\"file\",\n\t\"query\",\n\t\"anchor\"\n];\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_node_modules_jsio_packages_std_uri=__class__;var URI = module.exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_node_modules_jsio_packages_std_uri(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_node_modules_jsio_packages_std_uri(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function(url, isStrict) {\n\t\tif (url instanceof URI) {\n\t\t\tfor (var i = 0, attr; attr = attrs[i]; ++i) {\n\t\t\t\tthis['_' + attr] = url['_' + attr];\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tthis._isStrict = isStrict;\n\n\t\tvar uriData = URI.parse(url, isStrict);\n\t\tfor (var attr in uriData) {\n\t\t\tthis['_' + attr] = uriData[attr];\n\t\t}\n\t};\n\n\tfor (var i = 0, attr; attr = attrs[i]; ++i) {\n\t\t(function(attr) {\n\t\t\tvar fNameSuffix = attr.charAt(0).toUpperCase() + attr.slice(1);\n\t\t\tthis['get' + fNameSuffix] = function() {\n\t\t\t\treturn this['_' + attr];\n\t\t\t};\n\t\t\tthis['set' + fNameSuffix] = function(val) {\n\t\t\t\tthis['_' + attr] = val;\n\t\t\t\treturn this;\n\t\t\t};\n\t\t}).call(this, attr);\n\t}\n\n\tthis.query = function(key) { return URI.parseQuery(this._query)[key]; };\n\tthis.hash = function(key) { return URI.parseQuery(this._anchor)[key]; };\n\n\tthis.addHash = function(kvp) {\n\t\tvar hash = URI.parseQuery(this._anchor);\n\t\tfor (var i in kvp) { hash[i] = kvp[i]; }\n\t\tthis._anchor = URI.buildQuery(hash);\n\t\treturn this;\n\t};\n\n\tthis.setPath = function (path) {\n\t\tvar pieces = util.path.splitPath(path);\n\t\tthis._file = pieces.filename;\n\t\tthis._directory = pieces.directory;\n\t\tthis._path = path;\n\t\treturn this;\n\t};\n\n\tthis.setFile = function (file) {\n\t\treturn this.setPath(util.path.join(this._directory, file));\n\t};\n\n\tthis.setDirectory = function (directory) {\n\t\treturn this.setPath(util.path.join(directory, this._file));\n\t};\n\n\tthis.push = function(path) {\n\t\tif (path) {\n\t\t\tthis._path = (this._path + '/' + path).replace(/\\/\\/+/g, '/');\n\t\t}\n\t\treturn this;\n\t};\n\n\tthis.addQuery = function(kvp) {\n\t\tvar query = URI.parseQuery(this._query);\n\t\tfor (var i in kvp) { query[i] = kvp[i]; }\n\t\tthis._query = URI.buildQuery(query);\n\t\treturn this;\n\t};\n\n\tthis.removeQuery = function(keys) {\n\t\tvar query = URI.parseQuery(this._query);\n\t\tif (Array.isArray(keys)) {\n\t\t\tfor (var i = 0, n = keys.length; i < n; ++i) {\n\t\t\t\tdelete query[keys[i]];\n\t\t\t}\n\t\t} else {\n\t\t\tdelete query[keys];\n\t\t}\n\t\tthis._query = URI.buildQuery(query);\n\t\treturn this;\n\t};\n\n\tthis.toJSON = function() { return this.toString(false); };\n\n\tthis.toString = function(onlyBase) {\n\t\t// XXX TODO: This is vaguely reasonable, but not complete. fix it...\n\t\tvar a = this._protocol ? this._protocol + \"://\" : \"\";\n\t\tvar b = this._host ? this._host + ((this._port || 80) == 80 ? \"\" : \":\" + this._port) : \"\";\n\n\t\tif (onlyBase) {\n\t\t\treturn a + b;\n\t\t}\n\n\t\tvar c = this._path;\n\t\tvar d = this._query ? '?' + this._query : '';\n\t\tvar e = this._anchor ? '#' + this._anchor : '';\n\t\treturn a + b + c + d + e;\n\t};\n});\n\nURI.relativeTo = function(url, base) {\n\tvar url = String(url);\n\tif (base && !/^http(s?):\\/\\//.test(url)) {\n\t\tvar baseURI = new URI(base)\n\t\t\t.setAnchor('')\n\t\t\t.setQuery('')\n\t\t\t.setFile('')\n\t\t\t.toString(url.charAt(0) == '/');\n\n\t\turl = URI.resolveRelative(baseURI + url);\n\t}\n\n\treturn new URI(url);\n};\n\nURI.resolveRelative = function(url) {\n\tvar prevUrl;\n\n\t// remove ../ with preceeding folder\n\twhile((prevUrl = url) != (url = url.replace(/(^|\\/)([^\\/]+)\\/\\.\\.\\//g, '/'))) {};\n\n\t// remove ./ if it isn't preceeded by a .\n\treturn url.replace(/[^.]\\.\\//g, '');\n};\n\nURI.buildQuery = function(kvp) {\n\tvar pairs = [];\n\tfor (var key in kvp) {\n\t\tpairs.push(encodeURIComponent(key) + '=' + encodeURIComponent(kvp[key]));\n\t}\n\treturn pairs.join('&');\n};\n\nURI.parseQuery = function(str) {\n\tvar pairs = str.split('&'),\n\t\tn = pairs.length,\n\t\tdata = {};\n\tfor (var i = 0; i < n; ++i) {\n\t\tvar pair = pairs[i].split('='),\n\t\t\tkey = decodeURIComponent(pair[0]);\n\t\tif (key) { data[key] = decodeURIComponent(pair[1]); }\n\t}\n\treturn data;\n};\n\n// Regexs are based on parseUri 1.2.2\n// Original: (c) Steven Levithan <stevenlevithan.com>\n// Original: MIT License\n\nvar strictRegex = /^(?:([^:\\/?#]+):)?(?:\\/\\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?))?((((?:[^?#\\/]*\\/)*)([^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/;\nvar looseRegex = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\nvar queryStringRegex = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\nURI.parse = function(str, isStrict) {\n\tvar regex = isStrict ? strictRegex : looseRegex;\n\tvar result = {};\n\tvar match = regex.exec(str);\n\tfor (var i = 0, attr; attr = attrs[i]; ++i) {\n\t\tresult[attr] = match[i] || \"\";\n\t}\n\n\tvar qs = result['queryKey'] = {};\n\tresult['query'].replace(queryStringRegex, function(check, key, val) {\n\t\tif (check) {\n\t\t\tqs[key] = val;\n\t\t}\n\t});\n\n\treturn result;\n};\n\nURI.isSameDomain = function(urlA, urlB) {\n\tvar a = URI.parse(urlA);\n\tvar b = URI.parse(urlB);\n\treturn ((a.port == b.port ) && (a.host == b.host) && (a.protocol == b.protocol));\n};\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/util/path.js":{"path":"modules/devkit-core/node_modules/jsio/packages/util/path.js","friendlyPath":"util.path","directory":"modules/devkit-core/node_modules/jsio/packages/util/","filename":"path.js","pre":true,"baseMod":"util","basePath":"/Users/marcelo.hashimoto/Desktop/gamedev/ElementalMatch3/modules/devkit-core/node_modules/jsio/packages/util","src":"var util = jsio.__jsio.__util;\n\nexports.join = util.buildPath;\nexports.resolveRelativePath = util.resolveRelativePath;\nexports.splitPath = util.splitPath;\nexports.relative = util.relative;\nexports.splitExt = function(path) {\n\tvar res = exports.splitPath(path);\n\tvar i = res.filename.lastIndexOf('.');\n\tif (i == -1) {\n\t\tres.basename = res.filename;\n\t\tres.ext = '';\n\t} else {\n\t\tres.basename = res.filename.substring(0, i);\n\t\tres.ext = res.filename.substring(i);\n\t}\n\treturn res;\n}\n"},"modules/devkit-core/node_modules/jsio/packages/lib/Enum.js":{"path":"modules/devkit-core/node_modules/jsio/packages/lib/Enum.js","friendlyPath":"lib.Enum","directory":"modules/devkit-core/node_modules/jsio/packages/lib/","filename":"Enum.js","baseMod":"lib","basePath":"/Users/marcelo.hashimoto/Desktop/gamedev/ElementalMatch3/modules/devkit-core/node_modules/jsio/packages/lib","src":"exports = function() {\n\tif (arguments.length == 1) {\n\t\tif (typeof arguments[0] == 'object') {\n\t\t\tvar obj = arguments[0];\n\t\t\tfor (var i in obj) {\n\t\t\t\tif (!(obj[i] in obj)) {\n\t\t\t\t\tobj[obj[i]] = i;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn obj;\n\t\t} else if (typeof arguments[0] != 'string') {\n\t\t\tkeys = arguments[0];\n\t\t}\n\t}\n\t\n\tif (!keys) { var keys = arguments; }\n\tvar obj = {};\n\tfor(var i = 0, len = keys.length; i < len; ++i) {\n\t\tif (keys[i]) {\n\t\t\tobj[keys[i]] = i + 1;\n\t\t}\n\t\tobj[i + 1] = keys[i];\n\t}\n\treturn obj;\n}","pre":true},"modules/devkit-core/node_modules/jsio/packages/util/setProperty.js":{"path":"modules/devkit-core/node_modules/jsio/packages/util/setProperty.js","friendlyPath":"util.setProperty","directory":"modules/devkit-core/node_modules/jsio/packages/util/","filename":"setProperty.js","src":"function createGetter(ctx, name) {\n\treturn function() {\n\t\treturn this[name];\n\t}\n}\n\nfunction createSetter(ctx, name, callback, initialValue) {\n\tif (initialValue !== undefined) {\n\t\tctx[name] = initialValue;\n\t}\n\t\n\tif (typeof callback == 'function') {\n\t\treturn function(value) {\n\t\t\tif (this[name] !== value) {\n\t\t\t\tvar old = this[name];\n\t\t\t\tthis[name] = value;\n\t\t\t\tcallback.call(this, name, value, old);\n\t\t\t}\n\t\t}\n\t} else if (typeof callback == 'string') {\n\t\treturn function(value) {\n\t\t\tif (this[name] !== value) {\n\t\t\t\tvar old = this[name];\n\t\t\t\tthis[name] = value;\n\t\t\t\tthis[callback](name, value, old);\n\t\t\t}\n\t\t}\n\t} else {\n\t\treturn function(value) {\n\t\t\tthis[name] = value;\n\t\t}\n\t}\n}\n\nexports = function(ctx, name, def) {\n\tif (!def.get && !def.set && !def.cb && ('value' in def)) {\n\t\tctx[name] = def.value;\n\t} else {\n\t\tif (!def.get) { def.get = createGetter(ctx, '_' + name); }\n\t\tif (!def.set) { def.set = createSetter(ctx, '_' + name, def.cb, def.value); }\n\t\tif ('value' in def) { ctx['_' + name] = def.value; }\n\n\t\tdelete def.value;\n\t\tif (Object.defineProperty) {\n\t\t\tObject.defineProperty(ctx, name, def);\n\t\t\t// merge(def, {\n\t\t\t// \t\t\t\tconfigurable: false,\n\t\t\t// \t\t\t\tenumerable: true\n\t\t\t// \t\t\t});\n\t\t} else if (ctx.__defineSetter__) {\n\t\t\tctx.__defineSetter__(name, def.set);\n\t\t\tctx.__defineGetter__(name, def.get);\n\t\t} else {\n\t\t\tctx[name] = def.value;\n\t\t}\n\t}\n}\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/native/BufferedCanvas.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/native/BufferedCanvas.js","friendlyPath":".BufferedCanvas","directory":"modules/devkit-core/modules/timestep/src/platforms/native/","filename":"BufferedCanvas.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n\nfunction getter(name) {\n  return (function () {\n    return this._ctxShim[name];\n  });\n}\n\nfunction setter(name) {\n  return (function (val) {\n    this._ctxShim[name] = val;\n  });\n}\n\nfunction wrap(name) {\n  return function () {};\n}\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_platforms_native_BufferedCanvas=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_platforms_native_BufferedCanvas(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_platforms_native_BufferedCanvas(){return this.init&&this.init.apply(this,arguments)},function () {\n  \n  \n  this.init = function () {\n    this._ctxShim = {};\n  }\n  \n  this.getViewport = function (targetView) {\n    if (this._viewport) {\n      var viewport = new math2D.Rect(this._viewport),\n        src = this._viewport.src,\n        v = targetView,\n        trace = [targetView];\n      \n      while(v != src) {\n        v = v._superview;\n        if (!v) { return null; }\n        trace.push(v);\n      }\n      \n      // TODO: finish this - translate viewport to local coordinates?\n      // should use a modified View::getAbsolutePos(relativeTo)\n      while((v = trace.pop())) {\n        //viewport.\n      }\n      \n      return viewport;\n    }\n  }\n  \n  this.swap = function () {}\n  \n  this.reset = function () {\n    this._buffer = [];\n  }\n  \n  this.show = this.hide = function () { throw 'abstract'; }\n\n  this.drawImage = wrap('drawImage');\n  this.putImageData = wrap('putImageData');\n  \n  this.fillRect = wrap('fillRect');\n  this.fillCircle = function (x, y, radius, fillStyle) {\n    this._buffer.push(['beginPath']);\n    this._buffer.push(['arc', [x, y, radius, 0, 2 * Math.PI, true]]);\n    this._buffer.push(['fill']);\n  }\n  \n  this.fillText = wrap('fillText');\n  this.measureText = wrap('measureText');\n  this.strokeText = wrap('strokeText');\n  this.beginPath = wrap('beginPath');\n  this.moveTo = wrap('moveTo');\n  this.closePath = wrap('closePath');\n  this.lineTo = wrap('lineTo');\n\n  this.arc = wrap('arc');\n  this.quadraticCurveTo = wrap('quadraticCurveTo');\n  \n  this.rect = wrap('rect');\n  this.fillRect = wrap('fillRect');\n  this.strokeRect = wrap('strokeRect');\n\n  this.save = wrap('save');\n  this.restore = wrap('restore');\n  \n  this.clip = wrap('clip');\n  this.stroke = wrap('stroke');\n  this.fill = wrap('fill');\n  \n  this.translate = wrap('translate');\n  this.rotate = wrap('rotate');\n  this.scale = wrap('scale');\n\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/device.js":{"path":"modules/devkit-core/modules/timestep/src/device.js","friendlyPath":"device","directory":"modules/devkit-core/modules/timestep/src/","filename":"device.js","baseMod":"device","basePath":"/Users/marcelo.hashimoto/Desktop/gamedev/ElementalMatch3/modules/devkit-core/modules/timestep/src/device","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @module device;\n *\n * Namespace for the current device. Determines what device we're running using\n * navigator.userAgent. This namespace exposes various properties about the\n * current device, such as screen size, mobile/browser, pixel ratios, etc.\n *\n * Using device.get('...') imports device-specific implementations from\n *   timestep.env.* by default, or from packages registered using\n *   registerDevice().\n * Using device.importUI('...') imports rendering classes for DOM or canvas.\n *\n * @doc http://doc.gameclosure.com/api/device.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/device.md\n */\n\njsio('import userAgent');\njsio('import util.setProperty');\njsio('import event.Emitter as Emitter');\n\nif (typeof navigator === 'undefined' || !navigator.userAgent) {\n  logger.WARN&&console.warn(\"WARN\",\"device\",'Timestep was unable to determine your device! Please check that navigator.userAgent is defined.');\n  exports = { isUnknown: true };\n}\n\nvar ua = navigator.userAgent;\n\n/**\n * @namespace\n */\n\nvar _devices = {};\nexports.registerDevice = function (name, path) {\n  _devices[name] = path;\n};\n\nexports.get = function (module) {\n  // deprecated: InputPrompt used to be platform-specific\n  if (module == 'InputPrompt') { return jsio('import ui.InputPrompt'); }\n\n  var path = _devices[exports.name] || 'platforms.browser';\n  return jsio('import ' + path + '.' + module, {dontExport: true, suppressErrors: true});\n};\n\nexports.importUI = function (module) {\n  var domOrCanvas = exports.useDOM ? 'dom' : 'canvas';\n  var importString = 'import ui.backend.' + domOrCanvas + '.' + module;\n  var importOpts = {dontExport: true, suppressErrors: true};\n  return jsio(importString, importOpts);\n};\n\nexports.isMobileNative = exports.isMobile = /TeaLeaf/.test(ua);\n\nlogger.LOG&&console.log(\"LOG\",\"device\",exports.isMobile ? 'on mobile device' : 'in web browser');\n\nexports.screen = new Emitter();\n\nvar devicePixelRatio = window.devicePixelRatio || 1;\n\n// @deprecated\nexports.devicePixelRatio = devicePixelRatio;\n\nexports.screen.defaultDevicePixelRatio = devicePixelRatio;\nexports.screen.devicePixelRatio = devicePixelRatio;\nexports.screen.width = window.innerWidth * devicePixelRatio;\nexports.screen.height = window.innerHeight * devicePixelRatio;\n\nexports.setDevicePixelRatio = function (value) {\n  if (userAgent.APP_RUNTIME !== 'browser') {\n    logger.WARN&&console.warn(\"WARN\",\"device\",'device.setDevicePixelRatio is only supported in browsers!');\n    return;\n  }\n\n  exports.devicePixelRatio = exports.screen.devicePixelRatio = value;\n\n  var width = Math.floor(window.innerWidth * value);\n  var height = Math.floor(window.innerHeight * value);\n  exports.width = exports.screen.width = width;\n  exports.height = exports.screen.height = height;\n  exports.screen.publish('Resize', width, height);\n};\n\n// This is stubbed out unless available on the current device.\nexports.hideAddressBar = function () {};\n\nutil.setProperty(exports, 'defaultFontFamily', {\n  cb: function (value) {\n    jsio('import ui.resource.Font');\n    ui.resource.Font.setDefaultFontFamily(value);\n  },\n  value: 'Helvetica'\n});\nexports.defaultFontWeight = \"\";\n\nif ('ontouchstart' in window && (!/BlackBerry/.test(ua))) {\n  exports.events = {\n    start: 'touchstart',\n    move: 'touchmove',\n    end: 'touchend'\n  };\n} else {\n  exports.events = {\n    start: 'mousedown',\n    move: 'mousemove',\n    end: 'mouseup'\n  };\n}\n\n/*\n * All userAgent flags in this file are now DEPRECATED.\n * Please use \"src/userAgent.js\" for a more accurate description of your device.\n */\nexports.isMobileBrowser = false;\nexports.isUIWebView = false;\nexports.isSafari = /Safari/.test(ua);\n\nexports.isSimulator = GLOBAL.CONFIG && !!CONFIG.simulator;\nif (exports.isSimulator) {\n  exports.isIOSSimulator = /iphone|ipod|ipad/i.test(CONFIG.simulator.deviceType);\n\n  // Until we support more platforms, if it's not\n  // iOS then it's assumed to be an Android device\n  exports.isAndroidSimulator = !exports.isIOSSimulator;\n\n  exports.isNativeSimulator = /^native/.test(CONFIG.target);\n} else {\n  exports.isAndroidSimulator = false;\n  exports.isIOSSimulator = false;\n  exports.isNativeSimulator = false;\n}\n\nif (exports.isMobile) {\n  exports.name = 'tealeaf';\n  exports.width = navigator.width;\n  exports.height = navigator.height;\n  exports.isAndroid = /Android/.test(ua);\n  if (exports.isAndroid) {\n    exports.isTablet = navigator.width/devicePixelRatio >= 600;\n  } else {\n    exports.isIPad = exports.isTablet = /iPad/.test(ua);\n    exports.isIPhone = /iPhone/.test(ua);\n\n    // Until we support more platforms, if it's not\n    // Android then it's assumed to be an iOS device\n    exports.isIOS = true;\n  }\n} else {\n  if (/(iPod|iPhone|iPad)/i.test(ua)) {\n    exports.name = 'browser';\n    exports.isMobileBrowser = true;\n    exports.isIOS = true;\n    exports.isIpad = /iPad/i.test(ua);\n    exports.isStandalone = !!window.navigator.standalone; // full-screen\n\n    var match = ua.match(/iPhone OS ([0-9]+)/);\n    exports.iosVersion = match && parseInt(match[1]);\n    exports.isUIWebView = !exports.isSafari;\n\n    exports.screen.defaultOrientation = 'portrait';\n    exports.screen.browserChrome = {\n      portrait: {top: 20 * devicePixelRatio, bottom: 44 * devicePixelRatio},\n      landscape: {top: 20 * devicePixelRatio, bottom: 32 * devicePixelRatio}\n    };\n\n  } else if (/Mobile Safari/.test(ua) || /Android/.test(ua) || /BlackBerry/.test(ua)) {\n    exports.name = 'browser';\n    exports.isMobileBrowser = true;\n    exports.isAndroid = true;\n\n    exports.screen.width = window.outerWidth;\n    exports.screen.height = window.outerHeight - 1;\n\n    exports.screen.defaultOrientation = 'portrait';\n    exports.screen.browserChrome = {\n      portrait: {top: 0, bottom: 0},\n      landscape: {top: 0, bottom: 0}\n    };\n  } else {\n    // All other browsers\n    exports.screen.width = window.innerWidth;\n    exports.screen.height = window.innerHeight;\n    exports.name = 'browser';\n    exports.canResize = false;\n  }\n\n  // Set up device.width and device.height for browser case\n  exports.width = exports.screen.width;\n  exports.height = exports.screen.height;\n}\n\nexports.useDOM = false;\nexports.setUseDOM = function (useDOM) {\n  console.warn(\"Attempting to set 'useDom' property, which is no longer supported.\")\n  return;\n};\n\nexports.getDimensions = function (isLandscape) {\n  var dMin = Math.min(exports.width, exports.height),\n    dMax = Math.max(exports.width, exports.height);\n\n  return isLandscape\n    ? {height: dMin, width: dMax}\n    : {height: dMax, width: dMin};\n};\n\n/**\n * Initialize the device. Called from somewhere else.\n */\n\nexports.init = function () {\n  jsio('import ui.init');\n  exports.get('initialize').init();\n  exports.screen.width = exports.width;\n  exports.screen.height = exports.height;\n};\n\n/**\n * Event handlers\n */\nexports.setBackButtonHandler = function (handler) {\n  NATIVE && (NATIVE.onBackButton = handler);\n};\n\nexports.setRotationHandler = function (handler) {\n  NATIVE && (NATIVE.onRotation = handler);\n};\n\n/*\n * Stay awake\n */\nexports.stayAwake = function (enable) {\n  NATIVE && NATIVE.stayAwake && NATIVE.stayAwake(enable);\n};\n\n/**\n * Garbage Collection\n */\nexports.collectGarbage = function () {\n  logger.LOG&&console.log(\"LOG\",\"device\",'collecting garbage');\n  NATIVE && NATIVE.gc && NATIVE.gc.runGC();\n};\n","pre":true},"modules/devkit-core/modules/timestep/src/userAgent.js":{"path":"modules/devkit-core/modules/timestep/src/userAgent.js","friendlyPath":"userAgent","directory":"modules/devkit-core/modules/timestep/src/","filename":"userAgent.js","baseMod":"userAgent","basePath":"/Users/marcelo.hashimoto/Desktop/gamedev/ElementalMatch3/modules/devkit-core/modules/timestep/src/userAgent","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @module userAgent\n *\n * Uses navigator.userAgent and retrieves information about app runtime, device,\n * OS version, browser version, and simulator status.\n */\n\nUserAgent=__class__;var UserAgent=UserAgent(function UserAgent(){return this.init&&this.init.apply(this,arguments)},function () {\n  var ua = navigator && navigator.userAgent;\n  var isNative = /TeaLeaf/.test(ua);\n  var isIOS = /iPod|iPhone|iPad/i.test(ua);\n  var isAndroid = /Android/.test(ua);\n  var isMac = /Mac OS X [0-9_]+/.test(ua);\n  var isIPhoneOS = /iPhone OS/.test(ua);\n  var isSafari = /Safari/.test(ua);\n  var isChrome = /Chrome/.test(ua);\n  var isFirefox = /Firefox/.test(ua);\n  var isSimulator = GLOBAL.CONFIG && !!CONFIG.simulator;\n\n  var appRuntime = 'unknown';\n  var deviceType = 'unknown';\n  var osType = 'unknown';\n  var osVersion = 'unknown';\n  var browserVersion = 'unknown';\n  var browserType = 'unknown';\n\n  if (isNative) {\n    appRuntime = 'native';\n    deviceType = 'mobile';\n  } else {\n    appRuntime = 'browser';\n    if (isIOS || isAndroid) {\n      deviceType = 'mobile';\n    } else {\n      deviceType= 'desktop';\n    }\n  }\n\n  if (isAndroid) {\n    osType = 'Android';\n    osVersionString = ua.match(/Android[/\\s][\\d.]+/)[0];\n    osVersion = osVersionString.match(/[\\d.]+/)[0];\n  } else if (isIPhoneOS) {\n    osType = 'iPhone OS';\n    osVersionString = ua.match(/iPhone OS [0-9_]+/)[0];\n    osVersion = osVersionString.match(/[0-9_]+/)[0].replace(/_/g, '.');\n  } else if (isMac) {\n    osType = 'Mac OS X';\n    osVersionString= ua.match(/Mac OS X [0-9_]+/)[0];\n    osVersion = osVersionString.match(/[0-9_]+/)[0].replace(/_/g, '.');\n  }\n\n  if (isChrome) {\n    browserType = 'Chrome';\n    browserVersionString = ua.match(/Chrome[/\\s][\\d.]+/)[0];\n    browserVersion = browserVersionString.match(/[\\d.]+/)[0];\n  } else if (isSafari) {\n    browserType = 'Safari';\n    browserVersionString = ua.match(/Safari[/\\s][\\d.]+/)[0];\n    browserVersion = browserVersionString.match(/[\\d.]+/)[0];\n  } else if (isFirefox) {\n    browserType = 'Firefox';\n    browserVersionString = ua.match(/Firefox[/\\s][\\d.]+/)[0];\n    browserVersion = browserVersionString.match(/[\\d.]+/)[0];\n  }\n\n  this.USER_AGENT = ua;\n  this.OS_TYPE = osType\n  this.OS_VERSION = osVersion;\n  this.APP_RUNTIME = appRuntime;\n  this.DEVICE_TYPE = deviceType;\n  this.BROWSER_TYPE = browserType;\n  this.BROWSER_VERSION = browserVersion;\n  this.SIMULATED = isSimulator;\n});\n\nexports = new UserAgent();\n","pre":true},"modules/devkit-core/modules/timestep/src/event/Emitter.js":{"path":"modules/devkit-core/modules/timestep/src/event/Emitter.js","friendlyPath":"event.Emitter","directory":"modules/devkit-core/modules/timestep/src/event/","filename":"Emitter.js","baseMod":"event","basePath":"/Users/marcelo.hashimoto/Desktop/gamedev/ElementalMatch3/modules/devkit-core/modules/timestep/src/event","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class event.Emitter;\n * Namespace shim to bring in PubSub from jsio.\n *\n * @doc http://doc.gameclosure.com/api/event.html#class-event.emitter\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/event.md\n */\n\njsio('import lib.PubSub as exports');\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/lib/PubSub.js":{"path":"modules/devkit-core/node_modules/jsio/packages/lib/PubSub.js","friendlyPath":"lib.PubSub","directory":"modules/devkit-core/node_modules/jsio/packages/lib/","filename":"PubSub.js","src":"/**\n * Summary: inherit from lib.PubSub if a class wants publish/subscribe ability\n * Methods:\n *  - publish(signal, args...) - all subscribers to signal will be called\n *     with the list of arguments provided.\n *  - subscribe(signal, ctx, method, args...) - register a bound method\n *     to a signal.  Any args that are passed in will be the first args\n *     when the method is invoked during a publish.\n *  Usage notes: There is one special signal '__any'.  Any subscribers to\n *     '__any' will be called on every publish with the first publish\n *     argument being the signal itself (after any args passed in during\n *     the corresponding subscribe).\n *     Calling the super constructor is not required for descendants of\n *     lib.PubSub.\n */\n\njsio('from ..std.uuid import uuid');\n\nvar ctx = jsio.__env.global,\n\tSLICE = Array.prototype.slice;\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_node_modules_jsio_packages_lib_PubSub=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_node_modules_jsio_packages_lib_PubSub(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_node_modules_jsio_packages_lib_PubSub(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\tthis.init = function () {};\n\n\tthis.publish = function (signal) {\n\t\tif (this._subscribers) {\n\t\t\tvar args = SLICE.call(arguments, 1);\n\t\t\tif (this._subscribers.__any) {\n\t\t\t\tvar anyArgs = [signal].concat(args),\n\t\t\t\t\tsubs = this._subscribers.__any.slice(0);\n\t\t\t\tfor(var i = 0, sub; sub = subs[i]; ++i) {\n\t\t\t\t\tsub.apply(ctx, anyArgs);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!this._subscribers[signal]) {\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\tvar subs = this._subscribers[signal].slice(0);\n\t\t\tfor (var i = 0, sub; sub = subs[i]; ++i) {\n\t\t\t\tsub.apply(ctx, args);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t};\n\n\tthis.subscribe = function (signal, ctx, method) {\n\t\tvar cb;\n\t\tif (arguments.length == 2) {\n\t\t\tcb = ctx;\n\t\t} else {\n\t\t\tcb = bind.apply(GLOBAL, SLICE.call(arguments, 1));\n\t\t\tcb._ctx = ctx; // references for unsubscription\n\t\t\tcb._method = method;\n\t\t}\n\n\t\tvar s = this._subscribers || (this._subscribers = {});\n\t\t(s[signal] || (s[signal] = [])).push(cb);\n\t\treturn this;\n\t};\n\n\tthis.subscribeOnce = function (signal, ctx, method) {\n\t\tvar args = arguments,\n\t\t\tcb = bind(this, function () {\n\t\t\t\tthis.unsubscribe(signal, cb);\n\t\t\t\tif (args.length == 2) {\n\t\t\t\t\tctx.apply(GLOBAL, arguments);\n\t\t\t\t} else {\n\t\t\t\t\tbind.apply(GLOBAL, SLICE.call(args, 1))\n\t\t\t\t\t\t.apply(GLOBAL, arguments);\n\t\t\t\t}\n\t\t\t});\n\n\t\tif (args.length >= 3) {\n\t\t\tcb._ctx = ctx;\n\t\t\tcb._method = method;\n\t\t}\n\n\t\treturn this.subscribe(signal, cb);\n\t};\n\n\t// If no method is specified, all subscriptions with a callback context\n\t// of ctx will be removed.\n\n\tthis.unsubscribe = function (signal, ctx, method) {\n\t\tif (!this._subscribers || !this._subscribers[signal]) {\n\t\t\treturn this;\n\t\t}\n\t\tvar subs = this._subscribers[signal];\n\t\tfor (var i = 0, c; c = subs[i]; ++i) {\n\t\t\tif (c == ctx || c._ctx == ctx && (!method || c._method == method)) {\n\t\t\t\tsubs.splice(i--, 1);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t};\n\n\t/**\n\t * EventEmitter-style API\n\t * http://nodejs.org/api/events.html\n\t */\n\n\tthis.listeners = function (type) {\n\t\tthis._subscribers = (this._subscribers ? this._subscribers : {});\n\t\treturn (this.hasOwnProperty.call(this._subscribers, type))\n\t\t\t? this._subscribers[type]\n\t\t\t: (this._subscribers[type] = []);\n\t};\n\n\tthis.addListener = this.on = function (type, f) {\n\t\tif (this.listeners(type).length + 1 > this._maxListeners && this._maxListeners !== 0) {\n\t\t\tif (typeof console !== \"undefined\") {\n\t\t\t\tconsole.warn(\"Possible EventEmitter memory leak detected. \" + this._subscribers[type].length + \" listeners added. Use emitter.setMaxListeners() to increase limit.\");\n\t\t\t}\n\t\t}\n\t\tthis.emit(\"newListener\", type, f);\n\t\treturn this.subscribe(type, this, f);\n\t};\n\n\tthis.once = function (type, f) {\n\t\treturn this.subscribeOnce(type, this, f);\n\t};\n\n\tthis.removeListener = function (type, f) {\n\t\tthis.unsubscribe(type, this, f);\n\t\treturn this;\n\t};\n\n\tthis.removeAllListeners = function (type) {\n\t\tif (this._subscribers) {\n\t\t\tfor (var k in this._subscribers) {\n\t\t\t\tif (type == null || type == k) {\n\t\t\t\t\tdelete this._subscribers[k];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t};\n\n\tthis.emit = function (type) {\n\t\tthis.publish.apply(this, arguments);\n\t\treturn this.listeners(type).length > 0;\n\t};\n\n\tthis._maxListeners = 10;\n\n\tthis.setMaxListeners = function (_maxListeners) {\n\t\tthis._maxListeners = _maxListeners;\n\t};\n\n\tthis.hasListeners = function (type) {\n\t\treturn this._subscribers && this._subscribers[type] && this._subscribers[type].length;\n\t};\n\n\t/**\n\t * listenTo for inverting control of #subscribe, #on, etc.\n\t * @param {object} obj something extending js.io's lib.PubSub\n\t * @param {string} name the event name to listen to\n\t * @param {callback} function to run on event\n\t * @return {this}\n\t */\n\tthis.listenTo = function (obj, name, callback) {\n\t\tvar listeningTo = this._listeningTo || (this._listeningTo = {});\n\t\tvar id = obj._listenId || (obj._listenId = uuid(8, 16));\n\t\tlisteningTo[id] = obj;\n\t\tobj.subscribe(name, this, callback);\n\t\treturn this;\n\t};\n\n\t/**\n\t * Stop listening to objects previously passed to `listenTo`.\n\t *\n\t * @example\n\t *     // Stop listening to all events on all objects\n\t *     this.stopListening();\n\t *\n\t *     // Stop listening to all events on `obj`\n\t *     this.stopListening(obj);\n\t *\n\t *     // Stop all of my callbacks for a given event\n\t *     this.stopListening(obj, name);\n\t *\n\t *     // Stop a single callback from firing\n\t *     this.stopListening(obj, name, callback);\n\t *\n\t * @param {object} [obj] object extending lib.PubSub and using listenTo\n\t * @param {string} [name] the event name to listen to\n\t * @param {callback} [callback] function to stop running\n\t * @return {this}\n\t */\n\tthis.stopListening = function (obj, name, callback) {\n\t\tvar events, names, retain, i, j, k, l, ev;\n\t\tvar listeningTo = this._listeningTo;\n\t\tif (!listeningTo) {\n\t\t\treturn this;\n\t\t}\n\n\t\tlogger.LOG&&console.log(\"LOG\",\"lib.PubSub\",obj);\n\t\tvar remove = !name && !callback;\n\t\tif (obj) {\n\t\t\t(listeningTo = {})[obj._listenId] = obj;\n\t\t}\n\n\t\tfor (var id in listeningTo) {\n\t\t\tobj = listeningTo[id];\n\n\t\t\tnames = name ? [name] : Object.keys(obj._subscribers);\n\t\t\tfor (i = 0, l = names.length; i < l; i++) {\n\t\t\t\tname = names[i];\n\t\t\t\tif (events = obj._subscribers[name]) {\n\t\t\t\t\tobj._subscribers[name] = retain = [];\n\t\t\t\t\tfor (j = 0, k = events.length; j < k; j++) {\n\t\t\t\t\t\tev = events[j];\n\t\t\t\t\t\tif ((callback && callback !== ev._method) ||\n\t\t\t\t\t\t\t\t(this && this !== ev._ctx)) {\n\t\t\t\t\t\t\tretain.push(ev);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!retain.length) delete obj._subscribers[name];\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (remove) {\n\t\t\t\tdelete this._listeningTo[id];\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t};\n});\n\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/std/uuid.js":{"path":"modules/devkit-core/node_modules/jsio/packages/std/uuid.js","friendlyPath":"..std.uuid","directory":"modules/devkit-core/node_modules/jsio/packages/std/","filename":"uuid.js","src":"/*\nBased on Math.uuid.js 1.4 by Robert Kieffer\n\n----\nCopyright (c) 2008, Robert Kieffer\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are met:\n\n  * Redistributions of source code must retain the above copyright notice,\n\tthis list of conditions and the following disclaimer.\n  * Redistributions in binary form must reproduce the above copyright\n\tnotice, this list of conditions and the following disclaimer in the\n\tdocumentation and/or other materials provided with the distribution.\n  * Neither the name of Robert Kieffer nor the names of its contributors\n\tmay be used to endorse or promote products derived from this software\n\twithout specific prior written permission.\n  \nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\nAND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\nIMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\nARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE\nLIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\nCONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\nSUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\nINTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\nCONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\nARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\nPOSSIBILITY OF SUCH DAMAGE.\n\n*/\n\n\n\n/*\n * Generate a random uuid.\n *\n * USAGE: uuid.uuid(length, radix)\n *   length - the desired number of characters\n *   radix  - the number of allowable values for each character.\n *\n * EXAMPLES:\n *   // No arguments  - returns RFC4122, version 4 ID\n *   >>> std.uuid()\n *   \"92329D39-6F5C-4520-ABFC-AAB64544E172\"\n * \n *   // One argument - returns ID of the specified length\n *   >>> std.uuid(15)\t // 15 character ID (default base=62)\n *   \"VcydxgltxrVZSTV\"\n *\n *   // Two arguments - returns ID of the specified length, and radix. (Radix must be <= 62)\n *   >>> std.uuid(8, 2)  // 8 character ID (base=2)\n *   \"01001010\"\n *   >>> std.uuid(8, 10) // 8 character ID (base=10)\n *   \"47473046\"\n *   >>> std.uuid(8, 16) // 8 character ID (base=16)\n *   \"098F4D35\"\n */\n\n\nvar CHARS = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split(''); \nexports.uuid = function (len, radix) {\n\tvar chars = CHARS, uuid = [], rnd = Math.random;\n\tradix = radix || chars.length;\n\n\tif (len) {\n\t\t// Compact form\n\t\tfor (var i = 0; i < len; i++) uuid[i] = chars[0 | rnd()*radix];\n\t} else {\n\t\t// rfc4122, version 4 form\n\t\tvar r;\n\n\t\t// rfc4122 requires these characters\n\t\tuuid[8] = uuid[13] = uuid[18] = uuid[23] = '-';\n\t\tuuid[14] = '4';\n\n\t\t// Fill in random data.  At i==19 set the high bits of clock sequence as\n\t\t// per rfc4122, sec. 4.1.5\n\t\tfor (var i = 0; i < 36; i++) {\n\t\t\tif (!uuid[i]) {\n\t\t\t\tr = 0 | rnd()*16;\n\t\t\t\tuuid[i] = chars[(i == 19) ? (r & 0x3) | 0x8 : r & 0xf];\n\t\t\t}\n\t\t}\n\t}\n\treturn uuid.join('');\n};\n\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/native/initialize.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/native/initialize.js","friendlyPath":"platforms.native.initialize","directory":"modules/devkit-core/modules/timestep/src/platforms/native/","filename":"initialize.js","baseMod":"platforms","basePath":"/Users/marcelo.hashimoto/Desktop/gamedev/ElementalMatch3/modules/devkit-core/modules/timestep/src/platforms","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import device');\n\ndevice.registerDevice('tealeaf', 'platforms.native');\nexports.init = function () {\n  // TODO: any init?\n}\n\n//TODO do fonts in a better way and then remove this entirely\nif (!NATIVE.gl.initialized) {\n  NATIVE.gl.initialized = true;\n  \n  if (NATIVE.gl.fonts) {\n    var data = NATIVE.gl.fonts;\n    var boldRe = /(bold|W6|wide)/i;\n    var italicRe = /(italic|oblique)/i;\n    var mediumRe = /(medium)/i;\n    var lightRe = /(light)/i;\n\n    var fontMap = {};\n    for (var family in data) {\n      var fonts = data[family];\n      var familyMap = {};\n    \n      var keys = fonts.map(function (font) {\n        var captures = /[\\-]{1,1}(\\w+)/.exec(font);\n        var style = captures ? captures[1] : null;\n        if (!style) {\n          return 'normal';\n        }\n        if (boldRe.test(style)) {\n          if (italicRe.test(style)) {\n            return 'bolditalic';\n          }else{\n            return 'bold'\n          }\n        }\n        if(italicRe.test(style)) {\n          return 'italic';\n        }\n        if(mediumRe.test(style) && data[family].some(function (item) {\n          return lightRe.test(item);\n        })) {\n          return 'bold';\n        }\n        return 'normal';\n      });\n\n      for (var i = 0, style; style = keys[i]; ++i) {\n        familyMap[style] = fonts[i];\n      }\n      fontMap[family] = familyMap;\n    }\n    NATIVE.gl.fonts = fontMap;\n  }\n}\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/canvas/animate.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/animate.js","friendlyPath":".backend.canvas.animate","directory":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/","filename":"animate.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * package ui.backend.canvas.animate;\n *\n * Canvas animate namespace and functions.\n *\n * Internal Class Note:\n *   Animators are kept on subjects, and only get GC'd if subject does\n *   Frames are pooled and recycled internally\n */\n\njsio('import event.Emitter as Emitter');\njsio('import animate.transitions as transitions');\njsio('import timer');\njsio('import ObjectPool');\n\nvar engine = null;\nvar groups = {};\nvar DEFAULT_GROUP_ID = \"__default_group\";\n\nexports = function (subject, groupID) {\n  // TODO: we have a circular import, so do the Engine import on first use\n  if (engine === null) {\n    jsio('import ui.Engine as Engine');\n    jsio('import ui.View as View');\n    jsio('import device');\n    engine = Engine.get();\n  }\n\n  if (device.useDOM && subject instanceof View && !groupID) {\n    return subject.getAnimation();\n  }\n\n  // create a group for this groupID if it doesn't exist\n  groupID = groupID || DEFAULT_GROUP_ID;\n  !groups[groupID] && (groups[groupID] = new Group(groupID));\n\n  // animators created once and cached on subject '__anims' object by groupID\n  // so they're only garbage collected when the subject is garbage collected\n  var anims = subject.__anims || (subject.__anims = {});\n  var anim = anims[groupID];\n  if (!anim) {\n    anim = subject instanceof View\n      ? new ViewAnimator(subject)\n      : new Animator(subject);\n    anim.groupID = groupID;\n    anims[groupID] = anim;\n  }\n\n  return anim;\n};\n\n// get all animations on a given subject\nexports.getSubjectAnimations = function (subject) {\n  var anims = subject.__anims || {};\n  var animsArray = [];\n  for (var id in anims) {\n    animsArray.push(anims[id]);\n  }\n  return animsArray;\n};\n\n// clear all animations on a given subject\nexports.clearSubjectAnimations = function (subject) {\n  var anims = this.getSubjectAnimations(subject);\n  for (var i = 0; i < anims.length; i++) {\n    anims[i].clear();\n  }\n};\n\n// commit all animations on a given subject\nexports.commitSubjectAnimations = function (subject) {\n  var anims = this.getSubjectAnimations(subject);\n  for (var i = 0; i < anims.length; i++) {\n    anims[i].commit();\n  }\n};\n\n// pause all animations on a given subject\nexports.pauseSubjectAnimations = function (subject) {\n  var anims = this.getSubjectAnimations(subject);\n  for (var i = 0; i < anims.length; i++) {\n    anims[i].pause();\n  }\n};\n\n// resume all animations on a given subject\nexports.resumeSubjectAnimations = function (subject) {\n  var anims = this.getSubjectAnimations(subject);\n  for (var i = 0; i < anims.length; i++) {\n    anims[i].resume();\n  }\n};\n\n// clear all animations globally\nexports.clearAllAnimations = function () {\n  for (var id in groups) {\n    groups[id].clear();\n  }\n};\n\n// commit all animations globally\nexports.commitAllAnimations = function () {\n  for (var id in groups) {\n    groups[id].commit();\n  }\n};\n\n// pause all animations globally\nexports.pauseAllAnimations = function () {\n  for (var id in groups) {\n    groups[id].pause();\n  }\n};\n\n// resume all animations globally\nexports.resumeAllAnimations = function () {\n  for (var id in groups) {\n    groups[id].resume();\n  }\n};\n\n// see Group Class notes below\nexports.getGroup = function (groupID) {\n  return groups[groupID || DEFAULT_GROUP_ID];\n};\n\n/**\n * Group Class\n * - a collection of animations by groupID across different subjects\n * - accessed by animate.getGroup()\n * - subscribe to the 'Finish' event to fire a callback when\n *     all animations in the group are complete or cleared, for example:\n *     myGroup.once('Finish', function () { ... });\n * - exposes clear, commit, pause, and resume to apply to all group animations\n */\nGroup=__class__;var Group=Group(function Group(){return this.init&&this.init.apply(this,arguments)},Emitter, function () {\n  this.init = function (groupID) {\n    this.groupID = groupID + '';\n    this.anims = [];\n  };\n\n  // add an active animator to the group\n  this.add = function (anim) {\n    if (this.anims.indexOf(anim) === -1) {\n      this.anims.push(anim);\n    }\n  };\n\n  // remove an inactive animator from the group\n  this.remove = function (anim) {\n    var index = this.anims.indexOf(anim);\n    if (index !== -1) {\n      this.anims.splice(index, 1);\n\n      // fire Finish event after final animation removed\n      if (this.anims.length === 0) {\n        this.publish('Finish');\n      }\n    }\n  };\n\n  // are there any active animators in the group?\n  this.isActive = function () {\n    return this.anims.length > 0;\n  };\n\n  // clear all the animators in the group\n  this.clear = function () {\n    var anims = this.anims;\n    for (var i = anims.length - 1; i >= 0; i--) {\n      anims[i].clear();\n    }\n    return this;\n  };\n\n  // commit all the animators in the group\n  this.commit = function () {\n    var anims = this.anims;\n    for (var i = anims.length - 1; i >= 0; i--) {\n      anims[i].commit();\n    }\n    return this;\n  };\n\n  // pause all the animators in the group\n  this.pause = function () {\n    var anims = this.anims;\n    for (var i = anims.length - 1; i >= 0; i--) {\n      anims[i].pause();\n    }\n    return this;\n  };\n\n  // resume all the animators in the group\n  this.resume = function () {\n    var anims = this.anims;\n    for (var i = anims.length - 1; i >= 0; i--) {\n      anims[i].resume();\n    }\n    return this;\n  };\n});\n\nvar TRANSITIONS = [\n  transitions.easeInOut,         // 0: default\n  transitions.linear,            // 1\n  transitions.easeIn,            // 2\n  transitions.easeOut,           // 3\n  transitions.easeInOut,         // 4\n  transitions.easeInQuad,        // 5\n  transitions.easeOutQuad,       // 6\n  transitions.easeInOutQuad,     // 7\n  transitions.easeInCubic,       // 8\n  transitions.easeOutCubic,      // 9\n  transitions.easeInOutCubic,    // 10\n  transitions.easeInQuart,       // 11\n  transitions.easeOutQuart,      // 12\n  transitions.easeInOutQuart,    // 13\n  transitions.easeInQuint,       // 14\n  transitions.easeOutQuint,      // 15\n  transitions.easeInOutQuint,    // 16\n  transitions.easeInSine,        // 17\n  transitions.easeOutSine,       // 18\n  transitions.easeInOutSine,     // 19\n  transitions.easeInExpo,        // 20\n  transitions.easeOutExpo,       // 21\n  transitions.easeInOutExpo,     // 22\n  transitions.easeInCirc,        // 23\n  transitions.easeOutCirc,       // 24\n  transitions.easeInOutCirc,     // 25\n  transitions.easeInElastic,     // 26\n  transitions.easeOutElastic,    // 27\n  transitions.easeInOutElastic,  // 28\n  transitions.easeInBack,        // 29\n  transitions.easeOutBack,       // 30\n  transitions.easeInOutBack,     // 31\n  transitions.easeInBounce,      // 32\n  transitions.easeOutBounce,     // 33\n  transitions.easeInOutBounce    // 34\n];\n\nexports.linear            = 1;\nexports.easeIn            = 2;\nexports.easeOut           = 3;\nexports.easeInOut         = 4;\nexports.easeInQuad        = 5;\nexports.easeOutQuad       = 6;\nexports.easeInOutQuad     = 7;\nexports.easeInCubic       = 8;\nexports.easeOutCubic      = 9;\nexports.easeInOutCubic    = 10;\nexports.easeInQuart       = 11;\nexports.easeOutQuart      = 12;\nexports.easeInOutQuart    = 13;\nexports.easeInQuint       = 14;\nexports.easeOutQuint      = 15;\nexports.easeInOutQuint    = 16;\nexports.easeInSine        = 17;\nexports.easeOutSine       = 18;\nexports.easeInOutSine     = 19;\nexports.easeInExpo        = 20;\nexports.easeOutExpo       = 21;\nexports.easeInOutExpo     = 22;\nexports.easeInCirc        = 23;\nexports.easeOutCirc       = 24;\nexports.easeInOutCirc     = 25;\nexports.easeInElastic     = 26;\nexports.easeOutElastic    = 27;\nexports.easeInOutElastic  = 28;\nexports.easeInBack        = 29;\nexports.easeOutBack       = 30;\nexports.easeInOutBack     = 31;\nexports.easeInBounce      = 32;\nexports.easeOutBounce     = 33;\nexports.easeInOutBounce   = 34;\n\nfunction getTransition(n) {\n  return (typeof n == 'function' ? n : TRANSITIONS[n | 0]);\n};\n\nFrame=__class__;var Frame=Frame(function Frame(){return this.init&&this.init.apply(this,arguments)},function () {\n  this.init = function () {\n    this.subject = null;\n    this.target = null;\n    this.duration = 0;\n    this.transition = null;\n    this.base = null;\n    this._baseStyle = null;\n    // ObjectPool book-keeping\n    this.pool = null;\n    this._poolIndex = 0;\n    this._obtainedFromPool = false;\n  };\n\n  this.reset = function (subject, target, duration, transition) {\n    this.subject = subject;\n    this.target = target;\n    this.duration = duration === 0 ? 0 : (duration || 500);\n    this.transition = getTransition(transition);\n    this.base = null;\n    this._baseStyle = null;\n    if (this.duration < 0) {\n      throw new Error(\"Animations cannot have negative durations!\");\n    }\n  };\n\n  this.recycle = function () {\n    this.pool.release(this);\n  };\n\n  this.exec = function (tt, t, debug) {};\n  this.debugLog = function (tt) {};\n});\n\nCallbackFrame=__class__;var CallbackFrame=CallbackFrame(function CallbackFrame(){return this.init&&this.init.apply(this,arguments)},Frame, function () {\n  var supr = Frame.prototype;\n\n  this.reset = function (subject, target, duration, transition) {\n    supr.reset.call(this, subject, target, duration, transition);\n    // CallbackFrames act like tick functions when given durations\n    this.duration = duration || 0;\n  };\n\n  this.exec = function (tt, t, debug) {\n    this.target.call(this.subject, tt, t, debug);\n  };\n});\n\nObjectFrame=__class__;var ObjectFrame=ObjectFrame(function ObjectFrame(){return this.init&&this.init.apply(this,arguments)},Frame, function () {\n  this.exec = function (tt, t, debug) {\n    // set starting values on first execution\n    if (!this.base) {\n      this.base = {};\n      for (var key in this.target) {\n        this.base[key] = this.subject[key];\n      }\n    }\n\n    for (var key in this.target) {\n      var baseValue = this.base[key];\n      this.subject[key] = baseValue + tt * (this.target[key] - baseValue);\n    }\n    debug && this.debugLog(tt);\n  };\n\n  this.debugLog = function (tt) {\n    var changed = {};\n    for (var key in this.target) {\n      changed[key] = this.subject[key] + ' -> ' + this.target[key];\n    }\n    logger.LOG&&console.log(\"LOG\",\".backend.canvas.animate\",this.duration, tt, JSON.stringify(changed));\n  };\n});\n\n// a ViewStyleFrame updates a view's style in exec\nViewStyleFrame=__class__;var ViewStyleFrame=ViewStyleFrame(function ViewStyleFrame(){return this.init&&this.init.apply(this,arguments)},Frame, function () {\n  this.resolveDeltas = function (againstStyle) {\n    var style = this.target;\n    for (var key in style) {\n      var baseKey = key.substring(1);\n      if (key.charAt(0) == 'd'\n        && !(key in againstStyle)\n        && (baseKey in againstStyle))\n      {\n        style[baseKey] = style[key] + againstStyle[baseKey];\n        delete style[key];\n      }\n    }\n  };\n\n  this.exec = function (tt, t, debug) {\n    var oldStyle = this._baseStyle;\n    var newStyle = this.target;\n    var viewStyle = this.subject.style;\n\n    // resolve deltas and starting style on first execution\n    if (!oldStyle) {\n      oldStyle = this._baseStyle = viewStyle.copy();\n      this.resolveDeltas(oldStyle);\n    }\n\n    for (var key in newStyle) {\n      if (key in oldStyle) {\n        var oldValue = oldStyle[key];\n        viewStyle[key] = oldValue + tt * (newStyle[key] - oldValue);\n      }\n    }\n    debug && this.debugLog(tt);\n  };\n\n  this.debugLog = function (tt) {\n    var changed = {};\n    var newStyle = this.target;\n    var viewStyle = this.subject.style;\n    for (var key in newStyle) {\n      changed[key] = viewStyle[key] + ' -> ' + newStyle[key];\n    }\n    logger.LOG&&console.log(\"LOG\",\".backend.canvas.animate\",timer.now, this.duration, tt, JSON.stringify(changed));\n  };\n});\n\nexports.Animator=__class__;var Animator = exports.Animator=exports.Animator(function exports_Animator(){return this.init&&this.init.apply(this,arguments)},Emitter, function () {\n  this.init = function (subject) {\n    this.subject = subject;\n    this._queue = [];\n    this._elapsed = 0;\n    this._isPaused = false;\n    this._isScheduled = false;\n    this._debug = false;\n  };\n\n  this.clear = function () {\n    var queue = this._queue;\n    var len = queue.length;\n    for (var i = 0; i < len; i++) {\n      queue[i].recycle();\n    }\n    queue.length = 0;\n    this._elapsed = 0;\n    this._unschedule();\n    this._removeFromGroup();\n    return this;\n  };\n\n  // Careful: pause will *not* fire the finish event, so anything pending the end of the\n  // animation will have to wait until the animation is resumed.\n  this.pause = function () {\n    if (!this._isPaused) {\n      this._isPaused = true;\n      this._unschedule();\n    }\n    return this;\n  };\n\n  this.resume = function () {\n    if (this._isPaused) {\n      this._isPaused = false;\n      this._schedule();\n    }\n    return this;\n  };\n\n  this._schedule = function () {\n    if (!this._isScheduled) {\n      this._isScheduled = true;\n      engine.subscribe('Tick', this, 'onTick');\n    }\n  };\n\n  this._unschedule = function () {\n    if (this._isScheduled) {\n      this._isScheduled = false;\n      engine.unsubscribe('Tick', this, 'onTick');\n    }\n  };\n\n  this.isPaused = function () { return this._isPaused; };\n  this.hasFrames = function () { return !!this._queue[0]; };\n\n  this.wait = function (duration) {\n    return this.then(undefined, duration);\n  };\n\n  this.buildFrame = function (target, duration, transition) {\n    var frame;\n    var subject = this.subject;\n    var targetType = typeof target;\n    if (targetType === 'function') {\n      frame = callbackFramePool.obtain();\n      frame.pool = callbackFramePool;\n    } else if (targetType === 'object') {\n      frame = objectFramePool.obtain();\n      frame.pool = objectFramePool;\n    } else {\n      frame = framePool.obtain();\n      frame.pool = framePool;\n    }\n    frame.reset(subject, target, duration, transition);\n    return frame;\n  };\n\n  this.now = function (target, duration, transition) {\n    this.clear();\n    return this.then(target, duration, transition);\n  };\n\n  this.then = function (target, duration, transition) {\n    if (!this._queue.length) {\n      this._elapsed = 0;\n    }\n\n    this._queue.push(this.buildFrame(target, duration, transition));\n    this._schedule();\n    this._addToGroup();\n    return this;\n  };\n\n  this.debug = function () {\n    this._debug = true;\n    return this;\n  };\n\n  this.commit = function () {\n    this.resume();\n    this._elapsed = 0;\n    for (var i = 0, p; p = this._queue[i]; ++i) {\n      this._elapsed += p.duration;\n    }\n\n    this.next();\n    return this;\n  };\n\n  this.onTick = function (dt) {\n    if (!this._isScheduled) {\n      return;\n    }\n\n    this._elapsed += dt;\n    this.next();\n  };\n\n  this.next = function () {\n    var p = this._queue[0];\n    while (p) {\n      var duration = p.duration;\n      var frameFinished = this._elapsed >= duration;\n      var t = frameFinished ? 1 : this._elapsed / duration;\n      var tt = p.transition(t);\n\n      if (frameFinished) {\n        this._elapsed -= duration;\n      }\n\n      p.exec(tt, t, this._debug);\n\n      // remove frame if finished and queue wasn't modified by a callback\n      if (frameFinished && p === this._queue[0]) {\n        var frame = this._queue.shift();\n        frame.recycle();\n      }\n\n      // if paused during a callback or frame not finished, don't continue\n      if (!frameFinished || this._isPaused) { return; }\n\n      p = this._queue[0];\n    }\n\n    // nothing left in the queue!\n    this._unschedule();\n    this._removeFromGroup();\n  };\n\n  this._addToGroup = function () {\n    var group = groups[this.groupID];\n    group && group.add(this);\n  };\n\n  this._removeFromGroup = function () {\n    var group = groups[this.groupID];\n    group && group.remove(this);\n  };\n});\n\nViewAnimator=__class__;var ViewAnimator=ViewAnimator(function ViewAnimator(){return this.init&&this.init.apply(this,arguments)},Animator, function () {\n  var supr = Animator.prototype;\n\n  this.buildFrame = function (target, duration, transition) {\n    if (typeof target === 'object') {\n      var frame = viewStyleFramePool.obtain();\n      frame.pool = viewStyleFramePool;\n      frame.reset(this.subject, target, duration, transition);\n      return frame;\n    } else {\n      return supr.buildFrame.call(this, target, duration, transition);\n    }\n  };\n});\n\n// used to get/set native or browser ViewAnimator constructors\nexports.getViewAnimator = function () { return ViewAnimator; };\nexports.setViewAnimator = function (ctor) { ViewAnimator = ctor; };\n\n\n\n// pool frame classes to minimize mem allocation and garbage collection\nvar framePool = new ObjectPool({ ctor: Frame });\nvar objectFramePool = new ObjectPool({ ctor: ObjectFrame });\nvar callbackFramePool = new ObjectPool({ ctor: CallbackFrame });\nvar viewStyleFramePool = new ObjectPool({ ctor: ViewStyleFrame });\n\n// API for pre-populating frame pools\n//   this is useful if you plan on launching many animations at once\nexports.initializeFrameCount = function (count) {\n  count -= framePool.getTotalCount();\n  for (var i = 0; i < count; i++) {\n    framePool.create();\n  }\n};\n\nexports.initializeObjectFrameCount = function (count) {\n  count -= objectFramePool.getTotalCount();\n  for (var i = 0; i < count; i++) {\n    objectFramePool.create();\n  }\n};\n\nexports.initializeCallbackFrameCount = function (count) {\n  count -= callbackFramePool.getTotalCount();\n  for (var i = 0; i < count; i++) {\n    callbackFramePool.create();\n  }\n};\n\nexports.initializeViewStyleFrameCount = function (count) {\n  count -= viewStyleFramePool.getTotalCount();\n  for (var i = 0; i < count; i++) {\n    viewStyleFramePool.create();\n  }\n};\n","pre":true},"modules/devkit-core/modules/timestep/src/animate/transitions.js":{"path":"modules/devkit-core/modules/timestep/src/animate/transitions.js","friendlyPath":"animate.transitions","directory":"modules/devkit-core/modules/timestep/src/animate/","filename":"transitions.js","baseMod":"animate","basePath":"/Users/marcelo.hashimoto/Desktop/gamedev/ElementalMatch3/modules/devkit-core/modules/timestep/src/animate","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @module animate.transitions\n *\n * Transition functions for use by the animate features. These aren't referenced\n * directly by the animate namespace, but by numerical reference.\n *\n * @doc http://doc.gameclosure.com/api/animate.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/animate.md\n */\n\nexports.linear = function (n) {\n  return n;\n};\nexports.easeIn = exports.easeInQuad = function (n) {\n  return n * n;\n};\nexports.easeOut = exports.easeOutQuad = function (n) {\n  return n * (2 - n);\n};\nexports.easeInOutQuad = function (n) {\n  if ((n *= 2) < 1) return 0.5 * n * n;\n  return -0.5 * ((--n) * (n - 2) - 1);\n};\nexports.easeInCubic = function (n) {\n  return n * n * n;\n};\nexports.easeOutCubic = function (n) {\n  return ((n -= 1) * n * n + 1);\n};\nexports.easeInOut = exports.easeInOutCubic = function (n) {\n  if ((n *= 2) < 1) return 0.5 * n * n * n;\n  return 0.5 * ((n -= 2) * n * n + 2);\n};\nexports.easeInQuart = function (n) {\n  return n * n * n * n;\n};\nexports.easeOutQuart = function (n) {\n  return -1 * ((n -= 1) * n * n * n - 1);\n};\nexports.easeInOutQuart = function (n) {\n  if ((n *= 2) < 1) return 0.5 * n * n * n * n;\n  return -0.5 * ((n -= 2) * n * n * n - 2);\n};\nexports.easeInQuint = function (n) {\n  return n * n * n * n * n;\n};\nexports.easeOutQuint = function (n) {\n  return ((n -= 1) * n * n * n * n + 1);\n};\nexports.easeInOutQuint = function (n) {\n  if ((n *= 2) < 1) return 0.5 * n * n * n * n * n;\n  return 0.5 * ((n -= 2) * n * n * n * n + 2);\n};\nexports.easeInSine = function(n){\n  if (n == 0) return 0;\n  if (n == 1) return 1;\n  return -1 * Math.cos(n * (Math.PI / 2)) + 1;\n};\nexports.easeOutSine = function (n) {\n  if (n == 0) return 0;\n  if (n == 1) return 1;\n  return Math.sin(n * (Math.PI / 2));\n};\nexports.easeInOutSine = function (n) {\n  if (n == 0) return 0;\n  if (n == 1) return 1;\n  return -0.5 * (Math.cos(Math.PI * n) - 1);\n};\nexports.easeInExpo = function (n) {\n  if (n == 0) return 0;\n  if (n == 1) return 1;\n  return (n == 0) ? 0 : Math.pow(2, 10 * (n - 1));\n};\nexports.easeOutExpo = function (n) {\n  if (n == 0) return 0;\n  if (n == 1) return 1;\n  return (n == 1) ? 1 : (-Math.pow(2, -10 * n) + 1);\n};\nexports.easeInOutExpo = function (n) {\n  if (n == 0) return 0;\n  if (n == 1) return 1;\n  if ((n *= 2) < 1) return 0.5 * Math.pow(2, 10 * (n - 1));\n  return 0.5 * (-Math.pow(2, -10 * --n) + 2);\n};\nexports.easeInCirc = function (n) {\n  if (n == 0) return 0;\n  if (n == 1) return 1;\n  return -1 * (Math.sqrt(1 - n * n) - 1);\n};\nexports.easeOutCirc = function (n) {\n  if (n == 0) return 0;\n  if (n == 1) return 1;\n  return  Math.sqrt(1 - (n -= 1) * n);\n};\nexports.easeInOutCirc = function (n) {\n  if (n == 0) return 0;\n  if (n == 1) return 1;\n  if ((n*=2) < 1) return -0.5 * (Math.sqrt(1 - n * n) - 1);\n  return 0.5 * (Math.sqrt(1 - (n -= 2) * n) + 1);\n};\nexports.easeInElastic = function (n) {\n  if (n == 0) return 0;\n  if (n == 1) return 1;\n  var p = 0.3;\n  var s = 0.075;  // p / (2 * Math.PI) * Math.asin(1)\n  return -(Math.pow(2, 10 * (n -= 1)) * Math.sin((n - s) * (2 * Math.PI) / p));\n};\nexports.easeOutElastic = function (n) {\n  if (n == 0) return 0;\n  if (n == 1) return 1;\n  var p = 0.3;\n  var s = 0.075;  // p / (2 * Math.PI) * Math.asin(1)\n  return Math.pow(2,-10 * n) * Math.sin((n - s) * (2 * Math.PI) / p) + 1;\n};\nexports.easeInOutElastic = function (n) {\n  if (n == 0) return 0;\n  if ((n *= 2) == 2) return 1;\n  var p = 0.45; // 0.3 * 1.5\n  var s = 0.1125; // p / (2 * Math.PI) * Math.asin(1)\n  if (n < 1) return -.5 * (Math.pow(2, 10 * (n -= 1)) * Math.sin((n * 1 - s) * (2 * Math.PI) / p));\n  return Math.pow(2, -10 * (n -= 1)) * Math.sin((n * 1 - s) * (2 * Math.PI) / p ) * .5 + 1;\n};\nexports.easeInBack = function (n) {\n  if (n == 0) return 0;\n  if (n == 1) return 1;\n  var s = 1.70158;\n  return n * n * ((s + 1) * n - s);\n};\nexports.easeOutBack = function (n) {\n  if (n == 0) return 0;\n  if (n == 1) return 1;\n  var s = 1.70158;\n  return ((n -= 1) * n * ((s + 1) * n + s) + 1);\n};\nexports.easeInOutBack = function (n) {\n  if (n == 0) return 0;\n  if (n == 1) return 1;\n  var s = 1.70158;\n  if ((n *= 2) < 1) return 0.5 * (n * n * (((s *= 1.525) + 1) * n - s));\n  return 0.5 * ((n -= 2) * n * (((s *= 1.525) + 1) * n + s) + 2);\n};\nexports.easeOutBounce = function (n) {\n  if (n == 0) return 0;\n  if (n == 1) return 1;\n  if (n < (1 / 2.75)) {\n    return (7.5625 * n * n);\n  } else if (n < (2 / 2.75)) {\n    return (7.5625 * (n -= (1.5 / 2.75)) * n + .75);\n  } else if (n < (2.5 / 2.75)) {\n    return (7.5625 * (n -= (2.25 / 2.75)) * n + .9375);\n  } else {\n    return (7.5625 * (n -= (2.625 / 2.75)) * n + .984375);\n  }\n};\nexports.easeInBounce = function (n) {\n  return 1 - exports.easeOutBounce(1 - n);\n};\nexports.easeInOutBounce = function (n) {\n  if (n < 0.5) return exports.easeInBounce(n * 2) * .5;\n  return exports.easeOutBounce((n * 2) - 1) * .5 + .5;\n};","pre":true},"modules/devkit-core/modules/timestep/src/timer.js":{"path":"modules/devkit-core/modules/timestep/src/timer.js","friendlyPath":"timer","directory":"modules/devkit-core/modules/timestep/src/","filename":"timer.js","baseMod":"timer","basePath":"/Users/marcelo.hashimoto/Desktop/gamedev/ElementalMatch3/modules/devkit-core/modules/timestep/src/timer","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @module timer\n *\n * Implements an independent, singleton timer for use by the environment.\n * The Application Engine binds to this to generate the rendering tick.\n */\n\njsio('import device');\n\nvar Timer = device.get('Timer');\n\nvar MAX_TICK = 10000; // ticks over 10 seconds will be considered too large to process\nexports.now = 0;\nexports.frames = 0;\nexports.reset = function () { this._last = null; }\nexports.tick = function (dt) {\n  try {\n    if (dt > MAX_TICK) {\n      exports.onLargeTick(dt, MAX_TICK);\n      dt = 1;\n    }\n    \n    exports.now += dt;\n    exports.frames++;\n    exports.onTick(dt);\n    ok = true;\n  } finally {\n    if (exports.debug && !ok) {\n      app.stopLoop()\n    }\n  }\n}\n\n/**\n * If our computer falls asleep, dt might be an insanely large number. \n * If we're running a simulation of sorts, we don't want the computer\n * to freeze while computing 1000s of simulation steps, so just drop\n * this tick.  Anyone who is interested can listen for a call to 'onLargeTick'\n */\nexports.onLargeTick = function (largeDt, threshold) {\n  logger.WARN&&console.warn(\"WARN\",\"timer\",'Dropping large tick: ' + largeDt + '; Threshold is set at: ' + threshold);\n}\n\nexports.onTick = function (dt) {}\n\nexports.debug = false;\n\n\n// TODO: <jsio>('from iOS import start as exports.start, stop as exports.stop');\n\nexports.start = function (minDt) {\n  this.reset();\n  this.isRunning = true;\n  device.get('Timer').start(exports.tick, minDt);\n}\n\nexports.stop = function () {\n  this.reset();\n  this.isRunning = false;\n  device.get('Timer').stop();\n}\n\nexports.getTickProgress = function () {\n  var now = +new Date;\n  return (-(Timer.last || now) + now);\n}\n","pre":true},"modules/devkit-core/modules/timestep/src/ObjectPool.js":{"path":"modules/devkit-core/modules/timestep/src/ObjectPool.js","friendlyPath":"ObjectPool","directory":"modules/devkit-core/modules/timestep/src/","filename":"ObjectPool.js","baseMod":"ObjectPool","basePath":"/Users/marcelo.hashimoto/Desktop/gamedev/ElementalMatch3/modules/devkit-core/modules/timestep/src/ObjectPool","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ObjectPool\n *  class instances can be very costly to garbage collect and initialize, so\n *  be good to the environment, and always recycle!\n */\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ObjectPool=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ObjectPool(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ObjectPool(){return this.init&&this.init.apply(this,arguments)},'ObjectPool', function () {\n  this.init = function (opts) {\n    this._ctor = opts.ctor;\n    this._pool = [];\n    this._freshIndex = 0;\n\n    var initCount = opts.initCount || 0;\n    for (var i = 0; i < initCount; i++) {\n      this.create();\n    }\n  };\n\n  this.create = function () {\n    var pool = this._pool;\n    var obj = new this._ctor();\n    obj._poolIndex = pool.length;\n    pool.push(obj);\n    return obj;\n  };\n\n  this.obtain = function () {\n    var obj;\n    var pool = this._pool;\n    if (this._freshIndex < pool.length) {\n      obj = pool[this._freshIndex];\n    } else {\n      obj = this.create();\n    }\n    obj._obtainedFromPool = true;\n    this._freshIndex++;\n    return obj;\n  };\n\n  this.release = function (obj) {\n    var pool = this._pool;\n    if (obj._obtainedFromPool) {\n      obj._obtainedFromPool = false;\n      var temp = pool[this._freshIndex - 1];\n      pool[this._freshIndex - 1] = obj;\n      pool[obj._poolIndex] = temp;\n      var tempIndex = temp._poolIndex;\n      temp._poolIndex = obj._poolIndex;\n      obj._poolIndex = tempIndex;\n      this._freshIndex--;\n    }\n  };\n\n  this.forEachActive = function (fn, ctx) {\n    var pool = this._pool;\n    for (var i = this._freshIndex - 1; i >= 0; i--) {\n      fn.call(ctx, pool[i], i);\n    }\n  };\n\n  this.getActiveCount = function () {\n    return this._freshIndex;\n  };\n\n  this.getTotalCount = function () {\n    return this._pool.length;\n  };\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/Engine.js":{"path":"modules/devkit-core/modules/timestep/src/ui/Engine.js","friendlyPath":"ui.Engine","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"Engine.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.Engine\n *\n * This is the game engine for timestep. It is built on a scene graph composed\n * of \"views\", and has canvas and DOM rendering backends.\n *\n * Responsibilities for the application engine includes initializing the canvas,\n * input and key listeners, game loop, animation tick, the view hierarchy and\n * rendering the scene graph.\n *\n * Not to be confused with GC.Application, the superclass exposed to games which\n * controls the game loop. A single ui.Engine is instantiated for\n * games which resides at GC.app.engine.\n *\n * @doc http://doc.gameclosure.com/api/appengine.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/appengine.md\n */\n\njsio('import event.Emitter as Emitter');\n\njsio('import event.input.dispatch as dispatch');\n\njsio('import timer');\njsio('import ui.backend.ReflowManager as ReflowManager');\n\njsio('import device');\n\nvar _timers = [];\ntimer.onTick = function (dt) {\n  var i = _timers.length;\n  while (i--) {\n    _timers[i](dt);\n  }\n}\n\nvar __instance = null;\n\n/**\n * @extends event.Emitter\n */\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_Engine=__class__;var Engine = exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_Engine(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_Engine(){return this.init&&this.init.apply(this,arguments)},Emitter, function (supr) {\n  this.init = function (opts) {\n    if (!__instance) {\n      jsio('import .StackView');\n\n      __instance = this;\n    }\n\n    var canvas = opts && opts.canvas;\n    if (typeof canvas == 'string' && GLOBAL.document && document.getElementById) {\n      canvas = document.getElementById(canvas);\n    }\n\n    this._opts = opts = merge(opts, {\n      keyListenerEnabled: true,\n      width: canvas && canvas.width || device.width,\n      height: canvas && canvas.height || device.height,\n      view: null,\n      dtFixed: 0,\n      dtMinimum: 0,\n      clearEachFrame: true,\n      alwaysRepaint: true,\n      repaintOnEvent: true,\n      mergeMoveEvents: false,\n      continuousInputCheck: !device.isMobileBrowser && !device.isMobile,\n      showFPS: false\n    });\n\n    _timers.push(bind(this, this._tick));\n\n    this._doubleBuffered = true;\n    this._countdown = null;\n\n    var Canvas = device.get('Canvas');\n    this._rootElement = new Canvas({\n      el: canvas, // use an existing canvas if one was provided, but wrap the 2D context\n      useWebGL: true, // use WebGL if supported\n      width: opts.width,\n      height: opts.height,\n      offscreen: false\n    });\n\n    canvas = this._rootElement;\n\n    var dpr = device.screen.devicePixelRatio;\n    this._rootElement.style.width = (opts.width / dpr) + 'px';\n    this._rootElement.style.height = (opts.height / dpr) + 'px';\n    this._rootElement.id = \"timestep_onscreen_canvas\";\n    this._ctx = this._rootElement.getContext('2d');\n    this._ctx.font = '11px ' + device.defaultFontFamily;\n\n    this._view = opts.view || new StackView();\n    this._view.style.update({\n      width: opts.width,\n      height: opts.height\n    });\n\n    // __root is a pointer to the Engine instance that a view\n    // is currently attached to.  If __root is null, the view\n    // is not currently in a view hierarchy.\n    this._view.__root = this;\n\n    this._events = [];\n\n    if (dispatch.KeyListener) {\n      this._keyListener = new dispatch.KeyListener();\n    }\n\n    this._inputListener = new dispatch.InputListener({\n      rootView: this._view,\n      el: this._rootElement,\n      keyListener: this._keyListener,\n      engine: this\n    });\n\n    this._reflowMgr = ReflowManager.get();\n\n    this._tickBuffer = 0;\n    this._onTick = [];\n\n    // configure auto-layout in the browser (expand\n    // to fill the viewport)\n    if (device.name == 'browser') {\n      device.width = opts.width;\n      device.height = opts.height;\n      device.screen.width = opts.width;\n      device.screen.height = opts.height;\n      var doc = device.get('doc');\n      if (doc) {\n        doc.setEngine(this);\n      }\n    }\n\n    this.updateOpts(this._opts);\n  };\n\n  this.getOpt = function (key) {\n    return this._opts[key];\n  };\n\n  this.updateOpts = function (opts) {\n    this._opts = merge(opts, this._opts);\n    if (this._keyListener) {\n      this._keyListener.setEnabled(this._opts.keyListenerEnabled);\n    }\n\n    if (this._opts.scaleUI) {\n      if (Array.isArray(this._opts.scaleUI)) {\n        if (this._opts.scaleUI.length != 2) {\n          throw new Error(\"Illegal value for engine option scaleUI: \" + this._opts.scaleUI);\n        }\n        this.scaleUI(this._opts.scaleUI[0], this._opts.scaleUI[1]);\n      } else {\n        this.scaleUI(576, 1024);\n      }\n    }\n\n    if (this._opts.showFPS) {\n      if (!this._applicationFPS) {\n        jsio('import ui.backend.debug.FPSView as FPSView');\n        this._applicationFPS = new FPSView({application: this});\n      }\n\n      this._renderFPS = bind(this._applicationFPS, this._applicationFPS.render);\n      this._tickFPS = bind(this._applicationFPS, this._applicationFPS.tick);\n    } else {\n      this._renderFPS = function () {};\n      this._tickFPS = function () {};\n    }\n  };\n\n  this.scaleUI = function (w, h) {\n    if (device.height > device.width) {\n      this._view.baseWidth = w;\n      this._view.baseHeight = device.height * (w / device.width);\n      this._view.scale = device.width / this._view.baseWidth;\n    } else {\n      this._view.baseWidth = h;\n      this._view.baseHeight = device.height * (h / device.width);\n      this._view.scale = device.height / this._view.baseHeight;\n    }\n    this._view.style.scale = this._view.scale;\n  };\n\n  this.supports = function (key) {\n    return this._opts[key];\n  };\n\n  /* @internal */\n  this.getInput = function () {\n    return this._inputListener;\n  };\n\n  this.getKeyListener = function () {\n    return this._keyListener;\n  };\n\n  this.getEvents = function () {\n    return this._events;\n  };\n\n  // deprecating getCanvas...\n  this.getElement = this.getCanvas = function () {\n    return this._rootElement;\n  };\n\n  this.getViewCtor = function () {\n    return View;\n  };\n\n  this.getView = function () {\n    return this._view;\n  };\n\n  this.setView = function (view) {\n    this._view = view; return this;\n  };\n\n  this.show = function () {\n    this._rootElement.style.display = 'block';\n    return this;\n  };\n\n  this.hide = function () {\n    this._rootElement.style.display = 'none';\n    return this;\n  };\n\n  this.pause = function () {\n    this.stopLoop();\n    if (this._keyListener) {\n      this._keyListener.setEnabled(false);\n    }\n  };\n\n  this.resume = function () {\n    this.startLoop();\n    if (this._keyListener) {\n      this._keyListener.setEnabled(true);\n    }\n  };\n\n  this.stepFrame = function (n) {\n    this.pause();\n    n = n || 1;\n    this._countdown = n;\n    this.resume();\n  };\n\n  this.startLoop = function (dtMin) {\n    if (this._running) { return; }\n    this._running = true;\n\n    this.now = 0;\n    timer.start(dtMin || this._opts.dtMinimum);\n    this.emit('resume');\n    return this;\n  };\n\n  this.stopLoop = function () {\n    if (!this._running) { return; }\n    this._running = false;\n    timer.stop();\n    this.emit('pause');\n    return this;\n  };\n\n  this.isRunning = function () {\n    return this._running;\n  };\n\n  this.doOnTick = function (cb) {\n    if (arguments.length > 1) { cb = bind.apply(this, arguments); }\n    this._onTick.push(cb);\n  };\n\n  this._tick = function (dt) {\n    //if the countdown is defined\n    if (this._countdown !== null) {\n      this._countdown--;\n\n      //if below zero, stop timer\n      if (this._countdown === -1) {\n        this.pause();\n        this._countdown = null;\n      }\n    }\n\n    if (this._ctx) {\n      var el = this._ctx.getElement();\n      var s = this._view.style;\n      if (el && (s.width != el.width / s.scale || s.height != el.height / s.scale)) {\n        s.width = el.width / s.scale;\n        s.height = el.height / s.scale;\n      }\n    }\n\n    for (var i = 0, cb; cb = this._onTick[i]; ++i) { cb(dt); }\n\n    var events = this._inputListener.getEvents();\n    var n = events.length;\n\n    this._events = events;\n    if (this._opts._mergeMoveEvents) {\n      var hasMove = false;\n      for (var i = n - 1; i >= 0; --i) {\n        if (events[i].type == dispatch.eventTypes.MOVE) {\n          if (!hasMove) {\n            hasMove = true;\n          } else {\n            events.splice(i, 1);\n          }\n        }\n      }\n    }\n\n    for (var i = 0, evt; evt = events[i]; ++i) {\n      evt.srcApp = this;\n      dispatch.dispatchEvent(this._view, evt);\n    }\n\n    if (!device.useDOM) {\n      if (i > 0) {\n        if (this._opts.repaintOnEvent) { this.needsRepaint(); }\n      } else if (this._opts.continuousInputCheck) {\n        var prevMove = dispatch._evtHistory['input:move'];\n        if (prevMove) {\n          dispatch.dispatchEvent(this._view, new dispatch.InputEvent(prevMove.id, prevMove.type, prevMove.srcPt));\n        }\n      }\n    }\n\n    if (this._opts.dtFixed) {\n      this._tickBuffer += dt;\n      while (this._tickBuffer >= this._opts.dtFixed) {\n        this._tickBuffer -= this._opts.dtFixed;\n        this.now += this._opts.dtFixed;\n        this.__tick(this._opts.dtFixed);\n      }\n    } else {\n      this.__tick(dt);\n    }\n\n    this._reflowMgr.reflowViews(this._ctx);\n\n    var doRepaint = this._opts.alwaysRepaint || this._needsRepaint;\n    if (!doRepaint && this._doubleBuffered && this._doubleBufferedState > 0) {\n      // even if we don't repaint, we need to paint at least 1 more time\n      // for devices that use multiple buffers (like the ios, I think...)\n      --this._doubleBufferedState;\n      this.render(dt);\n    } else if (doRepaint) {\n      this._doubleBufferedState = 3;\n      this.render(dt);\n    }\n\n    this._needsRepaint = false;\n  };\n\n  this.render = function (dt) {\n    if (this._opts.clearEachFrame) {\n      this._ctx && this._ctx.clear();\n    }\n\n    this._view.__view.constructor.absScale = 1;\n    this._view.__view.wrapRender(this._ctx, {});\n    this.publish('Render', this._ctx);\n\n    if (this._ctx) {\n      if (DEBUG) {\n        this._renderFPS(this._ctx, dt);\n      }\n\n      this._ctx.swap();\n    }\n  };\n\n  this.needsRepaint = function () {\n    this._needsRepaint = true;\n    return this;\n  };\n\n  this.__tick = function (dt) {\n    this._tickFPS(dt);\n    this.publish('Tick', dt);\n    this._view.__view.wrapTick(dt, this);\n  };\n\n  var log_counter = 0;\n\n});\n\nexports.get = function () { return __instance; };\n","pre":true},"modules/devkit-core/modules/timestep/src/event/input/dispatch.js":{"path":"modules/devkit-core/modules/timestep/src/event/input/dispatch.js","friendlyPath":"event.input.dispatch","directory":"modules/devkit-core/modules/timestep/src/event/input/","filename":"dispatch.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @module event.input.dispatch;\n * This namespace includes functions to dispatch touch events starting from the\n * root application view, which are traced through the hierarchy to each view's\n * individual InputHandler proxy. Additionally, this namespace includes those\n * functions actually in timestep.input, like InputListener and KeyListener classes.\n */\n\njsio('import math.geom.Point as Point');\njsio('import device');\njsio('import lib.Enum');\n\nexports.eventTypes = new lib.Enum('START', 'MOVE', 'SELECT', 'SCROLL', 'CLEAR');\nexports.VERTICAL_AXIS = 2;\nexports.HORIZONTAL_AXIS = 1;\n\n/**\n * capture/bubble event, starting from root Application view\n *  - publish <inputTypeCapture> on the way down (e.g. onInputStartCapture)\n *  - call callbacks (e.g. onInputStart) and publish <inputType> (e.g. onInputstart)\n *    on the way up, checking evt.cancelled to see if someone has cancelled the event\n */\nexports.dispatchEvent = function (root, evt) {\n  // if (evt.type == input.eventTypes.MOVE) { var now = +new Date(); }\n  // store the root in case an event listener wants the top-most view?\n  evt.root = root;\n  \n  // SHOULD_HANDLE = LOCALIZE = 0;\n\n  // grab the bottom-most view whose bounding box contains the evt.srcPt\n  // also updates the evt object with a trace of localized points and views\n  exports.traceEvt(root, evt, evt.srcPt);\n\n  // if (now) { logger.LOG&&console.log(\"LOG\",\"event.input.dispatch\",'TRACED A', LOCALIZE, SHOULD_HANDLE) }\n  \n  // once we've traced the event, we know how deep it goes\n  var depth = evt.depth;\n  \n  exports._evtHistory[evt.type] = evt;\n  \n  var signal = exports._evtCb[evt.type] || exports.getEvtCbName(evt.type);\n  \n  for (var i = depth - 1; i >= 0; --i) {\n    var view = evt.trace[i],\n      pt = evt.pt[view.uid];\n    view.publish(signal + 'Capture', evt, pt, i == 0);\n    if (evt.cancelled || view.__input.blockEvents) { return; }\n  }\n  \n  var cbName = 'on' + signal;\n  for (var i = 0; i < depth; ++i) {\n    var view = evt.trace[i];\n    if (view.__input.canHandleEvents) {\n      var pt = evt.pt[view.uid];\n      if (view[cbName]) { view[cbName](evt, pt, i == 0); }\n      view.publish(signal, evt, pt, i == 0);\n      view._onEventPropagate(evt, pt, i == 0);\n      if (evt.cancelled) { break; }\n    }\n  }\n}\n\n/**\n * Trace an event recursively down to the view on which the event is triggered.\n */\nexports.traceEvt = function (view, evt, pt) {\n  // var now = +new Date();\n  var localPt = view.style.localizePoint(new Point(pt));\n  var inputHandler = view.getInput();\n  if (!inputHandler.containsEvent(evt, localPt)) { return false; }\n\n  var canHandleEvents = view.getInput().canHandleEvents;\n  if (canHandleEvents) {\n    evt.depth++;\n    evt.trace.unshift(view);\n    evt.pt[view.uid] = localPt;\n  }\n  \n  var subviews = view.getSubviews();\n  for (var i = subviews.length - 1; i >= 0; --i) {\n    if (subviews[i].style.visible && exports.traceEvt(subviews[i], evt, localPt)) {\n      return true;\n    }\n  }\n  \n  if (canHandleEvents) {\n    evt.target = view;\n    return true;\n  }\n}\n\nexports._evtHistory = {};\nexports._activeInputOver = {};\n\nexports.clearOverState = function (id) {\n  if (id) {\n    var evt = exports._activeInputOver[id];\n    if (evt) {\n      delete exports._activeInputOver[id];\n      var trace = evt.trace;\n      if (trace) {\n        for (var i = 0, view; view = trace[i]; ++i) {\n          view.__input.onLeave(id);\n        }\n      }\n    }\n  } else {\n    for (var id in exports._activeInputOver) {\n      exports.clearOverState(id);\n    }\n  }\n}\n\nexports._isDragging = false;\nexports.isDragging = function () { return exports._isDragging; }\n\nexports._evtCb = {};\nexports.getEvtCbName = function (evtType) {\n  var name = exports.eventTypes[evtType];\n  return (exports._evtCb[evtType] = 'Input' + name.charAt(0) + name.substring(1).toLowerCase());\n}\n\n/**\n * Aliases for children of the timestep.input \"package\".\n */\n\nexports.InputListener = device.get('Input');\nexports.KeyListener = device.get('KeyListener');\n\njsio('import .InputEvent as exports.InputEvent');\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/math/geom/Point.js":{"path":"modules/devkit-core/node_modules/jsio/packages/math/geom/Point.js","friendlyPath":"math.geom.Point","directory":"modules/devkit-core/node_modules/jsio/packages/math/geom/","filename":"Point.js","baseMod":"math","basePath":"/Users/marcelo.hashimoto/Desktop/gamedev/ElementalMatch3/modules/devkit-core/node_modules/jsio/packages/math","src":"/**\n * @package math.geom.Point;\n * Models a Point in 2D space.\n */\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_node_modules_jsio_packages_math_geom_Point=__class__;var Point = exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_node_modules_jsio_packages_math_geom_Point(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_node_modules_jsio_packages_math_geom_Point(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function(a, b) {\n\t\tswitch(arguments.length) {\n\t\t\tcase 0:\n\t\t\t\tthis.x = 0;\n\t\t\t\tthis.y = 0;\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tthis.x = a.x || 0;\n\t\t\t\tthis.y = a.y || 0;\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tthis.x = a || 0;\n\t\t\t\tthis.y = b || 0;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * Rotates this point around the origin by a value in radians.\n\t */\n\t\n\tthis.rotate = function(r) {\n\t\tvar x = this.x,\n\t\t\ty = this.y,\n\t\t\tcosr = Math.cos(r),\n\t\t\tsinr = Math.sin(r);\n\t\t\n\t\tthis.x = x * cosr - y * sinr;\n\t\tthis.y = x * sinr + y * cosr;\n\t\t\n\t\treturn this;\n\t}\n\n\t/**\n\t * Translate this point by two scalars or by another point.\n\t */\n\t\n\tthis.translate = this.add = function(x, y) {\n\t\tif (typeof x == 'number') {\n\t\t\tthis.x += x;\n\t\t\tthis.y += y;\n\t\t} else {\n\t\t\tthis.x += x.x;\n\t\t\tthis.y += x.y;\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**\n\t * Subtract this point by two scalars or by another point.\n\t */\n\t\n\tthis.subtract = function(x, y) {\n\t\tif (typeof x == 'number') {\n\t\t\tthis.x -= x;\n\t\t\tthis.y -= y;\n\t\t} else {\n\t\t\tthis.x -= x.x;\n\t\t\tthis.y -= x.y;\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**\n\t * Scale this number.\n\t */\n\n\tthis.scale = function(sx, sy) {\n\t\t//if no scaleY specified\n\t\tif(sy === undefined) sy = sx;\n\n\t\tthis.x *= sx;\n\t\tthis.y *= sy;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Set the magnitude of this point at a constant angle.\n\t */\n\t\n\tthis.setMagnitude = function(m) {\n\t\tvar theta = this.getAngle();\n\t\tthis.x = m * Math.cos(theta);\n\t\tthis.y = m * Math.sin(theta);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Normalize this point to the unit circle.\n\t */\n\t\n\tthis.normalize = function() {\n\t\tvar m = this.getMagnitude();\n\t\tthis.x /= m;\n\t\tthis.y /= m;\n\t\treturn this;\n\t};\n\n\t/**\n\t * Add magnitude to this point.\n\t */\n\t\n\tthis.addMagnitude = function(m) {\n\t\treturn this.setMagnitude(this.getMagnitude() + m);\n\t};\n\n\tthis.getMagnitude = function() {\n\t\treturn Math.sqrt(this.x * this.x + this.y * this.y);\n\t};\n\n\tthis.getSquaredMagnitude = function() {\n\t\treturn this.x * this.x + this.y * this.y;\n\t};\n\n\tthis.getDirection = this.getAngle = function() {\n\t\treturn Math.atan2(this.y, this.x);\n\t};\n\t\n});\n\n/*\n */\nPoint.getPolarR = function(x, y) { \n\tthrow \"notImplemented\";\n}\n\n/*\n\t### Class Method: Point.getPolarTheta (x, y)\n\t1. `x {number}`\n\t2. `y {number}`\n\t3. Return: `{number}`\n*/\nPoint.getPolarTheta = function(x, y) { \n\tvar val = Math.atan2(y,x) + (Math.PI * 2); \n\treturn val > Math.PI * 2 ? val % (Math.PI * 2) : val;\n}\n\n/*\n\t### Class Method: Point.add (a, b, c, d)\n\t### Class Method: Point.translate (a, b, c, d)\n\t1. `a {number}`\n\t2. `b {number}`\n\t3. `c {number}`\n\t4. `d {number}`\n\t5. Return: `{Point}`\n */\nPoint.add = Point.translate = function(a, b, c, d) {\n\tswitch(arguments.length) {\n\t\tcase 2: return new Point(a).add(b);\n\t\tcase 3: return new Point(a).add(b, c);\n\t\tcase 4: return new Point(a, b).add(c, d);\n\t}\n}\n\n/*\n\t### Class Method: Point.subtract (a, b, c, d)\n\t1. `a {number}`\n\t2. `b {number}`\n\t3. `c {number}`\n\t4. `d {number}`\n\t5. Return: `{Point}`\n */\nPoint.subtract = function(a, b, c, d) {\n\tswitch(arguments.length) {\n\t\tcase 2: return new Point(a).subtract(b);\n\t\tcase 3: return new Point(a).subtract(b, c);\n\t\tcase 4: return new Point(a, b).subtract(c, d);\n\t}\n}\n\n/*\n\t### Class Method: Point.scale (a, b, c) \n\t1. `a {number}`\n\t2. `b {number}`\n\t3. `c {number}`\n\t4. Return: `{Point}`\n */\nPoint.scale = function(a, b, c) {\n\tswitch(arguments.length) {\n\t\tcase 2: return new Point(a).scale(b);\n\t\tcase 3: return new Point(a, b).scale(c);\n\t}\n}\n\n/*\n\t### Class Method: Point.setMagnitude (a, b, c)\n\t1. `a {number}`\n\t2. `b {number}`\n\t3. `c {number}`\n\t4. Return: `{Point}`\n*/\nPoint.setMagnitude = function(a, b, c) {\n\tswitch(arguments.length) {\n\t\tcase 2: return new Point(a).setMagnitude(c);\n\t\tcase 3: return new Point(a, b).setMagnitude(c);\n\t}\n}\n\n/*\n\t### Class Method: Point.addMagnitude (a, b, c)\n\t1. `a {number}`\n\t2. `b {number}`\n\t3. `c {number}`\n\t4. Return: `{Point}`\n */\nPoint.addMagnitude = function(a, b, c) {\n\tswitch(arguments.length) {\n\t\tcase 2: pt = new Point(a); break;\n\t\tcase 3: pt = new Point(a, b); b = c; break;\n\t}\n\t\n\treturn pt.addMagnitude(b);\n}\n\n/*\n\t### Class Method: Point.getMagnitude (a, b)\n\t1. `a {number}`\n\t2. `b {number}`\n\t3. Return: `{Point}`\n */\nPoint.getMagnitude = function(a, b) { return new Point(a, b).getMagnitude(); }\n\n/*\n\t### Class Method: Point.rotate (a, b, c)\n\t1. `a {number}`\n\t2. `b {number}`\n\t3. `c {number}`\n\t4. Return: `{Point}`\n */\nPoint.rotate = function(a, b, c) {\n\tswitch(arguments.length) {\n\t\tcase 2: return new Point(a).rotate(b);\n\t\tcase 3: return new Point(a, b).rotate(c);\n\t}\n}\n\n/**\n * Treat two points as vectors and project a onto b\n *  (a dot unit(b)) * unit(b)\n */\nPoint.project = function (a, b) {\n\tvar unitB = new Point(b).normalize();\n\treturn unitB.scale(unitB.x * a.x + unitB.y * a.y);\n}\n","pre":true},"modules/devkit-core/modules/timestep/src/event/input/InputEvent.js":{"path":"modules/devkit-core/modules/timestep/src/event/input/InputEvent.js","friendlyPath":".InputEvent","directory":"modules/devkit-core/modules/timestep/src/event/input/","filename":"InputEvent.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class event.input.InputEvent;\n * This class represents an input event.\n * \n * It assumes a tree structure of View objects.  The top (root) of the\n * tree is typically the main Application view.  \n * \n * Events are assigned a root and a target.  View::dispatchEvent\n * computes the root and target from the event location (x, y).\n *\n * Propogation has two phases: capturing and bubbling.  Users \n * can mostly ignore capturing as the primary hooks are in the \n * bubbling.  Bubbling is defined as calling event handlers on\n * each view starting with 'target' and then continuing up \n * superview pointers until reaching 'root'.  Views can listen\n * to the event bubbling by adding methods such as:\n * \"input:start\" -> \"function onInputStart(evt)\"\n * \"input:drag\" -> \"function onDrag(dragEvt, moveEvt, delta)\"\n *\n * Other code can hook into a view's events by calling:\n *   myView.subscribe('input:start', function () { alert('Mouse Down'); });\n *   myView.subscribe('input:end', this, 'onChildViewClick');\n *\n * Propogation of events can be cancelled by calling evt.cancel().\n *\n * Note that onDrag is a special event that receives not only\n * a move event from an 'input:move' event, but also a custom\n * dragEvt object that contains extra data such as the start\n * position of the drag.\n *\n * @doc http://doc.gameclosure.com/api/event.html#class-event.input.inputevent\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/event.md\n */\n\njsio('import math.geom.Point as Point');\njsio('import timer');\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_event_input_InputEvent=__class__;var InputEvent = exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_event_input_InputEvent(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_event_input_InputEvent(){return this.init&&this.init.apply(this,arguments)},function () {\n  this.cancelled = false; // If true, this event will not propogate\n  this.depth = 0; // Number of levels of the tree from root to target (inclusive)\n  \n  // Note that under normal usage:\n  //   this.depth == this.trace.length\n  //   this.root = this.trace[this.trace.length - 1]\n  //   this.target = this.trace[0]\n  \n  this.init = function (id, evtType, x, y, root, target) {\n    // unique ID for a particular input - the ID should be constant for a given input\n    // for example, the mouse should always have the same ID.  Each finger (touch)\n    // should have the same ID throughout the touch start/move/end process\n    this.id = id; \n    \n    // string evtType, e.g. 'input:start'\n    this.type = evtType;\n    \n    // localized point coordinates, indexed by a view's uid (View::uid)\n    // @internal --at least for now, concerns over performance.\n    this.point = this.pt = {};\n    \n    // raw (x, y) coordinates\n    this.srcPoint = this.srcPt = new Point(x, y);\n    \n    // list of View nodes from target to root\n    this.trace = [];\n    \n    // Top-most view where event is dispatched (e.g. the tree root)\n    this.root = root || null;\n    \n    // time of dispatch\n    this.when = timer.now;\n    \n    // Bottom-most view where the event occurred\n    this.target = target || null;\n  }\n  \n  this.cancel = function () {\n    this.cancelled = true;\n  }\n\n  this.clone = function () {\n    return new InputEvent(this.id, this.type, this.srcPt.x, this.srcPt.y, this.root, this.target);\n  }\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/ReflowManager.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/ReflowManager.js","friendlyPath":"ui.backend.ReflowManager","directory":"modules/devkit-core/modules/timestep/src/ui/backend/","filename":"ReflowManager.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar DEBUG_REFLOW = false;\nvar DEBUG_TIME = false;\nif (DEBUG_REFLOW || DEBUG_TIME) {\n  var _debug = {\n    space: '',\n    stepIn: function () { this.space += ' '; return true; },\n    stepOut: function () { this.space = this.space.slice(0, this.space.length - 1); return true; },\n    log: function () { logger.log.apply(logger, [this.space].concat(Array.prototype.slice.call(arguments, 0))); return true; }\n  };\n  logger.LOG&&console.log(\"LOG\",\"ui.backend.ReflowManager\",'===== CREATING REFLOW MANAGER');\n}\n\n// max reflows for any view in a given tick\nvar MAX_REFLOW_THRESHOLD = 20;\n\nvar _pool = new (Class(function () {\n  this._pool = [];\n\n  this.recycle = function (item) {\n    item.view = null;\n    this._pool.push(item);\n  };\n\n  this.get = function (view) {\n    var item = this._pool.pop() || {};\n    item.view = view;\n    item.count = 0;\n    item.needsReflow = false;\n    return item;\n  };\n}));\n\n/**\n * The ReflowManager is the controller for view layout.  It hooks into\n * the render cycle in two places:\n *  1. at the start of a render to reflow any views that we know\n *     need layout.  This is signalled by calling calls to needsReflow\n *     on a view between render cycles that result in a call to\n *     `ReflowMgr.add`.\n *  2. during render, if the view hasn't ever been rendered, the\n *     ReflowManager is notified to initiate the buildView call\n *     and handle any reflow logic before the view's first render.\n * The ReflowManager uses a queue-like structure to resolve the reflow\n * constraints. Views notify the ReflowManager through the add(view)\n * method, which then adds the view to the queue.  During a reflow cycle,\n * the ReflowManager tracks how many iterations through the queue each\n * view actually gets reflowed.  If the number of reflows exceeds the\n * MAX_REFLOW_THRESHOLD, reflow stops for that view, preventing infinite\n * loops when reflow cycles occur.\n */\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_ReflowManager=__class__;var ReflowManager = exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_ReflowManager(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_ReflowManager(){return this.init&&this.init.apply(this,arguments)},function () {\n  this.init = function () {\n    this._pending = {};\n    this._iter = 0;\n    this._pendingCount = 0;\n  };\n\n  this.add = function (view) {\n    if (!view.style.layout) { return; }\n\n    var uid = view.uid;\n    var item = this._pending[uid] || (this._pending[uid] = _pool.get(view));\n\n    if (!item.needsReflow) {\n      ++this._pendingCount;\n      item.needsReflow = true;\n\n      DEBUG_REFLOW && _debug.log('adding ' + view + ' (' + view.uid + ')' + (' ' + view.style.layout || '') + ':',\n        (view.style.width === undefined ? '?' : view.style.width)\n          + 'x'\n          + (view.style.height === undefined ? '?' : view.style.height));\n    }\n\n    // increment count once per reflow iteration\n    if (item.iter != this._iter) {\n      item.iter = this._iter;\n    }\n  };\n\n  this.reflow = function (view) {\n    if (view.style.__cachedWidth === undefined) {\n      view.style.__cachedWidth = view.style.width;\n    }\n\n    if (view.style.__cachedHeight === undefined) {\n      view.style.__cachedHeight = view.style.height;\n    }\n\n    var item = this._pending[view.uid];\n    if (item && item.needsReflow) {\n      item.needsReflow = false;\n      --this._pendingCount;\n    }\n\n    if (view.__layout) {\n      view.__layout.reflow();\n    }\n\n    view.reflow && view.reflow();\n\n    // always reflow children if a layout changes sizes\n    if (view.__layout) {\n      var style = view.style;\n      if (style.__cachedWidth != style.width || style.__cachedHeight != style.height) {\n        var subviews = view.getSubviews();\n        for (var i = 0, n = subviews.length; i < n; ++i) {\n          this.add(subviews[i]);\n        }\n      }\n    }\n  };\n\n  this.reflowViews = function (_ctx) {\n    if (!this._pendingCount) { return; }\n\n    this._iter = 0;\n\n    var count;\n    var uid;\n\n    DEBUG_REFLOW && _debug.stepIn();\n    if (DEBUG_TIME) {\n      var startTime = Date.now();\n    }\n\n    // outer loop manages batched resize events\n    // inner loop manages recursive reflow\n    while (this._pendingCount) {\n\n      // as long as we reflowed some views, keep looping\n      while (this._pendingCount) {\n        ++this._iter; // what iteration are we on? only increment a view's count once per iteration\n\n        count = 0;\n        for (uid in this._pending) {\n          DEBUG_REFLOW && count == 0 && this._iter == 1 && console.log(' == beginning reflow == ');\n\n          var item = this._pending[uid];\n          if (item.count > MAX_REFLOW_THRESHOLD) {\n            logger.WARN&&console.warn(\"WARN\",\"ui.backend.ReflowManager\",'reflow loop detected for view', item.view.uid);\n            this.cleanUp();\n            break;\n          }\n\n          if (item.needsReflow) {\n            ++item.count;\n            DEBUG_REFLOW && _debug.log('-- reflow view', item.view.uid, '(' + item.count + ' times)') && _debug.stepIn();\n            this.reflow(item.view);\n            DEBUG_REFLOW && _debug.stepOut();\n            ++count;\n          }\n        }\n\n        DEBUG_REFLOW && count && _debug.log('***** iteration', this._iter, 'reflowed', count, 'views');\n      }\n\n      for (uid in this._pending) {\n        var view = this._pending[uid].view;\n        if (view.hasListeners('resize')) {\n          var style = view.style;\n          var w = style.width;\n          var h = style.height;\n          if (style.__cachedWidth != w || style.__cachedHeight != h) {\n            DEBUG_REFLOW && _debug.log('view', view.uid, 'resize event firing', w + 'x' + h, '(prev: ' + style.__cachedWidth + 'x' + style.__cachedHeight + ')');\n            style.__cachedWidth = w;\n            style.__cachedHeight = h;\n            view.emit('resize');\n          }\n        }\n      }\n    }\n\n    this.cleanUp();\n\n    if (DEBUG_REFLOW) {\n      _debug.stepOut();\n    }\n\n    if (DEBUG_TIME && this._iter) {\n      var now = Date.now();\n      _debug.log('total reflow time:', now - startTime);\n    }\n  };\n\n\n  this.cleanUp = function () {\n    // recyle items\n    for (var uid in this._pending) {\n      _pool.recycle(this._pending[uid]);\n      delete this._pending[uid];\n    }\n\n    this._pendingCount = 0;\n  };\n});\n\nvar _instance = null;\nexports.get = function () {\n  return (_instance || (_instance = new ReflowManager()));\n};\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/StackView.js":{"path":"modules/devkit-core/modules/timestep/src/ui/StackView.js","friendlyPath":".StackView","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"StackView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.StackView;\n * Implements a view which can switch out one of several child views to display at the front.\n *\n * @doc http://doc.gameclosure.com/api/ui-stackview.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/stackview.md\n */\n\njsio('import ui.View as View');\njsio('import animate');\n\n/**\n * @extends ui.View\n */\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_StackView=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_StackView(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_StackView(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n  this.init = function (opts) {\n    opts = merge(opts, {\n      layout: 'box'\n    });\n    supr(this, 'init', [opts]);\n    this.stack = [];\n  };\n\n  this.getStack = function () { return this.stack; };\n\n  this.getCurrentView = function () {\n    if (!this.stack.length) { return null; }\n    return this.stack[this.stack.length - 1];\n  };\n\n  this.push = function (view, dontAnimate, reverse) {\n    // don't animate the first (base) view of a stackview unless explicitly asked to\n    if (!this.stack[0] && dontAnimate !== false) {\n      dontAnimate = true;\n    }\n\n    var current = this.getCurrentView();\n    if (current) { this._hide(current, dontAnimate); }\n    view.style.y = 0;\n    view.style.width = this.style.width / view.style.scale;\n    view.style.height = this.style.height / view.style.scale;\n    this.stack.push(view);\n    this._show(view, dontAnimate, reverse);\n    return view;\n  };\n\n  this._hide = function (view, dontAnimate, reverse) {\n    view.publish('ViewWillDisappear');\n    if (!dontAnimate) {\n      this.getInput().blockEvents = true;\n      animate(view)\n        .then({x: (reverse ? 1 : -1) * this.style.width})\n        .then(bind(this, function () {\n          this.removeSubview(view);\n          view.publish('ViewDidDisappear');\n          this.getInput().blockEvents = false;\n        }));\n    } else {\n      this.removeSubview(view);\n      view.publish('ViewDidDisappear');\n    }\n  };\n\n  this._show = function (view, dontAnimate, reverse) {\n    view.publish('ViewWillAppear');\n    view.style.visible = true;\n    if (!dontAnimate) {\n      view.style.x = (reverse ? -1 : 1) * this.style.width;\n      this.addSubview(view);\n      animate(view)\n        .then({x: 0})\n        .then(bind(view, 'publish', 'ViewDidAppear'));\n    } else {\n      this.addSubview(view);\n      view.style.x = 0;\n      view.publish('ViewDidAppear');\n    }\n  };\n\n  this.hasView = function (view) {\n    return this.stack.indexOf(view) >= 0;\n  };\n\n  this.remove = function (view) {\n    var i = this.stack.indexOf(view);\n    if (i >= 0) {\n      this.stack.splice(i, 1);\n    }\n  }\n\n  this.pop = function (dontAnimate, reverse) {\n    if (!this.stack.length) { return false; }\n    var view = this.stack.pop();\n    //reverse by default\n    this._hide(view, dontAnimate, (reverse === false) ? false : true);\n\n    if (this.stack.length) {\n      this._show(this.stack[this.stack.length - 1], dontAnimate, true);\n    }\n\n    return view;\n  };\n\n  this.popAll = function (dontAnimate) {\n    while (this.stack[1]) {\n      this.pop(dontAnimate);\n    }\n  };\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/View.js":{"path":"modules/devkit-core/modules/timestep/src/ui/View.js","friendlyPath":"ui.View","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"View.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.View;\n * The View base class.\n *\n * @doc http://doc.gameclosure.com/api/ui-view.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/view.md\n */\n\njsio('import device');\njsio('import event.Emitter as Emitter');\n\njsio('import math.geom.Point as Point');\njsio('import math.geom.Rect as Rect');\n\njsio('import .backend.canvas.ViewBacking');\n\njsio('import ui.backend.ReflowManager as ReflowManager');\nvar _reflowMgr = ReflowManager.get();\n\njsio('import event.input.dispatch as dispatch');\njsio('import event.input.InputHandler as InputHandler');\n\njsio('import animate');\n\njsio('import util.setProperty');\n\nEventScheduler=__class__;var EventScheduler=EventScheduler(function EventScheduler(){return this.init&&this.init.apply(this,arguments)},function () {\n  this.init = function () {\n    this._queue = [];\n  }\n\n  this.add = function (f) {\n    this._queue.push(f);\n\n    if (!this._running) {\n      this._running = true;\n      while ((f = this._queue.shift())) {\n        f();\n      }\n      this._running = false;\n    }\n  }\n});\n\nvar scheduler = new EventScheduler();\n\n/**\n * This singleton class controls the focus of the current application. Only one\n * view can be focused at a given time.\n *\n * This doesn't correspond to native and isn't being used.\n */\nvar FocusMgr = new (Class(function () {\n  this.init = function (opts) {\n    this._target = null;\n    this._canChange = true;\n  };\n\n  /**\n   * Focus the target, unfocusing the last target with focus.\n   */\n  this.focus = function (target) {\n    if (this._target != target && this._canChange) {\n      if (this._target && this._target.onBlur) {\n        this._target.onBlur(this);\n      }\n\n      this._target = target;\n      if (target && target.onFocus) {\n        this._target.onFocus(this);\n      }\n    }\n  };\n\n  this.blur = function (target) {\n    target.onBlur && target.onBlur(this);\n    this._target = false;\n  };\n\n  this.get = function () {\n    return this;\n  };\n}));\n\n/**\n * Unique ID counter for all views.\n */\nvar UID = 0;\n\nvar _BackingCtor = null;\n\n/**\n * @extends event.Emitter\n */\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_View=__class__;var View = exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_View(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_View(){return this.init&&this.init.apply(this,arguments)},Emitter, function () {\n  /**\n   * infinite: boolean, default false - if true, no bounding shape at all (e.g. infinite scroll plane)\n   * clip: boolean, default false - if true, always clip to the region\n   * canHandleEvents: boolean, default true - if false, this view is ignored for event handling\n   * parent: object, if provided, sets the initial superview\n   */\n  this.init = function (opts) {\n    if (!opts) { opts = {}; }\n\n    this.uid = ++UID;\n\n    // Maintain pointers to children to keep native views from being garbage collected\n    this.__parent = null;\n    this.__children = null;\n    this.__leftSibling = null;\n    this.__rightSibling = null;\n\n    this.__input = new InputHandler(this, opts);\n\n    // set with View.setDefaultViewBacking();\n    this.__view = this.style = new (opts.Backing || _BackingCtor)(this, opts);\n\n    this._filter = null;\n\n    this.__view._view = this;\n\n    this.updateOpts(opts);\n  };\n\n  this.updateOpts = function (opts) {\n    opts = opts || {};\n    if (this._opts) {\n      for (var key in opts) {\n        this._opts[key] = opts[key];\n      }\n    } else {\n      this._opts = opts;\n    }\n\n    if (opts.tag) { this.tag = opts.tag; }\n    if (opts.filter) { this._filter = opts.filter; }\n\n    if (opts.infinite) {\n      this._infinite = opts.infinite;\n    }\n\n    this.style.update(opts);\n    this.__input.update(opts);\n\n    if (opts.centerAnchor) {\n      this.style.anchorX = (this.style.width || 0) / 2;\n      this.style.anchorY = (this.style.height || 0) / 2;\n    }\n\n    if (opts.superview) {\n      opts.superview.addSubview(this);\n    }\n    //opts.parent is deprecated, use opts.superview instead\n    if (opts.parent) {\n      opts.parent.addSubview(this);\n    }\n\n    return opts;\n  };\n\n  // --- filters ---\n  // each filter can have multiple views\n  // but no view can have more than one filter\n\n  /**\n   * Returns the filters attached to this view -- DEPRECATED\n   */\n  this.getFilters = function () {\n    logger.WARN&&console.warn(\"WARN\",\"ui.View\",\"View.getFilters() is deprecated! Use View.getFilter() instead.\");\n    var filters = {};\n    if (this._filter) {\n      filters[this._filter.getType()] = this._filter;\n    }\n    return filters;\n  };\n\n  /**\n   * Returns the filter attached to this view.\n   */\n  this.getFilter = function () {\n    return this._filter;\n  };\n\n  /**\n   * Sets the filter on this view -- DEPRECATED\n   */\n  this.addFilter = function (filter) {\n    logger.WARN&&console.warn(\"WARN\",\"ui.View\",\"View.addFilter() is deprecated! Use View.setFilter() instead.\");\n    this.setFilter(filter);\n  };\n\n  /**\n   * Sets the filter on this view. Only one filter can exist on a view.\n   */\n  this.setFilter = function (filter) {\n    this._filter = filter;\n  };\n\n  /**\n   * Remove the filter from this view.\n   */\n  this.removeFilter = function () {\n    this._filter = null;\n  };\n\n  // --- render/tick setters ---\n\n  /**\n   * Adds a hook to determine when the \"render\" property is set.\n   */\n  util.setProperty(this, 'render', {\n      value: undefined,\n      cb: function () { this.__view && (this.__view.hasJSRender = true); }\n    });\n\n  /**\n   * Adds a hook to determine when the \"tick\" property is set.\n   */\n  util.setProperty(this, 'tick', {\n      value: undefined,\n      cb: function () { this.__view && (this.__view.hasJSTick = true); }\n    });\n\n  // --- animation component ---\n\n  /**\n   * Get an animation group from this view.\n   */\n  this.getAnimation = function (groupID) {\n    return animate(this, groupID);\n  };\n\n  /**\n   * @deprecated\n   * Return an animation object for this view.\n   */\n  this.animate = function (style, duration, easing) {\n    return this.getAnimation().then(style, duration, easing);\n  };\n\n  // --- ui focus/blur component ---\n\n  /**\n   * Indicate to the focus manager singleton this element is focused.\n   */\n  this.focus = function () {\n    FocusMgr.get().focus(this); return this;\n  };\n\n  /**\n   * Indicate to the focus manager singleton this element is blurred.\n   */\n  this.blur = function () {\n    FocusMgr.get().blur(this);\n    return this;\n  };\n\n  /**\n   * Triggered when focus is given to this view.\n   */\n  this.onFocus = function () {\n    this._isFocused = true;\n  };\n\n  /**\n   * Indicate to the focus manager singleton this element is blurred.\n   */\n  this.onBlur = function () {\n    this._isFocused = false;\n  };\n\n  // --- input component ---\n\n  /**\n   * Returns a boolean indicating we are currently dragging this view.\n   */\n  this.isDragging = function () {\n    return this.__input.isDragging();\n  };\n\n  /**\n   * Start responding to touch input by dragging this view.\n   */\n  this.startDrag = function (opts) {\n    this.__input.startDrag(opts);\n  };\n\n  /**\n   * Return the InputHandler for this view.\n   */\n  this.getInput = function () {\n    return this.__input;\n  };\n\n  /**\n   * Returns a boolean indicating if a touch is on this view.\n   */\n  this.isInputOver = function () {\n    return !!this.__input.overCount;\n  };\n\n  /**\n   * Returns a number indicating how many touches are on this view.\n   */\n  this.getInputOverCount = function () {\n    return this._inputOverCount;\n  };\n\n  /**\n   * Renamed to setHandleEvents, canHandleEvents is deprecated.\n   * @param {boolean} handleEvents Pass events through.\n   * @param {boolean} ignoreSubviews Optional, defaults to false in InputHandler. Ignore events in childen as well.\n   */\n  this.setHandleEvents = this.canHandleEvents = function (handleEvents, ignoreSubviews) {\n    this.__input.canHandleEvents = handleEvents;\n\n    if (typeof ignoreSubviews === 'boolean') {\n      this.__input.blockEvents = ignoreSubviews;\n    }\n  };\n\n  // TODO: think about refactoring internal components and exposing them differently...\n  this.setIsHandlingEvents = function (canHandleEvents) {\n    this.__input.canHandleEvents = canHandleEvents;\n  };\n\n  this.isHandlingEvents = function () {\n    return this.__input.canHandleEvents;\n  };\n\n  this.needsRepaint = function () {\n    this._needsRepaint = true;\n  };\n\n  this.needsReflow = function () {\n    if (this.reflow != DEFAULT_REFLOW || this.style.layout) {\n      _reflowMgr.add(this);\n      this._needsRepaint = true;\n    }\n  };\n\n  this.reflowSync = function () { _reflowMgr.reflow(this); };\n\n  /**\n   * Consumes an event targeting this view.\n   * NOTE: Does no actual propagation.\n   */\n  this._onEventPropagate = function (evt, pt, atTarget) {\n    if (atTarget) {\n      var id = evt.id;\n      var lastEvt;\n      var i;\n\n      switch(evt.type) {\n        case dispatch.eventTypes.SELECT:\n        case dispatch.eventTypes.CLEAR:\n          dispatch._evtHistory[dispatch.eventTypes.MOVE] = null;\n          lastEvt = dispatch._activeInputOver[id];\n          if (lastEvt) {\n            dispatch.clearOverState(id);\n          }\n          break;\n\n        case dispatch.eventTypes.START:\n        case dispatch.eventTypes.MOVE:\n          // translate input:move events into two higher-level events:\n          //   input:over and input:out\n\n          var target = evt.trace[0];\n          var view = null;\n\n          // fire input:out events first, start with deepest node and work out\n          lastEvt = dispatch._activeInputOver[id];\n          if (lastEvt && target != lastEvt.trace[0]) {\n            var trace = lastEvt.trace;\n            for (i = 0, view; view = trace[i]; ++i) {\n              if (!(view.uid in evt.pt)) {\n                view.__input.onLeave(id, target == view);\n              }\n            }\n          }\n\n          if (!lastEvt || target != lastEvt.trace[0]) {\n            // fire input:over events second, start with outermost node and go to target\n            var trace = evt.trace;\n            for (i = evt.depth - 1; i >= 0; --i) {\n              trace[i].__input.onEnter(id, target == view);\n            }\n\n            // update current mouse trace\n            dispatch._activeInputOver[id] = evt;\n          }\n          break;\n      }\n    }\n  };\n\n  this.localizePoint = function (pt) {\n    var list = this.getParents();\n    var i = 0;\n    list.push(this);\n    while (list[i]) {\n      pt = list[i++].__view.localizePoint(pt);\n    }\n    return pt;\n  };\n\n  // --- view hierarchy component ---\n\n  /**\n   * Return the subview at the given index.\n   */\n  this.getSubview = function (i) {\n    return this.__view.getSubviews()[i];\n  };\n\n  /**\n   * Returns an array of all subviews.\n   */\n  this.getSubviews = function () {\n    return this.__view.getSubviews();\n  };\n\n  /**\n   * Returns the superview of this view.\n   */\n  this.getSuperview = function () {\n    return this.__view.getSuperview();\n  };\n\n  this.connectEvent = function (src, name /*, args */) {\n    if (!this.__subs) {\n      this.__subs = [];\n\n      this.on('ViewAdded', bind(this, '_connectEvents'));\n      this.on('ViewRemoved', bind(this, '_disconnectEvents'));\n\n      if (this.__root) {\n        this._connectEvents();\n      }\n    }\n\n    var args = Array.prototype.slice.call(arguments, 1);\n    this.__subs.push([src, args]);\n    if (this.__root) {\n      src.on.apply(src, args);\n    }\n  }\n\n  function compareSubscription (args, sub) {\n    // note that args and sub may not be the same length\n    // return true if all items in args match items in sub\n    // (we don't care if sub has extra arguments)\n    for (var i = 0, n = args.length; i < n; ++i) {\n      if (args[i] != sub[i]) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  this.disconnectEvent = function (src, name /*, args */) {\n    if (this.__subs) {\n      var args = Array.prototype.slice.call(arguments, 1);\n      for (var i = 0, sub; sub = this.__subs[i]; ++i) {\n        if (sub[0] == src && compareSubscription(args, sub[1])) {\n          sub[0].removeListener.apply(sub[0], sub[1]);\n          this.__subs.splice(i--, 1);\n        }\n      }\n    }\n  };\n\n  this._connectEvents = function () {\n    for (var i = 0, args; args = this.__subs[i]; ++i) {\n      args[0].on.apply(args[0], args[1]);\n    }\n  };\n\n  this._disconnectEvents = function () {\n    for (var i = 0, args; args = this.__subs[i]; ++i) {\n      args[0].removeListener.apply(args[0], args[1]);\n    }\n  };\n\n  /**\n   * Add a subview.\n   */\n  this.addSubview = function (view) {\n    if (this.__view.addSubview(view)) {\n      view.needsRepaint();\n\n      this._linkView(view);\n\n      // if successful, clear any residual input over count\n      view.__input.resetOver();\n\n      this.publish('SubviewAdded', view);\n      if (this.__root) {\n        var root = this.__root;\n        var viewCreated = view;\n        scheduler.add(bind(this, function recurse (view) {\n          if (!view.style.__firstRender) {\n            view.style.__firstRender = true;\n            view.needsReflow();\n          }\n\n          view.__root = root;\n          view.emit('ViewAdded', viewCreated);\n          var subviews = view.getSubviews();\n          for (var i = 0, subview; subview = subviews[i]; ++i) {\n            recurse(subview);\n          }\n        }, view));\n      }\n    }\n\n    return view;\n  };\n\n  // link the input view to the current view to prevent native views from being\n  // garbage collected\n  this._linkView = function (view) {\n    // remove any current connections\n    this._unlinkView(view);\n\n    // Insert this view as the head of the sibling list\n    if (this.__children) {\n      this.__children.__leftSibling = view;\n    }\n    view.__leftSibling = null;\n    view.__rightSibling = this.__children;\n    this.__children = view;\n    view.__parent = this;\n\n\n  };\n\n  this._unlinkView = function (view) {\n    if (view.__parent) {\n      // When removing a subview, remove the view from its sibling list\n      if (view.__leftSibling) {\n        view.__leftSibling.__rightSibling = view.__rightSibling;\n      }\n\n      if (view.__rightSibling) {\n        view.__rightSibling.__leftSibling = view.__leftSibling;\n      }\n\n      // If this view is the head of the sibling list\n      // then set the next sibling to be the head\n      if (view.__parent.__children == view) {\n        view.__parent.__children = view.__rightSibling;\n      }\n\n      view.__leftSibling = null;\n      view.__rightSibling = null;\n      view.__parent = null;\n    }\n  };\n\n  /**\n   * Removes a subview.\n   */\n  this.removeSubview = function (view) {\n    if (this.__view.removeSubview(view)) {\n      this._unlinkView(view);\n      this.publish('SubviewRemoved', view);\n      if (view.__root) {\n        scheduler.add(bind(this, function recurse(view) {\n          view.__root = null;\n          view.emit('ViewRemoved', this);\n          var subviews = view.getSubviews();\n          for (var i = 0, subview; subview = subviews[i]; ++i) {\n            recurse(subview);\n          }\n        }, view));\n      }\n    }\n\n    return view;\n  };\n\n  /**\n   * Removes this view from its parent.\n   */\n  this.removeFromSuperview = function () {\n    var superview = this.__view.getSuperview();\n    if (superview) {\n      superview.removeSubview(this);\n    }\n  };\n\n  /**\n   * Removes all subviews from this view.\n   */\n  this.removeAllSubviews = function () {\n    var subviews = this.getSubviews();\n    var i = subviews.length;\n    while (i--) {\n      this.removeSubview(subviews[i]);\n    }\n  };\n\n  // legacy implementation shim\n  util.setProperty(this, '_superview', {get: this.getSuperview, set: function () {}});\n  util.setProperty(this, '_subviews', {get: this.getSubviews, set: function () {}});\n\n  // --- onResize callbacks ---\n\n  var DEFAULT_REFLOW = function () {\n  };\n\n  this.reflow = DEFAULT_REFLOW;\n\n  // ---\n\n  /**\n   * Get the root application for this view.\n   */\n  this.getEngine = this.getApp = function () {\n    return this.__root;\n  };\n\n  /**\n   * Returns an array of all ancestors of the current view.\n   */\n  this.getParents = /* deprecated */\n  this.getSuperviews = function () {\n\n    var views = [];\n    var next = this.getSuperview();\n    while (next) {\n      views.unshift(next);\n      next = next.getSuperview();\n    }\n\n    return views;\n  };\n\n  /**\n   * @interface\n   */\n  this.buildView = function () {};\n\n  /**\n   * Determine if this view contains a point.\n   */\n  this.containsLocalPoint = function (pt) {\n    if (this._infinite) { return true; }  // infinite plane\n\n    var s = this.style,\n      w = s.width,\n      h = s.height;\n\n    if (w > 0 && h > 0) {\n      return pt.x <= w && pt.y <= h && pt.x >= 0 && pt.y >= 0;\n    } else if (w > 0) {\n      return pt.x <= w && pt.y >= h && pt.x >= 0 && pt.y <= 0;\n    } else if (h > 0) {\n      return pt.x >= w && pt.y <= h && pt.x <= 0 && pt.y >= 0;\n    } else {\n      return pt.x >= w && pt.y >= h && pt.x <= 0 && pt.y <= 0;\n    }\n  };\n\n  /**\n   * Return the bounding shape for this view. The shape is defined in the\n   * options object when this view was constructed.\n   */\n  this._boundingShape = {};\n  this.getBoundingShape = function (simple) {\n    if (this._infinite) {\n      return true;\n    } else {\n      var s = this.style;\n      var w = s.width;\n      var h = s.height;\n      if (!(w && h) && s.layout) {\n        var superview = this.getSuperview();\n        if (superview) {\n          var supersize = superview.getBoundingShape(true);\n          if (!w) {\n            w = supersize.width;\n            if (s.layoutWidth) {\n              w *= parseInt(s.layoutWidth) / 100;\n            }\n          }\n          if (!h) {\n            h = supersize.height;\n            if (s.layoutHeight) {\n              h *= parseInt(s.layoutHeight) / 100;\n            }\n          }\n        }\n      }\n      if (simple) {\n        this._boundingShape.x = s.x;\n        this._boundingShape.y = s.y;\n        this._boundingShape.width = w * s.scale;\n        this._boundingShape.height = h * s.scale;\n        return this._boundingShape;\n      }\n      return new Rect(s.x, s.y, w * s.scale, h * s.scale);\n    }\n  };\n\n  /**\n   * Given a rectangle and a parent view, compute the location of\n   * the rectangle in this view's coordinate space.\n   * WARNING: only works with non-rotated rectangles.\n   * TODO Make it work with rotated rectangles!\n   */\n  this.getRelativeRegion = function (region, parent) {\n    var offset = this.getPosition(parent || region.src);\n    return new Rect((region.x - offset.x) / offset.scale,\n            (region.y - offset.y)  / offset.scale,\n            region.width / offset.scale,\n            region.height / offset.scale);\n  };\n\n  /**\n   * Return a fully defined position, rotation, size, and scale for this view.\n   */\n  this.getPosition = function (/* optional */ relativeTo) {\n    var abs = new Point(),\n      view = this,\n      r = 0,\n      s = this.style,\n      w = s.width,\n      h = s.height,\n      c = 1;\n\n    while (view && view != relativeTo) {\n      var scale = view.style.scale;\n\n      //translate to anchor point\n      abs.add(\n        -(view.style.anchorX),\n        -(view.style.anchorY)\n      );\n\n      //scale and rotate\n      abs.rotate(view.style.r);\n      abs.scale(scale);\n\n      //translate back\n      abs.add(\n        view.style.anchorX + view.style.x + view.style.offsetX,\n        view.style.anchorY + view.style.y + view.style.offsetY\n      );\n\n      r += view.style.r;\n      w *= scale;\n      h *= scale;\n      c *= scale;\n      view = view.__view.getSuperview();\n    }\n\n    return {\n      x: abs.x,\n      y: abs.y,\n      r: r % (2 * Math.PI),\n      width: w,\n      height: h,\n      scale: c,\n      anchorX: this.style.anchorX,\n      anchorY: this.style.anchorY\n    };\n  };\n\n  /**\n   * Exposes the internal implementation of the view hierarchy\n   */\n  this.getBacking = function () {\n    return this.__view;\n  };\n\n  /**\n   * Sets the visibility to true. Triggers repaint.\n   */\n  this.show = function () {\n    this.style.visible = true;\n    this.needsRepaint();\n  };\n\n  /**\n   * Sets the visibility to false. Triggers repaint.\n   */\n  this.hide = function () {\n    this.style.visible = false;\n    this.needsRepaint();\n  };\n\n  /**\n   * Return a human-readable tag for this view.\n   */\n  this.toString = this.getTag = function () {\n    var cls = \"View\";\n\n    if (DEBUG) {\n      // check the cached name\n      if (this.__tagClassName) {\n        cls = this.__tagClassName;\n      } else {\n        // generate the classname\n        cls = this.constructor.name;\n\n        if (!cls) {\n          cls = this.constructor.toString().match(/^function ([^(]*)/)[1];\n        }\n\n        if (cls) {\n          cls = cls.substr(cls.lastIndexOf(\"_\") + 1);\n        }\n\n        this.__tagClassName = cls || 'unknown';\n      }\n    }\n\n    return cls + this.uid + (this.tag ? ':' + this.tag : '');\n  };\n});\n\nvar _extensions = [];\nView.addExtension = function (ext) {\n  ext.extend(View.BackingCtor);\n  _extensions.push(ext);\n};\n\nView.setDefaultViewBacking = function (ViewBackingCtor) {\n  _BackingCtor = View.BackingCtor = ViewBackingCtor;\n  _extensions.forEach(function (ext) { ext.extend(_BackingCtor); });\n};\n\n// default view backing is canvas\nView.setDefaultViewBacking(backend.canvas.ViewBacking);\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/math/geom/Rect.js":{"path":"modules/devkit-core/node_modules/jsio/packages/math/geom/Rect.js","friendlyPath":"math.geom.Rect","directory":"modules/devkit-core/node_modules/jsio/packages/math/geom/","filename":"Rect.js","src":"jsio('import lib.Enum');\njsio('import .Point');\njsio('import .Line');\njsio('import .intersect');\n\n/**\n * Model a rectangle.\n */\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_node_modules_jsio_packages_math_geom_Rect=__class__;var Rect = exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_node_modules_jsio_packages_math_geom_Rect(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_node_modules_jsio_packages_math_geom_Rect(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function(a, b, c, d) {\n\t\tswitch(arguments.length) {\n\t\t\tcase 0: // init\n\t\t\t\tthis.width = this.height = this.x = this.y = 0;\n\t\t\t\tbreak;\n\t\t\tcase 1: // copy\n\t\t\t\tthis.width = a.width;\n\t\t\t\tthis.height = a.height;\n\t\t\t\tthis.x = a.x;\n\t\t\t\tthis.y = a.y;\n\t\t\t\tbreak;\n\t\t\tcase 2: // (x, y), (width, height)\n\t\t\t\tthis.x = a.x;\n\t\t\t\tthis.y = a.y;\n\t\t\t\tthis.width = b.x;\n\t\t\t\tthis.height = b.y;\n\t\t\t\tbreak;\n\t\t\tcase 3: // (x, y), width, height\n\t\t\t\tthis.x = a.x;\n\t\t\t\tthis.y = a.y;\n\t\t\t\tthis.width = b;\n\t\t\t\tthis.height = c;\n\t\t\t\tbreak;\n\t\t\tcase 4: // x, y, width, height\n\t\t\t\tthis.x = a;\n\t\t\t\tthis.y = b;\n\t\t\t\tthis.width = c;\n\t\t\t\tthis.height = d;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * Normalize negative height and width dimensions by adjusting the position\n\t * of the rect.\n\t */\n\t\n\tthis.normalize = function() {\n\t\tif (this.width < 0) {\n\t\t\tthis.x -= this.width;\n\t\t\tthis.width = -this.width;\n\t\t}\n\t\t\n\t\tif (this.height < 0) {\n\t\t\tthis.y -= this.height;\n\t\t\tthis.height = -this.height;\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**\n\t * Generate the intersection of a rectange with another rectangle.\n\t */\n\n\tthis.intersectRect = function (rect) {\n\t\tif (intersect.isRectAndRect(this, rect)) {\n\t\t\tvar x1 = this.x;\n\t\t\tvar y1 = this.y;\n\t\t\tvar x2 = this.x + this.width;\n\t\t\tvar y2 = this.y + this.height;\n\n\t\t\tthis.x = Math.max(x1, rect.x),\n\t\t\tthis.y = Math.max(y1, rect.y),\n\t\t\tthis.width = Math.min(x2, rect.x + rect.width) - this.x;\n\t\t\tthis.height = Math.min(y2, rect.y + rect.height) - this.y;\n\t\t} else {\n\t\t\tthis.width = 0;\n\t\t\tthis.height = 0;\n\t\t}\n\t}\n\t\n\t/**\n\t * Generate the union of a rectange with another rectangle.\n\t */\n\t\n\tthis.unionRect = function(rect) {\n\t\tthis.normalize();\n\t\tif (rect.normalize) { rect.normalize(); }\n\t\t\n\t\tvar x2 = this.x + this.width,\n\t\t\ty2 = this.y + this.height;\n\t\t\n\t\tvar rx2 = rect.x + rect.width,\n\t\t\try2 = rect.y + rect.height;\n\t\t\n\t\tthis.x = this.x < rect.x ? this.x : rect.x;\n\t\tthis.y = this.y < rect.y ? this.y : rect.y;\n\t\t\n\t\tthis.width = (x2 > rx2 ? x2 : rx2) - this.x;\n\t\tthis.height = (y2 > ry2 ? y2 : ry2) - this.y;\n\t};\n\n\t/**\n\t * Get a point for the given corner.\n\t */\n\t\n\tthis.getCorner = function(i) {\n\t\tswitch(i) {\n\t\t\tcase CORNERS.TOP_LEFT:\n\t\t\t\treturn new Point(this.x, this.y);\n\t\t\tcase CORNERS.TOP_RIGHT:\n\t\t\t\treturn new Point(this.x + this.width, this.y);\n\t\t\tcase CORNERS.BOTTOM_LEFT:\n\t\t\t\treturn new Point(this.x, this.y + this.height);\n\t\t\tcase CORNERS.BOTTOM_RIGHT:\n\t\t\t\treturn new Point(this.x + this.width, this.y + this.height);\n\t\t}\n\t}\n\t\n\t/**\n\t * Return a line corresponding to the given side.\n\t */\n\t\n\tthis.getSide = function(i) {\n\t\tswitch(i) {\n\t\t\tcase SIDES.TOP:\n\t\t\t\treturn new Line(this.getCorner(CORNERS.TOP_LEFT), this.getCorner(CORNERS.TOP_RIGHT));\n\t\t\tcase SIDES.RIGHT:\n\t\t\t\treturn new Line(this.getCorner(CORNERS.TOP_RIGHT), this.getCorner(CORNERS.BOTTOM_RIGHT));\n\t\t\tcase SIDES.BOTTOM:\n\t\t\t\treturn new Line(this.getCorner(CORNERS.BOTTOM_RIGHT), this.getCorner(CORNERS.BOTTOM_LEFT));\n\t\t\tcase SIDES.LEFT:\n\t\t\t\treturn new Line(this.getCorner(CORNERS.BOTTOM_LEFT), this.getCorner(CORNERS.TOP_LEFT));\n\t\t}\n\t}\n\n\t/**\n\t * Return the center point of a rectangle.\n\t */\n\t\n\tthis.getCenter = function() {\n\t\treturn new Point(this.x + this.width / 2, this.y + this.height / 2);\n\t}\n});\n\nvar SIDES = Rect.SIDES = lib.Enum('TOP', 'BOTTOM', 'LEFT', 'RIGHT');\nvar CORNERS = Rect.CORNERS = lib.Enum('TOP_LEFT', 'TOP_RIGHT', 'BOTTOM_RIGHT', 'BOTTOM_LEFT');\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/math/geom/Line.js":{"path":"modules/devkit-core/node_modules/jsio/packages/math/geom/Line.js","friendlyPath":".Line","directory":"modules/devkit-core/node_modules/jsio/packages/math/geom/","filename":"Line.js","src":"jsio('import .Point');\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_node_modules_jsio_packages_math_geom_Line=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_node_modules_jsio_packages_math_geom_Line(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_node_modules_jsio_packages_math_geom_Line(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function(a, b, c, d) {\n\t\tswitch(arguments.length) {\n\t\t\tcase 0:\n\t\t\t\tthis.start = new Point();\n\t\t\t\tthis.end = new Point();\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tthis.start = new Point(a.start);\n\t\t\t\tthis.end = new Point(a.end);\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tthis.start = new Point(a);\n\t\t\t\tthis.end = new Point(b);\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tthis.start = new Point(a);\n\t\t\t\tthis.end = new Point(b, c);\n\t\t\t\tbreak;\n\t\t\tcase 4:\n\t\t\tdefault:\n\t\t\t\tthis.start = new Point(a, b);\n\t\t\t\tthis.end = new Point(c, d);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\t\n\tthis.getMagnitude = \n\tthis.getLength = function() {\n\t\tvar dx = this.end.x - this.start.x,\n\t\t\tdy = this.end.y - this.start.y;\n\t\t\n\t\treturn Math.sqrt(dx * dx + dy * dy);\n\t}\n});\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/math/geom/intersect.js":{"path":"modules/devkit-core/node_modules/jsio/packages/math/geom/intersect.js","friendlyPath":".intersect","directory":"modules/devkit-core/node_modules/jsio/packages/math/geom/","filename":"intersect.js","src":"jsio('import .Point');\njsio('import .Line');\njsio('import .Rect');\n\n/**\n * @package math.geom.intersect\n */\nvar intersect = exports;\n\nintersect.pointAndRect = intersect.ptAndRect = function (pt, rect) {\n\tvar x = pt.x,\n\t\t\ty = pt.y;\n\treturn (x >= rect.x &&\n\t\t\t\t\tx <= rect.x + rect.width &&\n\t\t\t\t\ty >= rect.y &&\n\t\t\t\t\ty <= rect.y + rect.height);\n};\n\nintersect.rectAndPoint = intersect.rectAndPt = function (rect, pt) {\n\treturn intersect.pointAndRect(pt, rect);\n};\n\nintersect.pointAndCircle = intersect.ptAndCirc = function(pt, circle) {\n\tvar dx = pt.x - circle.x,\n\t\t\tdy = pt.y - circle.y;\n\treturn dx * dx + dy * dy < circle.radius * circle.radius;\n};\n\nintersect.circleAndPoint = intersect.circAndPt = function (circle, pt) {\n\treturn intersect.pointAndCircle(pt, circle);\n};\n\nintersect.circleAndCircle = function(circle1, circle2) {\n\tvar dx = circle2.x - circle1.x,\n\t\tdy = circle2.y - circle1.y;\n\tvar radiusSum = circle1.radius + circle2.radius;\n\treturn dx * dx + dy * dy <= radiusSum * radiusSum;\n};\n\nintersect.isRectAndRect = function (rect1, rect2) {\n\treturn !((rect1.y + rect1.height < rect2.y) ||\n\t\t\t\t\t (rect2.y + rect2.height < rect1.y) ||\n\t\t\t\t\t (rect1.x + rect1.width < rect2.x) ||\n\t\t\t\t\t (rect2.x + rect2.width < rect1.x));\n};\n\nintersect.circleAndRect = function(circle, rect) {\n\tif (intersect.pointAndRect(circle, rect)) {\n\t\treturn true;\n\t}\n\treturn (intersect.lineAndCircle(rect.getSide(1), circle) ||\n\t\t\t\t\tintersect.lineAndCircle(rect.getSide(2), circle) ||\n\t\t\t\t\tintersect.lineAndCircle(rect.getSide(3), circle) ||\n\t\t\t\t\tintersect.lineAndCircle(rect.getSide(4), circle));\n};\n\nintersect.rectAndCircle = function(rect, circle) {\n\treturn intersect.circleAndRect(circle, rect);\n};\n\nintersect.lineAndCircle = function (line, circle) {\n\tvar vec = intersect.pointToLine(circle, line);\n\treturn vec.getMagnitude() < circle.radius;\n};\n\nintersect.circleAndLine = function (circle, line) {\n\treturn intersect.lineAndCircle(line, circle);\n};\n\n// returns line from pt to nearest pt on line\nintersect.pointToLine = intersect.ptToLine = function (pt, line) {\n\tvar dx = (line.end.x - line.start.x),\n\t\t\tdy = (line.end.y - line.start.y),\n\t\t\tu = ((pt.x - line.start.x) * dx\t// TODO can we abstract this from 2D to 2D/3D?\n\t\t\t\t\t + (pt.y - line.start.y) * dy) / (dx * dx + dy * dy);\n\n\tvar i;\n\tif (u < 0) {\n\t\ti = new Point(line.start);\n\t} else if (u > 1) {\n\t\ti = new Point(line.end);\n\t} else {\n\t\ti = new Point(line.start.x + u * dx, line.start.y + u * dy);\n\t}\n\treturn new Line(i, pt);\n};\n\n// returns rectangle of intersection\nintersect.rectAndRect = function (rect1, rect2) {\n\tjsio('import .Rect');\n\treturn (intersect.rectAndRect = function(rect1, rect2) {\n\t\tif (rect1 === true) { return new Rect(rect2); }\n\t\tif (rect2 === true) { return new Rect(rect2); }\n\n\t\tif (intersect.isRectAndRect(rect1, rect2)) {\n\t\t\tvar x1 = Math.max(rect1.x, rect2.x),\n\t\t\t\t\ty1 = Math.max(rect1.y, rect2.y),\n\t\t\t\t\tx2 = Math.min(rect1.x + rect1.width, rect2.x + rect2.width),\n\t\t\t\t\ty2 = Math.min(rect1.y + rect1.height, rect2.y + rect2.height);\n\t\t\treturn new Rect(x1, y1, x2 - x1, y2 - y1);\n\t\t}\n\t\treturn null;\n\t})(rect1, rect2);\n}\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/canvas/ViewBacking.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/ViewBacking.js","friendlyPath":".backend.canvas.ViewBacking","directory":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/","filename":"ViewBacking.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package ui.backend.canvas.ViewStyle;\n *\n * Models the style object of the canvas View.\n */\n\njsio('import ..strPad');\njsio('import ..BaseBacking');\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_ViewBacking=__class__;var ViewBacking = exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_ViewBacking(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_ViewBacking(){return this.init&&this.init.apply(this,arguments)},BaseBacking, function () {\n  var IDENTITY_MATRIX = { a: 1, b: 0, c: 0, d: 1, tx: 0, ty: 0 };\n  var sin = Math.sin;\n  var cos = Math.cos;\n\n  this.init = function (view) {\n    this._globalTransform = { a: 1, b: 0, c: 0, d: 1, tx: 0, ty: 0 };\n    this._cachedRotation = 0;\n    this._cachedSin = 0;\n    this._cachedCos = 1;\n    this._globalOpacity = 1;\n    this._view = view;\n    this._superview = null;\n    this._subviews = [];\n    this._childCount = 0;\n  };\n\n  this.getSuperview = function () { return this._superview; };\n  this.getSubviews = function () {\n    if (this._needsSort) { this._needsSort = false; this._subviews.sort(); }\n    var subviews = [];\n    var backings = this._subviews;\n    var n = backings.length;\n    for (var i = 0; i < n; ++i) {\n      subviews[i] = backings[i]._view;\n    }\n\n    return subviews;\n  };\n\n  var ADD_COUNTER = 900000;\n  this.addSubview = function (view) {\n    var backing = view.__view;\n    var superview = backing._superview;\n    if (superview == this._view || this == backing) { return false; }\n    if (superview) { superview.__view.removeSubview(view); }\n\n    var n = this._subviews.length;\n    this._subviews[n] = backing;\n\n    backing._superview = this._view;\n    backing._setAddedAt(++ADD_COUNTER);\n    this._childCount++;\n\n    if (n && backing.__sortKey < this._subviews[n - 1].__sortKey) {\n      this._needsSort = true;\n    }\n\n    return true;\n  };\n\n  this.removeSubview = function (targetView) {\n    var index = this._subviews.indexOf(targetView.__view);\n    if (index != -1) {\n      this._subviews.splice(index, 1);\n      this._childCount--;\n      // this._view.needsRepaint();\n\n      targetView.__view._superview = null;\n      return true;\n    }\n\n    return false;\n  };\n\n  this.wrapTick = function (dt, app) {\n    this._view._tick && this._view._tick(dt, app);\n\n    var views = this._subviews;\n    for (var i = 0; i < this._childCount; ++i) {\n      views[i].wrapTick(dt, app);\n    }\n  };\n\n  this.updateGlobalTransform = function () {\n    var flipX = this.flipX ? -1 : 1;\n    var flipY = this.flipY ? -1 : 1;\n\n    var pgt;\n    var parent = this._superview && this._superview.__view;\n    if (parent) {\n      pgt = parent._globalTransform;\n      this._globalOpacity = parent._globalOpacity * this.opacity;\n    } else {\n      pgt = IDENTITY_MATRIX;\n      this._globalOpacity = this.opacity;\n    }\n\n    var gt = this._globalTransform;\n    var sx = this.scaleX * this.scale * flipX;\n    var sy = this.scaleY * this.scale * flipY;\n    var ax = this.flipX ? this._width - this.anchorX : this.anchorX;\n    var ay = this.flipY ? this._height - this.anchorY : this.anchorY;\n    var tx = this.x + this.offsetX + this.anchorX;\n    var ty = this.y + this.offsetY + this.anchorY;\n\n    if (this.r === 0) {\n      tx -= ax * sx;\n      ty -= ay * sy;\n      gt.a = pgt.a * sx;\n      gt.b = pgt.b * sx;\n      gt.c = pgt.c * sy;\n      gt.d = pgt.d * sy;\n      gt.tx = tx * pgt.a + ty * pgt.c + pgt.tx;\n      gt.ty = tx * pgt.b + ty * pgt.d + pgt.ty;\n    } else {\n      if (this.r !== this._cachedRotation) {\n        this._cachedRotation = this.r;\n        this._cachedSin = sin(this.r);\n        this._cachedCos = cos(this.r);\n      }\n      var a  =  this._cachedCos * sx;\n      var b  =  this._cachedSin * sx;\n      var c  = -this._cachedSin * sy;\n      var d  =  this._cachedCos * sy;\n\n      if (ax || ay) {\n        tx -= a * ax + c * ay;\n        ty -= b * ax + d * ay;\n      }\n\n      gt.a = a * pgt.a + b * pgt.c;\n      gt.b = a * pgt.b + b * pgt.d;\n      gt.c = c * pgt.a + d * pgt.c;\n      gt.d = c * pgt.b + d * pgt.d;\n      gt.tx = tx * pgt.a + ty * pgt.c + pgt.tx;\n      gt.ty = tx * pgt.b + ty * pgt.d + pgt.ty;\n    }\n  };\n\n  this.wrapRender = function (ctx, opts) {\n    if (!this.visible) { return; }\n\n    if (this._needsSort) {\n      this._needsSort = false;\n      this._subviews.sort();\n    }\n\n    var width = this._width;\n    var height = this._height;\n    if (width < 0 || height < 0) { return; }\n\n    var saveContext = this.clip || this.compositeOperation || !this._view.__parent;\n    if (saveContext) { ctx.save(); }\n\n    this.updateGlobalTransform();\n    var gt = this._globalTransform;\n    ctx.setTransform(gt.a, gt.b, gt.c, gt.d, gt.tx, gt.ty);\n    ctx.globalAlpha = this._globalOpacity;\n\n    if (this.clip) { ctx.clipRect(0, 0, width, height); }\n\n    var filter = this._view.getFilter();\n    if (filter) {\n      ctx.setFilter(filter);\n    } else {\n      ctx.clearFilter();\n    }\n\n    if (this.compositeOperation) {\n      ctx.globalCompositeOperation = this.compositeOperation;\n    }\n\n    if (this.backgroundColor) {\n      ctx.fillStyle = this.backgroundColor;\n      ctx.fillRect(0, 0, width, height);\n    }\n\n    var viewport = opts.viewport;\n    this._view._render && this._view._render(ctx, opts);\n    this._renderSubviews(ctx, opts);\n    opts.viewport = viewport;\n    ctx.clearFilter();\n\n    if (saveContext) { ctx.restore(); }\n  };\n\n  this._renderSubviews = function (ctx, opts) {\n    var subviews = this._subviews;\n    for (var i = 0; i < this._childCount; i++) {\n      subviews[i].wrapRender(ctx, opts);\n    }\n  };\n\n  this._onResize = function (prop, value, prevValue) {\n    // child view properties might be invalidated\n    this._view.needsReflow();\n\n    // enforce center anchor on width / height change\n    var s = this._view.style;\n    if (s.centerAnchor) {\n      s.anchorX = (s.width || 0) / 2;\n      s.anchorY = (s.height || 0) / 2;\n    }\n  };\n\n  this._sortIndex = strPad.initialValue;\n  this._onZIndex = function (_, zIndex) {\n    this._sortIndex = strPad.pad(zIndex);\n\n    this._setSortKey();\n    this._view.needsRepaint();\n\n    var superview = this._view.getSuperview();\n    if (superview) { superview.__view._needsSort = true; }\n  };\n\n  this._setAddedAt = function (addedAt) {\n    this._addedAt = addedAt;\n    this._setSortKey();\n  };\n\n  this._setSortKey = function () {\n    this.__sortKey = this._sortIndex + this._addedAt;\n  };\n\n  //not implemented\n  this._onOffsetX = function (n) {\n    this.offsetX = n * this.width / 100;\n  };\n\n  //not implemented\n  this._onOffsetY = function (n) {\n    this.offsetY = n * this.height / 100;\n  };\n\n  this.toString = function () { return this.__sortKey; };\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/strPad.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/strPad.js","friendlyPath":"..strPad","directory":"modules/devkit-core/modules/timestep/src/ui/backend/","filename":"strPad.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar LEN = 8;\nvar MAX = 99999999;\nvar MIN = -99999999;\nvar PAD = \"00000000\";\n\nexports.initialValue = PAD;\n\nexports.pad = function (val) {\n  val = ~~val;\n\n  if (val < MIN) { val = MIN; }\n  if (val > MAX) { val = MAX; }\n  if (val < 0) {\n    val *= -1;\n    return '-' + PAD.substring(0, LEN - ('' + val).length) + val;\n  } else {\n    return PAD.substring(0, LEN - ('' + val).length) + val;\n  }\n};\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/BaseBacking.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/BaseBacking.js","friendlyPath":"..BaseBacking","directory":"modules/devkit-core/modules/timestep/src/ui/backend/","filename":"BaseBacking.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n\njsio('import util.setProperty as setProperty');\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_BaseBacking=__class__;var BaseBacking = exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_BaseBacking(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_BaseBacking(){return this.init&&this.init.apply(this,arguments)},function () {\n\n  // required methods:\n  //\n  // this._onResize = function () {};\n  // this._onZIndex = function () {};\n\n  var styleKeys = this.constructor.styleKeys = {};\n\n  // keys map to properties\n  var BASE_STYLE_PROPS = {\n    'x': {value: 0},\n    'y': {value: 0},\n    'offsetX': {value: 0}, //translate\n    'offsetY': {value: 0},\n    'offsetXPercent': {value: undefined, cb: '_onOffsetX'}, //not implemented\n    'offsetYPercent': {value: undefined, cb: '_onOffsetY'},\n    'anchorX': {value: 0}, //rotation and scale\n    'anchorY': {value: 0},\n    'centerAnchor': {value: false},\n    'width': {cb: '_onResize'},\n    'height': {cb: '_onResize'},\n    'r': {value: 0},\n    'opacity': {value: 1},\n    'zIndex': {value: 0, cb: '_onZIndex'},\n    'scale': {value: 1},\n    'scaleX': {value: 1},\n    'scaleY': {value: 1},\n    'flipX': {value: false},\n    'flipY': {value: false},\n    'visible': {value: true},\n    'shadowColor': {value: 'black'}, //only has an effect in TextView??\n    'clip': {value: false},\n    'backgroundColor': {value: ''},\n    'compositeOperation': {value: undefined},\n  };\n\n  this.constructor.addProperty = function (key, def) {\n    styleKeys[key] = true;\n    setProperty(this.prototype, key, def);\n  }\n\n  for (var key in BASE_STYLE_PROPS) {\n    this.constructor.addProperty(key, BASE_STYLE_PROPS[key]);\n  }\n\n  this.localizePoint = function (pt) {\n    pt.x -= this.x + this.anchorX + this.offsetX;\n    pt.y -= this.y + this.anchorY + this.offsetY;\n    if (this.r) { pt.rotate(-this.r); }\n    pt.scale(1 / this.scale);\n    pt.x += this.anchorX;\n    pt.y += this.anchorY;\n    return pt;\n  }\n\n  this.copy = function () {\n    var copy = {};\n    for (var key in styleKeys) {\n      copy[key] = this[key];\n    }\n\n    return copy;\n  }\n  \n  this.update = function (style) {\n    for (var i in style) {\n      if (style.hasOwnProperty(i) && styleKeys.hasOwnProperty(i)) {\n        this[i] = style[i];\n      }\n    }\n    return this;\n  }\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/event/input/InputHandler.js":{"path":"modules/devkit-core/modules/timestep/src/event/input/InputHandler.js","friendlyPath":"event.input.InputHandler","directory":"modules/devkit-core/modules/timestep/src/event/input/","filename":"InputHandler.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class event.input.InputHandler;\n * An event handler proxy for an individual view. This handles dispatching\n * of events onto the actual view itself, as well as determining if the view\n * is the actual target of a propagated event.\n */\n\njsio('import math.geom.Point as Point');\njsio('import event.input.dispatch as dispatch');\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_event_input_InputHandler=__class__;var InputHandler = exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_event_input_InputHandler(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_event_input_InputHandler(){return this.init&&this.init.apply(this,arguments)},function () {\n\n  // ---- start mouseover\n  this.startCount = 0;\n  this.dragCount = 0;\n  this.overCount = 0;\n  this.canHandleEvents = true;\n  this.blockEvents = false;\n\n  this.init = function (view, opts) {\n    this.view = view;\n    this.view.subscribe('InputStart', this, 'onInputStart');\n    this.update(opts);\n  }\n\n  this.update = function(opts) {\n    if ('canHandleEvents' in opts) {\n      this.canHandleEvents = opts.canHandleEvents;\n    }\n\n    if ('blockEvents' in opts) {\n      this.blockEvents = opts.blockEvents;\n    }\n  }\n\n  this.containsEvent = function (evt, localPt) {\n    // block events must be false\n    return !this.blockEvents && (!this.view._superview   // top-view captures all events\n        || this.view.containsLocalPoint(localPt));\n  }\n\n  this.onEnter = function (id, atTarget) {\n    var view = this.view;\n    var over = this._over || (this._over = {});\n    if (id in over) { return; }\n\n    over[id] = true;\n    this.overCount++;\n\n    if (view.onInputOver) { view.onInputOver(over, this.overCount, atTarget); }\n    view.publish('InputOver', over, this.overCount, atTarget);\n  }\n\n  this.onLeave = function (id, atTarget) {\n    var view = this.view;\n    var over = this._over || (this._over = {});\n    if (!(id in over)) { return; }\n\n    delete over[id];\n    --this.overCount;\n\n    if (view.onInputOut) { view.onInputOut(over, this.overCount, atTarget); }\n    view.publish('InputOut', over, this.overCount, atTarget);\n  }\n\n  this.resetOver = function () {\n    delete this._over;\n    this.overCount = 0;\n  }\n\n  // ---- end mouseover\n\n\n  // ---- start drag\n\n  this.startDrag = function (opts) {\n    opts = opts || {};\n    var view = this.view;\n    var inputStartEvt = opts.inputStartEvt || opts.inputStartEvent || dispatch._evtHistory[dispatch.eventTypes.START];\n    var id = inputStartEvt.id;\n\n    // dedup drags from same input ID\n    var dragging = this._isDragging || (this._isDragging = {});\n    if (dragging[id]) { return; }\n    dragging[id] = true;\n\n    ++this.dragCount;\n    ++this.startCount;\n\n    var root = inputStartEvt.root;\n    var dragEvt = new dispatch.InputEvent(inputStartEvt.id, 'input:drag', inputStartEvt.srcPt.x, inputStartEvt.srcPt.y, root, view);\n\n    dragEvt.didDrag = false;\n    dragEvt.radius = opts.radius * opts.radius || 0;\n\n    root.subscribe('InputMoveCapture', this, 'onDragStart', dragEvt);\n    root.subscribe('InputSelectCapture', this, 'onDragStop', dragEvt);\n  }\n\n  this.isDragging = function () { return this.dragCount && dispatch._isDragging; }\n\n  this.onDragStart = function (dragEvt, moveEvt) {\n    // have we exceeded the move radius?\n    var dx = moveEvt.srcPt.x - dragEvt.srcPt.x;\n    var dy = moveEvt.srcPt.y - dragEvt.srcPt.y;\n    if (dx * dx + dy * dy <= dragEvt.radius) { return; }\n\n    if (dragEvt.didDrag) {\n      return;\n    }\n    dragEvt.didDrag = true;\n    --this.startCount;\n\n    var view = this.view;\n\n    // no longer need to listen for move events for onDragStart\n    if (this.startCount == 0) {\n      dragEvt.root.unsubscribe('InputMoveCapture', this, 'onDragStart');\n    }\n\n    // want to fire onDragStart with the current point equal to the initial point\n    // even though the user has moved away by now\n    dragEvt.currPt = dragEvt.srcPt;\n    dragEvt.localPt = view.localizePoint(new Point(dragEvt.currPt));\n\n    if (view.onDragStart) { view.onDragStart(dragEvt); }\n    view.publish('DragStart', dragEvt);\n\n    // future move events should be captured by _onDrag\n    // we should also call _onDrag now to handle the current move event delta\n    dragEvt.root.subscribe('InputMoveCapture', this, 'onDrag', dragEvt);\n    this.onDrag(dragEvt, moveEvt);\n  }\n\n  this.onDrag = function (dragEvt, moveEvt) {\n    if (dragEvt.id != moveEvt.id\n        || moveEvt.srcPt.x == dragEvt.currPt.x && moveEvt.srcPt.y == dragEvt.currPt.y) { return; }\n\n    var view = this.view;\n\n    dragEvt.prevPt = dragEvt.currPt;\n    dragEvt.currPt = moveEvt.srcPt;\n\n    dragEvt.prevLocalPt = dragEvt.localPt;\n    dragEvt.localPt = view.localizePoint(new Point(dragEvt.currPt));\n\n    var delta = Point.subtract(dragEvt.localPt, dragEvt.prevLocalPt);\n\n    dispatch._isDragging = true;\n\n    if (view.onDrag) { view.onDrag(dragEvt, moveEvt, delta); }\n    view.publish('Drag', dragEvt, moveEvt, delta);\n\n    //moveEvt.cancel();\n  }\n\n  this.onDragStop = function (dragEvt, selectEvt) {\n    var id = dragEvt.id;\n    var dragging = this._isDragging || (this._isDragging = {});\n    if (!dragging[id] || dragEvt.id != selectEvt.id) { return; }\n\n    delete dragging[id];\n    --this.dragCount;\n\n    if (!this.dragCount) {\n      dragEvt.root.unsubscribe('InputMoveCapture', this, 'onDragStart');\n      dragEvt.root.unsubscribe('InputMoveCapture', this, 'onDrag');\n      dragEvt.root.unsubscribe('InputSelectCapture', this, 'onDragStop');\n      dispatch._isDragging = false;\n    }\n\n    if (dragEvt.didDrag) {\n      var view = this.view;\n\n      // a subscription can later 'uncancel' the selectEvt by setting 'selectEvt.cancelled = false;'\n      selectEvt.cancel();\n\n      if (view.onDragStop) { view.onDragStop(dragEvt, selectEvt); }\n      view.publish('DragStop', dragEvt, selectEvt);\n    }\n  }\n\n  // ---- end drag\n\n  this.onInputStart = function(evt) {\n    if (this.view.listeners('InputActivate').length === 0) { return; }\n    this._isDown = true;\n    this.view.subscribe('InputSelect', this, 'onInputSelect');\n    evt.root.subscribeOnce('InputSelect', this, 'onGlobalInputSelect');\n  };\n\n  this.onInputSelect = function(evt, localPt) {\n    if (this._isDown) {\n      this.view.publish('InputActivate', evt, localPt);\n    }\n    this._isDown = false;\n    this.view.unsubscribe('InputSelect', this, 'onInputSelect');\n  };\n\n  this.onGlobalInputSelect = function(evt) {\n    if (this._isDown) {\n      this.view.unsubscribe('InputSelect', this, 'onInputSelect');\n    }\n    this._isDown = false;\n  };\n\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/animate.js":{"path":"modules/devkit-core/modules/timestep/src/animate.js","friendlyPath":"animate","directory":"modules/devkit-core/modules/timestep/src/","filename":"animate.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @module animate\n * Import the DOM/Canvas implementation of animate. Also define the transition function aliases.\n *\n * @doc http://doc.gameclosure.com/api/animate.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/animate.md\n */\n\njsio('import ui.backend.canvas.animate as exports');\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/debug/FPSView.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/debug/FPSView.js","friendlyPath":"ui.backend.debug.FPSView","directory":"modules/devkit-core/modules/timestep/src/ui/backend/debug/","filename":"FPSView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package ui.backend.debug.FPSView;\n *\n * The view which renders the FPS when showFPS is set to true on the\n * Application options.\n *\n * TODO Move to debug package.\n */\n\njsio('import device');\njsio('import lib.Enum as Enum');\n\njsio('import math.geom.Rect as Rect');\njsio('import math.geom.intersect as intersect');\n\njsio('import event.input.dispatch as dispatch');\n\nvar viewModes = new Enum('FPS', 'DT');\n\nfunction strokeRect(ctx, rect, color) {\n  ctx.fillStyle = color;\n  ctx.fillRect(rect.x, rect.y, 1, rect.height);\n  ctx.fillRect(rect.x, rect.y, rect.width, 1);\n  ctx.fillRect(rect.x + rect.width - 1, rect.y, 1, rect.height);\n  ctx.fillRect(rect.x, rect.y + rect.height - 1, rect.width, 1);\n};\n\nfunction fillRect(ctx, rect, color) {\n  ctx.fillStyle = color;\n  ctx.fillRect(rect.x, rect.y, rect.width, rect.height);\n};\n\nGraph=__class__;var Graph=Graph(function Graph(){return this.init&&this.init.apply(this,arguments)},function () {\n  this.init = function (opts) {\n    var Canvas = device.get('Canvas');\n\n    this._width = opts.width;\n    this._height = opts.height;\n\n    this._maxValue = opts.maxValue;\n    this._backgroundColor = opts.backgroundColor;\n    this._colors = opts.colors;\n    this._axisColor = opts.axisColor;\n\n    this._canvas = new Canvas({width: opts.width, height: opts.height});\n    this._ctx = this._canvas.getContext('2d');\n    this._ctx.fillStyle = opts.backgroundColor;\n    this._ctx.fillRect(0, 0, opts.width, opts.height);\n\n    this._offset = 0;\n    this._index = 0;\n  };\n\n  this.addValues = function (values, timeAxis) {\n    var ctx = this._ctx,\n      width = this._width,\n      height = this._height,\n      value,\n      maxValue = this._maxValue,\n      x = (this._offset + this._index) % width,\n      y = this._height,\n      n,\n      i, j;\n\n    ctx.fillStyle = this._backgroundColor;\n    ctx.fillRect(x, 0, 2, height);\n\n    i = values.length;\n    while (i) {\n      value = values[--i];\n      if (value > maxValue) {\n        value = maxValue;\n      }\n      n = ~~(value / maxValue *  height);\n      ctx.fillStyle = this._colors[i];\n      ctx.fillRect(x, height - n, 2, n);\n    }\n\n    ctx.fillStyle = this._axisColor;\n    if (timeAxis) {\n      ctx.fillRect(x, 0, 1, height);\n    }\n    ctx.fillRect(x, 25, 2, 1);\n    ctx.fillRect(x, 50, 2, 1);\n    ctx.fillRect(x, 75, 2, 1);\n\n    if (this._index < width) {\n      this._index += 2;\n    } else {\n      this._offset += 2;\n      if (this._offset >= width) {\n        this._offset = 0;\n      }\n    }\n  };\n\n  this.render = function (ctx, x, y) {\n    var offset = this._offset,\n      width = this._width,\n      height = this._height;\n\n    if (offset === 0) {\n      ctx.drawImage(this._canvas, 0, 0, width, height, x, y, width, height);\n    } else {\n      ctx.drawImage(this._canvas, offset, 0, width - offset, height, x, y, width - offset, height);\n      ctx.drawImage(this._canvas, 0, 0, offset, height, width - offset + x, y, offset, height);\n    }\n  };\n});\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_debug_FPSView=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_debug_FPSView(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_debug_FPSView(){return this.init&&this.init.apply(this,arguments)},function () {\n  this.init = function (opts) {\n    this._application = opts.application;\n\n    this._time = +(new Date()) + 1000;\n    this._frames = 0;\n    this._fps = 20;\n    this._dt = 10;\n\n    this._minimized = true;\n\n    var width = 200,\n      height = 100;\n\n    this._rectTop = new Rect(1, 1, width, 16);\n    this._rectMin = new Rect(0, 0, 24, 15);\n    this._rectMax = new Rect(0, 0, width + 2, height + 17);\n    this._rect = this._rectMin;\n\n    this._rectFPS = new Rect(141, 1, 30, 15);\n    this._rectDT = new Rect(171, 1, 30, 15);\n\n    this._borderColor = 'rgb(100,100,150)';\n    this._backgroundColor = '#17182E';\n    this._textColor = '#FFFFFF';\n\n    this._viewMode = viewModes.DT;\n\n    this._graphs = {}\n    this._graphs[viewModes.FPS] = new Graph({\n      width: width,\n      height: height,\n      maxValue: 60,\n      backgroundColor: this._backgroundColor,\n      colors: ['rgba(170,170,252,0.3)', 'rgb(170,170,252)'],\n      axisColor: '#FFFFFF'\n    });\n    this._graphs[viewModes.DT] = new Graph({\n      width: width,\n      height: height,\n      maxValue: 66,\n      backgroundColor: this._backgroundColor,\n      colors: ['rgba(255,0,0,0.5)', 'rgb(254,255,170)'],\n      axisColor: '#FFFFFF'\n    });\n  };\n\n  this.tick = function (dt) {\n    var time = +(new Date());\n    if (time > this._time) {\n      this._time = time + 1000;\n      this._fps = this._frames;\n      this._frames = 1;\n    } else {\n      this._frames++;\n    }\n\n    var events = this._application.getEvents();\n    if (events.length) {\n      this._handleEvents(events);\n    }\n\n    this._dt = this._dt * 0.8 + dt * 0.2;\n\n    if (!this._minimized) {\n      switch (this._viewMode) {\n        case viewModes.DT:\n          this._graphs[viewModes.DT].addValues([this._dt, dt], (this._frames === 1));\n          break;\n\n        case viewModes.FPS:\n          this._graphs[viewModes.FPS].addValues([this._fps, 1000 / dt], (this._frames === 1));\n          break;\n      }\n    }\n  };\n\n  this._handleEvents = function (events) {\n    var types = dispatch.eventTypes;\n    var i = events.length;\n\n    while (i) {\n      var event = events[--i];\n      switch (event.type) {\n        case types.START:\n          if (intersect.ptAndRect(event.srcPt, this._rect)) {\n            if (this._minimized) {\n              this._minimized = false;\n            } else {\n              if (intersect.ptAndRect(event.srcPt, this._rectFPS)) {\n                this._viewMode = viewModes.FPS;\n              } else if (intersect.ptAndRect(event.srcPt, this._rectDT)) {\n                this._viewMode = viewModes.DT;\n              } else {\n                this._minimized = true;\n              }\n            }\n            this._rect = this._minimized ? this._rectMin : this._rectMax;\n          }\n          break;\n      }\n    }\n  };\n\n  this.render = function (ctx) {\n    ctx.save();\n\n    ctx.textBaseline = 'top';\n    ctx.textAlign = 'center';\n    ctx.font = '12px Verdana';\n\n    if (this._minimized) {\n      fillRect(ctx, this._rect, this._backgroundColor);\n    } else {\n      fillRect(ctx, this._rectTop, this._backgroundColor);\n      this._graphs[this._viewMode].render(ctx, 1, 17);\n      ctx.fillStyle = this._borderColor;\n      ctx.fillRect(0, 16, this._rect.width, 1);\n\n      var fpsMode = (this._viewMode === viewModes.FPS),\n        dtMode = (this._viewMode === viewModes.DT);\n\n      fillRect(ctx, this._rectFPS, fpsMode ? this._borderColor : this._backgroundColor);\n      ctx.fillStyle = fpsMode ? this._textColor : this._borderColor;\n      ctx.fillText('FPS', this._rectFPS.x + this._rectFPS.width / 2, 0);\n\n      fillRect(ctx, this._rectDT, dtMode ? this._borderColor : this._backgroundColor);\n      ctx.fillStyle = dtMode ? this._textColor : this._borderColor;\n      ctx.fillText('DT', this._rectDT.x + this._rectDT.width / 2, 0);\n    }\n\n    strokeRect(ctx, this._rect, this._borderColor);\n\n    ctx.fillStyle = this._textColor;\n    ctx.fillText(this._fps, 12, 0);\n\n    ctx.restore();\n  };\n\n  this.getFPS = function () {\n    return this._fps;\n  };\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/canvas/ImageView.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/ImageView.js","friendlyPath":".backend.canvas.ImageView","directory":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/","filename":"ImageView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * package ui.backend.canvas.ImageView;\n *\n * canvas.ImageView implementation.\n */\n\njsio('import util.path');\njsio('import std.uri as URI');\n\njsio('import ui.View as View');\njsio('import ui.resource.Image as Image');\njsio('import ui.resource.ImageViewCache as ImageViewCache');\n\n/**\n * @extends ui.View\n */\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_ImageView=__class__;var ImageView = exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_ImageView(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_ImageView(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n\n  /**\n   * Options:\n   *   autoSize - See .setImage()\n   */\n\n  /**\n   * Return this view's Image object.\n   */\n\n  this.getImage = function () {\n    return this._img;\n  };\n\n  // @deprecated\n  this.getImageFromCache = function(url, forceReload) {\n    return ImageViewCache.getImage(url, forceReload);\n  };\n\n  this.updateOpts = function (opts) {\n    var opts = supr(this, 'updateOpts', arguments);\n\n    if ('autoSize' in opts) {\n      this._autoSize = !!opts.autoSize;\n    }\n\n    if (opts.image) {\n      this.setImage(opts.image);\n    } else {\n      this.needsReflow();\n    }\n\n    return opts;\n  };\n\n  /**\n   * Set the image of the view from an Image object or string.\n   * Options:\n   *   autoSize - Automatically set view size from image dimensions.\n   */\n\n  this.setImage = function (img, opts) {\n    var forceReload = opts && opts.forceReload;\n    if (typeof img == 'string') {\n      img = ImageViewCache.getImage(img, forceReload);\n    } else if (forceReload) {\n      img.reload();\n    }\n\n    this._img = img;\n\n    if (this._img) {\n      this._autoSize = (opts && ('autoSize' in opts)) ? opts.autoSize : this._autoSize;\n      if (this._autoSize) {\n        // sprited resources will know their dimensions immediately\n        if (this._img.getWidth() > 0 && this._img.getHeight() > 0) {\n          this.autoSize();\n        } else {\n          // non-sprited resources need to load first\n          this._img.doOnLoad(this, 'autoSize');\n        }\n      }\n      this._img.doOnLoad(this, 'needsRepaint');\n    }\n  };\n\n  /**\n   * Pass a function to load once the Image object is loaded, or a list of\n   * arguments that call lib.Callback::run() implicitly.\n   */\n\n  this.doOnLoad = function () {\n    if (arguments.length == 1) {\n      this._img.doOnLoad(this, arguments[0]);\n    } else {\n      this._img.doOnLoad.apply(this._img, arguments);\n    }\n    return this;\n  };\n\n  /**\n   * Automatically resize the view to the size of the image.\n   */\n\n  this.autoSize = function () {\n    if (this._img) {\n      this.style.width = this._img.getWidth();\n      this.style.height = this._img.getHeight();\n\n      if (this.style.fixedAspectRatio) {\n        this.style.enforceAspectRatio(this.style.width, this.style.height);\n      }\n    }\n  }\n\n  /**\n   * Get original width of the Image object.\n   */\n\n  this.getOrigWidth = this.getOrigW = function () {\n    return this._img.getOrigW();\n  };\n\n  /**\n   * Get original height of the Image object.\n   */\n\n  this.getOrigHeight = this.getOrigH = function () {\n    return this._img.getOrigH();\n  };\n\n  /**\n   * Render this image onto a canvas.\n   */\n\n  this.render = function (ctx) {\n    if (!this._img) { return; }\n\n    var s = this.style;\n    var w = s.width;\n    var h = s.height;\n    this._img.render(ctx, 0, 0, w, h);\n  }\n\n  /**\n   * Return a human-readable tag for this view.\n   */\n\n  var _loc = window.location.toString();\n  var _host = window.location.hostname;\n\n  this.getTag = function () {\n    var tag;\n    if (this._img) {\n      var url = this._img.getOriginalURL();\n      if (this._cachedTag && url == this._cachedTag.url) {\n        tag = this._cachedTag.tag;\n      } else {\n        var uri = URI.relativeTo(url, _loc);\n        var host = uri.getHost();\n        tag = util.path.splitExt(uri.getFile()).basename + (host && host != _host ? ':' + host : '');\n\n        this._cachedTag = {\n          url: url,\n          tag: tag\n        };\n      }\n    };\n\n    return (tag || '') + ':ImageView' + this.uid;\n  }\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/resource/Image.js":{"path":"modules/devkit-core/modules/timestep/src/ui/resource/Image.js","friendlyPath":"ui.resource.Image","directory":"modules/devkit-core/modules/timestep/src/ui/resource/","filename":"Image.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.resource.Image;\n * Model an Image for rendering. Supports taking a subset of images, to support\n * extracting from compacted sprite sheets. Also supports applying filters to\n * an image, usually by the View class.\n *\n * @doc http://doc.gameclosure.com/api/ui-imageview.html#class-ui.resource.image\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/imageview.md\n */\n\njsio('import device');\njsio('import lib.PubSub');\njsio('import event.Callback as Callback');\njsio('import ui.resource.loader as resourceLoader');\njsio('import ui.backend.canvas.filterRenderer as filterRenderer');\n\nvar ImageCache = {};\n\nvar GET_IMAGE_DATA_NOT_SUPPORTED = (!GLOBAL.document || !document.createElement);\n/**\n * Callback when images are loaded. This has a failsafe that runs up to a certain\n * threshold asynchronously, attempting to read the image size, before dying.\n */\n\n\n// `imageOnLoad` is called when a DOM image object fires a `load` or `error`\n// event.  Fire the internal `cb` with the error status.\nfunction imageOnLoad(success, evt, failCount) {\n  if (success && !this.width) {\n    // Some browsers fire the load event before the image width is\n    // available.  Wait up to 3 frames for the width.  Note that an image\n    // with zero-width will be considered an error.\n    if (failCount <= 3) {\n      setTimeout(bind(this, imageOnLoad, success, evt, (failCount || 0) + 1), 0);\n    } else {\n      this.__cb.fire(false);\n    }\n  } else {\n    this.__cb.fire(!success);\n  }\n}\n\n// Listen for preloaded images and add them to cache\nresourceLoader.on(resourceLoader.IMAGE_LOADED, function(image, src) {\n  ImageCache[src.resource] = image;\n  image.__cb = new Callback();\n  imageOnLoad.call(image, true);\n});\n\n/**\n * This class models the region of a larger image that this \"Image\" references.\n */\n\nvar ImageMap = !CONFIG.disableNativeViews\n  && NATIVE.timestep && NATIVE.timestep.ImageMap;\nif (!ImageMap) {\n  ImageMap=__class__;ImageMap=ImageMap(function ImageMap(){return this.init&&this.init.apply(this,arguments)},function () {\n    this.init = function (parentImage, x, y, width, height, marginTop, marginRight, marginBottom, marginLeft, url) {\n      this.url = url;\n      this.x = x;\n      this.y = y;\n      this.width = width;\n      this.height = height;\n      this.marginTop = marginTop;\n      this.marginRight = marginRight;\n      this.marginBottom = marginBottom;\n      this.marginLeft = marginLeft;\n    };\n  });\n}\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_resource_Image=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_resource_Image(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_resource_Image(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function () {\n\n  var isNative = GLOBAL.NATIVE && !device.isNativeSimulator;\n  var Canvas = device.get('Canvas');\n\n  // helper canvases for image data, initialized when/if needed\n  var _imgDataCanvas = null;\n  var _imgDataCtx = null;\n\n  this.init = function (opts) {\n    if (!opts) {\n      opts = {};\n    }\n\n    this._cb = new Callback();\n    this._map = new ImageMap(this, 0, 0, -1, -1, 0, 0, 0, 0, opts.url || '');\n    this._originalURL = opts.url || '';\n    this._scale = opts.scale || 1;\n    this._isError = false;\n\n    resourceLoader._updateImageMap(this._map, opts.url, opts.sourceX, opts.sourceY, opts.sourceW, opts.sourceH);\n\n    // srcImage can be null, then setSrcImg will create one\n    // (use the map's URL in case it was updated to a spritesheet)\n    this._setSrcImg(opts.srcImage, this._map.url, opts.forceReload);\n  };\n\n  this._setSrcImg = function (img, url, forceReload) {\n    this._cb.reset();\n    this._isError = false;\n\n    // if we haven't found an image, look in the image cache\n    if (!img && url && !forceReload && ImageCache[url]) {\n      img = ImageCache[url];\n    }\n\n    // look up the base64 cache -- if it's been preloaded, we'll get back an image that's already loaded\n    // if it has not been preloaded, we'll get back raw base64 in the b64 variable\n    if (!img && !forceReload && Image.get) {\n      var b64 = Image.get(url);\n      if (typeof b64 === 'object') {\n        img = b64;\n      } else if (b64) {\n        url = b64;\n      }\n    }\n\n    if (forceReload) {\n      // clear native texture in an image object\n      if (img && img.destroy) {\n        img.destroy();\n      }\n\n      // clear native textures by URL\n      if (url && NATIVE.gl && NATIVE.gl.deleteTexture) {\n        NATIVE.gl.deleteTexture(url);\n      }\n    }\n\n    // create an image if we don't have one\n    if (!img) {\n      img = new Image();\n      img.crossOrigin = 'use-credentials';\n    }\n\n    this._srcImg = img;\n\n    if (img instanceof HTMLCanvasElement || img instanceof Canvas) {\n      this._onLoad(false, img); // no error\n    } else {\n      // if it's already loaded, we call _onLoad immediately. Note that\n      // we don't use `.complete` here intentionally since web browsers\n      // set `.complete = true` before firing on the load/error\n      // callbacks, so we can't actually detect whether there's an error\n      // in some cases.\n      if (!img.__cb) {\n        img.__cb = new Callback();\n        img.addEventListener('load', bind(img, imageOnLoad, true), false);\n        img.addEventListener('error', bind(img, imageOnLoad, false), false);\n\n        if (url) {\n          ImageCache[url] = img;\n        }\n\n        if (!img.src && url) {\n          img.src = this._map.url = url;\n        }\n      }\n\n      img.__cb.run(this, function (err) {\n        this._onLoad(err, img);\n      });\n    }\n  };\n\n  this.getSource = this.getSrcImg = function () {\n    return this._srcImg;\n  };\n\n  this.setSource = this.setSrcImg = function (srcImg) {\n    this._setSrcImg(srcImg);\n  };\n\n  this.reload = function (cb) {\n    var srcImg = this._srcImg;\n    if (srcImg) {\n      // if passed a lib.Callback, chain it\n      if (cb && cb.chain) {\n        cb = cb.chain();\n      }\n\n      var hasFired = this._cb.fired();\n\n      // GC native has a reload method to force reload\n      if (srcImg.reload) {\n        var onReload = bind(this, function () {\n          srcImg.removeEventListener('reload', onReload, false);\n          if (hasFired) {\n            this._cb.fire(null, this);\n          }\n          cb && cb();\n        });\n        srcImg.addEventListener('reload', onReload, false);\n        srcImg.reload();\n\n        if (hasFired) {\n          this._cb.reset();\n        }\n      } else if (cb) {\n        if (this._cb.fired()) {\n          // always wait a frame before calling the callback\n          setTimeout(cb, 0);\n        } else {\n          this._cb.run(cb);\n        }\n      }\n    }\n  };\n\n  this.getURL = function () {\n    return this._map.url;\n  };\n\n  this.getOriginalURL = function () {\n    return this._originalURL;\n  };\n\n  this.getSourceX = function () {\n    return this._map.x;\n  };\n\n  this.getSourceY = function () {\n    return this._map.y;\n  };\n\n  this.getSourceWidth = this.getSourceW = function () {\n    return this._map.width;\n  };\n\n  this.getSourceHeight = this.getSourceH = function () {\n    return this._map.height;\n  };\n\n  this.getOrigWidth = this.getOrigW = function () {\n    return this._srcImg.width;\n  };\n\n  this.getOrigHeight = this.getOrigH = function () {\n    return this._srcImg.height;\n  };\n\n  this.setSourceX = function (x) {\n    this._map.x = x;\n  };\n\n  this.setSourceY = function (y) {\n    this._map.y = y;\n  };\n\n  this.setSourceWidth = this.setSourceW = function (w) {\n    this._map.width = w;\n  };\n\n  this.setSourceHeight = this.setSourceH = function (h) {\n    this._map.height = h;\n  };\n\n  this.setMarginTop = function (n) {\n    this._map.marginTop = n;\n  };\n\n  this.setMarginRight = function (n) {\n    this._map.marginRight = n;\n  };\n\n  this.setMarginBottom = function (n) {\n    this._map.marginBottom = n;\n  };\n\n  this.setMarginLeft = function (n) {\n    this._map.marginLeft = n;\n  };\n\n  this.setURL = function (url, forceReload) {\n    resourceLoader._updateImageMap(this._map, url);\n    this._setSrcImg(null, this._map.url, forceReload);\n  };\n\n  this.getWidth = function () {\n    var map = this._map;\n    return (map.width == -1 ? 0\n      : map.width + map.marginLeft + map.marginRight) / map.scale;\n  };\n\n  this.getHeight = function () {\n    var map = this._map;\n    return (map.height === -1 ? 0\n      : map.height + map.marginTop + map.marginBottom) / map.scale;\n  };\n\n  this.getMap = this.getBounds = function () {\n    return this._map;\n  };\n\n  this.setMap = this.setBounds = function (x, y, w, h, marginTop, marginRight, marginBottom, marginLeft) {\n    var map = this._map;\n    map.x = x;\n    map.y = y;\n    map.width = w;\n    map.height = h;\n    map.marginTop = marginTop || 0;\n    map.marginRight = marginRight || 0;\n    map.marginBottom = marginBottom || 0;\n    map.marginLeft = marginLeft || 0;\n    this.emit('changeBounds');\n  };\n\n  // register a callback for onload\n  this.doOnLoad = function () {\n    this._cb.forward(arguments);\n    return this;\n  };\n\n  // internal onload handler for actual Image object\n  // img is the internal image that triggered the _onLoad callback\n  this._onLoad = function (err, img) {\n    var map = this._map;\n    var srcImg = this._srcImg;\n    // if our source image has changed we should ignore this onload callback\n    // this can happen if _setSrcImg is called multiple times with different urls/images\n    if (img && img !== srcImg) {\n      return;\n    }\n\n    if (err) {\n      // TODO: something better?\n      logger.ERROR&&console.error(\"ERROR\",\"ui.resource.Image\",'Image failed to load:', map.url);\n      this._isError = true;\n      this._cb.fire({ NoImage: true });\n      return;\n    }\n\n    this._isError = false;\n\n    if (srcImg.width === 0) {\n      logger.WARN&&console.warn(\"WARN\",\"ui.resource.Image\",'Image has no width', this._url);\n    }\n\n    if (this._scale !== 1 && (map.width !== -1 || map.height !== -1)) {\n      // requested scale & provided a width or height\n      if (map.width === -1) {\n        // by the above check, this._sourceH should not be -1\n        map.width = srcImg.width * map.height / srcImg.height;\n      }\n\n      if (map.height === -1) {\n        // this._sourceW was initialized above\n        map.height = srcImg.height * map.width / srcImg.width;\n      }\n\n      // TODO: sourceImage might be shared so we can't actually modify width/height. This is a bug.\n      srcImg.width = map.width;\n      srcImg.height = map.height;\n    } else {\n      if (map.width === -1) {\n        map.width = srcImg.width;\n      }\n      if (map.height === -1) {\n        map.height = srcImg.height;\n      }\n    }\n\n    map.url = srcImg.src;\n    this._cb.fire(null, this);\n  };\n\n  this.isError = function () {\n    return this._isError;\n  };\n\n  this.isLoaded = this.isReady = function () {\n    return !this._isError && this._cb.fired();\n  };\n\n\n\n  this.render = function (ctx) {\n    if (!this._cb.fired() || this._isError) {\n      return;\n    }\n\n    var argumentCount = arguments.length;\n    var map = this._map;\n    var srcImg = this._srcImg;\n    var srcX = map.x;\n    var srcY = map.y;\n    var srcW = map.width;\n    var srcH = map.height;\n    var destX = argumentCount > 5 ? arguments[5] : arguments[1] || 0;\n    var destY = argumentCount > 6 ? arguments[6] : arguments[2] || 0;\n    var destW = argumentCount > 7 ? arguments[7] : arguments[3] || 0;\n    var destH = argumentCount > 8 ? arguments[8] : arguments[4] || 0;\n\n    if (argumentCount < 9) {\n      var scaleX = destW / (map.marginLeft + map.width + map.marginRight);\n      var scaleY = destH / (map.marginTop + map.height + map.marginBottom);\n      destX += scaleX * map.marginLeft;\n      destY += scaleY * map.marginTop;\n      destW = scaleX * map.width;\n      destH = scaleY * map.height;\n    } else {\n      srcX = arguments[1];\n      srcY = arguments[2];\n      srcW = arguments[3];\n      srcH = arguments[4];\n    }\n\n    if (!isNative && ctx.filter) {\n      var filterImg = filterRenderer.renderFilter(ctx, this, srcX, srcY, srcW, srcH);\n      if (filterImg) {\n        srcImg = filterImg;\n        srcX = 0;\n        srcY = 0;\n      }\n    }\n\n    ctx.drawImage(srcImg, srcX, srcY, srcW, srcH, destX, destY, destW, destH);\n  };\n\n  this.getImageData = function (x, y, width, height) {\n    // initialize a shared imgDataCanvas when/if needed\n    if (_imgDataCanvas === null) {\n      _imgDataCanvas = new Canvas();\n      _imgDataCtx = _imgDataCanvas.getContext('2d');\n    }\n\n    var map = this._map;\n    if (GET_IMAGE_DATA_NOT_SUPPORTED) { throw 'Not supported'; }\n    if (!map.width || !map.height) { throw 'Not loaded'; }\n\n    x = x || 0;\n    y = y || 0;\n    width = width || map.width;\n    height = height || map.height;\n    _imgDataCanvas.width = width;\n    _imgDataCanvas.height = height;\n\n    _imgDataCtx.clear();\n    this.render(_imgDataCtx, x, y, width, height, 0, 0, width, height);\n    return _imgDataCtx.getImageData(0, 0, width, height);\n  };\n\n  this.setImageData = function (data) {};\n\n  this.destroy = function () {\n    this._srcImg.destroy && this._srcImg.destroy();\n  };\n\n});\n\nexports.__clearCache__ = function () {\n  ImageCache = {};\n};\n\n","pre":true},"modules/devkit-core/modules/timestep/src/event/Callback.js":{"path":"modules/devkit-core/modules/timestep/src/event/Callback.js","friendlyPath":"event.Callback","directory":"modules/devkit-core/modules/timestep/src/event/","filename":"Callback.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class event.Callback;\n * Namespace shim to bring in Callback from jsio.\n *\n * @doc http://doc.gameclosure.com/api/event.html#class-event.callback\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/event.md\n */\n\njsio('import lib.Callback as exports');\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/lib/Callback.js":{"path":"modules/devkit-core/node_modules/jsio/packages/lib/Callback.js","friendlyPath":"lib.Callback","directory":"modules/devkit-core/node_modules/jsio/packages/lib/","filename":"Callback.js","src":"var Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_node_modules_jsio_packages_lib_Callback=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_node_modules_jsio_packages_lib_Callback(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_node_modules_jsio_packages_lib_Callback(){return this.init&&this.init.apply(this,arguments)},function() {\n\n\tthis._fired = false;\n\tthis._id = 0;\n\tthis._pending = null;\n\n\tthis.init = function() { this._run = []; };\n\t\n\t/* fired is @deprecated in favor of hasFired*/\n\tthis.hasFired = this.fired = function() { return this._fired; } ;\n\n\t// preserve pending callbacks, but clear fired status\n\tthis.reset = function() { this._args = []; this._fired = false; };\n\n\t// clear fired status and remove any pending callbacks\n\tthis.clear = function() { this.reset(); this._run = []; this._pending = null; this._stat = null; };\n\n\t// a convenience function to proxy arguments to `this.run`: arguments passed as the first argument\n\tthis.forward = function(args) { this.run.apply(this, args); };\n\n\t// when the lib.Callback object fires, run a ctx, method, and\n\t// (optional) curried arguments or a single callback function\n\tthis.run = function(ctx, method) {\n\t\tvar f = method ? bind.apply(this, arguments) : ctx;\n\t\tif (f) {\n\t\t\tif (this._fired) {\n\t\t\t\tf.apply(this, this._args);\n\t\t\t} else {\n\t\t\t\tthis._run.push(f);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t};\n\n\tthis.runOrTimeout = function(onFire, onTimeout, duration) {\n\t\tif (!onFire && !onTimeout) { return; }\n\n\t\tif (this._fired) {\n\t\t\tonFire.apply(this, this._args);\n\t\t} else {\n\t\t\tvar f = bind(this, function() {\n\t\t\t\tclearTimeout(timeout);\n\t\t\t\tonFire.apply(this, this._args);\n\t\t\t});\n\n\t\t\tthis.run(f);\n\n\t\t\tvar timeout = setTimeout(bind(this, function() {\n\t\t\t\tfor (var i = 0, n = this._run.length; i < n; ++i) {\n\t\t\t\t\tif (this._run[i] == f) {\n\t\t\t\t\t\tthis._run.splice(i, 1);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tonTimeout();\n\t\t\t}), duration);\n\t\t}\n\t};\n\n\tthis.fire = function() {\n\t\tif (this._fired) { return; }\n\t\tthis._fired = true;\n\n\t\tvar cbs = this._run;\n\t\tthis._args = arguments;\n\t\tfor(var i = 0, len = cbs.length; i < len; ++i) {\n\t\t\tif (cbs[i]) { cbs[i].apply(this, arguments); }\n\t\t}\n\t};\n\n\tthis.chain = function(id) {\n\t\tif (!this._pending) { this._pending = {}; }\n\t\tif (id === undefined) { id = this._id++; }\n\t\tthis._pending[id] = true;\n\n\t\tthis.reset();\n\t\treturn bind(this, '_deferred', id);\n\t};\n\n\tthis._deferred = function(id) {\n\t\tif (!this._stat) { this._stat = {}; }\n\t\tif (this._stat.hasOwnProperty(id)) { return; }\n\n\t\tthis._stat[id] = Array.prototype.slice.call(arguments, 1);\n\t\tvar pending = this._pending;\n\t\tdelete pending[id];\n\t\tfor (var id in pending) {\n\t\t\tif (pending.hasOwnProperty(id)) { return; }\n\t\t}\n\n\t\tthis.fire(this._stat);\n\t};\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/resource/loader.js":{"path":"modules/devkit-core/modules/timestep/src/ui/resource/loader.js","friendlyPath":"ui.resource.loader","directory":"modules/devkit-core/modules/timestep/src/ui/resource/","filename":"loader.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import .i18n');\njsio('import lib.Callback');\njsio('import event.Emitter as Emitter');\n\nvar _cache = {};\n\nvar MIME = {\n  '.png': 'image',\n  '.jpg': 'image',\n  '.bmp': 'image',\n  '.css': 'css',\n  '.html': 'html',\n  '.mp3': 'audio',\n  '.ogg': 'audio',\n  '.mp4': 'audio',\n  '.3gp': 'audio',\n  '.m4a': 'audio',\n  '.aac': 'audio',\n  '.flac': 'audio',\n  '.mkv': 'audio',\n  '.wav': 'audio'\n};\n\nLoader=__class__;var Loader=Loader(function Loader(){return this.init&&this.init.apply(this,arguments)},Emitter, function () {\n\n  var globalItemsToLoad = 0;\n  var globalItemsLoaded = 0;\n\n  this._map = {};\n\n  // save original map\n  this._originalMap = {};\n\n  this._audioMap = {};\n\n  Object.defineProperty(this, \"progress\", {\n    get: function() {\n      return globalItemsToLoad > 0 ? globalItemsLoaded / globalItemsToLoad : 1\n    }\n  });\n\n  this.has = function (src) {\n    return this._map[src];\n  };\n\n  this.restoreMap = function () {\n    this._map = this._originalMap;\n  };\n\n  this.getMap = function () {\n    return this._map;\n  };\n\n  // set resources map for the language\n  this.setMap = function (language) {\n    this.restoreMap();\n    if (!language) {\n      this._map = i18n.localizeResourceMap(this._map);\n    } else {\n      this._map = i18n.applyResourceMap(this._map, language);\n    }\n  };\n\n  // TODO: rename this function...\n  this.get = function (file) {\n    return 'resources/images/' + file;\n  };\n\n  /**\n   * Adds spritesheets to the image map\n   *\n   * @param {Object[]} sheets          an array of spritesheet definitions\n   * @param {string}   sheets[].f      sprite filename\n   * @param {number}   sheets[].x      sprite position x-coordinate (integer)\n   * @param {number}   sheets[].y      sprite position y-coordinate (integer)\n   * @param {number}   sheets[].w      sprite content width (without margin) (integer)\n   * @param {number}   sheets[].h      sprite content height (without margin) (integer)\n   * @param {number}   [sheets[].t=0]  sprite transparent margin top\n   * @param {number}   [sheets[].r=0]  sprite transparent margin right\n   * @param {number}   [sheets[].b=0]  sprite transparent margin bottom\n   * @param {number}   [sheets[].l=0]  sprite transparent margin left\n   */\n  this.addSheets = function (sheets) {\n    Object.keys(sheets).forEach(function (name) {\n      var sheet = sheets[name];\n      sheet.forEach(function (info) {\n        this._map[info.f] = {\n          sheet: name,\n          x: info.x || 0,\n          y: info.y || 0,\n          w: info.w || 0,\n          h: info.h || 0,\n          scale: info.s || 1,\n          marginTop: info.t || 0,\n          marginRight: info.r || 0,\n          marginBottom: info.b || 0,\n          marginLeft: info.l || 0\n        };\n      }, this);\n    }, this);\n    this._originalMap = this._map;\n  };\n\n\n  this.addAudioMap = function (map) {\n    Object.keys(map).forEach(function (name) {\n      this._audioMap[name] = true;\n    }, this);\n  };\n\n  /**\n   * Preload a given resource or array of resources.\n   * You can specify a folder name, or even a partial filename,\n   * to preload all resources that begin with that prefix.\n   * For instance, in a tree like so:\n   *\n   * resources\n   *  images\n     *      boss\n     *         enemy1.png\n   *         enemy2.png\n     *      hero\n     *          shield.png\n   *          sword.png\n   *\n   * You could preload both enemy images in either of the following\n   * ways:\n   *\n   *     ui.resource.loader.preload(\"resources/images/boss/\");\n   *     ui.resource.loader.preload(\"resources/images/boss/enemy\");\n   *\n   * Pass an array of paths to preload all at once. The callback\n   * will be called when all resources have finished loading.\n   *\n   * This works for both images and sounds.\n   */\n  this.preload = function (pathPrefix, opts, cb) {\n    if (typeof opts == 'function') {\n      cb = opts;\n      opts = undefined;\n    }\n\n    // process an array of items, where cb is run at completion of the final one\n    if (isArray(pathPrefix)) {\n      var chainCb = new lib.Callback();\n      pathPrefix.forEach(function (prefix) {\n        if (prefix) {\n          this.preload(prefix, opts, chainCb.chain());\n        }\n      }, this);\n      cb && chainCb.run(cb);\n      return chainCb;\n    } else {\n      pathPrefix = pathPrefix.replace(/^\\//, ''); // remove leading slash\n      // if an item is found in the map, add that item's sheet to the group.\n      // If there is no sheet in the map (i.e. for sounds), load that file directly.\n      var preloadSheets = {};\n      var map = this._map;\n      for (var uri in map) {\n        if (uri.indexOf(pathPrefix) === 0) {\n          // sprites have sheet; sounds are just by the filename key itself\n          preloadSheets[map[uri] && map[uri].sheet || uri] = true;\n        }\n      }\n\n      var audioMap = this._audioMap;\n      var audioToLoad = {};\n      for (var uri in audioMap) {\n        if (uri.indexOf(pathPrefix) === 0) {\n          audioToLoad[uri] = true;\n        }\n      }\n      var files = Object.keys(preloadSheets);\n      files = files.concat(Object.keys(audioToLoad));\n      // If no files were specified by the preload command,\n      if (files.length == 0) {\n        files = [pathPrefix];\n      }\n\n      var callback = this._loadGroup(merge({resources: files}, opts));\n      cb && callback.run(cb);\n      return callback;\n    }\n  };\n\n  var _soundManager = null;\n  var _soundLoader = null;\n  this.getSound = function (src) {\n    if (!_soundManager) {\n      jsio('import AudioManager');\n      _soundManager = new AudioManager({ preload: true });\n      _soundLoader = _soundManager.getAudioLoader();\n    }\n\n    if (GLOBAL.NATIVE && GLOBAL.NATIVE.sound && GLOBAL.NATIVE.sound.preloadSound) {\n      return NATIVE.sound.preloadSound(src);\n    } else {\n      _soundManager.addSound(src);\n      //HACK to make the preloader continue in the browser\n      return { complete: true, loader: _soundLoader };\n    }\n  };\n\n  this.getImagePaths = function (prefix) {\n    prefix = prefix.replace(/^\\//, ''); // remove leading slash\n    var images = [];\n    var map = this._map;\n    for (var uri in map) {\n      if (uri.indexOf(prefix) == 0) {\n        images.push(uri);\n      }\n    }\n    return images;\n  };\n\n  this.getImage = function (src, noWarn) {\n    // create the image\n    var img = new Image();\n    img.crossOrigin = 'use-credentials';\n\n    // find the base64 image if it exists\n    if (Image.get) {\n      var b64 = Image.get(src);\n      if (b64 instanceof Image) {\n        return b64;\n      }\n    }\n\n    if (b64) {\n      img.src = b64;\n      Image.set(src, img);\n    } else {\n      if (!noWarn) {\n        logger.WARN&&console.warn(\"WARN\",\"ui.resource.loader\",\"Preload Warning:\", src, \"not properly cached!\");\n      }\n      img.src = src;\n    }\n\n    return img;\n  };\n\n  /**\n   * used internally by timestep.Image to seamlessly convert\n   * non-sprited image URLs to sprited images. This is here (rather\n   * than in timestep.Image) to keep sprite formats in one consistent place.\n   */\n  this._updateImageMap = function (map, url, x, y, w, h) {\n    x = x || 0;\n    y = y || 0;\n    w = w == undefined ? -1 : w;\n    h = h == undefined ? -1 : h;\n\n    var info = this._map[url];\n    if (!info || !info.sheet) {\n      map.x = x;\n      map.y = y;\n      map.width = w;\n      map.height = h;\n      map.scale = 1;\n      map.url = url;\n      return;\n    }\n\n    var scale = info.scale || 1;\n\n    // calculate the source rectangle, with margins added to the edges\n    // (disregarding the fact that they may fall off the edge of the sheet)\n    map.x = info.x - info.marginLeft;\n    map.y = info.y - info.marginTop;\n    map.width = info.w + info.marginLeft + info.marginRight;\n    map.height = info.h + info.marginTop + info.marginBottom;\n\n    // Add in any source map options passed in to get the actual offsets\n    map.x += x * scale;\n    map.y += y * scale;\n    if (w > 0) {\n      map.width = w * scale;\n    }\n    if (h > 0) {\n      map.height = h * scale;\n    }\n\n    // now updatea the margins to account for the new source map\n    map.marginLeft = Math.max(0, info.x - map.x);\n    map.marginTop = Math.max(0, info.y - map.y);\n    map.marginRight = Math.max(0, (map.x + map.width) - (info.x + info.w));\n    map.marginBottom = Math.max(0, (map.y + map.height) - (info.y + info.h));\n\n    // and re-offset the source map to exclude margins\n    map.x += map.marginLeft;\n    map.y += map.marginTop;\n    map.width -= (map.marginLeft + map.marginRight);\n    map.height -= (map.marginTop + map.marginBottom);\n\n    // the scale of the source image, if scaled in a spritesheet\n    map.scale = scale;\n    map.url = info.sheet;\n    return map;\n  };\n\n  this._getRaw = function (type, src, copy, noWarn) {\n    // always return the cached copy unless specifically requested not to\n    if (!copy && _cache[src]) { return _cache[src]; }\n    var res = null;\n    switch (type) {\n      case 'audio':\n        res = this.getSound(src);\n        break;\n      case 'image':\n        res = this.getImage(src, noWarn);\n        break;\n      default:\n        logger.ERROR&&console.error(\"ERROR\",\"ui.resource.loader\",\"Preload Error: Unknown Type\", type);\n    }\n    return (_cache[src] = res);\n  };\n\n  // The callback is called for each image in the group with the image\n  // source that loaded and whether there was an error.\n  //\n  // function callback(lastSrc, error, isComplete, numCompleted, numTotal)\n  //    where error is true or false and isComplete is true when numCompleted == numTotal\n\n  this._requestedResources = [];\n\n  this._loadGroup = function (opts, cb) {\n    var timeout = opts.timeout;\n    var callback = new lib.Callback();\n    var that = this;\n\n    // compute a list of images using file extensions\n    var resources = opts.resources || [];\n    var n = resources.length || 0;\n    var loadableResources = [];\n\n    for (var i = 0; i < n; ++i) {\n      var ext = resources[i].substring(resources[i].lastIndexOf('.')).split('|')[0];\n      var type = MIME[ext];\n      var found = false;\n      var foundCount = 0;\n\n      var requested;\n\n      for (var j = 0; j < this._requestedResources.length; j++) {\n        requested = this._requestedResources[j];\n\n        if (requested.type === type && requested.resource === resources[i]) {\n          found = true;\n\n          foundCount++;\n\n          break;\n        }\n      }\n\n      if (!found) {\n        if (type === 'image' || type === 'audio') {\n          requested = { type: type, resource: resources[i] };\n\n          loadableResources.push(requested);\n\n          this._requestedResources.push(requested);\n        }\n\n        if (type == 'image' && GLOBAL.NATIVE && NATIVE.gl) {\n          NATIVE.gl.touchTexture(resources[i]);\n        }\n      }\n    }\n\n    // If no resources were loadable...\n\n    if (!loadableResources.length) {\n      if (!foundCount) {\n        logger.WARN&&console.warn(\"WARN\",\"ui.resource.loader\",\"Preload Fail: No Loadable Resources Found\");\n      }\n\n      if (cb) {\n        callback.run(cb);\n      }\n\n      callback.fire();\n\n      return callback;\n    }\n\n    // do the preload asynchronously (note that base64 is synchronous, only downloads are asynchronous)\n    var nextIndexToLoad = 0;\n    var numResources = loadableResources.length;\n    globalItemsToLoad += numResources;\n    var parallel = Math.min(numResources, opts.parallel || 5); // how many should we try to download at a time?\n    var numLoaded = 0;\n\n    var loadResource = bind(this, function () {\n      var currentIndex = nextIndexToLoad++;\n      var src = loadableResources[currentIndex];\n      var res;\n      if (src) {\n        res = this._getRaw(src.type, src.resource, false, true);\n      } else {\n        // End of resource list, done!\n        return;\n      }\n\n      var next = function (failed) {\n        // If already complete, stub this out\n        if (numLoaded >= numResources) { return; }\n\n        // Set stubs for the reload and load events so that code\n        // elsewhere can blindly call these without causing problems.\n        // An alternative would be to set these to null but not every\n        // piece of code that uses this does the right checks.\n        res.onreload = res.onload = res.onerror = function() {};\n\n        // The number of loads (success or failure) has increased.\n        ++numLoaded;\n        ++globalItemsLoaded;\n\n        // REALLY hacky progress tracker\n        if (globalItemsLoaded === globalItemsToLoad) { globalItemsLoaded = globalItemsToLoad = 0; }\n\n        // If we have loaded all of the resources,\n        if (numLoaded >= numResources) {\n          // Call the progress callback with isComplete == true\n          cb && cb(src, failed, true, numLoaded, numResources);\n\n          // If a timeout was set, clear it\n          if (_timeout) {\n            clearTimeout(_timeout);\n          }\n\n          // Fire the completion callback chain\n          logger.LOG&&console.log(\"LOG\",\"ui.resource.loader\",\"Preload Complete:\", src.resource);\n          callback.fire();\n        } else {\n          // Call the progress callback with the current progress\n          cb && cb(src, failed, false, numLoaded, numResources);\n\n          // Restart on next image in list\n          setTimeout(loadResource, 0);\n        }\n      };\n\n      // IF this is the type of resource that has a reload method,\n      if (res.reload && res.complete) {\n        // Use the magic of closures to create a chain of onreload\n        // completion callbacks.  This is really important because\n        // we can be be preloading the same resource twice, and we can\n        // also be simultaneously preloading two groups at once.\n        var prevOnLoad = res.onreload;\n        var prevOnError = res.onerror;\n\n        // When the resource completes loading, either with success\n        // or failure:\n\n        res.onreload = function () {\n          // If previous callback exists, run it first in a chain\n          prevOnLoad && prevOnLoad();\n\n          // React to successful load of this resource\n          next(false);\n        };\n\n        res.onerror = function () {\n          // If previous callback exists, run it first in a chain\n          prevOnError && prevOnError();\n\n          // React to failed load of this resource\n          next(true);\n        };\n\n        // Start it reloading\n        res.reload();\n      } else if (res.complete) {\n        if (res.loader) {\n          // real sound loading with AudioContext ...\n          res.loader.load([src.resource], next);\n        } else {\n          // Since the resource has already completed loading, go\n          // ahead and invoke the next callback indicating the previous\n          // success or failure.\n          next(res.failed === true);\n        }\n      } else {\n        // The comments above about onreload callback chaining equally\n        // apply here.  See above.\n        var prevOnLoad = res.onload;\n        var prevOnError = res.onerror;\n\n        // When the resource completes loading, either with success\n        // or failure:\n\n        res.onload = function () {\n          // If previous callback exists, run it first in a chain\n          prevOnLoad && prevOnLoad();\n\n          // Reset fail flag\n          res.failed = false;\n\n          // Let subscribers know an image was loaded\n          if (src.type === \"image\") {\n            that.emit(Loader.IMAGE_LOADED, res, src);\n          }\n\n          // React to successful load of this resource\n          next(false);\n        };\n\n        res.onerror = function () {\n          // If previous callback exists, run it first in a chain\n          prevOnError && prevOnError();\n\n          // Set fail flag\n          res.failed = true;\n\n          // React to failed load of this resource\n          next(true);\n        };\n      }\n    });\n\n    var _timeout = null;\n    setTimeout(function () {\n      // spin up n simultaneous loaders!\n      for (var i = 0; i < parallel; ++i) { loadResource(); }\n\n      // register timeout call\n      if (timeout) {\n        _timeout = setTimeout(function () {\n          logger.WARN&&console.warn(\"WARN\",\"ui.resource.loader\",\"Preload Timeout: Something Failed to Load\");\n          callback.fire();\n          numLoaded = numResources;\n        }, timeout);\n      }\n    }, 0);\n    return callback;\n  };\n\n});\n\nLoader.IMAGE_LOADED = \"imageLoaded\";\n\nexports = new Loader();\n\nexports.IMAGE_LOADED = Loader.IMAGE_LOADED;\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/resource/i18n.js":{"path":"modules/devkit-core/modules/timestep/src/ui/resource/i18n.js","friendlyPath":".i18n","directory":"modules/devkit-core/modules/timestep/src/ui/resource/","filename":"i18n.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar LOCALE_CODES = navigator.language && navigator.language.split('-');\nvar LANGUAGE_CODE = (LOCALE_CODES[0] || 'en').toLowerCase();\nvar REGION_CODE = (LOCALE_CODES[1] || 'US').toUpperCase();\n\nvar EU_REGIONS = [\n  'AD', 'AT', 'BE', 'BL', 'CY', 'DE', 'EE', 'ES', 'EU', 'FI', 'FR', 'GR',\n  'IE', 'IT', 'LU', 'LV', 'MC', 'ME', 'MT', 'MQ', 'NL', 'PM', 'PT', 'RE',\n  'SI', 'SK', 'SM', 'VA', 'YT'\n];\n\n/**\n * The i18n Class provides localization support for string JSON files.\n */\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_resource_i18n=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_resource_i18n(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_resource_i18n(){return this.init&&this.init.apply(this,arguments)},function () {\n\n  var defaultOpts = {\n    languageCode: LANGUAGE_CODE,\n    regionCode: REGION_CODE,\n    stringsPath: 'resources/strings/',\n    defaultStringsFile: 'en.json'\n  };\n\n  this.init = function (opts) {\n    opts = merge(opts, defaultOpts);\n    this._languageCode = opts.languageCode;\n    this._regionCode = opts.regionCode;\n    this._stringsPath = opts.stringsPath;\n    this._defaultStringsFile = opts.defaultStringsFile;\n    this._strings = {};\n\n    this.loadStrings(this._stringsPath, this._defaultStringsFile);\n  };\n\n  this.getLanguageCode = function () {\n    return this._languageCode;\n  };\n\n  this.getRegionCode = function () {\n    return this._regionCode;\n  };\n\n  this.loadStrings = function (path, defaultFile) {\n    var lc = this._languageCode;\n    var rc = this._regionCode;\n    var locPath = path + lc + '-' + rc + '.json';\n    var langPath = path + lc + '.json';\n    var defPath = path + defaultFile;\n    var data = CACHE[locPath] || CACHE[langPath] || CACHE[defPath];\n    if (data) {\n      try {\n        this._strings = JSON.parse(data);\n      } catch (e) {\n        console.error(\"Error loading strings JSON:\");\n        console.error(e);\n      }\n    } else {\n      console.error(\"No JSON found for files:\", locPath, langPath, defPath);\n    }\n  };\n\n  this.getString = function (key) {\n    var value = this._strings[key];\n    return value !== undefined ? value : key;\n  };\n\n});\n\n/**\n * This function is used by resource/loader to map localized resources to\n * the base resources directory automatically.\n * \n * To leverage this resource localization, structure your resource\n * directories like this:\n *\n * default directory:\n *   resources\n *    images\n *        hero.png\n * \n * language localized directory:\n *   resources-zh\n *    images\n *        hero.png\n * \n * regional localized directory:\n *   resources-zh-TW\n *    images\n *        hero.png\n * \n * You can then always use resources/images/hero.png, and the image will\n * automatically point to the best image for your user's language or region.\n *\n * It also supports regional localization for the EU, to aid in localizing\n * images of currency or currency symbols.\n */\nexports.localizeResourceMap = function (map) {\n  var localizedMap = {};\n  // directories listed in order of priority\n  var localeRes = 'resources-' + LANGUAGE_CODE + '-' + REGION_CODE;\n  var langRes = 'resources-' + LANGUAGE_CODE;\n  var regionRes = 'resources-' + REGION_CODE;\n  var euroRes = 'resources-EU';\n  for (var key in map) {\n    var path = key;\n    var localeIndex = key.indexOf(localeRes);\n    var langIndex = key.indexOf(langRes);\n    var regionIndex = key.indexOf(regionRes);\n    var euroIndex = key.indexOf(euroRes);\n    // replace localized path with default path\n    // i.e. resources-en-US can now be accessed by resources\n    if (localeIndex === 0) {\n      path = 'resources' + key.substring(localeRes.length);\n    } else if (langIndex === 0) {\n      path = 'resources' + key.substring(langRes.length);\n    } else if (regionIndex === 0) {\n      path = 'resources' + key.substring(regionRes.length);\n    } else if (euroIndex === 0 && EU_REGIONS.indexOf(REGION_CODE) !== -1) {\n      path = 'resources' + key.substring(euroRes.length);\n    }\n    localizedMap[path] = map[key];\n  }\n  return localizedMap;\n};\n\nexports.applyResourceMap = function (map, language) {\n  var localizedMap = {};\n  var langRes = 'resources-' + language;\n  for (var key in map) {\n    var path = key;\n    var langIndex = key.indexOf(langRes);\n    if (langIndex === 0) {\n      path = 'resources' + key.substring(langRes.length);\n      localizedMap[path] = map[key];\n    } else if (Object.keys(localizedMap).indexOf(path) < 0) {\n      // without this block, the same name default resource would replace the localized resource\n      localizedMap[path] = map[key];\n    }\n  }\n  return localizedMap;\n};\n","pre":true},"modules/devkit-core/modules/timestep/src/AudioManager.js":{"path":"modules/devkit-core/modules/timestep/src/AudioManager.js","friendlyPath":"AudioManager","directory":"modules/devkit-core/modules/timestep/src/","filename":"AudioManager.js","baseMod":"AudioManager","basePath":"/Users/marcelo.hashimoto/Desktop/gamedev/ElementalMatch3/modules/devkit-core/modules/timestep/src/AudioManager","src":"/**\n* @license\n* This file is part of the Game Closure SDK.\n*\n* The Game Closure SDK is free software: you can redistribute it and/or modify\n* it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n* The Game Closure SDK is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n* Mozilla Public License v. 2.0 for more details.\n\n* You should have received a copy of the Mozilla Public License v. 2.0\n* along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n*/\n\n/**\n* @class AudioManager;\n* Implements platform-aware Audio support.\n*\n* @doc http://doc.gameclosure.com/api/sound.html\n* @docsrc https://github.com/gameclosure/doc/blob/master/api/sound.md\n*/\n\njsio('import device');\njsio('import util.path');\njsio('import event.Emitter as Emitter');\njsio('import ui.backend.sound.AudioLoader as AudioLoader');\n\n// An API for playing named sounds. Sounds can be given a single file source\n// or multiple sources which will be chosen at random at play time. Sounds may\n// also be given a default volume and loop boolean.\n//\n// Only one background sound can be played at a time. They are streamed, not\n// preloaded, on native.\n\n// define AudioContext as best as possible; it may not exist\nvar AudioContext = window.AudioContext || window.webkitAudioContext;\n\n// global private variables\nvar _ctx = null;\n\n// use an AudioContext if available, otherwise fallback to Audio\nif (AudioContext) {\n  try {\n    _ctx = new AudioContext();\n  } catch (e) {\n    // most commonly due to hardware limits on AudioContext instances\n    logger.WARN&&console.warn(\"WARN\",\"AudioManager\",\"HTML5 AudioContext init failed, falling back to Audio!\");\n  }\n} else {\n  logger.WARN&&console.warn(\"WARN\",\"AudioManager\",\"HTML5 AudioContext not supported, falling back to Audio!\");\n}\n\nvar _muteAll = false;\nvar _registeredAudioManagers = [];\n\n/**\n* RawAudio Class\n*\n* Extend the local instance of Audio objects.\n* Created and used by MultiSound Class.\n*/\nRawAudio=__class__;var RawAudio=RawAudio(function RawAudio(){return this.init&&this.init.apply(this,arguments)},function () {\n  this.init = function () {\n    if (typeof Audio === \"undefined\") {\n      return null;\n    }\n\n    // we can't extend an HTML5 audio object in a browser, so do our best\n    var audio = new Audio();\n    var proto = RawAudio.prototype;\n    for (var i in proto) {\n      if (!audio[i] && proto.hasOwnProperty(i)) {\n        audio[i] = proto[i];\n      }\n    }\n\n    var playTimeout = null;\n    audio.oldPlay = audio.play;\n    audio.play = function() {\n      if (audio.readyState === 4) {\n        audio.oldPlay();\n      } else {\n        playTimeout = setTimeout(audio.play, 32);\n      }\n    };\n    audio.oldPause = audio.pause;\n    audio.pause = function() {\n      if (playTimeout !== null) {\n        clearTimeout(playTimeout);\n        playTimeout = null;\n      }\n      audio.oldPause();\n    };\n\n    return audio;\n  };\n\n  // add a stop method that resets the current time\n  this.stop = function () {\n    !this.paused && this.pause();\n    if ((this.NETWORK_LOADING === undefined\n      || this.networkState !== this.NETWORK_LOADING\n      || this.networkState !== this.NETWORK_NO_SOURCE)\n        && !isNaN(this.duration))\n    {\n      this.currentTime = 0;\n    }\n  };\n});\n\n/**\n* MultiSound Class\n*\n* A sound object that can play one of a collection of audio sources.\n* Created and used by exported AudioManager Class.\n*/\nMultiSound=__class__;var MultiSound=MultiSound(function MultiSound(){return this.init&&this.init.apply(this,arguments)},function () {\n  this.init = function (soundManager, name, opts) {\n    opts = typeof opts === 'string' ? { sources: [opts] } : (opts || {});\n\n    this._soundManager = soundManager;\n    this._name = name;\n    this._isPaused = false;\n    this._lastSrc = null;\n    this._sources = [];\n    this._paths = [];\n\n    this._useAudioContext = false;\n    this._loader = null;\n    this._gainNode = null;\n\n    this.loop = opts.loop !== undefined ? opts.loop : opts.background;\n    this.isBackgroundMusic = opts.background;\n\n    // if a list of file names is given in sources, load them as alternative\n    // clips for this sound. Else, assume the only clip for this sound\n    // is the file with its same name\n    var srcList = opts.sources || [name];\n    var sources = this._sources;\n    var paths = this._paths;\n    var basePath = soundManager.getPath();\n    var ext = soundManager.getExt();\n    var extTestExp = new RegExp(ext + '$', 'i');\n    var loop = this.loop;\n    var volume = opts.volume !== undefined ? opts.volume : 1;\n\n    // HTML5 hack for browsers\n    var isPaused = bind(this, 'isPaused');\n    var _checkPauseOnPlay = function (src) {\n      this.removeEventListener(arguments.callee);\n      isPaused() && this.pause();\n    };\n\n    if (_ctx) {\n      this._useAudioContext = true;\n      this._loader = soundManager.getAudioLoader();\n      this._gainNode = _ctx.createGain();\n      this._gainNode.connect(_ctx.destination);\n      this._gainNode.gain.value = volume;\n    }\n\n    for (var i = 0, src; src = srcList[i]; ++i) {\n      // file paths are relative to the base path\n      var fullPath = util.path.join(basePath, opts.path, src);\n      // append the extension if not already provided\n      if (!extTestExp.test(fullPath)) {\n        fullPath += ext;\n      }\n      paths.push(fullPath);\n\n      // prefer AudioContext over Audio\n      if (!this._useAudioContext) {\n        var audio = new RawAudio();\n        if (audio) {\n          audio.loop = loop;\n          audio.volume = volume;\n          audio.isBackgroundMusic = opts.background;\n          audio.src = fullPath;\n          audio.preload = ((audio.readyState !== 4) || (soundManager._preload && !opts.background)) ? \"auto\" : \"none\";\n\n          // If you pause or mute an html5 audio object in the browser\n          // before the sound is ready, it will play anyway.  Here, we\n          // check the pause status when the audio starts playing.\n          if (audio.addEventListener) {\n            audio.addEventListener('playing', _checkPauseOnPlay);\n          }\n\n          sources.push(audio);\n          if (audio.isBackgroundMusic && NATIVE && NATIVE.sound) {\n            NATIVE.sound.registerMusic(fullPath, audio);\n          }\n        }\n      }\n    }\n  };\n\n  this.getVolume = function () {\n    if (this._useAudioContext) {\n      return this._gainNode.gain.value;\n    } else {\n      var src = this._sources[0];\n      return (src && src.volume) || 0;\n    }\n  };\n\n  this.setVolume = function (volume) {\n    if (this._useAudioContext) {\n      this._gainNode.gain.value = volume;\n    } else {\n      for (var i = 0, src; src = this._sources[i]; ++i) {\n        src.volume = volume;\n      }\n    }\n  };\n\n  this.stop = function () {\n    if (this._useAudioContext) {\n      this._lastSrc && this._lastSrc.stop(0);\n      this._lastSrc = null;\n    } else {\n      for (var i = 0, src; src = this._sources[i]; ++i) {\n        src.stop();\n      }\n    }\n  };\n\n  this.pause = function () {\n    this._isPaused = true;\n    if (this._useAudioContext) {\n      this.stop();\n    } else {\n      for (var i = 0, src; src = this._sources[i]; ++i) {\n        src.pause();\n      }\n    }\n  };\n\n  this.isPaused = function () {\n    return this._isPaused;\n  };\n\n  this.isPlaying = function () {\n    var isPlaying = false;\n    if (!this._useAudioContext && this._lastSrc !== null) {\n      var cur = this._lastSrc.currentTime;\n      var dur = this._lastSrc.duration;\n      // NaN duration means the duration isn't loaded yet,\n      // meaning the sound was started very recently. Since\n      // this._lastSrc is defined, we know that the sound has\n      // been played, so it's playing unless it's paused :)\n      if (isNaN(dur) || cur < dur) {\n        isPlaying = !this.isPaused();\n      }\n    }\n    return isPlaying;\n  };\n\n  this.getDuration = function () {\n    return this._lastSrc && this._lastSrc.duration || 0;\n  };\n\n  this.getTime = function () {\n    return this._lastSrc && this._lastSrc.currentTime || 0;\n  };\n\n  this.setTime = function (t) {\n    if (!this._useAudioContext && this._lastSrc && this.isBackgroundMusic) {\n      if (this._lastSrc.duration) {\n        this._lastSrc.currentTime = t;\n      } else {\n        //setTimeout(bind(this, 'setTime', t + 0.01), 10);\n      }\n    }\n  };\n\n  this.play = function (opts) {\n    opts = opts || {};\n    var loop = opts.loop || this.loop;\n    var time = opts.time || 0;\n    var duration = opts.duration ? opts.duration * 1000 : undefined;\n\n    if (this._useAudioContext) {\n      var loader = this._loader;\n      var index = Math.random() * this._paths.length | 0;\n      var path = this._paths[index];\n      var buffer = loader.getBuffer(path);\n      if (!buffer) {\n        loader.doOnLoad(path, bind(this, function (buffers) {\n          if (!this._isPaused) {\n            this._playFromBuffer(buffers[0], loop, time, duration);\n          }\n        }));\n      } else {\n        this._playFromBuffer(buffer, loop, time, duration);\n      }\n    } else {\n      var src = this._getRandom();\n      src.play();\n      if (src.muted) {\n        // Chrome bug? Audio objects with muted set before they\n        // are played won't be muted, so toggle the mute state\n        // twice after calling play.\n        src.muted = false;\n        src.muted = true;\n      }\n      this.setTime(time);\n      if (duration !== undefined) {\n        setTimeout(bind(this, 'pause'), duration);\n      }\n      this._lastSrc = src;\n    }\n    this._isPaused = false;\n  };\n\n  this._playFromBuffer = function (buffer, loop, time, duration) {\n    if (buffer) {\n      var src = _ctx.createBufferSource();\n      src.buffer = buffer;\n      src.loop = loop;\n      src.connect(this._gainNode);\n      if (duration !== undefined) {\n        src.start(_ctx.currentTime, time, duration);\n      } else {\n        src.start(_ctx.currentTime, time);\n      }\n      this._lastSrc = src;\n    }\n  };\n\n  this._getRandom = function () {\n    var index = Math.random() * this._sources.length | 0;\n    return this._sources[index];\n  };\n});\n\n/**\n* AudioManager Class\n*\n* @extends event.Emitter\n*/\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_AudioManager=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_AudioManager(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_AudioManager(){return this.init&&this.init.apply(this,arguments)},Emitter, function (supr) {\n  this.init = function (opts) {\n    opts = opts || {};\n    supr(this, 'init', arguments);\n\n    this._loader = null;\n    this.setPath(opts.path);\n    this._map = opts.files || opts.map;\n    this._preload = opts.preload;\n    this._sounds = {};\n    this._isMusicMuted = false;\n    this._areEffectsMuted = false;\n    this._currentMusic = null;\n    this._key = \"\";\n\n    // register instances of AudioManager for global app mute\n    this.setMuted(_muteAll);\n    _registeredAudioManagers.push(this);\n\n    opts.persist && this.persistState(opts.persist);\n\n    // pass the global AudioContext instance to AudioLoaders\n    _ctx && this.setAudioContext();\n\n    // determine whether browser supports mp3 or ogg. Default to mp3 if\n    // both are supported. Native will return true for everything, but\n    // on native, we store ogg files as .mp3 files, so return .mp3...\n    if (typeof Audio !== \"undefined\") {\n      var sound = new Audio();\n      if (sound.canPlayType(\"audio/mpeg\")) {\n        this._ext = \".mp3\";\n      } else if (sound.canPlayType(\"audio/ogg\")) {\n        this._ext = \".ogg\";\n      }\n    } else {\n      logger.WARN&&console.warn(\"WARN\",\"AudioManager\",\"HTML5 Audio not supported!\");\n    }\n\n    if (this._ext === undefined) {\n      this._ext = \".mp3\";\n      logger.WARN&&console.warn(\"WARN\",\"AudioManager\",\"Warning: sound support unclear - defaulting to .mp3\");\n    }\n\n    // add sounds to the audio API's list of sounds and preload them\n    for (var key in this._map) {\n      var item = this._map[key];\n      this.addSound(key, item);\n    }\n\n    // AudioContext preloading\n    if (_ctx && this._preload) {\n      var urls = [];\n      for (var key in this._sounds) {\n        var sound = this._sounds[key];\n        urls = urls.concat(sound._paths);\n      }\n      this.preloadSounds(urls);\n    }\n  };\n\n  this.getAudioContext = function () {\n    return _ctx;\n  };\n\n  this.setAudioContext = function () {\n    if (this._loader) {\n      this._loader.setAudioContext(_ctx);\n    } else {\n      this._loader = new AudioLoader({ ctx: _ctx });\n    }\n  };\n\n  this.getAudioLoader = function () {\n    return this._loader;\n  };\n\n  this.preloadSounds = function (urls) {\n    // used for AudioContext only\n    this._loader && this._loader.load(urls);\n  };\n\n  this.getExt = function () {\n    return this._ext;\n  };\n\n  this.getPath = function () {\n    return this._path;\n  };\n\n  this.setPath = function (path) {\n    if (path) {\n      path = path.replace(/\\/$/, '');\n    }\n    this._path = path || '';\n  };\n\n  this.addSound = function (name, opts) {\n    this._sounds[name] = new MultiSound(this, name, opts);\n  };\n\n  /* @internal for now\n   */\n  this.persistState = function (key) {\n    this._key = key;\n\n    var value = localStorage.getItem(this._key);\n    if (value) {\n      try {\n        value = JSON.parse(value);\n      } catch (e) {}\n    }\n\n    if (value) {\n      logger.LOG&&console.log(\"LOG\",\"AudioManager\",\"Restoring Audio API state!\");\n      this.setMusicMuted(value.isMusicMuted);\n      this.setEffectsMuted(value.areEffectsMuted);\n    }\n  };\n\n  /* @internal for now\n   */\n  this._persist = function () {\n    if (this._key !== \"\") {\n      localStorage.setItem(this._key, JSON.stringify({\n        isMusicMuted: this._isMusicMuted,\n        areEffectsMuted: this._areEffectsMuted\n      }));\n    }\n  };\n\n  this.getMuted = function () {\n    return this._isMusicMuted && this._areEffectsMuted;\n  };\n\n  this.getMusicMuted = function () {\n    return this._isMusicMuted;\n  };\n\n  this.getEffectsMuted = function () {\n    return this._areEffectsMuted;\n  };\n\n  this.setMuted = function (isMuted) {\n    this.setMusicMuted(isMuted);\n    this.setEffectsMuted(isMuted);\n  };\n\n  this.setMusicMuted = function (isMusicMuted) {\n    if (_muteAll) { isMusicMuted = true; }\n    this._isMusicMuted = isMusicMuted;\n    this._persist();\n    // resume music on unmute\n    if (this._currentMusic) {\n      this._currentMusic.pause();\n      if (!isMusicMuted) {\n        this._currentMusic.play();\n      }\n    }\n  };\n\n  this.setEffectsMuted = function (areEffectsMuted) {\n    if (_muteAll) { areEffectsMuted = true; }\n    this._areEffectsMuted = areEffectsMuted;\n    this._persist();\n    if (areEffectsMuted) {\n      for (var key in this._sounds) {\n        var sound = this._sounds[key];\n        if (!sound.isBackgroundMusic) {\n          sound.stop();\n        }\n      }\n    }\n  };\n\n  this.getSound = function(name) {\n    var sound = this._sounds[name];\n    if (!sound) { logger.WARN&&console.warn(\"WARN\",\"AudioManager\",\"Warning: no sound named \" + name); }\n    return sound;\n  };\n\n  this.setVolume = function (name, volume) {\n    var sound = this.getSound(name);\n    if (sound) {\n      sound.setVolume(volume);\n      return true;\n    }\n    return false;\n  };\n\n  this.getVolume = function (name) {\n    var sound = this.getSound(name);\n    if (sound) {\n      return sound.getVolume();\n    } else {\n      return null;\n    }\n  };\n\n  this.setTime = function (name, t) {\n    var sound = this.getSound(name);\n    if (!sound) {\n      return false;\n    }\n    sound.setTime(t || 0);\n    return true;\n  };\n\n  this.getTime = function (name) {\n    var sound = this.getSound(name);\n    if (!sound) {\n      return false;\n    }\n    return sound.getTime();\n  };\n\n  this.getDuration = function (name) {\n    var sound = this.getSound(name);\n    if (!sound) {\n      return false;\n    }\n    return sound.getDuration();\n  };\n\n  this.play = function (name, opts) {\n    var sound = this.getSound(name);\n    if (!sound) {\n      return false;\n    }\n\n    opts = opts || {};\n    var isBackgroundMusic = sound.isBackgroundMusic;\n    if (isBackgroundMusic) {\n      // some platforms enforce only one simultaneous background music\n      // (native) while others do not.  Enforce it always.\n      if (this._currentMusic) {\n        this._currentMusic.stop();\n      }\n      this._currentMusic = sound;\n      // if we're muted, make sure to resume the music if we unmute\n      if (!this._isMusicMuted) {\n        sound.play(opts);\n      }\n    } else if (!this._areEffectsMuted) {\n      sound.play(opts);\n    }\n    return true;\n  };\n\n  this.pause = function (name) {\n    var sound = this.getSound(name);\n    if (!sound) {\n      return false;\n    }\n    // if muted and we pause current music, don't resume it on unmute\n    if (this._currentMusic === sound) {\n      this._currentMusic = null;\n    }\n    sound.pause();\n    return true;\n  };\n\n  this.stop = function (name) {\n    var sound = this.getSound(name);\n    if (!sound) {\n      return false;\n    }\n    // if muted and we pause current music, don't resume it on unmute\n    if (this._currentMusic === sound) {\n      this._currentMusic = null;\n    }\n    sound.stop();\n    return true;\n  };\n\n  this.isPaused = function (name) {\n    var sound = this.getSound(name);\n    if (!sound) {\n      return false;\n    }\n    return sound.isPaused();\n  };\n\n  this.isPlaying = function (name) {\n    var sound = this.getSound(name);\n    if (!sound) {\n      return false;\n    }\n    return sound.isPlaying();\n  };\n\n  // @deprecated\n  this.playBackgroundMusic = this.play;\n\n  // @deprecated\n  this.pauseBackgroundMusic = function () {\n    this._currentMusic && this._currentMusic.pause();\n  };\n});\n\n// expose a global mute function (GC.app.muteAll)\nexports.muteAll = function(mute) {\n  _muteAll = mute;\n  for (var i = 0, len = _registeredAudioManagers.length; i < len; i++) {\n    _registeredAudioManagers[i].setMuted(mute);\n  }\n};\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/sound/AudioLoader.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/sound/AudioLoader.js","friendlyPath":"ui.backend.sound.AudioLoader","directory":"modules/devkit-core/modules/timestep/src/ui/backend/sound/","filename":"AudioLoader.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar _ctx = null;\nvar _bufferMap = {};\nvar _loadingMap = {};\nvar _onLoadMap = {};\n\n/**\n * AudioContextLoader Class designed to work with HTML5 AudioContext\n */\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_sound_AudioLoader=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_sound_AudioLoader(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_sound_AudioLoader(){return this.init&&this.init.apply(this,arguments)},function () {\n  /**\n   * Requires an instance of AudioContext\n   */\n  this.init = function (opts) {\n    _ctx = opts.ctx;\n  };\n\n  /**\n   * Load audio files from a list of urls, call callback when all are loaded\n   */\n  this.load = function (urls, callback) {\n    var batch = {\n      fileCount: urls.length,\n      loadedCount: 0,\n      buffers: [],\n      callback: callback || function () {\n        logger.LOG&&console.log(\"LOG\",\"ui.backend.sound.AudioLoader\",\"Finished loading audio files:\", urls);\n      }\n    };\n\n    for (var i = 0, len = urls.length; i < len; i++) {\n      this._loadFile(urls[i], i, batch);\n    }\n  };\n\n  /*\n   * Private fn to react to buffer loading / errors; guarantees that preload\n   * callbacks get fired regardless of success so that nothing gets held up;\n   * however, does not call individual sound onload callbacks on errors\n   */\n  function onResponse (url, index, batch, buffer) {\n    if (!buffer) {\n      logger.ERROR&&console.error(\"ERROR\",\"ui.backend.sound.AudioLoader\",\"Error decoding audio file data:\", url);\n    } else {\n      batch.buffers[index] = _bufferMap[url] = buffer;\n      // on load callbacks for individual sounds\n      var cb = _onLoadMap[url];\n      if (cb) {\n        cb([buffer]);\n        _onLoadMap[url] = null;\n      }\n    }\n\n    _loadingMap[url] = false;\n    // batch callback for preloading, called regardless of success\n    if (++batch.loadedCount === batch.fileCount) {\n      batch.callback(batch.buffers);\n    }\n  };\n\n  /**\n   * Load an individual audio file asynchronously\n   */\n  this._loadFile = function (url, index, batch) {\n    var request = new XMLHttpRequest();\n    request.open(\"GET\", url, true);\n    request.responseType = \"arraybuffer\";\n    request.onload = function () {\n      _ctx.decodeAudioData(\n        request.response,\n        function (buffer) {\n          onResponse(url, index, batch, buffer);\n        },\n        function (e) {\n          logger.ERROR&&console.error(\"ERROR\",\"ui.backend.sound.AudioLoader\",\"Error with AudioContext decodeAudioData:\", (e && e.err) || e);\n          onResponse(url, index, batch, null);\n        }\n      );\n    };\n    request.onerror = function () {\n      logger.ERROR&&console.error(\"ERROR\",\"ui.backend.sound.AudioLoader\",\"Error with audio XHR on URL:\", url);\n      onResponse(url, index, batch, null);\n    };\n\n    _loadingMap[url] = true;\n    request.send();\n  };\n\n  this.getAudioContext = function () {\n    return _ctx;\n  };\n\n  this.setAudioContext = function (ctx) {\n    _ctx = ctx;\n  };\n\n  this.getBuffer = function (url) {\n    return _bufferMap[url] || null;\n  };\n\n  this.isLoading = function (url) {\n    return _loadingMap[url] || false;\n  };\n\n  this.doOnLoad = function (url, cb) {\n    if (this.isLoading(url)) {\n      _onLoadMap[url] = cb;\n    } else {\n      var buffer = this.getBuffer(url);\n      if (buffer) {\n        cb([buffer]);\n      } else {\n        this.load([url], cb);\n      }\n    }\n  };\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/canvas/filterRenderer.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/filterRenderer.js","friendlyPath":"ui.backend.canvas.filterRenderer","directory":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/","filename":"filterRenderer.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.backend.canvas.FilterRenderer;\n * Renders filter effects to a canvas. Manages filtered canvas caching.\n */\n\njsio('import cache.LRUCache as LRUCache');\njsio('import device');\n\nFilterRenderer=__class__;var FilterRenderer=FilterRenderer(function FilterRenderer(){return this.init&&this.init.apply(this,arguments)},function () {\n\n  var Canvas = null;\n  var noCacheCanvas = null;\n  var unusedCanvas = null;\n\n  var CACHE_SIZE = 1024;\n  var CACHE_FRAME_THRESHOLD = 3;\n\n  this.cache = new LRUCache(CACHE_SIZE);\n\n  var activeChecks = {};\n  var pendingChecks = {};\n  var currentFrame = 0;\n\n  var needsInitialization = true;\n\n  this.initialize = function() {\n    Canvas = device.get('Canvas');\n    noCacheCanvas = new Canvas({ useWebGL: CONFIG.useWebGL });\n    needsInitialization = false;\n    this.useCache = !device.isNative && !CONFIG.useWebGL;\n    this.useWebGL = CONFIG.useWebGL;\n    if (this.useCache) {\n      // If we're using canvas caching, set up the tick subscription\n      jsio('import ui.Engine').get().subscribe('Tick', this, this.onTick);\n    }\n  };\n\n  this.onTick = function(dt) {\n    currentFrame++;\n    activeChecks = pendingChecks;\n    pendingChecks = {};\n  };\n\n  this.renderFilter = function (ctx, srcImg, srcX, srcY, srcW, srcH) {\n    if (needsInitialization) { this.initialize(); }\n    var filter = ctx.filter;\n    var filterName = filter && filter.getType && filter.getType();\n\n    // Ugly hack, but WebGL still needs this class, for now, for masking.\n    // The other filters are handled by the WebGL context itself.\n    var filterNotSupported = this.useWebGL && filterName !== \"NegativeMask\" && filterName !== \"PositiveMask\";\n    if (!filter || filterNotSupported || !filter.getType) { return null; }\n\n    if (this.useCache) {\n      var cacheKey = this.getCacheKey(srcImg.getURL(), srcX, srcY, srcW, srcH, filter);\n      var resultImg = this.cache.get(cacheKey);\n      if (resultImg) { return resultImg; }\n    }\n\n    var shouldCache = this.useCache && this.testShouldCache(cacheKey);\n    if (shouldCache) {\n      resultImg = this.getCanvas(srcW, srcH);\n    } else {\n      resultImg = noCacheCanvas;\n      resultImg.width = srcW;\n      resultImg.height = srcH;\n    }\n\n    switch (filterName) {\n      case \"LinearAdd\":\n        this.renderColorFilter(ctx, srcImg, srcX, srcY, srcW, srcH, filter, 'lighter', resultImg);\n        break;\n\n      case \"Tint\":\n        this.renderColorFilter(ctx, srcImg, srcX, srcY, srcW, srcH, filter, 'source-over', resultImg);\n        break;\n\n      case \"Multiply\":\n        this.renderMultiply(ctx, srcImg, srcX, srcY, srcW, srcH, filter, resultImg);\n        break;\n\n      case \"NegativeMask\":\n        this.renderMask(ctx, srcImg, srcX, srcY, srcW, srcH, filter.getMask(), 'source-in', resultImg);\n        break;\n\n      case \"PositiveMask\":\n        this.renderMask(ctx, srcImg, srcX, srcY, srcW, srcH, filter.getMask(), 'source-out', resultImg);\n        break;\n    }\n\n    if (shouldCache) {\n      var removedEntry = this.cache.put(cacheKey, resultImg);\n      unusedCanvas = removedEntry ? removedEntry.value : null;\n    }\n\n    return resultImg;\n  };\n\n  this.testShouldCache = function(key) {\n    var checkFrame = pendingChecks[key] = activeChecks[key] || currentFrame;\n    return (currentFrame - checkFrame) > CACHE_FRAME_THRESHOLD;\n  };\n\n\n  this.renderColorFilter = function (ctx, srcImg, srcX, srcY, srcW, srcH, filter, op, destCanvas) {\n    var result = destCanvas;\n    var resultCtx = result.getContext('2d');\n    // render the base image\n    resultCtx.globalCompositeOperation = 'source-over';\n    srcImg.render(resultCtx, srcX, srcY, srcW, srcH, 0, 0, srcW, srcH);\n    // render the filter color\n    resultCtx.globalCompositeOperation = op;\n    resultCtx.fillStyle = filter.getColorString();\n    resultCtx.fillRect(0, 0, srcW, srcH);\n    // use our base image to cut out the image shape from the rect\n    resultCtx.globalCompositeOperation = 'destination-in';\n    srcImg.render(resultCtx, srcX, srcY, srcW, srcH, 0, 0, srcW, srcH);\n    return result;\n  };\n\n  this.renderMultiply = function(ctx, srcImg, srcX, srcY, srcW, srcH, filter, destCanvas) {\n    var color = filter.get();\n    var result = destCanvas;\n    var resultCtx = result.getContext('2d');\n    var imgData = srcImg.getImageData(srcX, srcY, srcW, srcH);\n    var data = imgData.data;\n    // simplified multiply math outside of the massive for loop\n    var a = color.a;\n    var mr = 1 + a * ((color.r / 255) - 1);\n    var mg = 1 + a * ((color.g / 255) - 1);\n    var mb = 1 + a * ((color.b / 255) - 1);\n    for (var i = 0, len = data.length; i < len; i += 4) {\n      data[i] *= mr;\n      data[i + 1] *= mg;\n      data[i + 2] *= mb;\n    }\n    // put the updated rgb data into our new canvas\n    resultCtx.putImageData(imgData, 0, 0);\n    return result;\n  };\n\n  this.renderMask = function (ctx, srcImg, srcX, srcY, srcW, srcH, mask, op, destCanvas) {\n    var result = destCanvas;\n    var resultCtx = result.getContext('2d');\n    // render the mask image\n    var srcMaskX = mask.getSourceX();\n    var srcMaskY = mask.getSourceY();\n    var srcMaskW = mask.getSourceW();\n    var srcMaskH = mask.getSourceH();\n    resultCtx.globalCompositeOperation = 'source-over';\n    mask.render(resultCtx, srcMaskX, srcMaskY, srcMaskW, srcMaskH, 0, 0, srcW, srcH);\n    // render the base image\n    resultCtx.globalCompositeOperation = op;\n    srcImg.render(resultCtx, srcX, srcY, srcW, srcH, 0, 0, srcW, srcH);\n    return result;\n  };\n\n  this.clearCache = function () {\n    this.cache.removeAll();\n  };\n\n  this.getCacheKey = function(url, srcX, srcY, srcW, srcH, filter) {\n    var filterType = filter && filter.getType && filter.getType();\n    var suffix;\n    if (filterType === 'NegativeMask' || filterType === 'PositiveMask') {\n      suffix = filter.getMask().getURL();\n    } else {\n      var color = filter.get();\n      var alpha = (color.a * 255) & 0xff;\n      suffix = \"\" + alpha + \"|\" + color.r + \"|\" + color.g + \"|\" + color.b;\n    }\n    var cacheKey = filterType + \"|\" + url + \"|\" + srcX + \"|\" + srcY + \"|\" + srcW + \"|\" + srcH + \"|\" + suffix;\n    return cacheKey;\n  };\n\n  this.getCanvas = function(width, height) {\n    var result;\n    if (unusedCanvas) {\n      result = unusedCanvas;\n      result.width = width;\n      result.height = height;\n      unusedCanvas = null;\n    } else {\n      result = new Canvas({ width: width, height: height });\n    }\n    return result;\n  };\n\n});\n\nexports = new FilterRenderer();\n","pre":true},"modules/devkit-core/modules/timestep/src/cache/LRUCache.js":{"path":"modules/devkit-core/modules/timestep/src/cache/LRUCache.js","friendlyPath":"cache.LRUCache","directory":"modules/devkit-core/modules/timestep/src/cache/","filename":"LRUCache.js","baseMod":"cache","basePath":"/Users/marcelo.hashimoto/Desktop/gamedev/ElementalMatch3/modules/devkit-core/modules/timestep/src/cache","src":"/**\n* Copyright (c) 2010 Rasmus Andersson http://hunch.se/\n*\n* MIT LICENSE\n*\n* Permission is hereby granted, free of charge, to any person obtaining a copy of\n* this software and associated documentation files (the \"Software\"), to deal in the\n* Software without restriction, including without limitation the rights to use, copy,\n* modify, merge, publish, distribute, sublicense, and/or sell copies of the Software,\n* and to permit persons to whom the Software is furnished to do so, subject to the\n* following conditions:\n*\n* The above copyright notice and this permission notice shall be included in all\n* copies or substantial portions of the Software.\n*\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\n* FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\n* COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN\n* AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\n* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n * A doubly linked list-based Least Recently Used (LRU) cache. Will keep most\n * recently used items while discarding least recently used items when its limit\n * is reached.\n *\n * Illustration of the design:\n *\n *       entry             entry             entry             entry\n *       ______            ______            ______            ______\n *      | head |.newer => |      |.newer => |      |.newer => | tail |\n *      |  A   |          |  B   |          |  C   |          |  D   |\n *      |______| <= older.|______| <= older.|______| <= older.|______|\n *\n *  removed  <--  <--  <--  <--  <--  <--  <--  <--  <--  <--  <--  added\n */\nvar LRUCache = function(limit) {\n  // Current size of the cache. (Read-only).\n  this.size = 0;\n  // Maximum number of items this cache can hold.\n  this.limit = limit;\n  this._keymap = {};\n}\n\n/**\n * Put <value> into the cache associated with <key>. Returns the entry which was\n * removed to make room for the new entry. Otherwise undefined is returned\n * (i.e. if there was enough room already).\n */\nLRUCache.prototype.put = function(key, value) {\n  var entry = {key:key, value:value};\n  // Note: No protection agains replacing, and thus orphan entries. By design.\n  this._keymap[key] = entry;\n  if (this.tail) {\n    // link previous tail to the new tail (entry)\n    this.tail.newer = entry;\n    entry.older = this.tail;\n  } else {\n    // we're first in -- yay\n    this.head = entry;\n  }\n  // add new entry to the end of the linked list -- it's now the freshest entry.\n  this.tail = entry;\n  if (this.size === this.limit) {\n    // we hit the limit -- remove the head\n    return this.shift();\n  } else {\n    // increase the size counter\n    this.size++;\n  }\n};\n\n/**\n * Purge the least recently used (oldest) entry from the cache. Returns the\n * removed entry or undefined if the cache was empty.\n *\n * If you need to perform any form of finalization of purged items, this is a\n * good place to do it. Simply override/replace this function:\n *\n *   var c = new LRUCache(123);\n *   c.shift = function() {\n *     var entry = LRUCache.prototype.shift.call(this);\n *     doSomethingWith(entry);\n *     return entry;\n *   }\n */\nLRUCache.prototype.shift = function() {\n  // todo: handle special case when limit == 1\n  var entry = this.head;\n  if (entry) {\n    if (this.head.newer) {\n      this.head = this.head.newer;\n      this.head.older = undefined;\n    } else {\n      this.head = undefined;\n    }\n    // Remove last strong reference to <entry> and remove links from the purged\n    // entry being returned:\n    entry.newer = entry.older = undefined;\n    // delete is slow, but we need to do this to avoid uncontrollable growth:\n    delete this._keymap[entry.key];\n  }\n  return entry;\n};\n\n/**\n * Get and register recent use of <key>. Returns the value associated with <key>\n * or undefined if not in cache.\n */\nLRUCache.prototype.get = function(key, returnEntry) {\n  // First, find our cache entry\n  var entry = this._keymap[key];\n  if (entry === undefined) return; // Not cached. Sorry.\n  // As <key> was found in the cache, register it as being requested recently\n  if (entry === this.tail) {\n    // Already the most recenlty used entry, so no need to update the list\n    return returnEntry ? entry : entry.value;\n  }\n  // HEAD--------------TAIL\n  //   <.older   .newer>\n  //  <--- add direction --\n  //   A  B  C  <D>  E\n  if (entry.newer) {\n    if (entry === this.head)\n      this.head = entry.newer;\n    entry.newer.older = entry.older; // C <-- E.\n  }\n  if (entry.older)\n    entry.older.newer = entry.newer; // C. --> E\n  entry.newer = undefined; // D --x\n  entry.older = this.tail; // D. --> E\n  if (this.tail)\n    this.tail.newer = entry; // E. <-- D\n  this.tail = entry;\n  return returnEntry ? entry : entry.value;\n};\n\n// ----------------------------------------------------------------------------\n// Following code is optional and can be removed without breaking the core\n// functionality.\n\n/**\n * Check if <key> is in the cache without registering recent use. Feasible if\n * you do not want to chage the state of the cache, but only \"peek\" at it.\n * Returns the entry associated with <key> if found, or undefined if not found.\n */\nLRUCache.prototype.find = function(key) {\n  return this._keymap[key];\n};\n\n/**\n * Update the value of entry with <key>. Returns the old value, or undefined if\n * entry was not in the cache.\n */\nLRUCache.prototype.set = function(key, value) {\n  var oldvalue, entry = this.get(key, true);\n  if (entry) {\n    oldvalue = entry.value;\n    entry.value = value;\n  } else {\n    oldvalue = this.put(key, value);\n    if (oldvalue) oldvalue = oldvalue.value;\n  }\n  return oldvalue;\n};\n\n/**\n * Remove entry <key> from cache and return its value. Returns undefined if not\n * found.\n */\nLRUCache.prototype.remove = function(key) {\n  var entry = this._keymap[key];\n  if (!entry) return;\n  delete this._keymap[entry.key]; // need to do delete unfortunately\n  if (entry.newer && entry.older) {\n    // relink the older entry with the newer entry\n    entry.older.newer = entry.newer;\n    entry.newer.older = entry.older;\n  } else if (entry.newer) {\n    // remove the link to us\n    entry.newer.older = undefined;\n    // link the newer entry to head\n    this.head = entry.newer;\n  } else if (entry.older) {\n    // remove the link to us\n    entry.older.newer = undefined;\n    // link the newer entry to head\n    this.tail = entry.older;\n  } else {// if(entry.older === undefined && entry.newer === undefined) {\n    this.head = this.tail = undefined;\n  }\n\n  this.size--;\n  return entry.value;\n};\n\n/** Removes all entries */\nLRUCache.prototype.removeAll = function() {\n  // This should be safe, as we never expose strong refrences to the outside\n  this.head = this.tail = undefined;\n  this.size = 0;\n  this._keymap = {};\n};\n\n/**\n * Return an array containing all keys of entries stored in the cache object, in\n * arbitrary order.\n */\nif (typeof Object.keys === 'function') {\n  LRUCache.prototype.keys = function() { return Object.keys(this._keymap); };\n} else {\n  LRUCache.prototype.keys = function() {\n    var keys = [];\n    for (var k in this._keymap) keys.push(k);\n    return keys;\n  };\n}\n\n/**\n * Call `fun` for each entry. Starting with the newest entry if `desc` is a true\n * value, otherwise starts with the oldest (head) enrty and moves towards the\n * tail.\n *\n * `fun` is called with 3 arguments in the context `context`:\n *   `fun.call(context, Object key, Object value, LRUCache self)`\n */\nLRUCache.prototype.forEach = function(fun, context, desc) {\n  var entry;\n  if (context === true) { desc = true; context = undefined; }\n  else if (typeof context !== 'object') context = this;\n  if (desc) {\n    entry = this.tail;\n    while (entry) {\n      fun.call(context, entry.key, entry.value, this);\n      entry = entry.older;\n    }\n  } else {\n    entry = this.head;\n    while (entry) {\n      fun.call(context, entry.key, entry.value, this);\n      entry = entry.newer;\n    }\n  }\n};\n\n/** Returns a JSON (array) representation */\nLRUCache.prototype.toJSON = function() {\n  var s = [], entry = this.head;\n  while (entry) {\n    s.push({key:entry.key.toJSON(), value:entry.value.toJSON()});\n    entry = entry.newer;\n  }\n  return s;\n};\n\n/** Returns a String representation */\nLRUCache.prototype.toString = function() {\n  var s = '', entry = this.head;\n  while (entry) {\n    s += String(entry.key)+':'+entry.value;\n    entry = entry.newer;\n    if (entry)\n      s += ' < ';\n  }\n  return s;\n};\n\nexports = LRUCache;","pre":true},"modules/devkit-core/modules/timestep/src/ui/resource/ImageViewCache.js":{"path":"modules/devkit-core/modules/timestep/src/ui/resource/ImageViewCache.js","friendlyPath":"ui.resource.ImageViewCache","directory":"modules/devkit-core/modules/timestep/src/ui/resource/","filename":"ImageViewCache.js","src":"jsio('import .Image');\n\n// cache of Images for ImageView and ImageScaleView\nexports.cache = {};\n\nexports.clear = function () {\n  exports.cache = {};\n}\n\nexports.getImage = function (url, forceReload) {\n  var img;\n  if (!forceReload) {\n    img = exports.cache[url];\n  }\n\n  if (!img) {\n    img = exports.cache[url] = new Image({\n      url: url,\n      forceReload: !!forceReload\n    });\n  }\n\n  return img;\n};\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/canvas/TextView.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/TextView.js","friendlyPath":".backend.canvas.TextView","directory":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/","filename":"TextView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * package ui.backend.canvas.TextView;\n *\n * canvas.TextView implementation.\n */\n\njsio('import ui.View as View');\njsio('import ui.resource.Image as Image');\njsio('import device');\njsio('import .util.FragmentBuffer as FragmentBuffer');\njsio('import .TextFlow');\n\njsio('import ...legacySettings as legacySettings');\n\nvar messageFont = true; // Report first font error message\n\nvar textViewID = 1;\n\n/**\n * @extends ui.View\n */\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_TextView=__class__;var TextView = exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_TextView(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_TextView(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n\n  var DEPRECATED = {\n    multiline: { replacement: \"wrap\" },\n    textAlign: { replacement: \"horizontalAlign\" },\n    lineWidth: { replacement: \"strokeWidth\" },\n    strokeStyle: { replacement: \"strokeColor\" },\n    outlineColor: { replacement: \"strokeColor\" }\n  };\n\n  var defaults = {\n    // layout properties...\n    wrap: false,\n    autoSize: false,\n    autoFontSize: true,\n    lineHeight: 1.2,\n\n    // font properties...\n    color: \"#000000\",\n    fontFamily: device.defaultFontFamily,\n    fontWeight: device.defaultFontWeight,\n    size: 128,\n    strokeWidth: 2,\n    shadowWidth: 2,\n    strokeColor: null,\n    shadowColor: null,\n\n    // alignment properties...\n    verticalAlign: \"middle\",\n    horizontalAlign: \"center\",\n\n    // misc properties...\n    buffer: false, // GLOBAL.NATIVE && !device.simulatingMobileNative,\n    backgroundColor: ''\n  };\n\n  var clearCache = {\n    // basic widget properties...\n    width: true,\n    height: true,\n\n    // layout properties...\n    wrap: true,\n    autoSize: true,\n    autoFontSize: true,\n    padding: true,\n    lineHeight: true,\n\n    // font properties...\n    color: false,\n    fontFamily: true,\n    fontWeight: true,\n    size: true,\n    strokeWidth: true,\n    shadowWidth: true,\n    strokeColor: false,\n    shadowColor: false,\n\n    // alignment properties...\n    verticalAlign: true,\n    horizontalAlign: true,\n\n    // misc properties...\n    backgroundColor: false,\n    text: true\n  };\n  var clearCacheKeys = Object.keys(clearCache);\n\n  var hashItems = {\n    // font properties...\n    color: true,\n    fontFamily: true,\n    fontWeight: true,\n    size: true,\n    strokeWidth: true,\n    shadowWidth: true,\n    strokeColor: false,\n    shadowColor: false,\n\n    // misc properties...\n    backgroundColor: true,\n    text: true\n  };\n  var hashItemsKeys = Object.keys(hashItems);\n\n  var savedOpts = [\n    \"width\",\n    \"height\",\n    \"size\"\n  ];\n\n  var fontBuffer = new FragmentBuffer();\n\n  fontBuffer.onGetHash = function (desc) {\n    return desc.textView.getHash();\n  };\n\n  this.init = function (opts) {\n    this._opts = {};\n    this._optsLast = {};\n    this.updateCache();\n\n    this._textFlow = new TextFlow({target: this});\n    this._textFlow.subscribe(\"ChangeWidth\", this, \"onChangeWidth\");\n    this._textFlow.subscribe(\"ChangeHeight\", this, \"onChangeHeight\");\n    this._textFlow.subscribe(\"ChangeSize\", this, \"onChangeSize\");\n\n    supr(this, 'init', [merge(opts, defaults)]);\n\n    this._id = textViewID++;\n  };\n\n  this.onChangeWidth = function (width) {\n    this.updateOpts({width: width}, true);\n  };\n\n  this.onChangeHeight = function (height) {\n    this.updateOpts({height: height}, true);\n  };\n\n  this.onChangeSize = function (size, ctx) {\n    this.updateOpts({size: size}, true);\n    if (ctx) {\n      ctx.font = this._opts.fontWeight + \" \" + this._opts.size + \"px \" + this._opts.fontFamily;\n    }\n  };\n\n  // These options might have been changed to make the text fit, restore them...\n  this._restoreOpts = function () {\n    var optsLast = this._optsLast;\n    var optsKey;\n    var i = savedOpts.length;\n    while (i) {\n      optsKey = savedOpts[--i];\n      if (optsKey in optsLast) {\n        this._opts[optsKey] = optsLast[optsKey];\n      }\n    }\n  };\n\n  // Check if the cache should be updated...\n  this._checkOpts = function (opts) {\n    var optsLast = this._optsLast;\n    var optsKey;\n    var i = clearCacheKeys.length;\n\n    this._cacheUpdate = this._cacheUpdate || !Object.keys(this._opts).length;\n    if (this._cacheUpdate) {\n      this._hash = false;\n    }\n    while (i) {\n      optsKey = clearCacheKeys[--i];\n      if ((optsKey in opts) && clearCache[optsKey] && (optsLast[optsKey] !== opts[optsKey])) {\n        this._cacheUpdate = true;\n      }\n      if (optsKey in opts) {\n        optsLast[optsKey] = opts[optsKey];\n      } else if (optsKey in this._opts) {\n        optsLast[optsKey] = this._opts[optsKey];\n      } else {\n        optsLast[optsKey] = defaults[optsKey];\n      }\n    }\n  };\n\n  this._checkDeprecatedOpts = function (opts) {\n    opts.allowVerticalSizing = !legacySettings.disableVerticalAutoSize;\n    for (var k in DEPRECATED) {\n      if (k in opts) {\n        var dep = DEPRECATED[k];\n        if (DEBUG && !dep.hasWarned) {\n          console.warn(\"TextView opts.\" + k + \" is deprecated, please use \" + dep.replacement + \"...\");\n          dep.hasWarned = true;\n        }\n        opts[dep.replacement] = opts[k];\n      }\n    }\n    var font = opts.font;\n    if (font) {\n      if (DEBUG && messageFont) {\n        console.warn(\"TextView opts.font is deprecated, please use fontFamily and size...\");\n        messageFont = false;\n      }\n      while (font.length && (font[0] === \" \")) {\n        font = font.substr(1 - font.length);\n      }\n      var i = font.indexOf(' ');\n      if (i !== -1) {\n        opts.size = parseInt(font.substr(0, i).replace(/[pxtem\\s]/gi, \"\"), 10);\n        opts.fontFamily = font.substr(i + 1 - font.length);\n      }\n    }\n  };\n\n  this.updateCache = function () {\n    this._cacheUpdate = true;\n    this._hash = false;\n  };\n\n  this.updateOpts = function (opts, dontCheck) {\n    // update emoticon data\n    if (opts.emoticonData) {\n      for (var key in opts.emoticonData.data) {\n        var data = opts.emoticonData.data[key];\n        if (!data.image) {\n          data.image = new Image({url: data.url});\n        }\n      }\n    }\n\n    if (this._opts.buffer) {\n      fontBuffer.releaseBin(this.getHash());\n    }\n    this.updateCache();\n\n    this._checkDeprecatedOpts(opts);\n\n    if (!dontCheck) {\n      this._restoreOpts();\n      this._checkOpts(opts);\n      if (this._cacheUpdate) {\n        opts.hash = false;\n      } else {\n        supr(this, \"updateOpts\", arguments);\n        return;\n      }\n    }\n\n    opts = supr(this, \"updateOpts\", arguments);\n\n    (\"text\" in opts) && this.setText(opts.text);\n    !dontCheck && this._textFlow.setOpts(this._opts);\n\n    return opts;\n  };\n\n  this._updateCtx = function (ctx) {\n    var opts = this._opts;\n\n    ctx.textAlign = \"left\";\n    ctx.textBaseline = \"top\";\n    ctx.fillStyle = opts.color;\n    ctx.font = opts.fontWeight + \" \" + opts.size + \"px \" + opts.fontFamily;\n    ctx.lineWidth = this.getStrokeWidth();\n  };\n\n  this._renderToCtx = function (ctx, offsetX, offsetY) {\n    var opts = this._opts;\n    var words = this._textFlow.getWords();\n    var maxWidth = opts.autoFontSize ? this._textFlow.getAvailableWidth() : 1000000;\n    var item;\n    var word;\n    var color = opts.color;\n    var strokeColor = opts.strokeColor;\n    var shadowColor = opts.shadowColor;\n    var lineOffset = this.getStrokeWidth() / 2;\n    var x, y;\n    var i = words.length;\n\n    if (legacySettings.textViewColor && this.color) {\n      color = this.color;\n    }\n\n    this._updateCtx(ctx);\n\n    while (i) {\n      item = words[--i];\n      word = item.word;\n\n      x = offsetX + item.x;\n      y = offsetY + item.y;\n\n      var emoticonData = (word[0] == '(') && opts.emoticonData && opts.emoticonData.data[word];\n      if (emoticonData) {\n        //ctx.fillStyle = color;\n        //ctx.fillRect(x + lineOffset, y + lineOffset, opts.size, opts.size);\n        if (emoticonData.image) {\n          emoticonData.image.render(ctx, x + lineOffset, y + lineOffset, opts.size, opts.size);\n        }\n\n      } else {\n        if (shadowColor) {\n          var shadowOffsetX = this._opts.shadowWidth || 0;\n          var shadowOffsetY = this._opts.shadowWidth || 0;\n          if ('shadowDx' in this._opts || 'shadowDy' in this._opts) {\n            var shadowOffsetX = this._opts.shadowDx | 0;\n            var shadowOffsetY = this._opts.shadowDy | 0;\n          }\n          var hasShadowOpacity = 'shadowOpacity' in this._opts;\n          var oldOpacity = ctx.globalAlpha;\n          if (hasShadowOpacity) {\n            ctx.globalAlpha *= this._opts.shadowOpacity;\n          }\n          if (strokeColor) {\n            ctx.strokeStyle = shadowColor;\n            ctx.strokeText(word, x + lineOffset + shadowOffsetX, y + lineOffset + shadowOffsetY, maxWidth);\n          } else {\n            ctx.fillStyle = shadowColor;\n            ctx.fillText(word, x + lineOffset + shadowOffsetX, y + lineOffset + shadowOffsetY, maxWidth);\n          }\n          if (hasShadowOpacity) {\n            ctx.globalAlpha = oldOpacity;\n          }\n        }\n\n        if (strokeColor) {\n          ctx.strokeStyle = strokeColor;\n          ctx.strokeText(word, x + lineOffset, y + lineOffset, maxWidth);\n        }\n\n        ctx.fillStyle = color;\n        ctx.fillText(word, x + lineOffset, y + lineOffset, maxWidth);\n      }\n    }\n    if (this._opts.debug) {\n      ctx.strokeStyle = 'black';\n      ctx.strokeRect(x, y, item.width, this.style.height - 2 * y);\n      ctx.strokeStyle = 'red';\n      ctx.strokeRect(0, 0, this.style.width, this.style.height);\n    }\n  };\n\n  this._renderBuffer = function (ctx) {\n    var fontBufferCtx = fontBuffer.getContext();\n    var offsetRect = this._textFlow.getOffsetRect();\n    var width = offsetRect.width;\n    var height = offsetRect.height;\n    var words = this._textFlow.getWords();\n    var desc;\n\n    if (width && height) {\n      this._opts.lineCount = words[words.length - 1].line;\n      offsetRect.text = this._opts.text;\n      offsetRect.textView = this;\n      // When we support clearing offscreen buffers then this line can be activated instead of the next one...\n      // desc = fontBuffer.getPositionForText(offsetRect) || fontBuffer.getPositionForText(offsetRect);\n      desc = fontBuffer.getPositionForText(offsetRect);\n      if (desc != null) {\n        if (this._cacheUpdate) {\n          fontBufferCtx.clearRect(desc.x, desc.y, desc.width, desc.height);\n          this._renderToCtx(fontBufferCtx, desc.x - offsetRect.x, desc.y - offsetRect.y);\n        }\n        ctx.drawImage(fontBuffer.getCanvas(), desc.x, desc.y, width, height, offsetRect.x, offsetRect.y, width, height);\n      } else {\n        this._opts.buffer = false;\n      }\n    }\n  };\n\n  this.computeSize = function (ctx) {\n    if (this._cacheUpdate) {\n      this._updateCtx(ctx);\n      var opts = this._opts;\n      this._textFlow.reflow(ctx, 1 + (opts.autoFontSize ? 4 : 0) + (opts.autoSize ? 2 : 0) + (opts.wrap ? 1 : 0));\n    }\n  }\n\n  this.render = function (ctx) {\n    this.computeSize(ctx);\n    if (!this._textFlow.getWords().length) {\n      this._cacheUpdate = false;\n      return;\n    }\n\n    if (this._opts.buffer) {\n      this._renderBuffer(ctx);\n    } else {\n      var strokeWidthOffset = -this.getStrokeWidth()/2;\n      this._renderToCtx(ctx, strokeWidthOffset, strokeWidthOffset);\n    }\n\n    this._cacheUpdate = false;\n  };\n\n  this.clearBuffers = function () {\n    fontBuffer.clearBuffer();\n  };\n\n  this.getFontBuffer = function () {\n    return fontBuffer;\n  };\n\n  this.setText = function (textData) {\n    var text = (textData != undefined) ? textData.toString() : \"\";\n\n    var emoticonData = this._opts.emoticonData;\n    if (emoticonData) {\n      for (var key in emoticonData.map) {\n        var re = new RegExp(key.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&'), 'g');\n        text = text.replace(re, emoticonData.map[key]);\n      }\n    }\n\n    if (this._opts.text !== text) {\n      if (this._opts.buffer) {\n        fontBuffer.releaseBin(this.getHash());\n      }\n\n      this._restoreOpts();\n      this._opts.text = text;\n      this.updateCache();\n      this.needsRepaint();\n    }\n  };\n\n  this.getStrokeWidth = function () {\n    return this._opts.strokeColor ? this._opts.strokeWidth : 0;\n  };\n\n  this.getText = function () {\n    return this._opts.text;\n  };\n\n  this.getTag = function () {\n    return \"TextView\" + this.uid + \":\" + (this.tag || (this._opts.text || \"\").substring(0, 20));\n  };\n\n  this.getOpts = function () {\n    return this._opts;\n  };\n\n  this.getHash = function () {\n    if (!this._hash) {\n      this._hash = \"\";\n\n      var opts = this._opts;\n      var i = hashItemsKeys.length;\n      while (i) {\n        this._hash += opts[hashItemsKeys[--i]];\n      }\n    }\n    return this._hash;\n\n    // When we support clearing offscreen buffers we can use this instead of the code above...\n    // return 't' + this._id;\n  };\n\n  this.reflow = function () {\n    this._restoreOpts();\n    this._cacheUpdate = true;\n  };\n});\n\nexports.clearBuffers = TextView.prototype.clearBuffers;\nexports.getFontBuffer = TextView.prototype.getFontBuffer;\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/canvas/util/FragmentBuffer.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/util/FragmentBuffer.js","friendlyPath":".util.FragmentBuffer","directory":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/util/","filename":"FragmentBuffer.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import device');\njsio('import .FragmentBin');\njsio('import .SortedLinkedList as SortedList');\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_util_FragmentBuffer=__class__;var FragmentBuffer = exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_util_FragmentBuffer(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_util_FragmentBuffer(){return this.init&&this.init.apply(this,arguments)},function () {\n  var debug = false;\n  this.init = function (opts) {\n    this.opts = merge(opts, {});\n    this._cache = {};\n    this._decriptions = [];\n    window.addEventListener('pageshow', bind(this, 'clearBuffer'), false);\n  };\n\n  var sort = function (a, b) {\n    return a.size() > b.size();\n  };\n\n  this._build = function () {\n      var Canvas = device.get('Canvas');\n        this._canvas = new Canvas({width: 1024, height: 1024});\n        this._ctx = this.getCanvas().getContext('2d', bind(this, function() {\n      logger.LOG&&console.log(\"LOG\",\".util.FragmentBuffer\",\"{fragment-buffer} Reacting to lost canvas by clearing text buffer\");\n      // On canvas loss:\n      this._canvas = null;\n      this.clearBuffer();\n    }));\n    this._ctx.clearRect(0, 0, 1024, 1024);\n    this._ctx.textAlign = 'left';\n    this._ctx.textBaseline = 'middle';\n    this._ctx.globalCompositeOperation = 'source-over';\n    this._binList = new SortedList(sort);\n    var head = new FragmentBin({\n      x: 0,\n      y: 0,\n      width: 1024,\n      height: 1024\n    });\n    this._binList.insert(head);\n    debug && window.open().document.body.appendChild(this._canvas);\n  };\n\n  this.getCanvas = function () {\n    if (!this._canvas) {\n      this._build();\n    }\n    return this._canvas;\n  };\n\n  this.getContext = function () {\n    if (!this._ctx) {\n      this._build();\n    }\n    return this._ctx;\n  };\n\n  this.onGetHash = function (description) {\n    throw Error('onGetHash should be implemented.');\n  };\n\n  var randomColor = function () {\n    var color = 'rgba(' +\n          (Math.random()*255).toFixed() + ',' +\n          (Math.random()*255).toFixed() + ',' +\n          (Math.random()*255).toFixed() + ',' +\n          '1)';\n    return color;\n  };\n\n  this._insertText = function (description) {\n    var width = Math.ceil(description.width) + 1;\n    var height = Math.ceil(description.height) + 1;\n    var iter = this._binList.iterator();\n    var bin = null;\n    var found = false;\n    while (iter.hasNext() && !found) {\n      bin = iter.next();\n      if (!bin.filled && bin.width >= width && bin.height >= height) {\n        found = true;\n      } else {\n        //we don't want to insert in filled bins\n        bin = null;\n      }\n    }\n    if (bin) {\n      newBins = bin.split(width, height);\n      for (var i = 0; i < newBins.length; i++) {\n        this._binList.insert(newBins[i]);\n      }\n    } else {\n      logger.LOG&&console.log(\"LOG\",\".util.FragmentBuffer\",'buffer full, further TextViews will not be cached');\n      // When we support clearing buffers then this should be enabled again...\n      // this.clearBuffer();\n    }\n\n    return bin;\n  };\n\n  /**\n  * debugging code to verify overlapping bins aren't created.\n  */\n  var rectIntersectsRect = function (r1, r2) {\n    var ax1 = r1.x;\n    var ax2 = r1.x + r1.width;\n    var ay1 = r1.y;\n    var ay2 = r1.y + r1.height;\n    var bx1 = r2.x;\n    var bx2 = r2.x + r2.width;\n    var by1 = r2.y;\n    var by2 = r2.y + r2.height;\n    return ax1 < bx2 && ax2 > bx1 && ay1 < by2 && ay2 > by1;\n  };\n\n  var debugCheck = function (bin, list) {\n    if (!bin) { return;}\n    var iter = list.iterator();\n    var ok = true;\n    while (iter.hasNext() && ok) {\n      var next = iter.next();\n      ok = next == bin || !rectIntersectsRect(next, bin);\n      if (!ok) {\n        logger.ERROR&&console.error(\"ERROR\",\".util.FragmentBuffer\",'rect overlaps');\n        logger.ERROR&&console.error(\"ERROR\",\".util.FragmentBuffer\",iter.current(), bin);\n      }\n    }\n  };\n\n  this.getPositionForText = function (description) {\n    var hash = this.onGetHash(description);\n    var width = Math.ceil(description.width) + 1;\n\n    if (!this._cache[hash] && width > 0) {\n      this._cache[hash] = this._insertText(description, false);\n      this._decriptions.push(description);\n    }\n    if (debug && false) {\n      debugCheck(description, this._binList);\n    }\n    return this._cache[hash];\n  };\n\n  this.releaseBin = function (hash) {\n    if (this._cache[hash]) {\n      // When we support clearin buffers then this should be enabled again...\n      // this._cache[hash].filled = false;\n      // delete this._cache[hash];\n    }\n  };\n\n  this.clearBuffer = function () {\n    this._cache = {};\n    this._binList = new SortedList(sort);\n    this._binList.insert(new FragmentBin({\n      x: 0,\n      y: 0,\n      width: 1024,\n      height: 1024\n    }));\n    this._ctx && this._ctx.clearRect(0, 0, 1024, 1024);\n    while (this._decriptions.length) {\n      this._decriptions.pop().textView.updateCache();\n    }\n  };\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/canvas/util/FragmentBin.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/util/FragmentBin.js","friendlyPath":".FragmentBin","directory":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/util/","filename":"FragmentBin.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * TextBins are used in the FragmentBuffer caching of TextViews.\n **/\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_util_FragmentBin=__class__;var FragmentBin = exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_util_FragmentBin(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_util_FragmentBin(){return this.init&&this.init.apply(this,arguments)},'TextBin', function (logger, supr) {\n  this.init = function (opts) {\n    this.width = opts.width;\n    this.height = opts.height;\n    this.x = opts.x;\n    this.y = opts.y;\n  };\n\n  this.size = function () {\n    return this.width * this.height;\n  };\n\n  this.split = function (x, y) {\n    var newBins = [this];\n    if (this.width > 10 && this.height > 10) {\n      if (this.height - y > 10) {\n        var bin1 = new FragmentBin({\n          x: this.x,\n          y: this.y + y,\n          width: this.width,\n          height: this.height - y\n        });\n        newBins.push(bin1);\n      }\n      if (this.width - x > 10) {\n        var bin2 = new FragmentBin({\n          x: this.x + x,\n          y: this.y,\n          width: this.width - x,\n          height: y\n        });\n        newBins.push(bin2);\n      }\n    }\n    this.width = x;\n    this.height = y;\n    this.filled = true;\n\n    return newBins;\n  };\n});","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/canvas/util/SortedLinkedList.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/util/SortedLinkedList.js","friendlyPath":".SortedLinkedList","directory":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/util/","filename":"SortedLinkedList.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nIterator=__class__;var Iterator=Iterator(function Iterator(){return this.init&&this.init.apply(this,arguments)},'Iterator', function (logger, supr) {\n  this.init = this.update = function (list) {\n    this._list = list || this._list;\n    this._current = list.head;\n    this._count = 0;\n  };\n\n  this.next = function () {\n    var data = this._current.data;\n    this._current = this._current.next;\n    this._count++;\n    return data;\n  };\n\n  this.current = function () {\n    return this._current.data;\n  };\n\n  this.insertBefore = function (data) {\n    this._current.insertBefore(data); \n    this._list.count++;\n  };\n\n  this.insertAfter = function (data) {\n    this._current.insertAfter(data);  \n    this._list.count++;\n  };\n\n  this.remove = function () {\n    this._current.prev.remove();\n    if (this._current.prev == this._current) {\n      this._list.head = null;\n    }\n    this._list.count--;\n  };\n\n  this.hasNext = function () {\n    return this._count < this._list.count;\n  };\n\n  this.atHead = function () {\n    return this._current == this._list.head;\n  };\n});\n\nItem=__class__;var Item=Item(function Item(){return this.init&&this.init.apply(this,arguments)},'Item', function (logger, supr) {\n  this.init = function (data, prev, next) {\n    this.data = data;\n    this.prev = prev || this; \n    this.next = next || this;\n  };\n\n  this.insertBefore = function (data) {\n    var item = new Item(data, this.prev, this);\n    this.prev.next = item;\n    this.prev = item;\n  };\n  \n  this.insertAfter = function (data) {\n    var item = new Item(data, this, this.next);\n    this.next.prev = item;\n    this.next = item;\n  };\n\n  this.remove = function () {\n    this.prev.next = this.next;\n    this.next.prev = this.prev;\n  };\n});\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_util_SortedLinkedList=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_util_SortedLinkedList(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_util_SortedLinkedList(){return this.init&&this.init.apply(this,arguments)},'SortedLinkedList', function (logger, supr) {\n  this.init = function (comparator) {\n    this.head = null;\n    this._comparator = comparator;\n    this.count = 0;\n  };\n\n  this.append = function (data) {\n    this._head.insertAfter(data);\n    this.count++;\n  };\n\n  this.insert = function (data) {\n    if (!this.head) {\n      this.head = new Item(data);\n      this.count++;\n    } else {\n      var i = this.iterator();\n      var d = i.current();  \n      var found = false;\n      while (i.hasNext() && !found) {\n        found = !this._comparator(data, d);\n        if (!found) {\n          i.next(); \n          d = i.current();\n        }\n      }\n      i.insertBefore(data);\n      if (found && i.atHead()) {\n        this.head = this.head.prev; \n      }\n    }\n  };\n\n  this.iterator = function () {\n    return new Iterator(this);\n  };\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/canvas/TextFlow.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/TextFlow.js","friendlyPath":".TextFlow","directory":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/","filename":"TextFlow.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import lib.Enum as Enum');\njsio('import lib.PubSub as PubSub');\n\nvar textFlowMode = Enum(\n  \"NONE\",\n  \"WRAP\",\n  \"AUTOSIZE\",\n  \"AUTOSIZE_WRAP\",\n  \"AUTOFONTSIZE\",\n  \"AUTOFONTSIZE_WRAP\",\n  \"AUTOFONTSIZE_AUTOSIZE\",\n  \"AUTOFONTSIZE_WRAP_AUTOSIZE\"\n);\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_TextFlow=__class__;var TextFlow = exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_TextFlow(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_TextFlow(){return this.init&&this.init.apply(this,arguments)},PubSub, function (supr) {\n  this.init = function (opts) {\n    supr(this, \"init\", arguments);\n\n    this._target = opts.target;\n    this._lineWidth = 0;\n    this._line = [];\n    this._lines = [];\n\n    this._words = [];\n\n    this._maxWordWidth = 0;\n    this._maxWidth = 0;\n    this._maxHeight = 0;\n\n    this._heightFound = 0;\n\n    this._offsetRect = {x: 0, y: 0, width: 0, height: 0};\n  };\n\n  this.measureText = function (ctx, text) {\n    var opts = this._opts;\n\n    var emoticonData = (text[0] == '(') && opts.emoticonData && opts.emoticonData.data[text];\n    if (emoticonData) {\n      return opts.size;\n    } else {\n      return ctx.measureText(text).width;\n    }\n  };\n\n  // Split the text into a list containing the word and the width of the word...\n  this._lineSplit = function (ctx) {\n    var opts = this._opts;\n    var spaceWidth = opts.wrapCharacter ? 0 : ctx.measureText(\" \").width;\n    var text = opts.text || \"\";\n    var words =\n        opts.wrapCharacter\n          ? text.replace(/\\t/g, \" \").match(/\\S[]?|[\\n]/g) || []\n          : (opts.wrap || (opts.horizontalAlign === \"justify\"))\n            ? (text.replace(/\\t/g, \" \").match(/\\S+|[\\n]| +(?= )/g) || [])\n            : text.split(\"\\n\");\n\n    var splitWords = [];\n    for (i in words) {\n      var word = words[i];\n      var eStart = -1;\n      var lastSplit = 0;\n      for (var index = 0; index < word.length; index++) {\n        var c = word[index];\n        if (c == '(') {\n          eStart = index;\n        } else if (c == ')') {\n          if (eStart > -1) {\n            (eStart - lastSplit > 0) && splitWords.push(word.substring(lastSplit, eStart));\n            splitWords.push(word.substring(eStart, index + 1));\n            lastSplit = index + 1;\n            eStart = -1;\n          }\n        }\n      }\n      if (lastSplit < word.length) {\n        splitWords.push(word.substring(lastSplit));\n      }\n    }\n    words = splitWords;\n    var currentWord = 0;\n    var wordCount = words.length;\n\n    this._line = [];\n    this._lineWidth = 0;\n    this._maxWordWidth = 0;\n\n    var availableWidth = this.getAvailableWidth();\n    if ((opts.hardWrap || exports.hardWrap) && words.length && this.measureText(ctx, text) > availableWidth) {\n      words = [];\n\n      var s = \"\";\n      var i = 0;\n\n      while (i < text.length) {\n        var c = text[i++];\n        if (ctx.measureText(s + c).width >= availableWidth) {\n          words.push(s);\n          s = c;\n        } else {\n          s += c;\n        }\n      }\n      if (s !== \"\") {\n        words.push(s);\n      }\n      wordCount = words.length;\n    }\n\n    while (currentWord < wordCount) {\n      var word = {word: words[currentWord], width: this.measureText(ctx, words[currentWord]), line: 1};\n      this._line.push(word);\n      this._lineWidth += word.width + spaceWidth;\n      this._maxWordWidth = Math.max(this._maxWordWidth, word.width);\n      currentWord++;\n    }\n    this._lineWidth -= spaceWidth;\n  };\n\n  this._measureWords = function (ctx) {\n    var spaceWidth = this._opts.wrapCharacter ? 0 : ctx.measureText(\" \").width;\n    var currentWord = 0;\n    var wordCount = this._line.length;\n\n    this._lineWidth = 0;\n    this._maxWordWidth = 0;\n\n    while (currentWord < wordCount) {\n      var word = this._line[currentWord];\n      word.line = 1;\n      word.width = this.measureText(ctx, word.word);\n      this._lineWidth += word.width + spaceWidth;\n      this._maxWordWidth = Math.max(this._maxWordWidth, word.width);\n      currentWord++;\n    }\n    this._lineWidth -= spaceWidth;\n  };\n\n  // Split the single line into multiple lines which fit into the available width...\n  this._wrap = function (ctx, width) {\n    var spaceWidth = this._opts.wrapCharacter ? 0 : ctx.measureText(\" \").width;\n    var currentWidth = 0;\n    var lines = [];\n    var line = [];\n    var s = \"\";\n\n    this._lines = lines;\n    this._maxWidth = 0;\n\n    var currentWord = 0;\n    var wordCount = this._line.length;\n\n    if (this._opts.horizontalAlign === \"justify\") {\n      while (currentWord < wordCount) {\n        var word = this._line[currentWord++];\n        currentWidth += word.width + spaceWidth;\n        if (word.word === \"\\n\") {\n          lines.push(line);\n          line = [];\n          currentWidth = 0;\n        } else if (currentWidth > width) {\n          line.length && lines.push(line);\n          line = [word];\n          currentWidth = word.width + spaceWidth;\n        } else {\n          line.push(word);\n        }\n      }\n      line.length && lines.push(line);\n    } else {\n      // Note: this algorithm isn't 100% accurate because we are going\n      // to use the cumulative width of the line (sum up widths of all\n      // measured words plus space widths), which on some platforms will\n      // actually be slightly longer than the actual line length.  Usually\n      // we're only off by a few pixels, so it doesn't matter.  However,\n      // if we remeasured each line after computing the full line length,\n      // we'd end up with a shorter line than we expected, and if we then\n      // resize our view to fit the width and try to wrap text again, we'd\n      // find that the width of the line is now longer than the width of\n      // the view, resulting in the line wrapping shorter than the previous\n      // time (unnecessarily).  Additionally, this extra measure is\n      // expensive, so we'll just use our rough approximation.\n      while (currentWord < wordCount) {\n        var word = this._line[currentWord++];\n        // currentWidth = ctx.measureText(s).width;\n        if (word.word === \"\\n\") {\n          //lines.push([{word: s, width: currentWidth, line: lines.length}]);\n          //s = \"\";\n          lines.push(line);\n          line = [];\n          currentWidth = 0;\n        } else {\n          var isLineEmpty = !line.length;\n          //var isLineEmpty = !s.length;\n          var hasSpace = !isLineEmpty && !this._opts.wrapCharacter;\n          var offset = hasSpace ? spaceWidth : 0;\n          if (currentWidth + word.width + offset > width) {\n            var wordWidth = word.width;\n\n            // if word is longer than the entire line width\n            if (wordWidth > width) {\n              var current = word.word;\n\n              // split word into lines\n              var wordPiece = \"\";\n              for (var i = 0, n = current.length; i < n; ++i) {\n                if ((isLineEmpty && !wordPiece) || this.measureText(ctx, wordPiece + current[i]) + offset + currentWidth <= width) {\n                  wordPiece += current[i];\n                } else {\n                  /*\n                  var line = s + (hasSpace ? \" \" : \"\") + wordPiece;\n                  currentWidth = ctx.measureText(line).width;\n                  lines.push([{word: line, width: currentWidth, line: lines.length}]);\n                  */\n                  currentWidth = this.measureText(ctx, wordPiece);\n                  line.push({word: wordPiece, width: currentWidth, line: lines.length});\n                  lines.push(line);\n                  line = [];\n                  currentWidth = 0;\n                  offset = 0;\n                  //s = \"\";\n                  isLineEmpty = true;\n                  hasSpace = false;\n                  wordPiece = current[i];\n                }\n              }\n\n              if (wordPiece) {\n                /*\n                var line = s + (hasSpace ? \" \" : \"\") + wordPiece;\n                currentWidth = ctx.measureText(line).width;\n                lines.push([{word: line, width: currentWidth, line: lines.length}]);\n                */\n                currentWidth = this.measureText(ctx, wordPiece);\n                line.push({word: wordPiece, width: currentWidth, line: lines.length});\n                //lines.push(line);\n\n              }\n            } else {\n              //(!isLineEmpty) && lines.push([{word: s, width: currentWidth, line: lines.length}]);\n              (!isLineEmpty) && lines.push(line);\n              //s = word.word;\n              line = [word];\n              currentWidth = word.width;\n            }\n          } else {\n            line.push(word);\n            //s += (hasSpace ? \" \" : \"\") + word.word;\n            currentWidth += word.width + offset;\n          }\n        }\n      }\n\n      //if (s !== \"\") {\n      if (line.length > 0) {\n        //lines.push([{word: s, width: currentWidth, line: lines.length}]);\n        lines.push(line);\n      }\n    }\n  };\n\n  this._getLineSize = function (lineCount) {\n    var opts = this._opts;\n    return ((lineCount <= 1) ? 1 : opts.lineHeight) * opts.size;\n  };\n\n  // Calculate the position of each word on the line...\n  this._wordFlow = function (ctx) {\n    var spaceWidth = this._opts.wrapCharacter ? 0 : ctx.measureText(\" \").width;\n    var lines = this._lines;\n\n    this._words = [];\n\n    this._maxWidth = 0;\n    this._maxHeight = 0;\n\n    var currentLine = 0;\n    var lineCount = lines.length;\n    var lineSize = this._getLineSize(lineCount);\n    var y = 0;\n\n    while (currentLine < lineCount) {\n      var line = lines[currentLine++];\n      var currentWord = 0;\n      var wordCount = line.length;\n      var x = 0;\n\n      while (currentWord < wordCount) {\n        var word = line[currentWord++];\n\n        word.x = x;\n        word.y = y;\n        word.line = currentLine;\n        this._words.push(word);\n\n        x += word.width + spaceWidth;\n      }\n\n      y += lineSize;\n      x -= spaceWidth;\n\n      this._maxWidth = Math.max(this._maxWidth, x);\n      this._maxHeight = Math.max(this._maxHeight, y);\n    }\n  };\n\n  // Check if the given width fits into the available size, if not the resize the font...\n  this._checkWidth = function (ctx, width) {\n    if (this._opts.text === \"\") {\n      return false;\n    }\n    var opts = this._opts;\n\n    if (width > this.getAvailableWidth()) {\n      var size = (opts.size * this._target.style.width / width) | 0;\n      (opts.size !== size) && this.publish(\"ChangeSize\", size, ctx);\n      return true;\n    }\n    return false;\n  };\n\n  this._checkHeight = function (ctx, loSize, hiSize, cb) {\n    if (this._opts.text === \"\") {\n      return;\n    }\n    if (Math.abs(hiSize - loSize) < 2) {\n      return;\n    }\n\n    var pivot = Math.max((loSize + hiSize) >> 1, 1);\n    this.publish(\"ChangeSize\", pivot, ctx);\n    cb();\n    if (pivot === 1) {\n      return;\n    }\n\n    var opts = this._opts;\n    var lineSize = this._getLineSize(this._lines.length);\n    if ((this._lines.length * lineSize > this.getAvailableHeight())) {\n      this._checkHeight(ctx, loSize, pivot, cb);\n    } else {\n      this._heightFound = opts.size;\n      this._checkHeight(ctx, pivot, hiSize, cb);\n    }\n  };\n\n  this._horizontalAlign = function (ctx) {\n    var words = this._words;\n    if (words.length) {\n      var spaceWidth = this._opts.wrapCharacter ? 0 : ctx.measureText(\" \").width;\n      var lastLineSpaceWidth = spaceWidth;\n      var lastLine = words[words.length - 1].line;\n      var paddingLeft = this.getPaddingLeft();\n      var div = {left: -1, center: 2, right: 1, justify: 3}[this._opts.horizontalAlign] || -1;\n      var availableWidth = this.getAvailableWidth();\n\n      if (div === 3) {\n        spaceWidth = 0;\n      }\n\n      var endWordIndex = 0;\n      var wordCount = words.length;\n      // for each line\n      while (endWordIndex < wordCount) {\n\n        // compute length of line\n        var wordIndex = endWordIndex;\n        var line = words[endWordIndex].line;\n        var lineWidth = 0;\n        while ((endWordIndex < wordCount) && (line === words[endWordIndex].line)) {\n          lineWidth += words[endWordIndex].width + spaceWidth;\n          endWordIndex++;\n        }\n\n        // align words in line\n        if (div === -1) { // left\n          while (wordIndex < endWordIndex) {\n            words[wordIndex++].x += paddingLeft;\n          }\n        } else if (div === 3) { // justify\n          var wordSpacing = (line < lastLine ? (availableWidth - lineWidth) / (endWordIndex - wordIndex - 1) : lastLineSpaceWidth);\n          var x = paddingLeft;\n          while (wordIndex < endWordIndex) {\n            words[wordIndex].x = x;\n            x += words[wordIndex].width + wordSpacing;\n            wordIndex++;\n          }\n        } else { // center|right\n          var offset = (availableWidth - lineWidth + spaceWidth) / div + paddingLeft;\n          while (wordIndex < endWordIndex) {\n            words[wordIndex++].x += offset;\n          }\n        }\n      }\n    }\n  };\n\n  this._verticalAlign = function () {\n    var lineCount = this._lines.length;\n    var verticalAlign = this._opts.verticalAlign;\n    var words = this._words;\n    var availableHeight = this.getAvailableHeight();\n    var i = words.length;\n    if (i) {\n      var offset;\n      if (verticalAlign == 'top') {\n        offset = this.getPaddingTop();\n      } else {\n        var div = verticalAlign == 'middle' ? 2 : 1;\n        var lineSize = this._getLineSize(lineCount);\n        offset = (availableHeight - lineCount * lineSize) / div + this.getPaddingTop();\n      }\n\n      while (i) {\n        words[--i].y += offset;\n      }\n\n      this._offsetRect.y += offset;\n    }\n  };\n\n  this.reflow = function (ctx, mode) {\n    var opts = this._opts;\n    var availableWidth = this.getAvailableWidth();\n    var availableHeight = this.getAvailableHeight();\n\n    this._lineSplit(ctx);\n\n    switch (mode) {\n      case textFlowMode.NONE:\n        this._lines = [this._line];\n        this._wordFlow(ctx);\n        break;\n\n      case textFlowMode.WRAP:\n        this._wrap(ctx, availableWidth);\n        this._wordFlow(ctx);\n        break;\n\n      case textFlowMode.AUTOSIZE:\n      case textFlowMode.AUTOFONTSIZE_AUTOSIZE:\n        this._lines = [this._line];\n        this._wordFlow(ctx);\n\n        if (this._opts.fitWidth || availableWidth < this._maxWidth) {\n          this.publish(\"ChangeWidth\", this._maxWidth + this.getHorizontalPadding());\n        }\n\n        if (this._opts.fitHeight || availableHeight < this._maxHeight) {\n          this.publish(\"ChangeHeight\", this._maxHeight + this.getVerticalPadding());\n        }\n        break;\n\n      case textFlowMode.AUTOSIZE_WRAP:\n        this._wrap(ctx, availableWidth);\n        this._wordFlow(ctx);\n\n        if (this._opts.fitWidth || availableWidth < this._maxWidth) {\n          this.publish(\"ChangeWidth\", this._maxWidth + this.getHorizontalPadding());\n        }\n\n        if (this._opts.fitHeight  || availableHeight < this._maxHeight) {\n          this.publish(\"ChangeHeight\", this._maxHeight + this.getVerticalPadding());\n        }\n\n        break;\n\n      case textFlowMode.AUTOFONTSIZE:\n        this._checkWidth(ctx, this._lineWidth) && this._lineSplit(ctx);\n        this._lines = [this._line];\n        // Don't use the lineHeight here because it's a single line\n        if (opts.allowVerticalSizing && opts.size > availableHeight) {\n          var cb = bind(\n            this,\n            function () {\n              this._measureWords(ctx);\n              this._wordFlow(ctx);\n            }\n          );\n\n          this._checkHeight(ctx, 1, opts.size, cb);\n          this.publish(\"ChangeSize\", this._heightFound, ctx);\n          cb();\n        } else {\n          this._wordFlow(ctx);\n        }\n        break;\n\n      case textFlowMode.AUTOFONTSIZE_WRAP:\n        this._wrap(ctx, availableWidth);\n        this._wordFlow(ctx);\n\n        var lineCount = this._lines.length;\n        var lineSize = this._getLineSize(lineCount);\n        if (opts.allowVerticalSizing && lineCount * lineSize > availableHeight) {\n          var cb = bind(\n            this,\n            function () {\n              this._measureWords(ctx);\n              this._wrap(ctx, availableWidth);\n              this._wordFlow(ctx);\n            }\n          );\n\n          this._checkHeight(ctx, 1, opts.size, cb);\n          this.publish(\"ChangeSize\", this._heightFound, ctx);\n          cb();\n        }\n\n        break;\n\n      case textFlowMode.AUTOFONTSIZE_WRAP_AUTOSIZE:\n        this._wrap(ctx, availableWidth);\n        this._wordFlow(ctx);\n\n        (availableHeight < this._maxHeight) && this.publish(\"ChangeHeight\", this._maxHeight + this.getVerticalPadding());\n        break;\n    }\n\n    var words = this._words;\n    var lastWord = words[words.length - 1];\n\n    if (words.length) {\n      var strokeWidth = this._target.getStrokeWidth();\n      var lineSize = Math.ceil(opts.size * opts.lineHeight + strokeWidth);\n      this._offsetRect.x = this.getPaddingLeft();\n      this._offsetRect.y = this.getPaddingTop();\n      this._offsetRect.width = availableWidth;\n      this._offsetRect.height = lastWord.line * lineSize;\n\n      this._horizontalAlign(ctx);\n      this._verticalAlign();\n\n      if (lastWord.line === 1) {\n        this._offsetRect.x = words[0].x;\n        this._offsetRect.width = lastWord.x + lastWord.width - words[0].x;\n      }\n\n      this._offsetRect.width += strokeWidth;\n    }\n  };\n\n  this.setOpts = function (opts) {\n    this._opts = opts;\n  };\n\n  this.getWords = function () {\n    return this._words;\n  };\n\n  this.getHorizontalPadding = function () {\n    var padding = this._target.style.padding;\n\n    return padding.left + padding.right;\n  };\n\n  this.getPaddingLeft = function () {\n    return this._target.style.padding.left;\n  };\n\n  this.getAvailableWidth = function () {\n    return this._target.style.width - this.getHorizontalPadding();\n  };\n\n  this.getVerticalPadding = function () {\n    var padding = this._target.style.padding;\n\n    return padding.top + padding.bottom;\n  };\n\n  this.getPaddingTop = function () {\n    return this._target.style.padding.top;\n  };\n\n  this.getAvailableHeight = function () {\n    return this._target.style.height - this.getVerticalPadding();\n  };\n\n  this.getOffsetRect = function () {\n    return this._offsetRect;\n  };\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/legacySettings.js":{"path":"modules/devkit-core/modules/timestep/src/ui/legacySettings.js","friendlyPath":"...legacySettings","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"legacySettings.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nexports = {\n  disableVerticalAutoSize: false,\n  textViewColor: false // use this.color in TextView if true\n}\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/canvas/ViewDebugger.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/ViewDebugger.js","friendlyPath":".backend.canvas.ViewDebugger","directory":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/","filename":"ViewDebugger.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_ViewDebugger=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_ViewDebugger(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_backend_canvas_ViewDebugger(){return this.init&&this.init.apply(this,arguments)},function () {\n  \n  this.init = function (target, opts) {\n    this._target = target;\n    this._opts = opts = merge(opts, {\n      trackClicks: false,\n      outline: false,\n      flash: false\n    });\n    \n    this.outline = opts.outline;\n    this.trackClicks = opts.trackClicks;\n    this.flash = opts.flash;\n    \n    this._flashState = 0;\n    this._nextFlash = 0;\n  }\n  \n  this.preRender = function (ctx) {\n    if (!this._time) { this._time = +new Date(); }\n    var prevTime = this._time;\n    this._time = +new Date();\n    this._dt = this._time - prevTime;\n    \n    var s = this._target.style;\n    if (this.outline) {\n      ctx.save();\n      ctx.globalAlpha = 0.2;\n      ctx.strokeStyle = 'black';\n      ctx.lineWidth = 1.0;\n      ctx.strokeRect(0, 0, s.width, s.height);\n      ctx.restore();\n    }\n  }\n  \n  this.postRender = function (ctx) {\n      var s = this._target.style;\n\n    var t = this._target;\n    if (this.trackClicks) {\n      for (var i = t._clicks.length - 1; i >= 0; --i) {\n        var c = t._clicks[i];\n        ctx.setFillStyle('rgba(0, 0, 0, ' + c.o + ')');\n        c.o -= 0.4 * this._dt / 1000;\n        if (c.o > 0) {\n          ctx.circle(c.x, c.y, 15);\n          ctx.fill();\n        } else {\n          t._clicks.splice(i, 1);\n        }\n      }\n    }\n    \n    if (this.flash) {\n      switch(this._flashState) {\n        case 0:\n          ctx.setFillStyle('rgba(0, 0, 0, 0.5)');\n          break;\n        case 1:\n          ctx.setFillStyle('rgba(0, 0, 0, 0)');\n          break;\n        case 2:\n          ctx.setFillStyle('rgba(255, 255, 255, 0.5)');\n          break;\n        case 3:\n          ctx.setFillStyle('rgba(0, 0, 0, 0)');\n          break;\n      }\n      \n      var now = +new Date();\n      if (now > this._nextFlash) {\n        this._flashState = (this._flashState + 1) % 4;\n        this._nextFlash = now + 300;\n      }\n      \n      ctx.fillRect(0, 0, t.style.width, t.style.height);\n    }\n  }\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/InputPrompt.js":{"path":"modules/devkit-core/modules/timestep/src/ui/InputPrompt.js","friendlyPath":"ui.InputPrompt","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"InputPrompt.js","baseMod":"ui","basePath":"/Users/marcelo.hashimoto/Desktop/gamedev/ElementalMatch3/modules/devkit-core/modules/timestep/src/ui","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n /* globals NATIVE, DEBUG, jsio */\n\njsio('import device');\njsio('import .debug.deprecated as deprecated');\n\nvar inputDialog = device.get('inputDialog');\n\n/**\n * @class InputPrompt\n *\n * Shows a native dialog that prompts the user for input.  In the tealeaf\n * runtime, this will open a native Android and iOS prompt.  In the browser, we\n * create a pure-DOM alternative of a one or two button prompt view using the\n * <input> tag and HTML5 input types.\n *\n */\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_InputPrompt=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_InputPrompt(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_InputPrompt(){return this.init&&this.init.apply(this,arguments)},function () {\n  /**\n   * @param {string} opts.title the prompt title\n   * @param {string} opts.value the value passed to the callbacks\n   * @param {function} opts.onChange called with value when value in prompt changes\n   * @param {function} opts.onSubmit called wtih value when prompt is submitted\n   * @param {function} opts.onCancel called with value when prompt is cancelled\n   * @param {string} [opts.okText='ok'] sets custom text for the ok button\n   * @param {string} [opts.cancelText='cancel'] sets custom text for the cancel button\n   * @param {boolean} [opts.autoShowKeyboard=true] opens the keyboard by default on mobile devices\n   * @param {boolean} [opts.isPassword=false] sets the input type to a password\n   * @param {string} [opts.keyboardType='Default'] sets the type of keyboard {@link keyboardTypes.rawTypes}\n   * @param {boolean} [opts.defaultBrowserStyles] use default browser styles\n   */\n  this.init = function (opts) {\n    opts = opts || {};\n\n    function get(prop, defaultValue) {\n      return opts[prop] !== undefined ? opts[prop] : defaultValue;\n    }\n\n    this._opts = merge({\n      title: get('title', ''),\n      value: get('value', ''),\n      okText: get('okText', 'ok'),\n      cancelText: get('cancelText', 'cancel'),\n      message: get('message', get('prompt', '')),\n      autoFocus: !!get('autoFocus', get('autoShowKeyboard', true)),\n      isPassword: !!get('isPassword', false),\n      keyboardType: get('keyboardType', 'default'),\n      defaultBrowserStyles: get('defaultBrowserStyles', true)\n    }, opts);\n\n    // set handlers\n    this.onChange = this._opts.onChange;\n    this.onSubmit = this._opts.onSubmit;\n\n    if (DEBUG) {\n      jsio(\"import .debug.types\").check('InputPrompt', {\n        'title': {value: this._opts.title, type: 'string', required: true},\n        'message (prompt)': {value: this._opts.message, type: 'string', required: true},\n        'ok text': {value: this._opts.okText, type: 'string', required: true},\n        'cancel text': {value: this._opts.cancelText, type: 'string', required: true},\n        'value': {value: this._opts.value, type: 'string', required: true},\n        'auto-show keyboard': {value: this._opts.autoShowKeyboard, type: 'boolean', require: true},\n        'is password field': {value: this._opts.isPassword, type: 'boolean', require: true},\n        'keyboard type': {value: this._opts.keyboardType, type: 'key', dictionary: exports.KeyboardTypes.htmlTypes, toLowerCase: true, require: true}\n      });\n    }\n  };\n\n  this.show = function () {\n    this._prompt = inputDialog.show(this, this._opts);\n  };\n\n  this.getValue = function () {\n    return this._opts.value;\n  };\n\n  this.setValue = function (value) {\n    this._opts.value = value;\n    return this;\n  };\n\n  this.setOkButton = function (value) {\n    this._opts.okText = value;\n    return this;\n  };\n\n  this.setCancelButton = function (value) {\n    this._opts.cancelText = value;\n    return this;\n  };\n\n  this.setKeyboardType = function (keyboardType) {\n    this._opts.keyboardType = keyboardType;\n    return this;\n  };\n\n  this.setMessage = function (message) {\n    this._opts.message = message;\n    return this;\n  };\n\n  deprecated.method(this, 'requestFocus', function () {\n    this.show();\n    return this;\n  });\n  deprecated.method(this, 'closeEditField');\n  deprecated.method(this, 'refresh');\n  deprecated.method(this, 'setHint');\n});\n\njsio('import .keyboardTypes as exports.KeyboardTypes');\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/debug/deprecated.js":{"path":"modules/devkit-core/modules/timestep/src/ui/debug/deprecated.js","friendlyPath":".debug.deprecated","directory":"modules/devkit-core/modules/timestep/src/ui/debug/","filename":"deprecated.js","src":"/* globals DEBUG */\n\nexports.method = function (prototype, method, func) {\n  if (DEBUG) {\n    prototype[method] = function () {\n      logger.ERROR&&console.error(\"ERROR\",\".debug.deprecated\",'@deprecated', method, prototype.constructor.name);\n      if (func) {\n        return func.apply(this, arguments);\n      }\n    };\n  } else {\n    prototype[method] = func || function () {};\n  }\n};\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/debug/types.js":{"path":"modules/devkit-core/modules/timestep/src/ui/debug/types.js","friendlyPath":".debug.types","directory":"modules/devkit-core/modules/timestep/src/ui/debug/","filename":"types.js","src":"/* globals DEBUG */\n\n/*\n * opts:\n *  - value: value to check\n *  - allowNull: if true and required, value can be null, else nulls for\n *    required values are errors\n *  - required: if true, error if value is undefined/null (see allowNull)\n */\nif (DEBUG) {\n  var isNumber = function (val) { return typeof val == 'number' && !isNaN(val); };\n  var VALIDATORS = {\n    'string': function (val) { return typeof val == 'string'; },\n    'integer': function (val) { return isNumber(val) && Math.floor(val) == val; },\n    'number': isNumber,\n    'float': isNumber,\n    'array': Array.isArray,\n    'object': function (val) { return typeof val == 'object'; },\n    'key': function (key, opts) {\n      if (opts.toLowerCase) {\n        return (key.toLowerCase && key.toLowerCase()) in lowerCaseKeys(opts.dictionary);\n      } else {\n        return opts.dictionary && (key in opts.dictionary);\n      }\n    }\n  };\n\n  var ERRORS = {\n    'default': function (scope, name, opts) {\n      return scope + ' \"' + name + '\" should be a ' + opts.type;\n    },\n    'key': function (scope, name, opts) {\n      return scope + ' \"' + name + '\" should be a key from the set: '\n        + Object\n            .keys(opts.toLowerCase\n              ? lowerCaseKeys(opts.dictionary)\n              : opts.dictionary)\n            .join(', ');\n    }\n  };\n\n  var lowerCaseKeys = function (obj) {\n    var keys = {};\n    if (obj) {\n      for (var k in obj) {\n        keys[k.toLowerCase()] = true;\n      }\n    }\n    return keys;\n  };\n\n  var getError = function (scope, name, opts) {\n    var msg = (ERRORS[opts.type] || ERRORS['default'])(scope, name, opts);\n    return new TypeError(msg);\n  };\n\n  exports.check = function (scope, properties) {\n    if (DEBUG) {\n      Object.keys(properties).forEach(function (name) {\n        var opts = properties[name];\n        if (opts.required && opts.value === undefined || opts.value === null && !opts.allowNull) {\n          logger.ERROR&&console.error(\"ERROR\",\".debug.types\",new TypeError(scope + ' \"' + name + '\" required'));\n        } else if (opts.type in VALIDATORS) {\n          if (!VALIDATORS[opts.type](opts.value, opts)) {\n            logger.ERROR&&console.error(\"ERROR\",\".debug.types\",getError(scope, name, opts));\n          }\n        }\n      });\n    }\n  };\n} else {\n  // production, no checking\n  exports.check = function () {};\n}\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/keyboardTypes.js":{"path":"modules/devkit-core/modules/timestep/src/ui/keyboardTypes.js","friendlyPath":".keyboardTypes","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"keyboardTypes.js","src":"jsio('import device');\n\n// map input types to native constants\nexports.nativeTypes = {\n    // legacy native names\n    Default: 0,                // Default type for the current input method.\n    NumbersAndPunctuation: 2,  // Numbers and assorted punctuation.\n    URL: 3,                    // A type optimized for URL entry (shows . / .com prominently).\n    NumberPad: 4,              // A number pad (0-9). Suitable for PIN entry.\n    PhonePad: 5,               // A phone pad (1-9, *, 0, #, with letters under the numbers).\n    EmailAddress: 7,           // A type optimized for multiple email address entry (shows space @ . prominently).\n    DecimalPad: 8,\n\n    // html5 names\n    url: 3,\n    number: device.isIOS ? 2 : 4, // ios/android mobile are different\n    tel: 5,\n    email: 7,\n  };\n\n// map input types to html5 type names\nexports.htmlTypes = {\n    // legacy native mapping\n    Default: 'text',\n    NumbersAndPunctuation: 'number', // note: android won't show punctuation\n    URL: 'url',\n    NumberPad: 'number',\n    PhonePad: 'tel',\n    EmailAddress: 'email',\n    DecimalPad: 'number',\n\n    // html5 types supported on both native/browser\n    number: 'number',\n    url: 'url',\n    tel: 'tel',\n    email: 'email',\n\n    // html5 types only supported in the browser\n    // TODO: add to native\n    date: 'date',\n    time: 'time',\n    datetime: 'datetime',\n    month: 'month'\n  };\n\nexports.types = {};\n\nfor (var type in exports.nativeTypes) {\n  exports.types[type.toLowerCase()] = exports.nativeTypes[type];\n}\n\nfor (var type in exports.htmlTypes) {\n  exports.htmlTypes[type.toLowerCase()] = exports.htmlTypes[type];\n}\n\nexports.has = function (type) {\n  return type.toLowerCase() in exports.types;\n};\n\nexports.getNativeType = function (type) {\n  return exports.types[type.toLowerCase()] || 0;\n};\n\nexports.getHTMLType = function (type) {\n  return exports.htmlTypes[type.toLowerCase()] || type;\n};\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/resource/Font.js":{"path":"modules/devkit-core/modules/timestep/src/ui/resource/Font.js","friendlyPath":"ui.resource.Font","directory":"modules/devkit-core/modules/timestep/src/ui/resource/","filename":"Font.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.resource.Font;\n * Font string parser, a la CSS Font strings. Exports a Font object class.\n * This class is purely informational.\n *\n * @doc http://doc.gameclosure.com/api/ui-text.html#class-ui.resource.font\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/text.md\n */\n\nvar _cache = {},\n  weights = 'normal|bold|bolder|lighter|[1-9]00',\n  styles = 'normal|italic|oblique',\n  units = 'px|pt|pc|in|cm|mm|%',\n  name = '([\\\\w\\\"\\'\\\\- ]+(?:,|$))+',\n  fontParser = new RegExp(\n    '^ *'\n      + '(?:(' + weights + ') *)?'\n      + '(?:(' + styles + ') *)?'\n      + '([\\\\d\\\\.]+)(' + units + ')'\n      + '('+ name + ')',\n      'i'\n  ),\n  sizeParser = new RegExp('([\\\\d\\\\.]+)(' + units + ')', 'i'),\n  TO_PT = {\n    'pt': 1,\n    'px': 3 / 4,\n    'in': 3 / 4 * 96,\n    'mm': 3 / 4 * 96 / 25.4,\n    'cm': 3 / 4 * 96 / 2.54\n  },\n  TO_PX = {\n    'pt': 4 / 3,\n    'px': 1,\n    'in': 96,\n    'mm': 96 / 25.4,\n    'cm': 96 / 2.54\n  };\n\nfunction parseSize(sizeStr, unit) {\n  var match = sizeStr.match(sizeParser);\n  if (!match) { throw 'invalid font size'; }\n  return {\n    value: parseFloat(match[1]),\n    unit: match[2]\n  };\n}\n\nfunction toPx(size) {\n  return {\n    value: size.value * TO_PX[size.unit],\n    unit: 'px'\n  };\n}\n\nfunction toPt(size) {\n  return {\n    value: size.value * TO_PT[size.unit],\n    unit: 'pt'\n  };\n}\n\nfunction parseFont(fontStr) {\n  var match = fontStr.match(fontParser);\n  if (!match) { throw 'invalid font string'; }\n  \n  var res = {};\n  res.weight = match[1] || 'normal';\n  res.style = match[2] || 'normal';\n  res.size = {\n    value: parseFloat(match[3]),\n    unit: match[4]\n  };\n\n  var splitStrings = match[5].split(',');\n\n  res.names = splitStrings.map(function (str) {\n    return str.replace(/[\\-_]/g, ' ')\n      .replace(/\\s+/g, ' ')\n      .replace(/['\"]/g, '')\n      .replace(/^\\s+|\\s+$/g, '');\n  });\n\n  res.name = res.names[0];\n\n  var origNames = splitStrings.map(function (str) {\n    return str.replace(/\\s+/g, ' ')\n      .replace(/['\"]/g, '')\n      .replace(/^\\s+|\\s+$/g, '');\n  });\n\n  res.origName = origNames[0];\n\n  return res;\n};\n\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_resource_Font=__class__;var Font = exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_resource_Font(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_resource_Font(){return this.init&&this.init.apply(this,arguments)},function () {\n  \n  var _defaultFontFamily = null;\n  this.constructor.setDefaultFontFamily = function (fontFamily) {\n    _defaultFontFamily = fontFamily;\n  }\n\n  var defaults = {\n    name: _defaultFontFamily,\n    size: 20,\n    unit: 'px',\n    style: '',\n    weight: ''\n  };\n\n  this.init = function (opts) {\n    if (typeof opts === 'string') {\n      _cache[opts] = this;\n      this._string = opts;\n      opts = parseFont(opts);\n    } else {\n      opts = merge(opts, defaults);\n    }\n    \n    if (typeof opts.size == 'string') {\n      opts.size = parseSize(opts.size);\n    }\n    \n    this._name = opts.name;\n    this._origName = opts.origName;\n    this._style = opts.style;\n    this.size = opts.size;\n    this.sizePx = toPx(this.size).value;\n    this.sizePt = toPt(this.size).value;\n    this._weight = opts.weight;\n\n    this._isBold = /bold/i.test(this._weight);\n  };\n  \n  this.getSize = function () { return this.sizePx; }\n\n  this.getName = function () { return this._name; }\n  this.getOrigName = function () { return this._origName; }\n  this.getWeight = function () { return this._weight; }\n});\n\nexports.parse = function (str) {\n  if (str in _cache) {\n    return _cache[str];\n  } else {\n    return new Font(str);\n  }\n}\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/init.js":{"path":"modules/devkit-core/modules/timestep/src/ui/init.js","friendlyPath":"ui.init","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"init.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import .View');\njsio('import .layout.BackingExtension');\njsio('import .Engine');","pre":true},"modules/devkit-core/modules/timestep/src/ui/layout/BackingExtension.js":{"path":"modules/devkit-core/modules/timestep/src/ui/layout/BackingExtension.js","friendlyPath":".layout.BackingExtension","directory":"modules/devkit-core/modules/timestep/src/ui/layout/","filename":"BackingExtension.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import ..View');\njsio('import ..backend.strPad as strPad');\njsio('import ..backend.BaseBacking');\njsio('import .BoxLayout');\njsio('import .LinearLayout');\njsio('import .Padding');\n\njsio('import util.setProperty');\n\nvar layoutProps = {\n    'layout': {value: false, cb: '_onSetLayout'},\n    'inLayout': {value: true, cb: '_onInLayout'},\n    'order': {value: 0, cb: '_onOrder'},\n    'direction': {value: 'vertical', cb: '_onLayoutChange'},\n    'flex': {value: 0, cb: '_onLayoutChange'},\n    'justifyContent': {value: 'start', cb: '_onLayoutChange'},\n\n    'centerX': {value: false, cb: '_onLayoutChange'},\n    'centerY': {value: false, cb: '_onLayoutChange'},\n\n    'top': {value: undefined, cb: '_onLayoutChange'},\n    'right': {value: undefined, cb: '_onLayoutChange'},\n    'bottom': {value: undefined, cb: '_onLayoutChange'},\n    'left': {value: undefined, cb: '_onLayoutChange'},\n\n    'minWidth': {value: undefined, cb: '_onBoundsChange'},\n    'minHeight': {value: undefined, cb: '_onBoundsChange'},\n    'maxWidth': {value: undefined, cb: '_onBoundsChange'},\n    'maxHeight': {value: undefined, cb: '_onBoundsChange'},\n\n    'layoutWidth': {value: undefined, cb: '_onLayoutWidth'},\n    'layoutHeight': {value: undefined, cb: '_onLayoutHeight'},\n\n    'fixedAspectRatio': {value: false, cb: '_onFixedAspectRatio'},\n    'aspectRatio': {value: null, cb: '_onLayoutChange'},\n\n    'margin': {value: null, cb: '_onMarginChange'},\n    'padding': {\n      get: function () {\n        return this._padding || (this._padding = new Padding());\n      },\n      set: function (value) {\n        if (this._padding) {\n          this._padding.update(value);\n        } else {\n          this._padding = new Padding(value);\n        }\n\n        this._onLayoutChange();\n      }\n    }\n  };\n\nfor (var key in layoutProps) {\n  backend.BaseBacking.addProperty(key, layoutProps[key]);\n}\n\nView.addExtension({\n  extend: function (ViewBacking) {\n\n    var proto = ViewBacking.prototype;\n\n    proto._sortOrder = strPad.initialValue;\n    proto._onOrder = function (_, order) {\n      this._sortOrder = strPad.pad(order);\n      this._onLayoutChange();\n    };\n\n    proto._onMarginChange = function (key, value) {\n      if (this._cachedMargin) {\n        this._cachedMargin.update(value);\n      } else {\n        this._cachedMargin = new Padding(value);\n      }\n\n      this.top = this._cachedMargin.top;\n      this.bottom = this._cachedMargin.bottom;\n      this.left = this._cachedMargin.left;\n      this.right = this._cachedMargin.right;\n\n      this._onLayoutChange();\n    }\n\n    proto._onFixedAspectRatio = function (key, value) {\n      if (value) {\n        this.updateAspectRatio();\n      }\n    }\n\n    proto.updateAspectRatio = function (width, height) {\n      this.aspectRatio = (width || this.width) / (height || this.height);\n    }\n\n    proto.enforceAspectRatio = function(iw, ih, isTimeout) {\n      if (iw && ih) {\n        this.updateAspectRatio(iw, ih);\n      }\n      var parent = this._view.getSuperview();\n      var opts = this._view._opts;\n      iw = iw || opts.width;\n      ih = ih || opts.height;\n      if (opts.width) {\n        iw = opts.width;\n        ih = opts.width / this.aspectRatio;\n      }\n      else if (opts.height) {\n        ih = opts.height;\n        iw = opts.height * this.aspectRatio;\n      }\n      else if (parent) {\n        if (this.layoutWidth && parent.style.width) {\n          iw = parent.style.width * parseFloat(this.layoutWidth) / 100;\n          ih = iw / this.aspectRatio;\n        }\n        else if (this.layoutHeight && parent.style.height) {\n          ih = parent.style.height * parseFloat(this.layoutHeight) / 100;\n          iw = ih * this.aspectRatio;\n        }\n        else if (this.flex && parent.style.direction == 'horizontal' && this.width) {\n          iw = this.width;\n          ih = iw / this.aspectRatio;\n        }\n        else if (this.flex && parent.style.direction == 'vertical' && this.height) {\n          ih = this.height;\n          iw = ih * this.aspectRatio;\n        }\n        else if (!isTimeout) {\n          setTimeout(bind(this, 'enforceAspectRatio', iw, ih, true), 0);\n        }\n      }\n      this.width = iw;\n      this.height = ih;\n    };\n\n    var layouts = {\n      'linear': LinearLayout,\n      'box': BoxLayout\n    };\n\n    proto._onSetLayout = function (key, which) {\n      var view = this._view;\n      var LayoutCtor = layouts[which];\n      if (LayoutCtor) {\n        view.__layout = new LayoutCtor({view: view});\n        this.addResizeListeners();\n      } else {\n        this._layout = false;\n      }\n    };\n\n    proto.addResizeListeners = function () {\n      if (!this._hasResizeListeners) {\n        this._hasResizeListeners = true;\n        util.setProperty(this, 'width', {cb: '_onWidth', value: this.width, configurable: true});\n        util.setProperty(this, 'height', {cb: '_onHeight', value: this.height, configurable: true});\n      }\n    }\n\n    proto._onWidth = function(prop, value, prevValue) {\n      // local properties are invalidated\n      // this._cache = null;\n\n      if (typeof this.maxWidth == 'number') {\n        this._width = Math.min(this.maxWidth, value || 0);\n      }\n\n      if (typeof this.minWidth == 'number') {\n        this._width = Math.max(this.minWidth, value || 0);\n      }\n\n      if (this._aspectRatio) {\n        this._height = this._width / this._aspectRatio;\n      }\n\n      this._onLayoutChange();\n    }\n\n    proto._onHeight = function(prop, value, prevValue) {\n      // local properties are invalidated\n      // this._cache = null;\n\n      if (typeof this.maxHeight == 'number') {\n        this._height = Math.min(this.maxHeight, value || 0);\n      }\n\n      if (typeof this.minHeight == 'number') {\n        this._height = Math.max(this.minHeight, value || 0);\n      }\n\n      if (this._aspectRatio) {\n        this._width = this._height * this._aspectRatio;\n      }\n\n      this._onLayoutChange();\n    }\n\n    proto._onInLayout = function (key, value) {\n      var layout = this._superview && this._superview.__layout;\n      if (layout) {\n        if (value) {\n          layout.add(this._view);\n        } else {\n          layout.remove(this._view);\n          this._view.needsReflow();\n        }\n      }\n    }\n\n    proto._onLayoutWidth = function (key, value) {\n      if (value.charAt(value.length - 1) == '%') {\n        this._layoutWidthValue = parseFloat(value) / 100;\n        this._layoutWidthIsPercent = true;\n      } else {\n        this._layoutWidthValue = 0;\n        this._layoutWidthIsPercent = false;\n      }\n\n      this._onLayoutChange();\n    }\n\n    proto._onLayoutHeight = function (key, value) {\n      if (value.charAt(value.length - 1) == '%') {\n        this._layoutHeightValue = parseFloat(value) / 100;\n        this._layoutHeightIsPercent = true;\n      } else {\n        this._layoutHeightValue = 0;\n        this._layoutHeightIsPercent = false;\n      }\n\n      this._onLayoutChange();\n    }\n\n    proto._onBoundsChange = function () {\n      this.addResizeListeners();\n      this._onLayoutChange();\n    }\n\n    // trigger a reflow, optionally of the parent if the parent has layout too\n    proto._onLayoutChange = function () {\n      var superview = this.getSuperview();\n      if (superview && superview.__layout) {\n        superview.needsReflow();\n      }\n\n      this._view.needsReflow();\n    }\n  }\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/layout/BoxLayout.js":{"path":"modules/devkit-core/modules/timestep/src/ui/layout/BoxLayout.js","friendlyPath":".BoxLayout","directory":"modules/devkit-core/modules/timestep/src/ui/layout/","filename":"BoxLayout.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_layout_BoxLayout=__class__;var BoxLayout = exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_layout_BoxLayout(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_layout_BoxLayout(){return this.init&&this.init.apply(this,arguments)},function () {\n\n  var cls = this.constructor;\n\n  this.init = function (opts) {\n    this._view = opts.view;\n\n    cls.listenSubviewResize(opts.view);\n  }\n\n  this.reflow = function () {\n    var view = this._view;\n    var sv = view.getSuperview();\n    var style = view.style;\n\n    // if wrapping content, listen for changes to subviews\n    if (style._layoutWidth == 'wrapContent' || style._layoutHeight == 'wrapContent') {\n      cls.addSubviewListener(view);\n    }\n\n    if (sv) {\n      var notInLayout = !style.inLayout || !style.flex || sv.style.layout != 'linear';\n      if (notInLayout || !sv.__layout.isHorizontal()) {\n        this.reflowX();\n      }\n\n      if (notInLayout || !sv.__layout.isVertical()) {\n        this.reflowY();\n      }\n    }\n  }\n\n  cls.addSubviewListener = function (view) {\n    if (!view.__hasSubviewListener) {\n      view.__hasSubviewListener = true;\n      view.subscribe('SubviewAdded', this, '_onSubviewAdded', view);\n      view.subscribe('SubviewRemoved', this, '_onSubviewRemoved', view);\n\n      var subviews = view.getSubviews();\n      for (var i = 0, n = subviews.length; i < n; ++i) {\n        this._onSubviewAdded(view, subviews[i]);\n      }\n    }\n  };\n\n  cls.removeSubviewListener = function (view) {\n    if (view.__hasSubviewListener) {\n      view.__hasSubviewListener = false;\n      view.unsubscribe('SubviewAdded', this, '_onSubviewAdded');\n      view.unsubscribe('SubviewRemoved', this, '_onSubviewRemoved');\n\n      var subviews = view.getSubviews();\n      for (var i = 0, n = subviews.length; i < n; ++i) {\n        this._onSubviewRemoved(view, subviews[i]);\n      }\n    }\n  };\n\n  cls._onSubviewAdded = function (view, subview) {\n    subview.style.addResizeListeners();\n    view.connectEvent(subview, 'resize', bind(view, 'needsReflow'));\n  };\n\n  cls._onSubviewRemoved = function (view, subview) {\n    view.disconnectEvent(subview, 'resize');\n  };\n\n  cls.addResizeListener = function (view) {\n    if (view.style.__removeSuperviewResize) {\n      view.style.__removeSuperviewResize();\n    }\n\n    // reflow on parent view resize\n    var onResize = bind(view, 'needsReflow');\n    var superview = view.getSuperview();\n    if (superview) {\n      superview.on('resize', onResize);\n      // store a closure to unsubscribe this event\n      view.style.__removeSuperviewResize = bind(view.style, function () {\n        this.__removeSuperviewResize = null;\n        superview && superview.removeListener('resize', onResize);\n      });\n    }\n  }\n\n  cls.listenSubviewResize = function (view) {\n    if (view.__root) { this.addResizeListener(view); }\n\n    view.on('ViewAdded', bind(this, 'addResizeListener', view));\n    view.on('ViewRemoved', bind(view.style, function () {\n      this.__removeSuperviewResize && this.__removeSuperviewResize();\n    }));\n  }\n\n  this.reflowX = function (view) {\n    var view = this._view;\n    var s = view.style;\n\n    var sv = view.getSuperview();\n    if (s.inLayout && sv.style.layout == 'linear') {\n      var inLinearLayout = sv.__layout.isHorizontal();\n      var padding = sv.style.padding;\n    }\n\n    var svWidth = sv.style.width;\n    var availWidth = svWidth - (padding && padding.getHorizontal() || 0);\n\n    // compute the width\n    var w;\n    if (s._layoutWidth == 'wrapContent') {\n      // find the maximal right edge\n      w = this.getContentWidth() + s.padding.right;\n    }\n\n    // 1. we're not in a layout and both right and left are defined\n    else if (!inLinearLayout && svWidth && s.right != undefined && s.left != undefined) {\n      w = availWidth / s.scale - (s.left || 0) - (s.right || 0);\n    }\n\n    // 2. width is defined a percent\n    else if (svWidth && s._layoutWidthIsPercent) {\n      w = availWidth / s.scale * s._layoutWidthValue;\n    }\n\n    // 3. width is inherited from the superview\n    else if (s.width == undefined && svWidth) {\n      w = availWidth / s.scale;\n    }\n\n    else {\n      w = s._width;\n    }\n\n    // enforce center anchor on width change\n    if (s.centerAnchor) {\n      s.anchorX = (w || 0) / 2;\n    }\n\n    // Note that we don't trigger any resize handlers here\n    s._width = w;\n\n    if (!inLinearLayout && svWidth) {\n      if (w !== undefined && s.centerX) { s.x = Math.round((availWidth - s.scale * w) / 2 + (padding && padding.left || 0)); }\n      if (w !== undefined && s.left == undefined && s.right != undefined) { s.x = Math.round(availWidth - s.scale * w - s.right - (padding && padding.right || 0)); }\n      if (s.left != undefined) { s.x = Math.round(s.left + (padding && padding.left || 0)); }\n    }\n  }\n\n  this.reflowY = function () {\n    var view = this._view;\n    var s = view.style;\n    var sv = view.getSuperview();\n    if (s.inLayout && sv.style.layout == 'linear') {\n      var inLinearLayout = sv.__layout.isVertical();\n      var padding = sv.style.padding;\n    }\n\n    var svHeight = sv.style.height;\n    var availHeight = svHeight - (padding && padding.getVertical() || 0);\n\n    var wrapContent = (s._layoutHeight == 'wrapContent');\n\n    // compute the height\n    var h;\n    if (wrapContent) {\n      h = this.getContentHeight() + s.padding.bottom;\n    } else if (!inLinearLayout && svHeight && s.top != undefined && s.bottom != undefined) {\n      h = availHeight / s.scale - (s.top || 0) - (s.bottom || 0);\n    } else if (svHeight && s._layoutHeightIsPercent) {\n      h = availHeight / s.scale * s._layoutHeightValue;\n    } else if (s.height == undefined && svHeight) {\n      h = availHeight / s.scale;\n    } else {\n      h = s.height;\n    }\n\n    // enforce center anchor on height change\n    if (s.centerAnchor) {\n      s.anchorY = (h || 0) / 2;\n    }\n\n    s._height = h;\n\n    if (!inLinearLayout && svHeight) {\n      if (h !== undefined && s.centerY) { s.y = Math.round((availHeight - s.scale * h) / 2 + (padding && padding.top || 0)); }\n      if (h !== undefined && s.top == undefined && s.bottom != undefined) { s.y = Math.round(availHeight - s.scale * h - s.bottom - (padding && padding.bottom || 0)); }\n      if (s.top != undefined) { s.y = Math.round(s.top + (padding && padding.top || 0)); }\n    }\n  }\n\n  this.getContentWidth = function () {\n    // find the maximal right edge\n    var w = 0;\n    var views = this._view.getSubviews();\n    for (var i = 0, v; v = views[i]; ++i) {\n      if (!v.style._layoutWidthIsPercent && v.style.visible) {\n        var right = v.style.x + v.style.width * v.style.scale + (v.style.right || 0);\n        if (right > w) {\n          w = right;\n        }\n      }\n    }\n    return w;\n  }\n\n  this.getContentHeight = function () {\n    // find the maximal bottom edge\n    var views = this._view.getSubviews();\n    var h = 0;\n    for (var i = 0, v; v = views[i]; ++i) {\n      if (!v.style._layoutHeightIsPercent && v.style.visible) {\n        var bottom = v.style.y + v.style.height * v.style.scale + (v.style.bottom || 0);\n        if (bottom > h) {\n          h = bottom;\n        }\n      }\n    }\n    return h;\n  }\n\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/layout/LinearLayout.js":{"path":"modules/devkit-core/modules/timestep/src/ui/layout/LinearLayout.js","friendlyPath":".LinearLayout","directory":"modules/devkit-core/modules/timestep/src/ui/layout/","filename":"LinearLayout.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * package ui.layout.LinearLayout;\n *\n * A class to direct the layout of its parent view, set through opts.parent.\n */\n\n/**\n * package ui.layout.LinearLayout;\n *\n * A class to direct the layout of its parent view, set through opts.parent.\n */\n\njsio('import ui.layout.Padding as Padding');\njsio('import ui.backend.strPad as strPad');\n\njsio('import .BoxLayout');\n\nvar DEBUG = false;\nif (DEBUG) {\n  var VIEW_STR = function (view) { return view + ' (' + view.uid + ')'; }\n  var _debug = {\n      space: '',\n      stepIn: function () { this.space += ' '; return true; },\n      stepOut: function () { this.space = this.space.slice(0, this.space.length - 1); return true; },\n      log: function () { logger.log.apply(logger, [this.space].concat(Array.prototype.slice.call(arguments, 0))); return true; }\n    };\n}\n\n// TODO: native\n// TODO: Resize event on width/height change\n// TODO: reflow on subview visibility change\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_layout_LinearLayout=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_layout_LinearLayout(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_layout_LinearLayout(){return this.init&&this.init.apply(this,arguments)},BoxLayout, function (supr) {\n\n  this.init = function () {\n    supr(this, 'init', arguments);\n\n    this._view.subscribe('SubviewAdded', this, '_onSubviewAdded');\n    this._view.subscribe('SubviewRemoved', this, '_onSubviewRemoved');\n\n    this._views = [];\n    var subviews = this._view.getSubviews();\n    for (var i = 0, view; view = subviews[i]; ++i) {\n      if (view.style.inLayout) {\n        this._views.push(this._initLayoutView(view));\n      }\n    }\n\n    this._forwardEvents();\n\n    this._debug = DEBUG;\n  }\n\n  this._onSubviewRemoved = function (view) {\n    if (view.style.inLayout) {\n      this.remove(view);\n    }\n  }\n\n  this._onSubviewAdded = function (view) {\n    if (view.style.inLayout) {\n      this.add(view);\n    }\n  }\n\n  this.debug = function () { this._debug = true; return this; }\n\n  this._setDirection = function (direction) {\n    this._direction = direction;\n\n    var isVertical = this.isVertical();\n    this._propPos = isVertical ? 'y' : 'x';\n    this._propPosOpp = isVertical ? 'x' : 'y';\n    this._propDim = isVertical ? '_height' : '_width';\n    this._minPropDim = isVertical ? 'minHeight' : 'minWidth';\n    this._maxPropDim = isVertical ? 'maxHeight' : 'maxWidth';\n    this._layoutPropDim = isVertical ? 'layoutHeight' : 'layoutWidth';\n    this._propDimOpp = isVertical ? '_width' : '_height';\n    this._propSideA = isVertical ? 'top' : 'left';\n    this._propSideB = isVertical ? 'bottom' : 'right';\n\n    this._flexProp = isVertical ? 'vflex' : 'hflex';\n  }\n\n  this.isVertical = function () { return this._direction == 'vertical'; }\n  this.isHorizontal = function () { return this._direction == 'horizontal'; }\n\n  /**\n   * Events to proxy to the parent view from this layout.\n   */\n  this._events = ['ViewWillAppear', 'ViewDidAppear', 'ViewWillDisappear', 'ViewDidDisappear'];\n\n  this._forwardEvents = function() {\n    for (var i = 0, a; a = this._events[i]; ++i) {\n      this._view.subscribe(a, this, '_forwardSignal', a);\n    }\n  };\n\n  this._events = ['ViewWillAppear', 'ViewDidAppear', 'ViewWillDisappear', 'ViewDidDisappear'];\n\n  /**\n   * Emit events on the children. Variable arguments.\n   */\n\n  this._forwardSignal = function () {\n    for (var i = 0, v; v = this._views[i]; ++i) {\n      v.view.publish.apply(v.view, arguments);\n    }\n  };\n\n  /**\n   * Initialize a subview controlled by this layout.\n   */\n\n  this._initLayoutView = function(view) {\n    view.style.inLayout = true;\n\n    this._debug && _debug.log('view', this._view.uid, 'layout: adding view', view.uid, '(' + this._propDim, '=', view.style[this._propDim] + ')');\n\n    // use connectEvent: prevents a memory leak\n    // acts like subscribe, but disconnects the event when this._view\n    // is not in the view hierarchy\n    this._view.connectEvent(view, 'Resize', bind(this, 'reflow'));\n\n    return {\n      view: view,\n      index: 0,\n      toString: toStringSort\n    };\n  };\n\n  function toStringSort () {\n    return this.view.style._sortOrder + this.index;\n  }\n\n  /**\n   * Return the size of this element (in its cardinal direction).\n   */\n\n  this.getSize = function () {\n    return this._size;\n  };\n\n  /**\n   * Return the index of a subview.\n   */\n\n  this.getViewIndex = function (view) {\n    for (var i = 0, d; d = this._views[i]; ++i) {\n      if (d.view == view) {\n        return i;\n      }\n    }\n    return -1;\n  };\n\n  /**\n   * Add an array of subviews to this element in batch (prevent reflow each\n   * time).\n   */\n\n  this.addSubviews = function (views) {\n    this._debug && _debug.log(this._view.uid, \"adding\", views.length, \"views\");\n    if (isArray(views)) {\n      for (var i = 0, n = views.length; i < n; ++i) {\n        var view = views[i];\n        if (view) {\n          this._views.push(this._initLayoutView(view));\n        }\n      }\n\n      this._view.needsReflow();\n    } else {\n      this.insertBefore(views);\n    }\n\n    return this;\n  }\n\n  /**\n   * Return the list of subviews controlled by this layout.\n   */\n\n  this.getSubviews = function () {\n    return this._views.map(function (v) { return v.view; });\n  };\n\n  /**\n   * Remove a subview controlled by this layout.\n   */\n\n  this.remove = function (view) {\n    var i = this.getViewIndex(view);\n    if (i != -1) {\n      this._views.splice(i, 1);\n      this._view.disconnectEvent(view, 'Resize');\n      this._view.needsReflow();\n      return;\n    }\n  }\n\n  /**\n   * Insert a subview before another subview in this hierarchy.\n   */\n\n  this.add =\n  this.insertBefore = function (view, before) {\n\n    if (this.getViewIndex(view) != -1) { return; }\n\n    var item = this._initLayoutView(view);\n    var added = false;\n    if (before) {\n      var i = this.getViewIndex(before);\n      if (i != -1) {\n        this._views.splice(i, 0, item);\n        added = true;\n      }\n    }\n\n    if (!added) {\n      this._views.push(item);\n    }\n\n    this._view.needsReflow();\n  }\n\n  /**\n   * Insert a subview after another subview in this hierarchy.\n   */\n\n  this.insertAfter = function (view, after) {\n\n    if (this.getViewIndex(view) != -1) { return; }\n\n    var item = this._initLayoutView(view);\n    var added = false;\n    if (after) {\n      var i = this.getViewIndex(after);\n      if (i != -1) {\n        this._views.splice(i + 1, 0, item);\n        added = true;\n      }\n    }\n\n    if (!added) {\n      this._views.unshift(item);\n    }\n\n    this._view.needsReflow();\n  }\n\n  /**\n   * Reflow logic.\n   */\n\n  this.reflow = function () {\n    supr(this, 'reflow', arguments);\n\n    // Get the position of each view in the subview array. This index\n    // will be used as the secondary sorting key.\n    var children = this._view.getSubviews();\n    var indexMap = {};\n    for (var i = 0, v; v = children[i]; ++i) {\n      indexMap[v.uid] = strPad.pad(i);\n    }\n\n    // style.order is first, then default to the views position in the\n    // subview array.\n    var n = 0;\n    for (var i = 0, v; v = this._views[i]; ++i) {\n      if (v.view.style.visible) {\n        v.index = indexMap[v.view.uid];\n\n        ++n;\n      }\n    }\n\n    if (!n) { return; }\n\n    this._views.sort();\n\n    var layoutStyle = this._view.style;\n    if (layoutStyle.direction != this._direction) {\n      this._setDirection(layoutStyle.direction);\n    }\n\n    var scale = this._view.getPosition().scale;\n\n    var isVertical = this._direction == 'vertical';\n    var propDim = this._propDim;\n    var propDimOpp = this._propDimOpp;\n    var minPropDim = this._minPropDim;\n    var propA = this._propSideA;\n    var propB = this._propSideB;\n    var padding = layoutStyle.padding;\n    var paddingSum = padding && (isVertical ? padding.getVertical() : padding.getHorizontal()) || 0;\n    var parentDim = layoutStyle[propDim];\n    var views = this._views;\n\n    this._debug && _debug.log(VIEW_STR(this._view) + ': layout', this._direction + ',', views.length, 'subview(s):') && _debug.stepIn() && this._summarize();\n\n    // compute the total size of the fixed views and count\n    // how many dynamically sized views we have\n    var viewSizeSum = 0;\n    var flexSum = 0;\n    for (var i = 0, v; v = views[i]; ++i) {\n      var s = v.view.style;\n      if (!s.visible) { continue; }\n      v.view.reflowSync();\n\n      v.margins = (s[propA] || 0) + (s[propB] || 0);\n\n      if (s.flex) {\n        flexSum += s.flex;\n        v.baseSize = (s[minPropDim] || 0) * s.scale + v.margins;\n        viewSizeSum += v.baseSize;\n      } else {\n        viewSizeSum += (s[propDim] || 0) * s.scale + v.margins;\n      }\n    }\n\n    if (flexSum && parentDim == undefined) { return; }\n\n    // compute available space\n    var availableSpace = parentDim - paddingSum;\n    if (availableSpace < 0) { return; }\n\n    // if there's a flex subview, the total size is the availableSpace\n    // otherwise the totalSize is the sum of the subview sizes\n    var justifyContent = layoutStyle.justifyContent;\n    var totalSize = flexSum ? parentDim : viewSizeSum + paddingSum;\n    var flexSize = availableSpace - viewSizeSum;\n\n    // compute the space for each flexible view\n    var flexUsed = 0;\n    var balance = 0;\n    for (var i = 0, v; v = views[i]; ++i) {\n      var s = v.view.style;\n      if (!s.visible) { continue; }\n\n      if (s.flex) {\n        // compute the ideal space for the flex view\n        var idealSpace = v.baseSize + flexSize * (s.flex / flexSum) / s.scale + balance;\n\n        // round to the nearest screen pixel (take into account the global scale of the layout view)\n        var roundedSpace = Math.round(idealSpace * scale) / scale;\n\n        // propogate the balance into the next view space computation\n        balance = idealSpace - roundedSpace;\n\n        // store the actual space for the view, which is the computed space minus the margins\n        v.dim = roundedSpace - v.margins;\n\n        // account for maximal bound\n        if (v.dim > s[this._maxPropDim]) {\n          v.dim = s[this._maxPropDim];\n        }\n\n        // keep track of used flex space\n        flexUsed += roundedSpace;\n      }\n    }\n\n    var flexRemaining = flexSize - flexUsed;\n\n    // set the position of the views\n    var pos = padding && padding[propA] || 0;\n    var gap = 0;\n    if (flexRemaining > 0) {\n      // there's unused space, so justify our views\n      switch (justifyContent) {\n        case 'end':\n          pos += flexRemaining;\n          break;\n        case 'center':\n          pos += flexRemaining / 2;\n          break;\n        case 'space':\n          gap = flexRemaining / (n - 1) || 0;\n          break;\n        case 'space-outside':\n          gap = flexRemaining / (n + 1) || 0;\n          pos += gap;\n          break;\n        case 'start':\n        default:\n          break;\n      }\n    }\n\n    // position and size views!\n    var propPos = this._propPos;\n    for (var i = 0, v; v = views[i]; ++i) {\n      pos = ((pos * scale) | 0) / scale;\n      var s = v.view.style;\n      if (!s.visible) { continue; }\n\n      // set position\n      s[propPos] = pos + (s[propA] || 0);\n\n      this._debug && _debug.log('->', VIEW_STR(v.view), propPos, '=', s[propPos]);\n\n      if (s.flex) {\n        // set width\n        s[propDim] = v.dim;\n\n        this._debug && _debug.log('->', VIEW_STR(v.view), propDim, '=', s[propDim]);\n      }\n\n      // advance position\n      pos += gap + (s[propDim] || 0) * s.scale + v.margins;\n    }\n\n    this._debug && this._summarize() && _debug.stepOut();\n\n    if (isVertical && layoutStyle.layoutHeight == 'wrapContent') {\n      this.reflowY();\n    } else if (!isVertical && layoutStyle.layoutWidth == 'wrapContent') {\n      this.reflowX();\n    }\n\n    if (this._size != totalSize) {\n      this._size = totalSize;\n      // this._view.publish('LayoutResize', totalSize);\n    }\n  };\n\n  this._summarize = function () {\n    var views = this._views;\n    for (var i = 0, v; v = views[i]; ++i) {\n      var s = v.view.style;\n      _debug.log('*', VIEW_STR(v.view) + ': ' + (!s.visible ? 'invisible' : ''), s.x + ',' + s.y + '-' + s.width + 'x' + s.height + ' (flex=' + (s.flex || 0) + ')');\n    }\n\n    return true;\n  }\n});\n\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/layout/Padding.js":{"path":"modules/devkit-core/modules/timestep/src/ui/layout/Padding.js","friendlyPath":"ui.layout.Padding","directory":"modules/devkit-core/modules/timestep/src/ui/layout/","filename":"Padding.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package ui.layout.Padding;\n *\n * A simple class to express padding views.\n */\n\nPadding=__class__;exports = Padding=Padding(function Padding(){return this.init&&this.init.apply(this,arguments)},function () {\n  this.init =\n  this.update = function (args) {\n    if (args instanceof Padding) {\n      this.top = args.top;\n      this.right = args.right;\n      this.bottom = args.bottom;\n      this.left = args.left;\n      return;\n    }\n    if (typeof args == 'string') {\n      args = args.split(/\\s+/).map(function (piece) { return parseFloat(piece); });\n    }\n\n    if (!args || !args.length) { args = [args || 0]; }\n\n    switch (args.length) {\n      case 1:\n        this.left = this.right = this.top = this.bottom = args[0];\n        break;\n      case 2:\n        this.top = this.bottom = args[0];\n        this.left = this.right = args[1];\n        break;\n      case 3:\n        this.top = args[0];\n        this.left = this.right = args[1];\n        this.bottom = args[2];\n        break;\n      case 4:\n        this.top = args[0];\n        this.right = args[1];\n        this.bottom = args[2];\n        this.left = args[3];\n        break;\n    }\n  }\n\n  this.getVertical = function () { return this.top + this.bottom; }\n  this.getHorizontal = function () { return this.left + this.right; }\n\n  this.toString = function () { return [this.top, this.right, this.bottom, this.left].join(' '); }\n});","pre":true},"modules/devkit-core/modules/timestep/src/platforms/native/FontRenderer.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/native/FontRenderer.js","friendlyPath":".FontRenderer","directory":"modules/devkit-core/modules/timestep/src/platforms/native/","filename":"FontRenderer.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package env.browser.FontRenderer;\n *\n * Render fonts or custom fonts on a Canvas context.\n */\n\njsio('import ui.Color as Color');\njsio('import ui.filter as filter');\njsio('import ui.resource.Font as Font');\n\nvar max = Math.max;\n\nvar _customFonts = {};\nvar _customFontInfo = {};\n\nexports.init = function () {\n  var manifest = window.CONFIG;\n  if (manifest && manifest.fonts) {\n    var fonts = manifest.fonts;\n    for (var i = 0, len = fonts.length; i < len; i++) {\n      var font = fonts[i];\n      var customFont = {\n        fontName: font.fontName,\n        settings: font,\n        imagesLoaded: -1,\n        imagesTotal: 0,\n        loaded: false\n      }\n      _customFonts[font.fontName] = customFont;\n      loadingCustomFont(customFont);\n    }\n  }\n};\n\nvar loadCustomFontImage = function(customFont, index, stroke) {\n  var img = new Image();\n  var url = 'resources/fonts/' + customFont.fontName + '_' + index + (stroke ? '_Stroke.png' : '.png');\n  img.onload = function () {\n    img.onload = null;\n    customFont.imagesLoaded++;\n    customFont.loaded = (customFont.imagesLoaded === customFont.imagesTotal);\n  };\n  img._src = url;\n  img.src = url;\n  return img;\n};\n\nvar findVerticalInfo = function(dimensions) {\n  // A..Z, a..z, all\n  var ranges = [{start: 0x41, end: 0x5A}, {start: 0x61, end: 0x7A}, {start: 0x20, end: 0xFF}];\n  var found = false;\n  var baseline = 0;\n  var bottom = 0;\n  for (var i = 0, len = ranges.length; i < len; i++) {\n    var range = ranges[i];\n    for (var j = range.start; j <= range.end; j++) {\n      var dimension = dimensions[j];\n      if (dimension) {\n        baseline = max(baseline, dimension.h);\n        bottom = max(bottom, dimension.h);\n        found = true;\n      }\n    }\n    if (found) {\n      break;\n    }\n  }\n  return { baseline: baseline, bottom: bottom };\n};\n\nvar findHorizontalInfo = function(dimensions) {\n  // a..z, A..Z\n  var ranges = [{start: 0x61, end: 0x7A}, {start: 0x41, end: 0x5A}, {start: 0x20, end: 0xFF}];\n  var width = 0;\n  var count = 0;\n  for (var i = 0, len = ranges.length; i < len; i++) {\n    var range = ranges[i];\n    for (var j = range.start; j <= range.end; j++) {\n      var dimension = dimensions[j];\n      if (dimension) {\n        width += dimension.w;\n        count++;\n      }\n    }\n    if (count !== 0) {\n      break;\n    }\n  }\n  return { width: 0.8 * width / count };\n};\n\nvar loadingCustomFont = function(customFont) {\n  if (customFont.imagesLoaded !== -1) {\n    return !customFont.loaded;\n  }\n\n  var settings = customFont.settings;\n  var fontName = settings.fontName;\n  var info = _customFontInfo[fontName];\n  if (info) {\n    customFont.dimensions = info.dimensions;\n    customFont.horizontal = info.horizontal;\n    customFont.vertical = info.vertical;\n  } else {\n    var json = CACHE['resources/fonts/' + fontName + '.json'];\n    customFont.dimensions = JSON.parse(json);\n    customFont.horizontal = findHorizontalInfo(customFont.dimensions);\n    customFont.vertical = findVerticalInfo(customFont.dimensions);\n\n    _customFontInfo[fontName] = {\n      dimensions: customFont.dimensions,\n      horizontal: customFont.horizontal,\n      vertical: customFont.vertical\n    };\n  }\n\n  var images = customFont.images = [];\n  var strokeImages = customFont.strokeImages = [];\n  customFont.imagesLoaded = 0;\n  for (var i = 0; i < settings.count; i++) {\n    images.push(loadCustomFontImage(customFont, i, false));\n    customFont.imagesTotal++;\n    if (customFont.settings.stroke) {\n      strokeImages.push(loadCustomFontImage(customFont, i, true));\n      customFont.imagesTotal++;\n    }\n  }\n  return true;\n};\n\nexports.findFontInfo = function (ctx) {\n  var font = Font.parse(ctx.font);\n  var name = font.getName();\n  if (name && _customFonts[name]) {\n    customFont = _customFonts[name];\n    font.customFont = customFont;\n    font.scale = font.getSize() / customFont.settings.size;\n    return font;\n  }\n  return null;\n};\n\nexports.wrapMeasureText = function (origMeasureText) {\n  return function (text) {\n    var fontInfo = exports.findFontInfo(this);\n    if (!fontInfo) {\n      return origMeasureText.apply(this, arguments);\n    }\n    if (loadingCustomFont(fontInfo.customFont)) {\n      return origMeasureText.apply(this, arguments);\n    }\n    var measureInfo = this._ctx.measureTextBitmap(text + '', fontInfo);\n    if (measureInfo.failed) {\n      return origMeasureText.apply(this, arguments);\n    }\n    return measureInfo;\n  }\n};\n\nexports.wrapFillText = function (origFillText) {\n  return function (text, x, y, maxWidth) {\n    var fontInfo = exports.findFontInfo(this);\n    if (!fontInfo) {\n      return origFillText.apply(this, arguments);\n    }\n    if (loadingCustomFont(fontInfo.customFont)) {\n      return;\n    }\n\n    var color = Color.parse(this.fillStyle);\n    if (this.__compositeColor !== color) {\n      this.__compositeColor = color;\n      if (!this.__compositeFilter) {\n        this.__compositeFilter = new filter.MultiplyFilter(color);\n      }\n      this.__compositeFilter.update(color);\n    }\n    this.setFilter(this.__compositeFilter);\n\n    if (!this._ctx.fillTextBitmap(this, x, y, text + '', maxWidth, this.fillStyle, fontInfo, 0)) {\n      return origFillText.apply(this, arguments);\n    }\n  }\n};\n\nexports.wrapStrokeText = function (origStrokeText) {\n  return function (text, x, y, maxWidth) {\n    var resetFilters = false;\n    var fontInfo = exports.findFontInfo(this);\n    if (!fontInfo) {\n      return origStrokeText.apply(this, arguments);\n    }\n    if (loadingCustomFont(fontInfo.customFont)) {\n      return;\n    }\n\n    var color = Color.parse(this.strokeStyle);\n    if (this.__compositeStrokeColor !== color) {\n      this.__compositeStrokeColor = color;\n      if (!this.__compositeStrokeFilter) {\n        this.__compositeStrokeFilter = new filter.MultiplyFilter(color);\n      }\n      this.__compositeStrokeFilter.update(color);\n    }\n    this.setFilter(this.__compositeStrokeFilter);\n\n    if (!this._ctx.fillTextBitmap(this, x, y, text + '', maxWidth, this.strokeStyle, fontInfo, 1)) {\n      return origStrokeText.apply(this, arguments);\n    }\n  }\n};\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/Color.js":{"path":"modules/devkit-core/modules/timestep/src/ui/Color.js","friendlyPath":"ui.Color","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"Color.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.Color\n *\n * @doc http://doc.gameclosure.com/api/color.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/color.md\n */\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_Color=__class__;var RGBA = exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_Color(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_Color(){return this.init&&this.init.apply(this,arguments)},function () {\n\n  this.init = function () {\n    this.r = 0;\n    this.g = 0;\n    this.b = 0;\n    this.a = 1;\n\n    this.update.apply(this, arguments);\n  };\n\n  this.update = function (rgba) {\n    if (arguments.length > 2) {\n      this.r = arguments[0];\n      this.g = arguments[1];\n      this.b = arguments[2];\n      this.a = arguments[3] !== undefined ? arguments[3] : 1;\n    } else if (typeof rgba === 'string') {\n      var cached = cache[rgba];\n      if (cached) {\n        this.set(cached);\n      } else {\n        this.parse(rgba);\n      }\n    } else if (rgba) {\n      this.set(rgba);\n    }\n  };\n\n  this.get = function () {\n    return {\n      r: this.r,\n      g: this.g,\n      b: this.b,\n      a: this.a\n    };\n  };\n\n  this.set = function (rgba) {\n    if (rgba !== undefined) {\n      this.r = rgba.r || 0;\n      this.g = rgba.g || 0;\n      this.b = rgba.b || 0;\n      this.a = rgba.a !== undefined ? rgba.a : 1;\n    }\n  };\n\n  var rgbParser = /rgba?\\(\\s*([.0-9]+)\\s*,\\s*([.0-9]+)\\s*,\\s*([.0-9]+)\\s*,?\\s*([.0-9]+)?\\s*\\)/;\n\n  function hexToRGB(a) {\n    a = '0x' + a.slice(1).replace(a.length < 5 && /./g, '$&$&');\n    return [a >> 16, a >> 8 & 255, a & 255];\n  };\n\n  this.parse = function (str) {\n    var match = str.match(rgbParser);\n    if (match) {\n      this.r = parseInt(match[1]) || 0;\n      this.g = parseInt(match[2]) || 0;\n      this.b = parseInt(match[3]) || 0;\n      if (match[4] !== undefined) {\n        var a = parseFloat(match[4]);\n        this.a = isNaN(a) ? 1 : a;\n      } else {\n        this.a = 1;\n      }\n    } else {\n      // handles hex strings (#FC0, #FFCC00, #FC09, #FFCC0099)\n      this.a = 1;\n      var len = str.length;\n      if (len === 5) {\n        var a = str.substring(4, 5);\n        this.a = ('0x' + a + a | 0) / 255;\n        str = str.substring(0, 4);\n      } else if (len === 9) {\n        this.a = ('0x' + str.substring(7, 9) | 0) / 255;\n        str = str.substring(0, 7);\n      }\n      var match = hexToRGB(str);\n      if (match) {\n        this.r = match[0];\n        this.g = match[1];\n        this.b = match[2];\n      }\n    }\n  };\n\n  this.toHex = function () {\n    return \"#\" + ((256 + this.r << 8 | this.g) << 8 | this.b).toString(16).slice(1);\n  };\n\n  this.toString = function () {\n    return 'rgba(' + this.r + ',' + this.g + ',' + this.b + ',' + this.a + ')';\n  };\n\n});\n\nexports.parse = function (str) {\n  return cache[str] || (cache[str] = new RGBA(str));\n};\n\nvar cache = {\n  aliceblue:            new RGBA(240, 248, 255),\n  antiquewhite:         new RGBA(250, 235, 215),\n  aqua:                 new RGBA(  0, 255, 255),\n  aquamarine:           new RGBA(127, 255, 212),\n  azure:                new RGBA(240, 255, 255),\n  beige:                new RGBA(245, 245, 220),\n  bisque:               new RGBA(255, 228, 196),\n  black:                new RGBA(  0,   0,   0),\n  blanchedalmond:       new RGBA(255, 235, 205),\n  blue:                 new RGBA(  0,   0, 255),\n  blueviolet:           new RGBA(138,  43, 226),\n  brown:                new RGBA(165,  42,  42),\n  burlywood:            new RGBA(222, 184, 135),\n  cadetblue:            new RGBA( 95, 158, 160),\n  chartreuse:           new RGBA(127, 255,   0),\n  chocolate:            new RGBA(210, 105,  30),\n  coral:                new RGBA(255, 127,  80),\n  cornflowerblue:       new RGBA(100, 149, 237),\n  cornsilk:             new RGBA(255, 248, 220),\n  crimson:              new RGBA(220,  20,  60),\n  cyan:                 new RGBA(  0, 255, 255),\n  darkblue:             new RGBA(  0,   0, 139),\n  darkcyan:             new RGBA(  0, 139, 139),\n  darkgoldenrod:        new RGBA(184, 134,  11),\n  darkgray:             new RGBA(169, 169, 169),\n  darkgreen:            new RGBA(  0, 100,   0),\n  darkgrey:             new RGBA(169, 169, 169),\n  darkkhaki:            new RGBA(189, 183, 107),\n  darkmagenta:          new RGBA(139,   0, 139),\n  darkolivegreen:       new RGBA( 85, 107,  47),\n  darkorange:           new RGBA(255, 140,   0),\n  darkorchid:           new RGBA(153,  50, 204),\n  darkred:              new RGBA(139,   0,   0),\n  darksalmon:           new RGBA(233, 150, 122),\n  darkseagreen:         new RGBA(143, 188, 143),\n  darkslateblue:        new RGBA( 72,  61, 139),\n  darkslategray:        new RGBA( 47,  79,  79),\n  darkslategrey:        new RGBA( 47,  79,  79),\n  darkturquoise:        new RGBA(  0, 206, 209),\n  darkviolet:           new RGBA(148,   0, 211),\n  deeppink:             new RGBA(255,  20, 147),\n  deepskyblue:          new RGBA(  0, 191, 255),\n  dimgray:              new RGBA(105, 105, 105),\n  dimgrey:              new RGBA(105, 105, 105),\n  dodgerblue:           new RGBA( 30, 144, 255),\n  firebrick:            new RGBA(178,  34,  34),\n  floralwhite:          new RGBA(255, 250, 240),\n  forestgreen:          new RGBA( 34, 139,  34),\n  fuchsia:              new RGBA(255,   0, 255),\n  gainsboro:            new RGBA(220, 220, 220),\n  ghostwhite:           new RGBA(248, 248, 255),\n  gold:                 new RGBA(255, 215,   0),\n  goldenrod:            new RGBA(218, 165,  32),\n  gray:                 new RGBA(128, 128, 128),\n  grey:                 new RGBA(128, 128, 128),\n  green:                new RGBA(  0, 128,   0),\n  greenyellow:          new RGBA(173, 255,  47),\n  honeydew:             new RGBA(240, 255, 240),\n  hotpink:              new RGBA(255, 105, 180),\n  indianred:            new RGBA(205,  92,  92),\n  indigo:               new RGBA( 75,   0, 130),\n  ivory:                new RGBA(255, 255, 240),\n  khaki:                new RGBA(240, 230, 140),\n  lavender:             new RGBA(230, 230, 250),\n  lavenderblush:        new RGBA(255, 240, 245),\n  lawngreen:            new RGBA(124, 252,   0),\n  lemonchiffon:         new RGBA(255, 250, 205),\n  lightblue:            new RGBA(173, 216, 230),\n  lightcoral:           new RGBA(240, 128, 128),\n  lightcyan:            new RGBA(224, 255, 255),\n  lightgoldenrodyellow: new RGBA(250, 250, 210),\n  lightgray:            new RGBA(211, 211, 211),\n  lightgreen:           new RGBA(144, 238, 144),\n  lightgrey:            new RGBA(211, 211, 211),\n  lightpink:            new RGBA(255, 182, 193),\n  lightsalmon:          new RGBA(255, 160, 122),\n  lightseagreen:        new RGBA( 32, 178, 170),\n  lightskyblue:         new RGBA(135, 206, 250),\n  lightslategray:       new RGBA(119, 136, 153),\n  lightslategrey:       new RGBA(119, 136, 153),\n  lightsteelblue:       new RGBA(176, 196, 222),\n  lightyellow:          new RGBA(255, 255, 224),\n  lime:                 new RGBA(  0, 255,   0),\n  limegreen:            new RGBA( 50, 205,  50),\n  linen:                new RGBA(250, 240, 230),\n  magenta:              new RGBA(255,   0, 255),\n  maroon:               new RGBA(128,   0,   0),\n  mediumaquamarine:     new RGBA(102, 205, 170),\n  mediumblue:           new RGBA(  0,   0, 205),\n  mediumorchid:         new RGBA(186,  85, 211),\n  mediumpurple:         new RGBA(147, 112, 219),\n  mediumseagreen:       new RGBA( 60, 179, 113),\n  mediumslateblue:      new RGBA(123, 104, 238),\n  mediumspringgreen:    new RGBA(  0, 250, 154),\n  mediumturquoise:      new RGBA( 72, 209, 204),\n  mediumvioletred:      new RGBA(199,  21, 133),\n  midnightblue:         new RGBA( 25,  25, 112),\n  mintcream:            new RGBA(245, 255, 250),\n  mistyrose:            new RGBA(255, 228, 225),\n  moccasin:             new RGBA(255, 228, 181),\n  navajowhite:          new RGBA(255, 222, 173),\n  navy:                 new RGBA(  0,   0, 128),\n  oldlace:              new RGBA(253, 245, 230),\n  olive:                new RGBA(128, 128,   0),\n  olivedrab:            new RGBA(107, 142,  35),\n  orange:               new RGBA(255, 165,   0),\n  orangered:            new RGBA(255,  69,   0),\n  orchid:               new RGBA(218, 112, 214),\n  palegoldenrod:        new RGBA(238, 232, 170),\n  palegreen:            new RGBA(152, 251, 152),\n  paleturquoise:        new RGBA(175, 238, 238),\n  palevioletred:        new RGBA(219, 112, 147),\n  papayawhip:           new RGBA(255, 239, 213),\n  peachpuff:            new RGBA(255, 218, 185),\n  peru:                 new RGBA(205, 133,  63),\n  pink:                 new RGBA(255, 192, 203),\n  plum:                 new RGBA(221, 160, 221),\n  powderblue:           new RGBA(176, 224, 230),\n  purple:               new RGBA(128,   0, 128),\n  red:                  new RGBA(255,   0,   0),\n  rosybrown:            new RGBA(188, 143, 143),\n  royalblue:            new RGBA( 65, 105, 225),\n  saddlebrown:          new RGBA(139,  69,  19),\n  salmon:               new RGBA(250, 128, 114),\n  sandybrown:           new RGBA(244, 164,  96),\n  seagreen:             new RGBA( 46, 139,  87),\n  seashell:             new RGBA(255, 245, 238),\n  sienna:               new RGBA(160,  82,  45),\n  silver:               new RGBA(192, 192, 192),\n  skyblue:              new RGBA(135, 206, 235),\n  slateblue:            new RGBA(106,  90, 205),\n  slategray:            new RGBA(112, 128, 144),\n  slategrey:            new RGBA(112, 128, 144),\n  snow:                 new RGBA(255, 250, 250),\n  springgreen:          new RGBA(  0, 255, 127),\n  steelblue:            new RGBA( 70, 130, 180),\n  tan:                  new RGBA(210, 180, 140),\n  teal:                 new RGBA(  0, 128, 128),\n  thistle:              new RGBA(216, 191, 216),\n  tomato:               new RGBA(255,  99,  71),\n  transparent:          new RGBA(  0,   0,   0,   0),\n  turquoise:            new RGBA( 64, 224, 208),\n  violet:               new RGBA(238, 130, 238),\n  wheat:                new RGBA(245, 222, 179),\n  white:                new RGBA(255, 255, 255),\n  whitesmoke:           new RGBA(245, 245, 245),\n  yellow:               new RGBA(255, 255,   0),\n  yellowgreen:          new RGBA(154, 205,  50)\n};\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/filter.js":{"path":"modules/devkit-core/modules/timestep/src/ui/filter.js","friendlyPath":"ui.filter","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"filter.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @module ui.filter;\n *\n * A namespace for graphical filters used in games. These are attached using\n * View functions and applied using the Image class. This class is purely informational.\n *\n * If this is a namespace, the file name should be lower-case!\n *\n * Resources:\n *  http://jswidget.com/blog/2011/03/11/image-blending-algorithmpart-i/\n *  http://jswidget.com/blog/2011/03/11/image-blending-algorithmpart-ii/\n *\n * @doc http://doc.gameclosure.com/api/ui-filter.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/filter.md\n */\n\njsio('import ui.Color as Color');\n\nvar Image;\n\nexports.Filter=__class__;var Filter = exports.Filter=exports.Filter(function exports_Filter(){return this.init&&this.init.apply(this,arguments)},function () {\n\n  this.init = function (opts) {\n    this._color = new Color(opts);\n    this._type = opts.type || '';\n    this._views = [];\n  };\n\n  this.get = function () {\n    var opts = this._color.get();\n    opts.type = this._type;\n    opts.priority = 0;\n    return opts;\n  };\n\n  this.getType = function () {\n    return this._type;\n  };\n\n  this.update = function (opts) {\n    opts = opts || this.get();\n    this._color.update(opts);\n    this._type = opts.type !== undefined ? opts.type : this._type;\n\n    var views = this._views;\n    for (var i = 0, len = views.length; i < len; i++) {\n      var view = views[i];\n      view.__view.filterColor = this.getColorString();\n      view.__view.filterType = Filter.TYPES[this.getType()] || 0;\n    }\n  };\n\n  this.setView = function (view) {\n    var views = this._views;\n    if (views.indexOf(view) === -1) {\n      views.push(view);\n    }\n  };\n\n  this.removeView = function (view) {\n    var views = this._views;\n    var i = views.indexOf(view);\n    if (i !== -1) {\n      views.splice(i, 1);\n    }\n  };\n\n  this.getColorString = function () {\n    return this._color.toString();\n  };\n\n});\n\nFilter.TYPES = {\n  \"None\": 0,\n  \"LinearAdd\": 1,\n  \"Multiply\": 2,\n  \"Tint\": 3\n};\n\n/**\n * Linear add (lighten) filter.\n */\n\nexports.LinearAddFilter=__class__;exports.LinearAddFilter=exports.LinearAddFilter(function exports_LinearAddFilter(){return this.init&&this.init.apply(this,arguments)},Filter, function (supr) {\n  this.init = function (opts) {\n    supr(this, 'init', arguments);\n    this._type = 'LinearAdd';\n  };\n});\n\n/**\n * Tint (averaging) filter.\n */\n\nexports.TintFilter=__class__;exports.TintFilter=exports.TintFilter(function exports_TintFilter(){return this.init&&this.init.apply(this,arguments)},Filter, function (supr) {\n  this.init = function (opts) {\n    supr(this, 'init', arguments);\n    this._type = 'Tint';\n  };\n});\n\n/**\n * Multiply filter.\n */\n\nexports.MultiplyFilter=__class__;exports.MultiplyFilter=exports.MultiplyFilter(function exports_MultiplyFilter(){return this.init&&this.init.apply(this,arguments)},Filter, function (supr) {\n  this.init = function (opts) {\n    supr(this, 'init', arguments);\n    this._type = 'Multiply';\n  };\n});\n\n/**\n * Positive masking.\n */\n\nexports.PositiveMaskFilter=__class__;exports.PositiveMaskFilter=exports.PositiveMaskFilter(function exports_PositiveMaskFilter(){return this.init&&this.init.apply(this,arguments)},Filter, function (supr) {\n  this.init = function (opts) {\n    supr(this, 'init', arguments);\n    this._type = 'PositiveMask';\n    if (opts.image) {\n      Image = Image || jsio('import ui.resource.Image');\n      this._mask = new Image({ url: opts.image });\n    }\n  };\n\n  this.getMask = function () {\n    return this._mask;\n  };\n});\n\n/**\n * Negative masking.\n */\n\nexports.NegativeMaskFilter=__class__;exports.NegativeMaskFilter=exports.NegativeMaskFilter(function exports_NegativeMaskFilter(){return this.init&&this.init.apply(this,arguments)},Filter, function (supr) {\n  this.init = function (opts) {\n    supr(this, 'init', arguments);\n    this._type = 'NegativeMask';\n    if (opts.image) {\n      Image = Image || jsio('import ui.resource.Image');\n      this._mask = new Image({ url: opts.image });\n    }\n  };\n\n  this.getMask = function () {\n    return this._mask;\n  };\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/native/Input.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/native/Input.js","friendlyPath":".Input","directory":"modules/devkit-core/modules/timestep/src/platforms/native/","filename":"Input.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import event.input.InputEvent as InputEvent');\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_platforms_native_Input=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_platforms_native_Input(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_platforms_native_Input(){return this.init&&this.init.apply(this,arguments)},function () {\n  if (NATIVE.timestep && NATIVE.timestep.getEvents) {\n    if (!NATIVE.timestep.InputEvent) {\n      NATIVE.timestep.InputEvent = InputEvent;\n    }\n\n    this.getEvents = function () {\n      return NATIVE.timestep.getEvents();\n    }\n  } else {\n    this.getEvents = function () {\n      var raw = NATIVE.input.getTouchEvents(),\n        evts = [];\n      \n      var j = 0;\n      for(var i = 0, e; e = raw[i]; ++i) {\n        evts[j++] = new InputEvent(e.id, e.type, e.pt);\n        if (e.type == 'input:select') {\n          evts[j++] = new InputEvent(e.id, 'input:clear', e.pt.x, e.pt.y);\n        }\n      }\n      return evts;\n    }\n  }\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/native/inputDialog.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/native/inputDialog.js","friendlyPath":".inputDialog","directory":"modules/devkit-core/modules/timestep/src/platforms/native/","filename":"inputDialog.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n /* globals NATIVE */\n\njsio('import ...ui.keyboardTypes');\n\nvar _controllers = {};\n\nNATIVE.input.subscribe('InputPromptSubmit', function (evt) {\n  var controller = _controllers[evt.id];\n  if (controller) {\n    controller.setValue(evt.text);\n    controller.onChange && controller.onChange(evt.text);\n    controller.onSubmit && controller.onSubmit(evt.text);\n    delete _controllers[evt.id];\n  } else {\n    logger.WARN&&console.warn(\"WARN\",\".inputDialog\",'Dropping InputPrompt event: ' + JSON.stringify(evt));\n  }\n});\n\nNATIVE.input.subscribe('Cancel', function (evt) {\n  var controller = _controllers[evt.id];\n  if (controller) {\n    controller.onChange && controller.onChange(controller.getValue());\n    delete _controllers[evt.id];\n  } else {\n    logger.WARN&&console.warn(\"WARN\",\".inputDialog\",'Dropping InputPrompt event: ' + JSON.stringify(evt));\n  }\n});\n\nexports.show = function (controller, opts) {\n  var id = NATIVE.input.openPrompt(\n      '' + opts.title,\n      '' + opts.message,\n      '' + opts.okText,\n      '' + opts.cancelText,\n      '' + opts.value,\n      !!opts.autoFocus,\n      !!opts.isPassword,\n      ui.keyboardTypes.getNativeType(opts.keyboardType));\n\n  _controllers[id] = controller;\n};\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/native/StatusBar.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/native/StatusBar.js","friendlyPath":".StatusBar","directory":"modules/devkit-core/modules/timestep/src/platforms/native/","filename":"StatusBar.js","src":"\nexports.show = function() {\n  NATIVE.statusBar && NATIVE.statusBar.showStatusBar && NATIVE.statusBar.showStatusBar();\n};\n\nexports.hide = function() {\n  NATIVE.statusBar && NATIVE.statusBar.hideStatusBar && NATIVE.statusBar.hideStatusBar();\n};\n\nexports.getHeight = function () {\n  return NATIVE.statusBar && NATIVE.statusBar.statusBarHeight;\n}\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/native/KeyListener.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/native/KeyListener.js","friendlyPath":".KeyListener","directory":"modules/devkit-core/modules/timestep/src/platforms/native/","filename":"KeyListener.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_platforms_native_KeyListener=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_platforms_native_KeyListener(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_platforms_native_KeyListener(){return this.init&&this.init.apply(this,arguments)},'timestep.KeyListener', function (logger, supr) {\n  this.init = function () {\n    this._shortcuts = [];\n    this._events = [];\n  }\n\n\n  this.setEnabled = function (isEnabled) { this._isEnabled = isEnabled; }\n\n  this.captureShortcut = function (shortcut) {\n    this._shortcuts.push(shortcut);\n  }\n  \n  this.getPressed = function () { return {}; }\n\n  this.onKeyDown = function (e) {\n    \n  }\n  \n  this.liftAll = function () {\n  } \n  this.onKeyUp = function (e) {\n  }\n  \n  this.onKeyPress = function (e) {\n  }\n  \n  this.peekEvents = function () { return this._events; }\n  this.popEvents = function () { return this._events.splice(0, this._events.length); }\n});\n\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/native/TextBox.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/native/TextBox.js","friendlyPath":".TextBox","directory":"modules/devkit-core/modules/timestep/src/platforms/native/","filename":"TextBox.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_platforms_native_TextBox=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_platforms_native_TextBox(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_platforms_native_TextBox(){return this.init&&this.init.apply(this,arguments)},function () {\n  var T = NATIVE.textbox;\n  var SLICE = Array.prototype.slice;\n  \n  var defaults = {\n    x: 0,\n    y: 0,\n    width: 100,\n    height: 30,\n    text: \"\",\n    color: \"white\"\n  };  \n  this.init = function (opts) {\n    logger.LOG&&console.log(\"LOG\",\".TextBox\",\"in init\");\n    opts = merge(opts, defaults);\n    logger.LOG&&console.log(\"LOG\",\".TextBox\",'making a textbox with opts', JSON.stringify(opts));\n    this._id = T.create(opts.x, opts.y, opts.width, opts.height, opts.text);\n  }\n  \n  var methods = ['destroy', 'show', 'hide', 'setValue', 'setOpacity', 'setType', 'setVisible',\n    'getX', 'getY', 'getWidth', 'getHeight', 'getValue', 'getOpacity', 'getType', 'getVisible'];\n  \n  for (var i = 0, m; m = methods[i]; ++i) {\n    bind(this, function (m) {\n      // getters return the value, setters return this\n      if (/^get/.test(m)) {\n        this[m] = function () { return T[m].apply(T, [this._id].concat(SLICE.call(arguments, 0))); };\n      } else {\n        this[m] = function () { T[m].apply(T, [this._id].concat(SLICE.call(arguments, 0))); return this; };\n      }\n    })(m);\n  }\n  \n  this.setPosition = function (p) { T.setPosition(this._id, p.x, p.y); return this; }\n  this.getPosition = function () { return {x: this.getX(), y: this.getY()}; }\n  \n  this.setDimensions = function (d) { T.setDimensions(this._id, d.width, d.height); return this; }\n  this.getDimensions = function () { return {width: this.getWidth(), height: this.getHeight()}; }\n\n  this.setApp = function () {}\n\n  this.setOpacity = function (opacity) {\n    T.setOpacity(this._id, opacity);\n  }\n\n  this.setVisible = function (isVisible) {\n    if (isVisible) {\n      T.show(this._id); \n    } else {\n      T.hide(this._id);\n    }\n  }\n\n  this.setValue = function (text) {\n    T.setValue(this._id, text);\n  }\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/native/Timer.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/native/Timer.js","friendlyPath":".Timer","directory":"modules/devkit-core/modules/timestep/src/platforms/native/","filename":"Timer.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nexports.start = function (onTick) {\n  NATIVE.timer.start(function () {\n    var now = +new Date(),\n      dt = now - (exports.last || now);\n    \n    exports.last = now;\n    onTick(dt);\n  });\n}\n\nexports.last = null;\n\n// NOTE: The timer is stopped automatically so this is just a stub\nexports.stop = function () { }\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/native/EditText.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/native/EditText.js","friendlyPath":".EditText","directory":"modules/devkit-core/modules/timestep/src/platforms/native/","filename":"EditText.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import device');\n\nvar focused;\n\nNATIVE.input.subscribe('KeyUp', function(evt) {\n    if (focused != null) {\n        focused._value = evt.text;\n        focused.onChange(evt.text, evt.prevText, evt.cursorPos);\n    }\n});\n\nNATIVE.input.subscribe('FocusNext', function(evt) {\n    if (evt.next && focused && focused._textEditView && focused._textEditView._forwardTextEditView) {\n        focused._textEditView._forwardTextEditView.requestFocus();\n    } else if (!evt.next && focused && focused._textEditView && focused._textEditView._backTextEditView) {\n        focused._textEditView._backTextEditView.requestFocus();\n    }\n});\n\nNATIVE.input.subscribe('Submit', function(evt) {\n    focused && focused.submit(evt.close);\n});\n\n\nNATIVE.events.registerHandler('editText.onFinishEditing', function (evt) {\n    focused && focused.finishEditing();\n});\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_platforms_native_EditText=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_platforms_native_EditText(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_platforms_native_EditText(){return this.init&&this.init.apply(this,arguments)},function() {\n\n    var defaults = {\n        hint: '',\n        inputType: 'default', // default | number | phone | password | capital\n        maxLength: 1000,\n        inputReturnButton: 'default' // default (return) | go | google | join | next | route | search | send | yahoo | done | emergencycall,\n    }\n\n    this.init = function(opts) {\n        console.log('instantiate EditText with hint: ' + opts.hint);\n        this._opts = merge(opts, defaults);\n        this._textEditView = opts.textEditView;\n        this.onFocusChange = opts.onFocusChange || function() {};\n        this.onSubmit = opts.onSubmit || function () {}\n    };\n\n    this.onChange = function (value, prevValue, cursorPos) {\n        this._value = value;\n        if (this._opts.onChange) {\n            this._opts.onChange(value, prevValue, cursorPos);\n        }\n    }\n\n    this.getValue = function () { return this._value; }\n\n    this.setValue = function (value, cursorPos) {\n        this._value = value;\n        this.onChange(value);\n    NATIVE.call('editText.setText', {text: value, cursorPos: cursorPos });\n    }\n\n    this.requestFocus = function() {\n        if (focused !== this) {\n            if (focused != null) focused.removeFocus();\n            this.onFocusChange(true);\n        }\n\n        focused = this; \n    }\n\n  this.closeEditField = function () {\n        if (focused == this) {\n            this.removeFocus();\n        }\n  };\n\n  this.finishEditing = function() {\n        this.onFocusChange(false);\n    if (focused == this) {\n      focused = null;\n      this._textEditView.onFinishEditing();\n      var textBox = this._textEditView._textBox;\n      textBox.style.visible = true;\n    }\n    }\n\n    this.submit = function(close) {\n    this.onSubmit(this._value);\n        if (focused != null && close) {\n            focused.removeFocus();\n        }\n     }\n\n    this.refresh = function(currentVal, hasBack, hasForward, cursorPos) {\n    var textBox = this._textEditView._textBox;\n    textBox.style.visible = false;\n    var pos = this._textEditView.getPosition();\n    var scale = pos.width / this._textEditView.style.width;\n\n    var closeOnDone = true;\n    if (this._opts.closeOnDone === false) {\n      closeOnDone = false;\n    } \n\n    NATIVE.call('editText.focus', {\n        id: this._id,\n        paddingLeft: this._opts.paddingLeft * scale,\n        paddingRight: this._opts.paddingRight * scale,\n        x: pos.x,\n        y: pos.y, \n        width: pos.width,\n        height: pos.height, \n        text: currentVal || \"\" ,\n        hint: this._opts.hint,\n        hintColor: this._opts.hintColor,\n        inputType: this._opts.inputType,\n        inputReturnButton: this._opts.inputReturnButton,\n        maxLength: this._opts.maxLength, \n        fontColor: this._opts.color,\n        fontSize: textBox._opts.size * scale,\n        font: textBox._opts.fontFamily,\n        cursorPos: cursorPos,\n        hasBack: hasBack,\n        hasForward: hasForward,\n        closeOnDone: closeOnDone\n    });\n\n    //cursorPos);\n    }\n\n    this.hasFocus = function() {\n        return focused == this;\n    }\n\n    this.removeFocus = function() {\n        this.onFocusChange(false);\n        if (focused == this) {\n            focused = null;\n      var textBox = this._textEditView._textBox;\n      textBox.style.visible = true;\n      NATIVE.call('editText.clearFocus', {});\n        }\n    \n    }\n\n    this.setHint = function(hint) {\n        this._opts.hint = hint;\n    }\n\n});\n","pre":true},"modules/devkit-core/src/clientapi/native/common.js":{"path":"modules/devkit-core/src/clientapi/native/common.js","friendlyPath":".common","directory":"modules/devkit-core/src/clientapi/native/","filename":"common.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/* globals logger, CONFIG, NATIVE */\n\njsio('import lib.PubSub');\n\nexports.install = function () {\n  logger.LOG&&console.log(\"LOG\",\".common\",'installing native support');\n\n  /* jshint ignore:start */\n  jsio('import device');\n  jsio('import .Window');\n  jsio('import .Document');\n  jsio('import .localStorage');\n  jsio('import .events');\n  jsio('import .launchInfo');\n  jsio('import .plugins');\n  jsio('import .screen');\n  jsio('import platforms.native.Canvas');\n  /* jshint ignore:end */\n\n  jsio('import .Image');\n  jsio('import .XMLHttpRequest');\n  jsio('import .Audio');\n  jsio('import .dom.DOMParser');\n\n  Image.install();\n  XMLHttpRequest.install();\n  Audio.install();\n  dom.DOMParser.install();\n\n  if (NATIVE.device.native_info) {\n    NATIVE.device.info = JSON.parse(NATIVE.device.native_info);\n  }\n\n  jsio('import .timestep');\n  timestep.install();\n\n  // publisher for the overlay UIWebView\n  NATIVE.overlay.delegate = new lib.PubSub();\n  CONFIG.splash = CONFIG.splash || {};\n  var oldHide = CONFIG.splash.hide || function () {};\n  CONFIG.splash.hide = function (cb) {\n    if (NATIVE.doneLoading instanceof Function) {\n      NATIVE.doneLoading();\n    }\n\n    if (oldHide instanceof Function) {\n      oldHide();\n    }\n\n    cb && cb();\n  };\n};\n","pre":true},"modules/devkit-core/src/clientapi/native/Window.js":{"path":"modules/devkit-core/src/clientapi/native/Window.js","friendlyPath":".Window","directory":"modules/devkit-core/src/clientapi/native/","filename":"Window.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import lib.PubSub');\n\nmodule.exports = new lib.PubSub();\n\nwindow.open = window.open || window.setLocation;\n\nwindow.addEventListener = function (evtName, cb, isBubble) {\n  module.exports.on(evtName, cb);\n}\n\nwindow.removeEventListener = function (evtName, cb, isBubble) {\n  module.exports.removeListener(evtName, cb);\n}\n\nwindow.__fireEvent = function (name, evt) {\n  if (!evt) { evt = {}; }\n  evt.type = name;\n  module.exports.publish(name, evt);\n}\n","pre":true},"modules/devkit-core/src/clientapi/native/Document.js":{"path":"modules/devkit-core/src/clientapi/native/Document.js","friendlyPath":".Document","directory":"modules/devkit-core/src/clientapi/native/","filename":"Document.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nif (typeof document == 'undefined') {\n\tGLOBAL.document = {};\n}\n\nif (!document.createElement) {\n\tvar handlers = {};\n\t\n\tdocument.createElement = function (type) {\n\t\ttype = type.toUpperCase(); \n\t\tif (type in handlers) {\n\t\t\treturn handlers[type]();\n\t\t}\n\t}\n\t\n\tdocument.__registerCreateElementHandler = function (type, cb) {\n\t\ttype = type.toUpperCase();\n\t\thandlers[type] = cb;\n\t}\n}\n","pre":true},"modules/devkit-core/src/clientapi/native/localStorage.js":{"path":"modules/devkit-core/src/clientapi/native/localStorage.js","friendlyPath":".localStorage","directory":"modules/devkit-core/src/clientapi/native/","filename":"localStorage.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/*\njsio('import device');\n\nif (device.isIOS && GLOBAL.Proxy) {\n\tvar _ls = {\n\t\tlength: 0,\n\t\tgetItem: NATIVE.localStorage.getItem,\n\t\tsetItem:function (key, value) {logger.LOG&&console.log(\"LOG\",\".localStorage\",'setting item', value, 'for key', key); NATIVE.localStorage.setItem(key, value.toString()); },\n\t\tremoveItem: NATIVE.localStorage.removeItem,\n\t\tclear: NATIVE.localStorage.clear,\n\t\tkey: NATIVE.localStorage.key\n\t};\n\n\tvar localStorageHandler = {\n\t\tget: function (proxy, name) {\n\t\t\treturn _ls[name] || NATIVE.localStorage.getItem(name); \n\t\t},\n\t\tset: function (proxy, name, value) {\n\t\t\tif (NATIVE.localStorage.setItem(name, value.toString())) {\n\t\t\t\t_ls.length++;\n\t\t\t}\n\t\t}\n\t};\n\n\tif (typeof localStorage == 'undefined') {\n\t\tGLOBAL.localStorage = Proxy.create(localStorageHandler);\n\t}\n} else {*/\n\tGLOBAL.localStorage = {\n\t\tsetItem: function (key, value) { NATIVE.localStorage.setItem(key.toString(), value.toString()); },\n\t\tgetItem: function (key) { return NATIVE.localStorage.getItem(key.toString() || null); },\n\t\tremoveItem: function (key) { NATIVE.localStorage.removeItem(key.toString()); },\n\t\tclear: function () { NATIVE.localStorage.clear(); },\n\t\tkey: function () { logger.LOG&&console.log(\"LOG\",\".localStorage\",'ERROR: localStorage.key() unimplemented'); return null }\n\t};\n//}\n","pre":true},"modules/devkit-core/src/clientapi/native/events.js":{"path":"modules/devkit-core/src/clientapi/native/events.js","friendlyPath":".events","directory":"modules/devkit-core/src/clientapi/native/","filename":"events.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nhandlers = {};\n\nNATIVE.call = function(method, args) {\n\tjson = {};\n\ttry {\n\t\tjson = JSON.parse(NATIVE._call(method, JSON.stringify(args)));\n\t} catch (e) {\n\t\tlogger.LOG&&console.log(\"LOG\",\".events\",e);\n\t}\n\treturn json;\n}\n\nNATIVE.events = {};\nNATIVE.events.registerHandler = function (name, handler) {\n\thandlers[name] = handler;\n}\n\nNATIVE.events.dispatchEvent = function (evt, id) {\n\n\tif (typeof evt == 'string') {\n\t\ttry {\n\t\t\tevt = JSON.parse(evt);\n\t\t} catch (e) {\n\t\t\tlogger.ERROR&&console.error(\"ERROR\",\".events\",'Parse error:', e);\n\t\t\tlogger.ERROR&&console.error(\"ERROR\",\".events\",evt);\n\t\t\treturn;\n\t\t}\n\t}\n\t//TODO maybe do this in a better way\n\t//android sends the requestId back on the event object\n\t//ios does not\n\tif (evt._requestId && !id) {\n\t\tid = evt._requestId;\n\t\tdelete evt._requestId;\n\t}\n\n\tvar handler = handlers[evt.name];\n\tif (handler) {\n\t\thandler(evt, id);\n\t}\n}\n\njsio('import .backButton');\njsio('import .dialog');\njsio('import .imageLoading');\njsio('import .input');\njsio('import .inputPrompt');\njsio('import .log');\njsio('import .offscreenBuffer');\njsio('import .online');\njsio('import .overlay');\njsio('import .pauseResume');\njsio('import .plugins');\njsio('import .purchase');\njsio('import .rotation');\njsio('import .soundLoading');\njsio('import .windowFocus');\n","pre":true},"modules/devkit-core/src/clientapi/native/backButton.js":{"path":"modules/devkit-core/src/clientapi/native/backButton.js","friendlyPath":".backButton","directory":"modules/devkit-core/src/clientapi/native/","filename":"backButton.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import lib.PubSub');\n\nNATIVE.backButton = new lib.PubSub();\n\n/**\n * Register back button event. Calls NATIVE.onBackButton, and\n * sends game activity to the back unless NATIVE.onBackButton\n * returns true.\n */\nNATIVE.events.registerHandler('backButton', function (evt) {\n\tif (NATIVE.onBackButton) {\n\t\tvar result = NATIVE.onBackButton();\n\t\t\n\t\tlogger.LOG&&console.log(\"LOG\",\".backButton\",'back button pushed');\n\n\t\tif ( result === false && typeof NATIVE.sendActivityToBack === 'function' ) {\n\t\t\tNATIVE.sendActivityToBack();\n\t\t}\n\t} else {\n\t\tNATIVE.backButton.emit('pressed');\n\t}\n});\n","pre":true},"modules/devkit-core/src/clientapi/native/dialog.js":{"path":"modules/devkit-core/src/clientapi/native/dialog.js","friendlyPath":".dialog","directory":"modules/devkit-core/src/clientapi/native/","filename":"dialog.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n\"use import\";\n\nvar dialogId = 0;\nvar dialogCallbacks = {};\n\nNATIVE.dialogs.showDialog = function (title, text, image, buttons) {\n\tvar labels = [], callbacks = [], cbs = [];\n\tvar len = buttons.length;\n\tfor(var i = 0; i < len; i++) {\n\t\tlabels[i] = buttons[i].label;\n\t\tcallbacks[i] = buttons[i].callback;\n\t}\n\tfor(var i = 0; i < len; i++) {\n\t\tcbs[i] = dialogId;\n\t\tdialogCallbacks[dialogId] = callbacks[i];\n\t\tdialogId++;\n\t}\n\tNATIVE.dialogs._showDialog(title, text, image, labels, cbs);\n};\n\nNATIVE.dialogs.showUpdate = function (title, text, confirmLabel, denyLabel, image, callback) {\n\ttitle = title || CONFIG.title + ' has been updated!';\n\ttext = text || \"There's an update for \" + CONFIG.title + \"! Do you want to apply it?\";\n\tconfirmLabel = confirmLabel || 'OK';\n\tdenyLabel = denyLabel || 'Not now';\n\tvar ok = { label: confirmLabel, callback: function () { callback(); } };\n\tvar notnow = { label: denyLabel, callback: function () {} };\n\tNATIVE.dialogs.showDialog(title, text, image, [ok, notnow]);\n};\n\n\nNATIVE.dialogs.showCrossPromo = function (appID, displayName, image) {\n\tvar title = \"Try \" + displayName + \"!\";\n\tvar msg = \"We noticed you've enjoyed \" + CONFIG.title + \" and we think you might enjoy \" + displayName + \". Do you want to try it?\";\n\timage = image || null;\n\tvar sure = { label: 'Sure!', callback: function () { NATIVE.startGame(appID); } };\n\tvar nothanks = { label: 'Maybe layer', callback: function () { /* do nothing */ } };\n\tNATIVE.dialogs.showDialog(title, msg, image, [sure, nothanks]);\n};\n\nNATIVE.dialogs.showAppRater = function (title, text, image) {\n\ttitle = title || \"Rate \" + CONFIG.title;\n\ttext = text || \"It looks like you're enjoying \" + CONFIG.title + \". Please take a moment to rate it. Thanks!\";\n\tif (!image) {\n\t\tvar splash = CONFIG.splash;\n\t\timage = splash.landscape768;\n\t\tif (!image) image = splash.landscape1536;\n\t\tif (!image) image = splash.portrait480;\n\t\tif (!image) image = splash.portrait960;\n\t\tif (!image) image = splash.portrait1024;\n\t\tif (!image) image = splash.portrait1136;\n\t\tif (!image) image = splash.portrait2048;\n\t}\n\tvar rateme = { label: title, callback: function () { GLOBAL.setLocation(NATIVE.market.url); } };\n\tvar nothanks = { label: \"No thanks\", callback: function () {} };\n\tvar remindme = { label: \"Remind me later\", callback: function () {} };\n\tNATIVE.dialogs.showDialog(title, text, image, [rateme, remindme, nothanks]);\n};\n\nNATIVE.events.registerHandler('dialogButtonClicked', function (evt) {\n\tvar cb = dialogCallbacks[evt.id];\n\tif(cb && cb instanceof Function) {\n\t\tcb();\n\t\tdelete dialogCallbacks[evt.id];\n\t}\n});\n","pre":true},"modules/devkit-core/src/clientapi/native/imageLoading.js":{"path":"modules/devkit-core/src/clientapi/native/imageLoading.js","friendlyPath":".imageLoading","directory":"modules/devkit-core/src/clientapi/native/","filename":"imageLoading.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import lib.PubSub');\n\nmerge(NATIVE.gl, lib.PubSub.prototype);\n\nvar loadingImages = {};\nvar canvasImages = {};\n\nNATIVE.camera.getPicture = function (size, id) {\n\tsize = size || 64;\n\tid = id || NATIVE.camera.getNextId();\n\tvar src = '@CAMERA' + id + '-' + size;\n\tvar image = new Image();\n\timage.src = src;\n\treturn image;\n};\n\nNATIVE.gallery.choosePicture = function (size, id) {\n\tsize = size || 64;\n\tid = id || NATIVE.gallery.getNextId();\n\tvar src = '@GALLERYPHOTO' + id + '-' + size;\n\tvar image = new Image();\n\timage.src = src;\n\treturn image;\n};\n\nNATIVE.gl.loadImage = function (image) {\n\tvar texData = NATIVE.gl._loadImage(image._src);\n\tif (texData) {\n\t\tsetTimeout(function () {\n\t\t\timage._onload(texData.width, texData.height, texData.name);\n\t\t}, 0);\n\t} else {\n\t\tif (!loadingImages[image._src]) {\n\t\t\tloadingImages[image._src] = [];\n\t\t}\n\t\tloadingImages[image._src].push(image);\n\t}\n}\n\nNATIVE.events.registerHandler('imageLoaded', function (evt) {\n\tvar logURL = evt.url;\n\tif (logURL.substring(0, 11) == 'data:image/') {\n\t\tlogURL = '<base64>';\n\t}\n\n\tNATIVE.gl.publish('imageLoaded', evt);\n\n\tlogger.DEBUG&&console.debug(\"DEBUG\",\".imageLoading\",'imageLoaded:', logURL, evt.originalWidth + 'x' + evt.originalHeight, '(' + evt.width + 'x' + evt.height + ')');\n\n\tvar images = loadingImages[evt.url];\n\tdelete loadingImages[evt.url];\n\n\tif (images) { \n\t\timages.forEach(function (image) { \n\t\t\timage._onload(evt.originalWidth, evt.originalHeight, evt.glName);\n\t\t\tGLOBAL.GC && GC.app && GC.app.engine && GC.app.engine.needsRepaint();\n\t\t});\n\t}\n});\n\nNATIVE.events.registerHandler('imageError', function (evt) {\n\tvar images = loadingImages[evt.url];\n\tif (images) {\n\t\timages.forEach(function (image) {\n\t\t\tif (image._onerror) {\n\t\t\t\timage._onerror();\n\t\t\t}\n\t\t});\n\t\tdelete loadingImages[evt.url];\n\t}\n});\n\nNATIVE.gl.makeCanvas = function (width, height, unloadListener) {\n\tvar textureData = NATIVE.gl.newTexture(width, height);\n\n\tvar url = textureData._src;\n\tcanvasImages[url] = unloadListener;\n\n\tlogger.LOG&&console.log(\"LOG\",\".imageLoading\",\"{canvas-registry} Registering canvas:\", url);\n\n\treturn textureData;\n}\n\nNATIVE.gl.updateCanvasURL = function (oldUrl, newUrl) {\n\tcanvasImages[newUrl] = canvasImages[oldUrl];\n\tdelete canvasImages[oldUrl];\n}\n\nNATIVE.gl.forgetCanvas = function (url) {\n\tlogger.LOG&&console.log(\"LOG\",\".imageLoading\",\"{canvas-registry} Forgetting canvas:\", url);\n\n\tvar listener = canvasImages[url];\n\tif (listener) {\n\t\tdelete canvasImages[url];\n\t}\n}\n\nNATIVE.events.registerHandler('canvasFreed', function (evt) {\n\tvar url = evt.url;\n\n\tlogger.LOG&&console.log(\"LOG\",\".imageLoading\",\"{canvas-registry} Notifying of lost canvas:\", url);\n\n\tvar listener = canvasImages[url];\n\tif (listener) {\n\t\tif (typeof listener === \"function\") {\n\t\t\tlistener(url);\n\t\t}\n\t\tdelete canvasImages[url];\n\t}\n});\n\n","pre":true},"modules/devkit-core/src/clientapi/native/input.js":{"path":"modules/devkit-core/src/clientapi/native/input.js","friendlyPath":".input","directory":"modules/devkit-core/src/clientapi/native/","filename":"input.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar inputQueue = [];\n\nif (NATIVE.events.setResponder) {\n\tNATIVE.events.setResponder(inputQueue);\n}\n\nNATIVE.input.getTouchEvents = function () {\n\treturn inputQueue.splice(0, inputQueue.length);\n}\n","pre":true},"modules/devkit-core/src/clientapi/native/inputPrompt.js":{"path":"modules/devkit-core/src/clientapi/native/inputPrompt.js","friendlyPath":".inputPrompt","directory":"modules/devkit-core/src/clientapi/native/","filename":"inputPrompt.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import lib.PubSub');\njsio('import device');\n\nmerge(NATIVE.input, lib.PubSub.prototype);\n\nNATIVE.events.registerHandler('InputPromptSubmit', function (evt) {\n\tNATIVE.input.publish('InputPromptSubmit', evt);\n});\n\nNATIVE.events.registerHandler('InputKeyboardSubmit', function (evt) {\n\tNATIVE.input.publish('Submit', evt);\n});\n\nNATIVE.events.registerHandler('InputKeyboardCancel', function (evt) {\n\tNATIVE.input.publish('Cancel', evt);\n});\n\nNATIVE.events.registerHandler('InputKeyboardKeyUp', function (evt) {\n    NATIVE.input.publish('KeyUp', evt);\n});\n\nNATIVE.events.registerHandler('InputKeyboardFocusNext', function (evt) {\n    NATIVE.input.publish('FocusNext', evt);\n});\n\nvar __keyboardIsOpen = false;\nNATIVE.events.registerHandler('keyboardScreenResize', function (evt) {\n\tif (evt.height < .75 * device.screen.height) {\n\t\tevt.opened = true;\n\t\twindow.__fireEvent('keyboardScreenResize', evt);\n\t\tif (!__keyboardIsOpen) {\n\t\t\t__keyboardIsOpen = true;\n\t\t\twindow.__fireEvent('keyboardOpened', evt);\n\t\t}\n\t} else if (__keyboardIsOpen) {\n\t\tevt.opened = false;\n\t\twindow.__fireEvent('keyboardScreenResize', evt);\n\t\t__keyboardIsOpen = false;\n\t\twindow.__fireEvent('keyboardClosed', evt);\n\t}\n});\n","pre":true},"modules/devkit-core/src/clientapi/native/log.js":{"path":"modules/devkit-core/src/clientapi/native/log.js","friendlyPath":".log","directory":"modules/devkit-core/src/clientapi/native/","filename":"log.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nNATIVE.events.registerHandler('log', function (evt) {\n\tlogger.ERROR&&console.error(\"ERROR\",\".log\",evt.message);\n});\n","pre":true},"modules/devkit-core/src/clientapi/native/offscreenBuffer.js":{"path":"modules/devkit-core/src/clientapi/native/offscreenBuffer.js","friendlyPath":".offscreenBuffer","directory":"modules/devkit-core/src/clientapi/native/","filename":"offscreenBuffer.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nNATIVE.events.registerHandler('redrawOffscreenBuffers', bind(window, '__fireEvent', 'redrawOffscreenBuffers'));\n","pre":true},"modules/devkit-core/src/clientapi/native/online.js":{"path":"modules/devkit-core/src/clientapi/native/online.js","friendlyPath":".online","directory":"modules/devkit-core/src/clientapi/native/","filename":"online.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nNATIVE.events.registerHandler(\"networkStatus\", function (evt) {\n\t// evt.type is either \"online\" or \"offline\"\n\twindow.__fireEvent(evt.type, evt);\n});\n","pre":true},"modules/devkit-core/src/clientapi/native/overlay.js":{"path":"modules/devkit-core/src/clientapi/native/overlay.js","friendlyPath":".overlay","directory":"modules/devkit-core/src/clientapi/native/","filename":"overlay.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nNATIVE.events.registerHandler('overlay', function (evt) {\n\tif (NATIVE.overlay.delegate) {\n\t\tif (NATIVE.overlay.delegate.publish instanceof Function) {\n\t\t\tNATIVE.overlay.delegate.publish('message', evt.event);\n\t\t}\n\t}\n});\n","pre":true},"modules/devkit-core/src/clientapi/native/pauseResume.js":{"path":"modules/devkit-core/src/clientapi/native/pauseResume.js","friendlyPath":".pauseResume","directory":"modules/devkit-core/src/clientapi/native/","filename":"pauseResume.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nNATIVE.events.registerHandler('pause', bind(window, '__fireEvent', 'pagehide'));\n\nNATIVE.events.registerHandler('resume', function () {\n\t// reset any cached loading events\n\tjsio('import ui.resource.Image as Image');\n\tif (Image.__clearCache__) {\n\t\tImage.__clearCache__();\n\t}\n\n\twindow.__fireEvent('pageshow');\n});\n","pre":true},"modules/devkit-core/src/clientapi/native/plugins.js":{"path":"modules/devkit-core/src/clientapi/native/plugins.js","friendlyPath":".plugins","directory":"modules/devkit-core/src/clientapi/native/","filename":"plugins.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import lib.Callback');\njsio('import lib.PubSub');\n\nvar pluginsPubSub = new lib.PubSub();\n\nNATIVE.plugins.publish = bind(pluginsPubSub, 'publish');\nNATIVE.plugins.subscribe = bind(pluginsPubSub, 'subscribe');\nNATIVE.plugins.subscribeOnce = bind(pluginsPubSub, 'subscribeOnce');\nNATIVE.plugins.unsubscribe = bind(pluginsPubSub, 'unsubscribe');\n\nNATIVE.events.registerHandler('plugins', function (evt, id) {\n\tif (id) {\n\t\tvar cb = _requestCbs[id];\n\t\tdelete _requestCbs[id];\n\t\tcb && cb(evt.error, evt.response);\n\t} else {\n\t\t// TODO: probably this shouldn't be like this... maybe namespace by plugin name too, not just 'plugins'\n\t\tNATIVE.plugins.publish('Plugins', evt.data);\n\t}\n});\n\nNATIVE.events.registerHandler('pluginEvent', function (evt) {\n\tvar plugin = GC.plugins.getPlugin(evt.pluginName);\n\tif (plugin) {\n\t\tplugin.publish(evt.eventName, evt.data);\n\t} else {\n\t\tlogger.WARN&&console.warn(\"WARN\",\".plugins\",'plugin', evt.pluginName, 'not found');\n\t}\n});\n\nvar _requestId = 0;\nvar _requestCbs = {};\nNATIVE.plugins.sendRequest = function (pluginName, name, data, cb) {\n\tif (typeof data == 'function') {\n\t\tcb = data;\n\t\tdata = null;\n\t}\n\n\tvar id = ++_requestId;\n\t_requestCbs[id] = cb;\n\n\tvar dataStr;\n\tif (data) {\n\t\ttry {\n\t\t\tdataStr = JSON.stringify(data);\n\t\t} catch (e) {\n\t\t\tlogger.ERROR&&console.error(\"ERROR\",\".plugins\",e);\n\t\t}\n\t}\n\n\tNATIVE.plugins._sendRequest.call(this, pluginName, name, dataStr || '{}', id);\n}\n","pre":true},"modules/devkit-core/src/clientapi/native/purchase.js":{"path":"modules/devkit-core/src/clientapi/native/purchase.js","friendlyPath":".purchase","directory":"modules/devkit-core/src/clientapi/native/","filename":"purchase.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nNATIVE.events.registerHandler('purchase', function (evt) {\n\tvar state = evt.state,\n\t\tproduct = evt.product,\n\t\torder = evt.order,\n\t\tnotifyId = evt.notifyId;\n\tif (NATIVE.purchase.onResult(state, product, order)) {\n\t\tNATIVE.purchase.confirmPurchase(notifyId);\n\t}\n});\n","pre":true},"modules/devkit-core/src/clientapi/native/rotation.js":{"path":"modules/devkit-core/src/clientapi/native/rotation.js","friendlyPath":".rotation","directory":"modules/devkit-core/src/clientapi/native/","filename":"rotation.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * Does nothing by default.\n */\nNATIVE.onRotation = function () {};\n\n\n/**\n * Register rotation event. Calls NATIVE.onRotation.\n */\nNATIVE.events.registerHandler('rotate', function (evt) {\n\tNATIVE.onRotation(evt);\n});\n","pre":true},"modules/devkit-core/src/clientapi/native/soundLoading.js":{"path":"modules/devkit-core/src/clientapi/native/soundLoading.js","friendlyPath":".soundLoading","directory":"modules/devkit-core/src/clientapi/native/","filename":"soundLoading.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nNATIVE.events.registerHandler('soundLoaded', function (evt) {\n\tlogger.LOG&&console.log(\"LOG\",\".soundLoading\",'sound loaded with url', evt.url);\n\tvar loadedSound = sounds[evt.url];\n\tif (loadedSound && !loadedSound.complete) {\n\t\tloadedSound.complete = true;\n\t\tloadedSound.onload();\n\t\tdelete sounds[evt.url];\n\t}\n});\n\n\nNATIVE.events.registerHandler('soundError', function (evt) {\n\tlogger.LOG&&console.log(\"LOG\",\".soundLoading\",'sound with url', evt.url, 'failed to load');\n\tvar failedSound = sounds[evt.url];\n\tif (failedSound) {\n\t\tfailedSound.onerror();\n\t}\n});\n\nNATIVE.events.registerHandler('soundDuration', function (evt) {\n\tlogger.LOG&&console.log(\"LOG\",\".soundLoading\",'sound with url', evt.url, 'is', evt.duration, 'seconds long');\n\tif (evt.url in songs) {\n\t\tsongs[evt.url].duration = evt.duration;\n\t\tsongs[evt.url].durationMilliseconds = evt.duration * 1000;\n\t}\n});\n\nvar sounds = {};\nSound=__class__;var Sound=Sound(function Sound(){return this.init&&this.init.apply(this,arguments)},function (supr) {\n\tthis.init = function (opts) {\n\t\tthis.src = opts.src || null;\n\t\tthis.complete = opts.complete || null;\n\t}\n\n\tthis.onload = this.onerror = function () {}\n});\nNATIVE.sound.preloadSound = function (url) {\n\tNATIVE.sound.loadSound(url);\n\tsounds[url] = new Sound({\n\t\tsrc: url,\n\t\tcomplete: false,\n\t});\n\treturn sounds[url];\n}\n\nvar songs = {};\nNATIVE.sound.registerMusic = function (url, sound) {\n\tsongs[url] = sound;\n}","pre":true},"modules/devkit-core/src/clientapi/native/windowFocus.js":{"path":"modules/devkit-core/src/clientapi/native/windowFocus.js","friendlyPath":".windowFocus","directory":"modules/devkit-core/src/clientapi/native/","filename":"windowFocus.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nNATIVE.events.registerHandler('windowFocusAcquired', bind(window, '__fireEvent', 'onblur'));\nNATIVE.events.registerHandler('windowFocusAcquired', bind(window, '__fireEvent', 'onfocus'));\n","pre":true},"modules/devkit-core/src/clientapi/native/launchInfo.js":{"path":"modules/devkit-core/src/clientapi/native/launchInfo.js","friendlyPath":".launchInfo","directory":"modules/devkit-core/src/clientapi/native/","filename":"launchInfo.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nNATIVE.launch = {};\n\nNATIVE.events.registerHandler('launchType', function (evt) {\n\tNATIVE.launch.type = evt.type;\n\tNATIVE.launch.data = evt.data || null;\n});\n","pre":true},"modules/devkit-core/src/clientapi/native/screen.js":{"path":"modules/devkit-core/src/clientapi/native/screen.js","friendlyPath":".screen","directory":"modules/devkit-core/src/clientapi/native/","filename":"screen.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import device');\n\nNATIVE.screen.onResize = function (width, height) {\n\tlogger.LOG&&console.log(\"LOG\",\".screen\",'native screen resize', width, height);\n\twindow.screen.width = width;\n\twindow.screen.height= height;\n\tdevice.screen.publish('Resize', width, height);\n\tif (width > height) {\n\t\tdevice.screen.isPortrait = false;\n\t\tdevice.screen.isLandscape = true;\n\t\tdevice.screen.orientation = 'landscape';\n\t} else {\n\t\tdevice.screen.isPortrait = true;\n\t\tdevice.screen.isLandscape = false;\n\t\tdevice.screen.orientation = 'portrait';\n\t}\n\tdevice.screen.width = width;\n\tdevice.screen.height = height;\n\tdevice.width = width;\n\tdevice.height = height;\n\t\n\tdevice.screen.publish('Resize', width, height);\n\tlogger.LOG&&console.log(\"LOG\",\".screen\",'onResize', JSON.stringify(device.screen));\n}\n","pre":true},"modules/devkit-core/src/clientapi/native/Image.js":{"path":"modules/devkit-core/src/clientapi/native/Image.js","friendlyPath":".Image","directory":"modules/devkit-core/src/clientapi/native/","filename":"Image.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import lib.PubSub');\njsio('import util.setProperty');\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_src_clientapi_native_Image=__class__;var Image = exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_src_clientapi_native_Image(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_src_clientapi_native_Image(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function (supr) {\n\n\tthis.init = function (src, width, height, glname) {\n\t\tthis._src = src || \"\";\n\t\tthis.width = width || undefined;\n\t\tthis.height = height || undefined;\n\t\tthis.__gl_name = glname || undefined;\n\t\tthis.complete = false;\n\t\tthis._firedLoad = false;\n\t\tthis._fireReload = false;\n\t}\n\n\tutil.setProperty(this, 'src', {\n\t\tset: function (value) {\n\t\t\tif (!value) {\n\t\t\t\tlogger.ERROR&&console.error(\"ERROR\",\".Image\",'empty src set on an image!');\n\t\t\t\tthis._onerror();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._src = value;\n\t\t\tNATIVE.gl.loadImage(this);\n\t\t}\n\t});\n\n\tthis._onload = function (width, height, gl_name) {\n\t\tlogger.LOG&&console.log(\"LOG\",\".Image\",'onload called with', width, height, gl_name);\n\t\tthis.complete = true;\n\t\tthis.width = this.originalWidth = width;\n\t\tthis.height = this.originalHeight = height;\n\t\tthis.__gl_name = gl_name;\n\t\tif (!this._firedLoad) {\n\t\t\tthis._firedLoad = true;\n\t\t\tthis.onload && this.onload();\n\t\t\tthis.publish('load', {type: 'load'});\n\t\t}\n\n\t\tif (this._fireReload) {\n\t\t\tthis.onreload && this.onreload();\n\t\t\tthis.publish('reload', {type: 'reload'});\n\t\t} else {\n\t\t\tthis._fireReload = true;\n\t\t}\n\t}\n\n\tthis._onerror = function () {\n\t\tthis.onerror();\n\t\tthis.publish('error', {type: 'error'});\n\t}\n\n\tthis.reload = function () {\n\t\tthis._fireReload = true;\n\t\tNATIVE.gl.loadImage(this);\n\t}\n\n\tthis.destroy = function () {\n\t\tif (this._src) {\n\t\t\tNATIVE.gl.deleteTexture(this._src);\n\t\t}\n\t}\n\n\tthis.addEventListener = function (type, callback, useCapture) { this.subscribe(type, this, callback); }\n\tthis.removeEventListener = function (type, callback, useCapture) { this.unsubscribe(type, this, callback); }\n\n\tthis.onload = this.onerror = this.onreload = function () {}\n});\n\n\nexports.install = function () {\n\tGLOBAL.Image = Image;\n}\n","pre":true},"modules/devkit-core/src/clientapi/native/XMLHttpRequest.js":{"path":"modules/devkit-core/src/clientapi/native/XMLHttpRequest.js","friendlyPath":".XMLHttpRequest","directory":"modules/devkit-core/src/clientapi/native/","filename":"XMLHttpRequest.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nXMLHttpRequest=__class__;var XMLHttpRequest=XMLHttpRequest(function XMLHttpRequest(){return this.init&&this.init.apply(this,arguments)},function () {\n\tvar state = {\n\t\t\"UNSENT\": 0,\n\t\t\"OPENED\": 1,\n\t\t\"HEADERS_RECEIVED\": 2,\n\t\t\"LOADING\": 3,\n\t\t\"DONE\": 4\n\t};\n\tthis.init = function () {\n\t\tthis.readyState = state.UNSENT;\n\t\tthis.responseText = null;\n\t\tthis._requestHeaders = {};\n\t\tthis.__id = id;\n\t}\n\n\tthis.open = function (method, url, async) {\n\t\tthis._method = method;\n\t\tthis._url = '' + url;\n\t\tthis._async = async || false;\n\t\tthis.readyState = state.OPENED;\n\t\tthis.status = 0;\n\n\t\tif (!this._async) {\n\t\t\tlogger.WARN&&console.warn(\"WARN\",\".XMLHttpRequest\",\"synchronous xhrs not supported\");\n\t\t}\n\t}\n\n\tthis.getResponseHeader = function (name) { return this._responseHeadersLowerCase[name.toLowerCase()]; }\n\n\tthis.getAllResponseHeaders = function () {\n\t\tvar lines = [];\n\t\tvar headers = this._responseHeaders;\n\t\tfor(var key in headers) {\n\t\t\tif (!headers.hasOwnProperty(key)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlines.push(key + ': ' + headers[key]);\n\t\t}\n\t\treturn lines.join('\\r\\n');\n\t}\n\t\n\tthis.setRequestHeader = function (name, value) {\n\t\tthis._requestHeaders[name] = value;\n\t}\n\n\tthis.send = function (data) {\n\t\tthis._data = data || \"\";\n\t\txhrs[id++] = this;\n\t\tNATIVE.xhr.send(this._method, this._url, this._async, this._data, 0, this.__id, this._requestHeaders);\n\t}\n\n\tthis.uploadFile = function (filename) {\n\t\tthis._filename = filename;\n\t\txhrs[id++] = this;\n\t\tNATIVE.xhr.uploadFile(this.__id, this._filename, this._url, this._async, this._requestHeaders);\n\t}\n\n\tthis._onreadystatechange = function (state, status, response) {\n\t\tthis.readyState = state;\n\t\tthis.status = status;\n\t\tthis.responseText = response || null;\n        this.response = response || null;\n\t\tif (typeof this.onreadystatechange === 'function') {\n\t\t\tthis.onreadystatechange();\n\t\t}\n\t}\n\n\tthis.onreadystatechange = function () {}\n});\n\nvar xhrs = {};\nvar id = 0;\n\nexports.install = function () {\n\tGLOBAL.XMLHttpRequest = XMLHttpRequest;\n\tNATIVE.events.registerHandler('xhr', function (evt) {\n\t\tvar xhr = xhrs[evt.id];\n\t\tif (xhr) {\n\t\t\tvar headers = {};\n\t\t\tvar headersLowercase = {};\n\t\t\tfor(var i = 0, len = evt.headerKeys.length; i < len; i++) {\n\t\t\t\theadersLowercase[evt.headerKeys[i].toLowerCase()] = headers[evt.headerKeys[i]] = evt.headerValues[i];\n\t\t\t}\n\t\t\txhr._responseHeaders = headers;\n\t\t\txhr._responseHeadersLowerCase = headersLowercase;\n\t\t\txhr._onreadystatechange(evt.state, evt.status, evt.response);\n\t\t}\n\t\tdelete xhrs[evt.id];\n\t});\n\n}\n","pre":true},"modules/devkit-core/src/clientapi/native/Audio.js":{"path":"modules/devkit-core/src/clientapi/native/Audio.js","friendlyPath":".Audio","directory":"modules/devkit-core/src/clientapi/native/","filename":"Audio.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar lastbg;\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_src_clientapi_native_Audio=__class__;var Audio = exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_src_clientapi_native_Audio(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_src_clientapi_native_Audio(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\tthis.init = function (url) {\n\t\tthis._startedLoad = false;\n\t\tthis._src = \"\";\n\t\tthis.autoplay = false;\n\t\tthis.preload = \"auto\";\n\t\tthis._volume = 1;\n\t\tthis.loop = false;\n\t\tthis._startTime = 0;\n\t\tthis._et = 0;\n\t\tthis.readyState = 4;\n\t\tif (url) {\n\t\t\tthis.src = url;\n\t\t}\n\t};\n\n\tthis._updateElapsed = function () {\n\t\tif (this._startTime > 0) {\n\t\t\tvar now = Date.now();\n\t\t\tthis._et += (now - this._startTime);\n\t\t\tvar dur = this.durationMilliseconds;\n\t\t\tif (this.loop && !isNaN(dur) && this._et > dur) {\n\t\t\t\tthis._et %= dur;\n\t\t\t}\n\t\t\tthis._startTime = now;\n\t\t}\n\t};\n\n\tthis.__defineSetter__(\"src\", function (url) {\n\t\tlogger.LOG&&console.log(\"LOG\",\".Audio\",\"audio source is \", url);\n\t\tthis._src = url;\n\n\t\t// wait one frame in case preload gets set\n\t\tsetTimeout(bind(this, function () {\n\t\t\tif ((this.autoplay || this.preload == \"auto\") && !this.isBackgroundMusic) {\n\t\t\t\tthis.load();\n\t\t\t}\n\n\t\t\tif (this.autoplay) {\n\t\t\t\tthis.play();\n\t\t\t}\n\t\t}), 0);\n\t});\n\n\tthis.__defineGetter__(\"src\", function () {\n\t\treturn this._src;\n\t});\n\n\tthis.__defineSetter__(\"volume\", function (volume) {\n\t\tthis._volume = volume;\n\t\tif (!this.isBackgroundMusic || this == lastbg) {\n\t\t\tNATIVE.sound.setVolume(this._src, volume);\n\t\t}\n\t});\n\n\tthis.__defineGetter__(\"currentTime\", function () {\n\t\tthis._updateElapsed();\n\t\treturn this._et / 1000;\n\t});\n\n\tthis.__defineSetter__(\"currentTime\", function (t) {\n\t\tthis._et = t * 1000;\n\t\tthis._startTime = Date.now();\n\t\tif (this == lastbg) {\n\t\t\tNATIVE.sound.seekTo(this._src, t);\n\t\t}\n\t});\n\n\tthis.canPlayType = function (type) {\n\t\treturn true;\n\t};\n\n\tthis.load = function (thenPlay) {\n\t\tif (this.isBackgroundMusic) {\n\t\t\t// Background music should not be preloaded like normal sounds\n\t\t\treturn;\n\t\t}\n\t\tvar s = NATIVE.sound.preloadSound(this._src);\n\t\tif (thenPlay) {\n\t\t\ts.onload = bind(this, '_play');\n\t\t}\n\t\tthis._startedLoad = true;\n\t};\n\n\tthis._play = function () {\n\t\tNATIVE.sound.playSound(\n\t\t\tthis._src,\n\t\t\tthis._volume,\n\t\t\t(this.loop === \"loop\" || this.loop === true)\n\t\t);\n\t\tthis._startTime = Date.now();\n\t};\n\n\tthis.play = function () {\n\t\tthis.paused = false;\n\t\tif (this.isBackgroundMusic) {\n\t\t\tlastbg = this;\n\t\t\tthis._startedLoad = true;\n\t\t\tthis._startTime = Date.now();\n\t\t\tNATIVE.sound.playBackgroundMusic(this._src, this._volume, this.loop);\n\t\t} else if (!this._startedLoad) {\n\t\t\tthis.load(true);\n\t\t} else {\n\t\t\tthis._play();\n\t\t}\n\t};\n\n\tthis.pause = function () {\n\t\tif (this.paused) { return; }\n\t\tthis.paused = true;\n\n\t\tif (this._startedLoad) {\n\t\t\tif (!this.isBackgroundMusic || this == lastbg) {\n\t\t\t\tNATIVE.sound.pauseSound(this._src);\n\t\t\t}\n\t\t\tthis._updateElapsed();\n\t\t\tthis._startTime = 0;\n\t\t}\n\t};\n\n\tthis.stop = function () {\n\t\tif (this._startedLoad) {\n\t\t\tif (!this.isBackgroundMusic || this == lastbg) {\n\t\t\t\tNATIVE.sound.stopSound(this._src);\n\t\t\t}\n\t\t}\n\n\t\tthis.reset();\n\t};\n\n\tthis.reset = function () {\n\t\tthis._et = 0;\n\t\tthis._startTime = 0;\n\t};\n\n\tthis.destroy = function () {\n\t\tif (this == lastbg) {\n\t\t\tlastbg = undefined;\n\t\t}\n\n\t\tNATIVE.sound.destroySound(this._src);\n\t}\n\n});\n\nexports.install = function () {\n\tGLOBAL.Audio = Audio;\n}\n","pre":true},"modules/devkit-core/src/clientapi/native/dom/DOMParser.js":{"path":"modules/devkit-core/src/clientapi/native/dom/DOMParser.js","friendlyPath":".dom.DOMParser","directory":"modules/devkit-core/src/clientapi/native/dom/","filename":"DOMParser.js","src":"jsio('import .dom_parser');\nexports.install = function() {\n    if (!window.DOMParser) {\n        window.DOMParser = dom_parser.DOMParser;\n    }\n};\n","pre":true},"modules/devkit-core/src/clientapi/native/dom/dom_parser.js":{"path":"modules/devkit-core/src/clientapi/native/dom/dom_parser.js","friendlyPath":".dom_parser","directory":"modules/devkit-core/src/clientapi/native/dom/","filename":"dom_parser.js","src":"function DOMParser(options){\n\tthis.options = options ||{locator:{}};\n\t\n}\nDOMParser.prototype.parseFromString = function(source,mimeType){\t\n\tvar options = this.options;\n\tvar sax =  new XMLReader();\n\tvar domBuilder = options.domBuilder || new DOMHandler();//contentHandler and LexicalHandler\n\tvar errorHandler = options.errorHandler;\n\tvar locator = options.locator;\n\tvar defaultNSMap = options.xmlns||{};\n\tvar entityMap = {'lt':'<','gt':'>','amp':'&','quot':'\"','apos':\"'\"}\n\tif(locator){\n\t\tdomBuilder.setDocumentLocator(locator)\n\t}\n\t\n\tsax.errorHandler = buildErrorHandler(errorHandler,domBuilder,locator);\n\tsax.domBuilder = options.domBuilder || domBuilder;\n\tif(/\\/x?html?$/.test(mimeType)){\n\t\tentityMap.nbsp = '\\xa0';\n\t\tentityMap.copy = '\\xa9';\n\t\tdefaultNSMap['']= 'http://www.w3.org/1999/xhtml';\n\t}\n\tif(source){\n\t\tsax.parse(source,defaultNSMap,entityMap);\n\t}else{\n\t\tsax.errorHandler.error(\"invalid document source\");\n\t}\n\treturn domBuilder.document;\n}\nfunction buildErrorHandler(errorImpl,domBuilder,locator){\n\tif(!errorImpl){\n\t\tif(domBuilder instanceof DOMHandler){\n\t\t\treturn domBuilder;\n\t\t}\n\t\terrorImpl = domBuilder ;\n\t}\n\tvar errorHandler = {}\n\tvar isCallback = errorImpl instanceof Function;\n\tlocator = locator||{}\n\tfunction build(key){\n\t\tvar fn = errorImpl[key];\n\t\tif(!fn){\n\t\t\tif(isCallback){\n\t\t\t\tfn = errorImpl.length == 2?function(msg){errorImpl(key,msg)}:errorImpl;\n\t\t\t}else{\n\t\t\t\tvar i=arguments.length;\n\t\t\t\twhile(--i){\n\t\t\t\t\tif(fn = errorImpl[arguments[i]]){\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\terrorHandler[key] = fn && function(msg){\n\t\t\tfn(msg+_locator(locator));\n\t\t}||function(){};\n\t}\n\tbuild('warning','warn');\n\tbuild('error','warn','warning');\n\tbuild('fatalError','warn','warning','error');\n\treturn errorHandler;\n}\n/**\n * +ContentHandler+ErrorHandler\n * +LexicalHandler+EntityResolver2\n * -DeclHandler-DTDHandler \n * \n * DefaultHandler:EntityResolver, DTDHandler, ContentHandler, ErrorHandler\n * DefaultHandler2:DefaultHandler,LexicalHandler, DeclHandler, EntityResolver2\n * @link http://www.saxproject.org/apidoc/org/xml/sax/helpers/DefaultHandler.html\n */\nfunction DOMHandler() {\n    this.cdata = false;\n}\nfunction position(locator,node){\n\tnode.lineNumber = locator.lineNumber;\n\tnode.columnNumber = locator.columnNumber;\n}\n/**\n * @see org.xml.sax.ContentHandler#startDocument\n * @link http://www.saxproject.org/apidoc/org/xml/sax/ContentHandler.html\n */ \nDOMHandler.prototype = {\n\tstartDocument : function() {\n    \tthis.document = new DOMImplementation().createDocument(null, null, null);\n    \tif (this.locator) {\n        \tthis.document.documentURI = this.locator.systemId;\n    \t}\n\t},\n\tstartElement:function(namespaceURI, localName, qName, attrs) {\n\t\tvar doc = this.document;\n\t    var el = doc.createElementNS(namespaceURI, qName||localName);\n\t    var len = attrs.length;\n\t    appendElement(this, el);\n\t    this.currentElement = el;\n\t    \n\t\tthis.locator && position(this.locator,el)\n\t    for (var i = 0 ; i < len; i++) {\n\t        var namespaceURI = attrs.getURI(i);\n\t        var value = attrs.getValue(i);\n\t        var qName = attrs.getQName(i);\n\t\t\tvar attr = doc.createAttributeNS(namespaceURI, qName);\n\t\t\tif( attr.getOffset){\n\t\t\t\tposition(attr.getOffset(1),attr)\n\t\t\t}\n\t\t\tattr.value = attr.nodeValue = value;\n\t\t\tel.setAttributeNode(attr)\n\t    }\n\t},\n\tendElement:function(namespaceURI, localName, qName) {\n\t\tvar current = this.currentElement\n\t    var tagName = current.tagName;\n\t    this.currentElement = current.parentNode;\n\t},\n\tstartPrefixMapping:function(prefix, uri) {\n\t},\n\tendPrefixMapping:function(prefix) {\n\t},\n\tprocessingInstruction:function(target, data) {\n\t    var ins = this.document.createProcessingInstruction(target, data);\n\t    this.locator && position(this.locator,ins)\n\t    appendElement(this, ins);\n\t},\n\tignorableWhitespace:function(ch, start, length) {\n\t},\n\tcharacters:function(chars, start, length) {\n\t\tchars = _toString.apply(this,arguments)\n\t\t//console.log(chars)\n\t\tif(this.currentElement && chars){\n\t\t\tif (this.cdata) {\n\t\t\t\tvar charNode = this.document.createCDATASection(chars);\n\t\t\t\tthis.currentElement.appendChild(charNode);\n\t\t\t} else {\n\t\t\t\tvar charNode = this.document.createTextNode(chars);\n\t\t\t\tthis.currentElement.appendChild(charNode);\n\t\t\t}\n\t\t\tthis.locator && position(this.locator,charNode)\n\t\t}\n\t},\n\tskippedEntity:function(name) {\n\t},\n\tendDocument:function() {\n\t\tthis.document.normalize();\n\t},\n\tsetDocumentLocator:function (locator) {\n\t    if(this.locator = locator){// && !('lineNumber' in locator)){\n\t    \tlocator.lineNumber = 0;\n\t    }\n\t},\n\t//LexicalHandler\n\tcomment:function(chars, start, length) {\n\t\tchars = _toString.apply(this,arguments)\n\t    var comm = this.document.createComment(chars);\n\t    this.locator && position(this.locator,comm)\n\t    appendElement(this, comm);\n\t},\n\t\n\tstartCDATA:function() {\n\t    //used in characters() methods\n\t    this.cdata = true;\n\t},\n\tendCDATA:function() {\n\t    this.cdata = false;\n\t},\n\t\n\tstartDTD:function(name, publicId, systemId) {\n\t\tvar impl = this.document.implementation;\n\t    if (impl && impl.createDocumentType) {\n\t        var dt = impl.createDocumentType(name, publicId, systemId);\n\t        this.locator && position(this.locator,dt)\n\t        appendElement(this, dt);\n\t    }\n\t},\n\t/**\n\t * @see org.xml.sax.ErrorHandler\n\t * @link http://www.saxproject.org/apidoc/org/xml/sax/ErrorHandler.html\n\t */\n\twarning:function(error) {\n\t\tconsole.warn(error,_locator(this.locator));\n\t},\n\terror:function(error) {\n\t\tconsole.error(error,_locator(this.locator));\n\t},\n\tfatalError:function(error) {\n\t\tconsole.error(error,_locator(this.locator));\n\t    throw error;\n\t}\n}\nfunction _locator(l){\n\tif(l){\n\t\treturn '\\n@'+(l.systemId ||'')+'#[line:'+l.lineNumber+',col:'+l.columnNumber+']'\n\t}\n}\nfunction _toString(chars,start,length){\n\tif(typeof chars == 'string'){\n\t\treturn chars.substr(start,length)\n\t}else{//java sax connect width xmldom on rhino(what about: \"? && !(chars instanceof String)\")\n\t\tif(chars.length >= start+length || start){\n\t\t\treturn new java.lang.String(chars,start,length)+'';\n\t\t}\n\t\treturn chars;\n\t}\n}\n\n/*\n * @link http://www.saxproject.org/apidoc/org/xml/sax/ext/LexicalHandler.html\n * used method of org.xml.sax.ext.LexicalHandler:\n *  #comment(chars, start, length)\n *  #startCDATA()\n *  #endCDATA()\n *  #startDTD(name, publicId, systemId)\n *\n *\n * IGNORED method of org.xml.sax.ext.LexicalHandler:\n *  #endDTD()\n *  #startEntity(name)\n *  #endEntity(name)\n *\n *\n * @link http://www.saxproject.org/apidoc/org/xml/sax/ext/DeclHandler.html\n * IGNORED method of org.xml.sax.ext.DeclHandler\n * \t#attributeDecl(eName, aName, type, mode, value)\n *  #elementDecl(name, model)\n *  #externalEntityDecl(name, publicId, systemId)\n *  #internalEntityDecl(name, value)\n * @link http://www.saxproject.org/apidoc/org/xml/sax/ext/EntityResolver2.html\n * IGNORED method of org.xml.sax.EntityResolver2\n *  #resolveEntity(String name,String publicId,String baseURI,String systemId)\n *  #resolveEntity(publicId, systemId)\n *  #getExternalSubset(name, baseURI)\n * @link http://www.saxproject.org/apidoc/org/xml/sax/DTDHandler.html\n * IGNORED method of org.xml.sax.DTDHandler\n *  #notationDecl(name, publicId, systemId) {};\n *  #unparsedEntityDecl(name, publicId, systemId, notationName) {};\n */\n\"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl\".replace(/\\w+/g,function(key){\n\tDOMHandler.prototype[key] = function(){return null}\n})\n\n/* Private static helpers treated below as private instance methods, so don't need to add these to the public API; we might use a Relator to also get rid of non-standard public properties */\nfunction appendElement (hander,node) {\n    if (!hander.currentElement) {\n        hander.document.appendChild(node);\n    } else {\n        hander.currentElement.appendChild(node);\n    }\n}//appendChild and setAttributeNS are preformance key\n\njsio('import .sax');\njsio('import .dom');\nvar XMLReader = sax.XMLReader;\nvar DOMImplementation = exports.DOMImplementation = dom.DOMImplementation;\nexports.XMLSerializer = dom.XMLSerializer ;\nexports.DOMParser = DOMParser;\n","pre":true},"modules/devkit-core/src/clientapi/native/dom/sax.js":{"path":"modules/devkit-core/src/clientapi/native/dom/sax.js","friendlyPath":".sax","directory":"modules/devkit-core/src/clientapi/native/dom/","filename":"sax.js","src":"//[4]   \tNameStartChar\t   ::=   \t\":\" | [A-Z] | \"_\" | [a-z] | [#xC0-#xD6] | [#xD8-#xF6] | [#xF8-#x2FF] | [#x370-#x37D] | [#x37F-#x1FFF] | [#x200C-#x200D] | [#x2070-#x218F] | [#x2C00-#x2FEF] | [#x3001-#xD7FF] | [#xF900-#xFDCF] | [#xFDF0-#xFFFD] | [#x10000-#xEFFFF]\n//[4a]   \tNameChar\t   ::=   \tNameStartChar | \"-\" | \".\" | [0-9] | #xB7 | [#x0300-#x036F] | [#x203F-#x2040]\n//[5]   \tName\t   ::=   \tNameStartChar (NameChar)*\nvar nameStartChar = /[A-Z_a-z\\xC0-\\xD6\\xD8-\\xF6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD]///\\u10000-\\uEFFFF\nvar nameChar = new RegExp(\"[\\\\-\\\\.0-9\"+nameStartChar.source.slice(1,-1)+\"\\u00B7\\u0300-\\u036F\\\\ux203F-\\u2040]\");\nvar tagNamePattern = new RegExp('^'+nameStartChar.source+nameChar.source+'*(?:\\:'+nameStartChar.source+nameChar.source+'*)?$');\n//var tagNamePattern = /^[a-zA-Z_][\\w\\-\\.]*(?:\\:[a-zA-Z_][\\w\\-\\.]*)?$/\n//var handlers = 'resolveEntity,getExternalSubset,characters,endDocument,endElement,endPrefixMapping,ignorableWhitespace,processingInstruction,setDocumentLocator,skippedEntity,startDocument,startElement,startPrefixMapping,notationDecl,unparsedEntityDecl,error,fatalError,warning,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,comment,endCDATA,endDTD,endEntity,startCDATA,startDTD,startEntity'.split(',')\n\n//S_TAG,\tS_ATTR,\tS_EQ,\tS_V\n//S_ATTR_S,\tS_E,\tS_S,\tS_C\nvar S_TAG = 0;//tag name offerring\nvar S_ATTR = 1;//attr name offerring \nvar S_ATTR_S=2;//attr name end and space offer\nvar S_EQ = 3;//=space?\nvar S_V = 4;//attr value(no quot value only)\nvar S_E = 5;//attr value end and no space(quot end)\nvar S_S = 6;//(attr value end || tag end ) && (space offer)\nvar S_C = 7;//closed el<el />\n\nfunction XMLReader(){\n\t\n}\n\nXMLReader.prototype = {\n\tparse:function(source,defaultNSMap,entityMap){\n\t\tvar domBuilder = this.domBuilder;\n\t\tdomBuilder.startDocument();\n\t\t_copy(defaultNSMap ,defaultNSMap = {})\n\t\tparse(source,defaultNSMap,entityMap,\n\t\t\t\tdomBuilder,this.errorHandler);\n\t\tdomBuilder.endDocument();\n\t}\n}\nfunction parse(source,defaultNSMapCopy,entityMap,domBuilder,errorHandler){\n  function fixedFromCharCode(code) {\n\t\t// String.prototype.fromCharCode does not supports\n\t\t// > 2 bytes unicode chars directly\n\t\tif (code > 0xffff) {\n\t\t\tcode -= 0x10000;\n\t\t\tvar surrogate1 = 0xd800 + (code >> 10)\n\t\t\t\t, surrogate2 = 0xdc00 + (code & 0x3ff);\n\n\t\t\treturn String.fromCharCode(surrogate1, surrogate2);\n\t\t} else {\n\t\t\treturn String.fromCharCode(code);\n\t\t}\n\t}\n\tfunction entityReplacer(a){\n\t\tvar k = a.slice(1,-1);\n\t\tif(k in entityMap){\n\t\t\treturn entityMap[k]; \n\t\t}else if(k.charAt(0) === '#'){\n\t\t\treturn fixedFromCharCode(parseInt(k.substr(1).replace('x','0x')))\n\t\t}else{\n\t\t\terrorHandler.error('entity not found:'+a);\n\t\t\treturn a;\n\t\t}\n\t}\n\tfunction appendText(end){//has some bugs\n\t\tvar xt = source.substring(start,end).replace(/&#?\\w+;/g,entityReplacer);\n\t\tlocator&&position(start);\n\t\tdomBuilder.characters(xt,0,end-start);\n\t\tstart = end\n\t}\n\tfunction position(start,m){\n\t\twhile(start>=endPos && (m = linePattern.exec(source))){\n\t\t\tstartPos = m.index;\n\t\t\tendPos = startPos + m[0].length;\n\t\t\tlocator.lineNumber++;\n\t\t\t//console.log('line++:',locator,startPos,endPos)\n\t\t}\n\t\tlocator.columnNumber = start-startPos+1;\n\t}\n\tvar startPos = 0;\n\tvar endPos = 0;\n\tvar linePattern = /.+(?:\\r\\n?|\\n)|.*$/g\n\tvar locator = domBuilder.locator;\n\t\n\tvar parseStack = [{currentNSMap:defaultNSMapCopy}]\n\tvar closeMap = {};\n\tvar start = 0;\n\twhile(true){\n\t\tvar i = source.indexOf('<',start);\n\t\tif(i<0){\n\t\t\tif(!source.substr(start).match(/^\\s*$/)){\n\t\t\t\tvar doc = domBuilder.document;\n    \t\t\tvar text = doc.createTextNode(source.substr(start));\n    \t\t\tdoc.appendChild(text);\n    \t\t\tdomBuilder.currentElement = text;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tif(i>start){\n\t\t\tappendText(i);\n\t\t}\n\t\tswitch(source.charAt(i+1)){\n\t\tcase '/':\n\t\t\tvar end = source.indexOf('>',i+3);\n\t\t\tvar tagName = source.substring(i+2,end);\n\t\t\tvar config = parseStack.pop();\n\t\t\tvar localNSMap = config.localNSMap;\n\t\t\t\n\t        if(config.tagName != tagName){\n\t            errorHandler.fatalError(\"end tag name: \"+tagName+' is not match the current start tagName:'+config.tagName );\n\t        }\n\t\t\tdomBuilder.endElement(config.uri,config.localName,tagName);\n\t\t\tif(localNSMap){\n\t\t\t\tfor(var prefix in localNSMap){\n\t\t\t\t\tdomBuilder.endPrefixMapping(prefix) ;\n\t\t\t\t}\n\t\t\t}\n\t\t\tend++;\n\t\t\tbreak;\n\t\t\t// end elment\n\t\tcase '?':// <?...?>\n\t\t\tlocator&&position(i);\n\t\t\tend = parseInstruction(source,i,domBuilder);\n\t\t\tbreak;\n\t\tcase '!':// <!doctype,<![CDATA,<!--\n\t\t\tlocator&&position(i);\n\t\t\tend = parseDCC(source,i,domBuilder,errorHandler);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\ttry{\n\t\t\t\tlocator&&position(i);\n\t\t\t\t\n\t\t\t\tvar el = new ElementAttributes();\n\t\t\t\t\n\t\t\t\t//elStartEnd\n\t\t\t\tvar end = parseElementStartPart(source,i,el,entityReplacer,errorHandler);\n\t\t\t\tvar len = el.length;\n\t\t\t\t//position fixed\n\t\t\t\tif(len && locator){\n\t\t\t\t\tvar backup = copyLocator(locator,{});\n\t\t\t\t\tfor(var i = 0;i<len;i++){\n\t\t\t\t\t\tvar a = el[i];\n\t\t\t\t\t\tposition(a.offset);\n\t\t\t\t\t\ta.offset = copyLocator(locator,{});\n\t\t\t\t\t}\n\t\t\t\t\tcopyLocator(backup,locator);\n\t\t\t\t}\n\t\t\t\tif(!el.closed && fixSelfClosed(source,end,el.tagName,closeMap)){\n\t\t\t\t\tel.closed = true;\n\t\t\t\t\tif(!entityMap.nbsp){\n\t\t\t\t\t\terrorHandler.warning('unclosed xml attribute');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tappendElement(el,domBuilder,parseStack);\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tif(el.uri === 'http://www.w3.org/1999/xhtml' && !el.closed){\n\t\t\t\t\tend = parseHtmlSpecialContent(source,end,el.tagName,entityReplacer,domBuilder)\n\t\t\t\t}else{\n\t\t\t\t\tend++;\n\t\t\t\t}\n\t\t\t}catch(e){\n\t\t\t\terrorHandler.error('element parse error: '+e);\n\t\t\t\tend = -1;\n\t\t\t}\n\n\t\t}\n\t\tif(end<0){\n\t\t\t//TODO: sax\n\t\t\tappendText(i+1);\n\t\t}else{\n\t\t\tstart = end;\n\t\t}\n\t}\n}\nfunction copyLocator(f,t){\n\tt.lineNumber = f.lineNumber;\n\tt.columnNumber = f.columnNumber;\n\treturn t;\n\t\n}\n\n/**\n * @see #appendElement(source,elStartEnd,el,selfClosed,entityReplacer,domBuilder,parseStack);\n * @return end of the elementStartPart(end of elementEndPart for selfClosed el)\n */\nfunction parseElementStartPart(source,start,el,entityReplacer,errorHandler){\n\tvar attrName;\n\tvar value;\n\tvar p = ++start;\n\tvar s = S_TAG;//status\n\twhile(true){\n\t\tvar c = source.charAt(p);\n\t\tswitch(c){\n\t\tcase '=':\n\t\t\tif(s === S_ATTR){//attrName\n\t\t\t\tattrName = source.slice(start,p);\n\t\t\t\ts = S_EQ;\n\t\t\t}else if(s === S_ATTR_S){\n\t\t\t\ts = S_EQ;\n\t\t\t}else{\n\t\t\t\t//fatalError: equal must after attrName or space after attrName\n\t\t\t\tthrow new Error('attribute equal must after attrName');\n\t\t\t}\n\t\t\tbreak;\n\t\tcase '\\'':\n\t\tcase '\"':\n\t\t\tif(s === S_EQ){//equal\n\t\t\t\tstart = p+1;\n\t\t\t\tp = source.indexOf(c,start)\n\t\t\t\tif(p>0){\n\t\t\t\t\tvalue = source.slice(start,p).replace(/&#?\\w+;/g,entityReplacer);\n\t\t\t\t\tel.add(attrName,value,start-1);\n\t\t\t\t\ts = S_E;\n\t\t\t\t}else{\n\t\t\t\t\t//fatalError: no end quot match\n\t\t\t\t\tthrow new Error('attribute value no end \\''+c+'\\' match');\n\t\t\t\t}\n\t\t\t}else if(s == S_V){\n\t\t\t\tvalue = source.slice(start,p).replace(/&#?\\w+;/g,entityReplacer);\n\t\t\t\t//console.log(attrName,value,start,p)\n\t\t\t\tel.add(attrName,value,start);\n\t\t\t\t//console.dir(el)\n\t\t\t\terrorHandler.warning('attribute \"'+attrName+'\" missed start quot('+c+')!!');\n\t\t\t\tstart = p+1;\n\t\t\t\ts = S_E\n\t\t\t}else{\n\t\t\t\t//fatalError: no equal before\n\t\t\t\tthrow new Error('attribute value must after \"=\"');\n\t\t\t}\n\t\t\tbreak;\n\t\tcase '/':\n\t\t\tswitch(s){\n\t\t\tcase S_TAG:\n\t\t\t\tel.setTagName(source.slice(start,p));\n\t\t\tcase S_E:\n\t\t\tcase S_S:\n\t\t\tcase S_C:\n\t\t\t\ts = S_C;\n\t\t\t\tel.closed = true;\n\t\t\tcase S_V:\n\t\t\tcase S_ATTR:\n\t\t\tcase S_ATTR_S:\n\t\t\t\tbreak;\n\t\t\t//case S_EQ:\n\t\t\tdefault:\n\t\t\t\tthrow new Error(\"attribute invalid close char('/')\")\n\t\t\t}\n\t\t\tbreak;\n\t\tcase ''://end document\n\t\t\t//throw new Error('unexpected end of input')\n\t\t\terrorHandler.error('unexpected end of input');\n\t\tcase '>':\n\t\t\tswitch(s){\n\t\t\tcase S_TAG:\n\t\t\t\tel.setTagName(source.slice(start,p));\n\t\t\tcase S_E:\n\t\t\tcase S_S:\n\t\t\tcase S_C:\n\t\t\t\tbreak;//normal\n\t\t\tcase S_V://Compatible state\n\t\t\tcase S_ATTR:\n\t\t\t\tvalue = source.slice(start,p);\n\t\t\t\tif(value.slice(-1) === '/'){\n\t\t\t\t\tel.closed  = true;\n\t\t\t\t\tvalue = value.slice(0,-1)\n\t\t\t\t}\n\t\t\tcase S_ATTR_S:\n\t\t\t\tif(s === S_ATTR_S){\n\t\t\t\t\tvalue = attrName;\n\t\t\t\t}\n\t\t\t\tif(s == S_V){\n\t\t\t\t\terrorHandler.warning('attribute \"'+value+'\" missed quot(\")!!');\n\t\t\t\t\tel.add(attrName,value.replace(/&#?\\w+;/g,entityReplacer),start)\n\t\t\t\t}else{\n\t\t\t\t\terrorHandler.warning('attribute \"'+value+'\" missed value!! \"'+value+'\" instead!!')\n\t\t\t\t\tel.add(value,value,start)\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase S_EQ:\n\t\t\t\tthrow new Error('attribute value missed!!');\n\t\t\t}\n//\t\t\tconsole.log(tagName,tagNamePattern,tagNamePattern.test(tagName))\n\t\t\treturn p;\n\t\t/*xml space '\\x20' | #x9 | #xD | #xA; */\n\t\tcase '\\u0080':\n\t\t\tc = ' ';\n\t\tdefault:\n\t\t\tif(c<= ' '){//space\n\t\t\t\tswitch(s){\n\t\t\t\tcase S_TAG:\n\t\t\t\t\tel.setTagName(source.slice(start,p));//tagName\n\t\t\t\t\ts = S_S;\n\t\t\t\t\tbreak;\n\t\t\t\tcase S_ATTR:\n\t\t\t\t\tattrName = source.slice(start,p)\n\t\t\t\t\ts = S_ATTR_S;\n\t\t\t\t\tbreak;\n\t\t\t\tcase S_V:\n\t\t\t\t\tvar value = source.slice(start,p).replace(/&#?\\w+;/g,entityReplacer);\n\t\t\t\t\terrorHandler.warning('attribute \"'+value+'\" missed quot(\")!!');\n\t\t\t\t\tel.add(attrName,value,start)\n\t\t\t\tcase S_E:\n\t\t\t\t\ts = S_S;\n\t\t\t\t\tbreak;\n\t\t\t\t//case S_S:\n\t\t\t\t//case S_EQ:\n\t\t\t\t//case S_ATTR_S:\n\t\t\t\t//\tvoid();break;\n\t\t\t\t//case S_C:\n\t\t\t\t\t//ignore warning\n\t\t\t\t}\n\t\t\t}else{//not space\n//S_TAG,\tS_ATTR,\tS_EQ,\tS_V\n//S_ATTR_S,\tS_E,\tS_S,\tS_C\n\t\t\t\tswitch(s){\n\t\t\t\t//case S_TAG:void();break;\n\t\t\t\t//case S_ATTR:void();break;\n\t\t\t\t//case S_V:void();break;\n\t\t\t\tcase S_ATTR_S:\n\t\t\t\t\terrorHandler.warning('attribute \"'+attrName+'\" missed value!! \"'+attrName+'\" instead!!')\n\t\t\t\t\tel.add(attrName,attrName,start);\n\t\t\t\t\tstart = p;\n\t\t\t\t\ts = S_ATTR;\n\t\t\t\t\tbreak;\n\t\t\t\tcase S_E:\n\t\t\t\t\terrorHandler.warning('attribute space is required\"'+attrName+'\"!!')\n\t\t\t\tcase S_S:\n\t\t\t\t\ts = S_ATTR;\n\t\t\t\t\tstart = p;\n\t\t\t\t\tbreak;\n\t\t\t\tcase S_EQ:\n\t\t\t\t\ts = S_V;\n\t\t\t\t\tstart = p;\n\t\t\t\t\tbreak;\n\t\t\t\tcase S_C:\n\t\t\t\t\tthrow new Error(\"elements closed character '/' and '>' must be connected to\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tp++;\n\t}\n}\n/**\n * @return end of the elementStartPart(end of elementEndPart for selfClosed el)\n */\nfunction appendElement(el,domBuilder,parseStack){\n\tvar tagName = el.tagName;\n\tvar localNSMap = null;\n\tvar currentNSMap = parseStack[parseStack.length-1].currentNSMap;\n\tvar i = el.length;\n\twhile(i--){\n\t\tvar a = el[i];\n\t\tvar qName = a.qName;\n\t\tvar value = a.value;\n\t\tvar nsp = qName.indexOf(':');\n\t\tif(nsp>0){\n\t\t\tvar prefix = a.prefix = qName.slice(0,nsp);\n\t\t\tvar localName = qName.slice(nsp+1);\n\t\t\tvar nsPrefix = prefix === 'xmlns' && localName\n\t\t}else{\n\t\t\tlocalName = qName;\n\t\t\tprefix = null\n\t\t\tnsPrefix = qName === 'xmlns' && ''\n\t\t}\n\t\t//can not set prefix,because prefix !== ''\n\t\ta.localName = localName ;\n\t\t//prefix == null for no ns prefix attribute \n\t\tif(nsPrefix !== false){//hack!!\n\t\t\tif(localNSMap == null){\n\t\t\t\tlocalNSMap = {}\n\t\t\t\t//console.log(currentNSMap,0)\n\t\t\t\t_copy(currentNSMap,currentNSMap={})\n\t\t\t\t//console.log(currentNSMap,1)\n\t\t\t}\n\t\t\tcurrentNSMap[nsPrefix] = localNSMap[nsPrefix] = value;\n\t\t\ta.uri = 'http://www.w3.org/2000/xmlns/'\n\t\t\tdomBuilder.startPrefixMapping(nsPrefix, value) \n\t\t}\n\t}\n\tvar i = el.length;\n\twhile(i--){\n\t\ta = el[i];\n\t\tvar prefix = a.prefix;\n\t\tif(prefix){//no prefix attribute has no namespace\n\t\t\tif(prefix === 'xml'){\n\t\t\t\ta.uri = 'http://www.w3.org/XML/1998/namespace';\n\t\t\t}if(prefix !== 'xmlns'){\n\t\t\t\ta.uri = currentNSMap[prefix]\n\t\t\t\t\n\t\t\t\t//{console.log('###'+a.qName,domBuilder.locator.systemId+'',currentNSMap,a.uri)}\n\t\t\t}\n\t\t}\n\t}\n\tvar nsp = tagName.indexOf(':');\n\tif(nsp>0){\n\t\tprefix = el.prefix = tagName.slice(0,nsp);\n\t\tlocalName = el.localName = tagName.slice(nsp+1);\n\t}else{\n\t\tprefix = null;//important!!\n\t\tlocalName = el.localName = tagName;\n\t}\n\t//no prefix element has default namespace\n\tvar ns = el.uri = currentNSMap[prefix || ''];\n\tdomBuilder.startElement(ns,localName,tagName,el);\n\t//endPrefixMapping and startPrefixMapping have not any help for dom builder\n\t//localNSMap = null\n\tif(el.closed){\n\t\tdomBuilder.endElement(ns,localName,tagName);\n\t\tif(localNSMap){\n\t\t\tfor(prefix in localNSMap){\n\t\t\t\tdomBuilder.endPrefixMapping(prefix) \n\t\t\t}\n\t\t}\n\t}else{\n\t\tel.currentNSMap = currentNSMap;\n\t\tel.localNSMap = localNSMap;\n\t\tparseStack.push(el);\n\t}\n}\nfunction parseHtmlSpecialContent(source,elStartEnd,tagName,entityReplacer,domBuilder){\n\tif(/^(?:script|textarea)$/i.test(tagName)){\n\t\tvar elEndStart =  source.indexOf('</'+tagName+'>',elStartEnd);\n\t\tvar text = source.substring(elStartEnd+1,elEndStart);\n\t\tif(/[&<]/.test(text)){\n\t\t\tif(/^script$/i.test(tagName)){\n\t\t\t\t//if(!/\\]\\]>/.test(text)){\n\t\t\t\t\t//lexHandler.startCDATA();\n\t\t\t\t\tdomBuilder.characters(text,0,text.length);\n\t\t\t\t\t//lexHandler.endCDATA();\n\t\t\t\t\treturn elEndStart;\n\t\t\t\t//}\n\t\t\t}//}else{//text area\n\t\t\t\ttext = text.replace(/&#?\\w+;/g,entityReplacer);\n\t\t\t\tdomBuilder.characters(text,0,text.length);\n\t\t\t\treturn elEndStart;\n\t\t\t//}\n\t\t\t\n\t\t}\n\t}\n\treturn elStartEnd+1;\n}\nfunction fixSelfClosed(source,elStartEnd,tagName,closeMap){\n\t//if(tagName in closeMap){\n\tvar pos = closeMap[tagName];\n\tif(pos == null){\n\t\t//console.log(tagName)\n\t\tpos = closeMap[tagName] = source.lastIndexOf('</'+tagName+'>')\n\t}\n\treturn pos<elStartEnd;\n\t//} \n}\nfunction _copy(source,target){\n\tfor(var n in source){target[n] = source[n]}\n}\nfunction parseDCC(source,start,domBuilder,errorHandler){//sure start with '<!'\n\tvar next= source.charAt(start+2)\n\tswitch(next){\n\tcase '-':\n\t\tif(source.charAt(start + 3) === '-'){\n\t\t\tvar end = source.indexOf('-->',start+4);\n\t\t\t//append comment source.substring(4,end)//<!--\n\t\t\tif(end>start){\n\t\t\t\tdomBuilder.comment(source,start+4,end-start-4);\n\t\t\t\treturn end+3;\n\t\t\t}else{\n\t\t\t\terrorHandler.error(\"Unclosed comment\");\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t}else{\n\t\t\t//error\n\t\t\treturn -1;\n\t\t}\n\tdefault:\n\t\tif(source.substr(start+3,6) == 'CDATA['){\n\t\t\tvar end = source.indexOf(']]>',start+9);\n\t\t\tdomBuilder.startCDATA();\n\t\t\tdomBuilder.characters(source,start+9,end-start-9);\n\t\t\tdomBuilder.endCDATA() \n\t\t\treturn end+3;\n\t\t}\n\t\t//<!DOCTYPE\n\t\t//startDTD(java.lang.String name, java.lang.String publicId, java.lang.String systemId) \n\t\tvar matchs = split(source,start);\n\t\tvar len = matchs.length;\n\t\tif(len>1 && /!doctype/i.test(matchs[0][0])){\n\t\t\tvar name = matchs[1][0];\n\t\t\tvar pubid = len>3 && /^public$/i.test(matchs[2][0]) && matchs[3][0]\n\t\t\tvar sysid = len>4 && matchs[4][0];\n\t\t\tvar lastMatch = matchs[len-1]\n\t\t\tdomBuilder.startDTD(name,pubid && pubid.replace(/^(['\"])(.*?)\\1$/,'$2'),\n\t\t\t\t\tsysid && sysid.replace(/^(['\"])(.*?)\\1$/,'$2'));\n\t\t\tdomBuilder.endDTD();\n\t\t\t\n\t\t\treturn lastMatch.index+lastMatch[0].length\n\t\t}\n\t}\n\treturn -1;\n}\n\n\n\nfunction parseInstruction(source,start,domBuilder){\n\tvar end = source.indexOf('?>',start);\n\tif(end){\n\t\tvar match = source.substring(start,end).match(/^<\\?(\\S*)\\s*([\\s\\S]*?)\\s*$/);\n\t\tif(match){\n\t\t\tvar len = match[0].length;\n\t\t\tdomBuilder.processingInstruction(match[1], match[2]) ;\n\t\t\treturn end+2;\n\t\t}else{//error\n\t\t\treturn -1;\n\t\t}\n\t}\n\treturn -1;\n}\n\n/**\n * @param source\n */\nfunction ElementAttributes(source){\n\t\n}\nElementAttributes.prototype = {\n\tsetTagName:function(tagName){\n\t\tif(!tagNamePattern.test(tagName)){\n\t\t\tthrow new Error('invalid tagName:'+tagName)\n\t\t}\n\t\tthis.tagName = tagName\n\t},\n\tadd:function(qName,value,offset){\n\t\tif(!tagNamePattern.test(qName)){\n\t\t\tthrow new Error('invalid attribute:'+qName)\n\t\t}\n\t\tthis[this.length++] = {qName:qName,value:value,offset:offset}\n\t},\n\tlength:0,\n\tgetLocalName:function(i){return this[i].localName},\n\tgetOffset:function(i){return this[i].offset},\n\tgetQName:function(i){return this[i].qName},\n\tgetURI:function(i){return this[i].uri},\n\tgetValue:function(i){return this[i].value}\n//\t,getIndex:function(uri, localName)){\n//\t\tif(localName){\n//\t\t\t\n//\t\t}else{\n//\t\t\tvar qName = uri\n//\t\t}\n//\t},\n//\tgetValue:function(){return this.getValue(this.getIndex.apply(this,arguments))},\n//\tgetType:function(uri,localName){}\n//\tgetType:function(i){},\n}\n\n\n\n\nfunction _set_proto_(thiz,parent){\n\tthiz.__proto__ = parent;\n\treturn thiz;\n}\nif(!(_set_proto_({},_set_proto_.prototype) instanceof _set_proto_)){\n\t_set_proto_ = function(thiz,parent){\n\t\tfunction p(){};\n\t\tp.prototype = parent;\n\t\tp = new p();\n\t\tfor(parent in thiz){\n\t\t\tp[parent] = thiz[parent];\n\t\t}\n\t\treturn p;\n\t}\n}\n\nfunction split(source,start){\n\tvar match;\n\tvar buf = [];\n\tvar reg = /'[^']+'|\"[^\"]+\"|[^\\s<>\\/=]+=?|(\\/?\\s*>|<)/g;\n\treg.lastIndex = start;\n\treg.exec(source);//skip <\n\twhile(match = reg.exec(source)){\n\t\tbuf.push(match);\n\t\tif(match[1])return buf;\n\t}\n}\n\nif(typeof require == 'function'){\n\texports.XMLReader = XMLReader;\n}\n\n","pre":true},"modules/devkit-core/src/clientapi/native/dom/dom.js":{"path":"modules/devkit-core/src/clientapi/native/dom/dom.js","friendlyPath":".dom","directory":"modules/devkit-core/src/clientapi/native/dom/","filename":"dom.js","src":"/*\n * DOM Level 2\n * Object DOMException\n * @see http://www.w3.org/TR/REC-DOM-Level-1/ecma-script-language-binding.html\n * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/ecma-script-binding.html\n */\n\nfunction copy(src,dest){\n\tfor(var p in src){\n\t\tdest[p] = src[p];\n\t}\n}\n/**\n^\\w+\\.prototype\\.([_\\w]+)\\s*=\\s*((?:.*\\{\\s*?[\\r\\n][\\s\\S]*?^})|\\S.*?(?=[;\\r\\n]));?\n^\\w+\\.prototype\\.([_\\w]+)\\s*=\\s*(\\S.*?(?=[;\\r\\n]));?\n */\nfunction _extends(Class,Super){\n\tvar pt = Class.prototype;\n\tif(Object.create){\n\t\tvar ppt = Object.create(Super.prototype)\n\t\tpt.__proto__ = ppt;\n\t}\n\tif(!(pt instanceof Super)){\n\t\tfunction t(){};\n\t\tt.prototype = Super.prototype;\n\t\tt = new t();\n\t\tcopy(pt,t);\n\t\tClass.prototype = pt = t;\n\t}\n\tif(pt.constructor != Class){\n\t\tif(typeof Class != 'function'){\n\t\t\tconsole.error(\"unknow Class:\"+Class)\n\t\t}\n\t\tpt.constructor = Class\n\t}\n}\nvar htmlns = 'http://www.w3.org/1999/xhtml' ;\n// Node Types\nvar NodeType = {}\nvar ELEMENT_NODE                = NodeType.ELEMENT_NODE                = 1;\nvar ATTRIBUTE_NODE              = NodeType.ATTRIBUTE_NODE              = 2;\nvar TEXT_NODE                   = NodeType.TEXT_NODE                   = 3;\nvar CDATA_SECTION_NODE          = NodeType.CDATA_SECTION_NODE          = 4;\nvar ENTITY_REFERENCE_NODE       = NodeType.ENTITY_REFERENCE_NODE       = 5;\nvar ENTITY_NODE                 = NodeType.ENTITY_NODE                 = 6;\nvar PROCESSING_INSTRUCTION_NODE = NodeType.PROCESSING_INSTRUCTION_NODE = 7;\nvar COMMENT_NODE                = NodeType.COMMENT_NODE                = 8;\nvar DOCUMENT_NODE               = NodeType.DOCUMENT_NODE               = 9;\nvar DOCUMENT_TYPE_NODE          = NodeType.DOCUMENT_TYPE_NODE          = 10;\nvar DOCUMENT_FRAGMENT_NODE      = NodeType.DOCUMENT_FRAGMENT_NODE      = 11;\nvar NOTATION_NODE               = NodeType.NOTATION_NODE               = 12;\n\n// ExceptionCode\nvar ExceptionCode = {}\nvar ExceptionMessage = {};\nvar INDEX_SIZE_ERR              = ExceptionCode.INDEX_SIZE_ERR              = ((ExceptionMessage[1]=\"Index size error\"),1);\nvar DOMSTRING_SIZE_ERR          = ExceptionCode.DOMSTRING_SIZE_ERR          = ((ExceptionMessage[2]=\"DOMString size error\"),2);\nvar HIERARCHY_REQUEST_ERR       = ExceptionCode.HIERARCHY_REQUEST_ERR       = ((ExceptionMessage[3]=\"Hierarchy request error\"),3);\nvar WRONG_DOCUMENT_ERR          = ExceptionCode.WRONG_DOCUMENT_ERR          = ((ExceptionMessage[4]=\"Wrong document\"),4);\nvar INVALID_CHARACTER_ERR       = ExceptionCode.INVALID_CHARACTER_ERR       = ((ExceptionMessage[5]=\"Invalid character\"),5);\nvar NO_DATA_ALLOWED_ERR         = ExceptionCode.NO_DATA_ALLOWED_ERR         = ((ExceptionMessage[6]=\"No data allowed\"),6);\nvar NO_MODIFICATION_ALLOWED_ERR = ExceptionCode.NO_MODIFICATION_ALLOWED_ERR = ((ExceptionMessage[7]=\"No modification allowed\"),7);\nvar NOT_FOUND_ERR               = ExceptionCode.NOT_FOUND_ERR               = ((ExceptionMessage[8]=\"Not found\"),8);\nvar NOT_SUPPORTED_ERR           = ExceptionCode.NOT_SUPPORTED_ERR           = ((ExceptionMessage[9]=\"Not supported\"),9);\nvar INUSE_ATTRIBUTE_ERR         = ExceptionCode.INUSE_ATTRIBUTE_ERR         = ((ExceptionMessage[10]=\"Attribute in use\"),10);\n//level2\nvar INVALID_STATE_ERR        \t= ExceptionCode.INVALID_STATE_ERR        \t= ((ExceptionMessage[11]=\"Invalid state\"),11);\nvar SYNTAX_ERR               \t= ExceptionCode.SYNTAX_ERR               \t= ((ExceptionMessage[12]=\"Syntax error\"),12);\nvar INVALID_MODIFICATION_ERR \t= ExceptionCode.INVALID_MODIFICATION_ERR \t= ((ExceptionMessage[13]=\"Invalid modification\"),13);\nvar NAMESPACE_ERR            \t= ExceptionCode.NAMESPACE_ERR           \t= ((ExceptionMessage[14]=\"Invalid namespace\"),14);\nvar INVALID_ACCESS_ERR       \t= ExceptionCode.INVALID_ACCESS_ERR      \t= ((ExceptionMessage[15]=\"Invalid access\"),15);\n\n\nfunction DOMException(code, message) {\n\tif(message instanceof Error){\n\t\tvar error = message;\n\t}else{\n\t\terror = this;\n\t\tError.call(this, ExceptionMessage[code]);\n\t\tthis.message = ExceptionMessage[code];\n\t\tif(Error.captureStackTrace) Error.captureStackTrace(this, DOMException);\n\t}\n\terror.code = code;\n\tif(message) this.message = this.message + \": \" + message;\n\treturn error;\n};\nDOMException.prototype = Error.prototype;\ncopy(ExceptionCode,DOMException)\n/**\n * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/core.html#ID-536297177\n * The NodeList interface provides the abstraction of an ordered collection of nodes, without defining or constraining how this collection is implemented. NodeList objects in the DOM are live.\n * The items in the NodeList are accessible via an integral index, starting from 0.\n */\nfunction NodeList() {\n};\nNodeList.prototype = {\n\t/**\n\t * The number of nodes in the list. The range of valid child node indices is 0 to length-1 inclusive.\n\t * @standard level1\n\t */\n\tlength:0, \n\t/**\n\t * Returns the indexth item in the collection. If index is greater than or equal to the number of nodes in the list, this returns null.\n\t * @standard level1\n\t * @param index  unsigned long \n\t *   Index into the collection.\n\t * @return Node\n\t * \tThe node at the indexth position in the NodeList, or null if that is not a valid index. \n\t */\n\titem: function(index) {\n\t\treturn this[index] || null;\n\t}\n};\nfunction LiveNodeList(node,refresh){\n\tthis._node = node;\n\tthis._refresh = refresh\n\t_updateLiveList(this);\n}\nfunction _updateLiveList(list){\n\tvar inc = list._node._inc || list._node.ownerDocument._inc;\n\tif(list._inc != inc){\n\t\tvar ls = list._refresh(list._node);\n\t\t//console.log(ls.length)\n\t\t__set__(list,'length',ls.length);\n\t\tcopy(ls,list);\n\t\tlist._inc = inc;\n\t}\n}\nLiveNodeList.prototype.item = function(i){\n\t_updateLiveList(this);\n\treturn this[i];\n}\n\n_extends(LiveNodeList,NodeList);\n/**\n * \n * Objects implementing the NamedNodeMap interface are used to represent collections of nodes that can be accessed by name. Note that NamedNodeMap does not inherit from NodeList; NamedNodeMaps are not maintained in any particular order. Objects contained in an object implementing NamedNodeMap may also be accessed by an ordinal index, but this is simply to allow convenient enumeration of the contents of a NamedNodeMap, and does not imply that the DOM specifies an order to these Nodes.\n * NamedNodeMap objects in the DOM are live.\n * used for attributes or DocumentType entities \n */\nfunction NamedNodeMap() {\n};\n\nfunction _findNodeIndex(list,node){\n\tvar i = list.length;\n\twhile(i--){\n\t\tif(list[i] === node){return i}\n\t}\n}\n\nfunction _addNamedNode(el,list,newAttr,oldAttr){\n\tif(oldAttr){\n\t\tlist[_findNodeIndex(list,oldAttr)] = newAttr;\n\t}else{\n\t\tlist[list.length++] = newAttr;\n\t}\n\tif(el){\n\t\tnewAttr.ownerElement = el;\n\t\tvar doc = el.ownerDocument;\n\t\tif(doc){\n\t\t\toldAttr && _onRemoveAttribute(doc,el,oldAttr);\n\t\t\t_onAddAttribute(doc,el,newAttr);\n\t\t}\n\t}\n}\nfunction _removeNamedNode(el,list,attr){\n\tvar i = _findNodeIndex(list,attr);\n\tif(i>=0){\n\t\tvar lastIndex = list.length-1\n\t\twhile(i<lastIndex){\n\t\t\tlist[i] = list[++i]\n\t\t}\n\t\tlist.length = lastIndex;\n\t\tif(el){\n\t\t\tvar doc = el.ownerDocument;\n\t\t\tif(doc){\n\t\t\t\t_onRemoveAttribute(doc,el,attr);\n\t\t\t\tattr.ownerElement = null;\n\t\t\t}\n\t\t}\n\t}else{\n\t\tthrow DOMException(NOT_FOUND_ERR,new Error())\n\t}\n}\nNamedNodeMap.prototype = {\n\tlength:0,\n\titem:NodeList.prototype.item,\n\tgetNamedItem: function(key) {\n//\t\tif(key.indexOf(':')>0 || key == 'xmlns'){\n//\t\t\treturn null;\n//\t\t}\n\t\tvar i = this.length;\n\t\twhile(i--){\n\t\t\tvar attr = this[i];\n\t\t\tif(attr.nodeName == key){\n\t\t\t\treturn attr;\n\t\t\t}\n\t\t}\n\t},\n\tsetNamedItem: function(attr) {\n\t\tvar el = attr.ownerElement;\n\t\tif(el && el!=this._ownerElement){\n\t\t\tthrow new DOMException(INUSE_ATTRIBUTE_ERR);\n\t\t}\n\t\tvar oldAttr = this.getNamedItem(attr.nodeName);\n\t\t_addNamedNode(this._ownerElement,this,attr,oldAttr);\n\t\treturn oldAttr;\n\t},\n\t/* returns Node */\n\tsetNamedItemNS: function(attr) {// raises: WRONG_DOCUMENT_ERR,NO_MODIFICATION_ALLOWED_ERR,INUSE_ATTRIBUTE_ERR\n\t\tvar el = attr.ownerElement, oldAttr;\n\t\tif(el && el!=this._ownerElement){\n\t\t\tthrow new DOMException(INUSE_ATTRIBUTE_ERR);\n\t\t}\n\t\toldAttr = this.getNamedItemNS(attr.namespaceURI,attr.localName);\n\t\t_addNamedNode(this._ownerElement,this,attr,oldAttr);\n\t\treturn oldAttr;\n\t},\n\n\t/* returns Node */\n\tremoveNamedItem: function(key) {\n\t\tvar attr = this.getNamedItem(key);\n\t\t_removeNamedNode(this._ownerElement,this,attr);\n\t\treturn attr;\n\t\t\n\t\t\n\t},// raises: NOT_FOUND_ERR,NO_MODIFICATION_ALLOWED_ERR\n\t\n\t//for level2\n\tremoveNamedItemNS:function(namespaceURI,localName){\n\t\tvar attr = this.getNamedItemNS(namespaceURI,localName);\n\t\t_removeNamedNode(this._ownerElement,this,attr);\n\t\treturn attr;\n\t},\n\tgetNamedItemNS: function(namespaceURI, localName) {\n\t\tvar i = this.length;\n\t\twhile(i--){\n\t\t\tvar node = this[i];\n\t\t\tif(node.localName == localName && node.namespaceURI == namespaceURI){\n\t\t\t\treturn node;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n};\n/**\n * @see http://www.w3.org/TR/REC-DOM-Level-1/level-one-core.html#ID-102161490\n */\nfunction DOMImplementation(/* Object */ features) {\n\tthis._features = {};\n\tif (features) {\n\t\tfor (var feature in features) {\n\t\t\t this._features = features[feature];\n\t\t}\n\t}\n};\n\nDOMImplementation.prototype = {\n\thasFeature: function(/* string */ feature, /* string */ version) {\n\t\tvar versions = this._features[feature.toLowerCase()];\n\t\tif (versions && (!version || version in versions)) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t},\n\t// Introduced in DOM Level 2:\n\tcreateDocument:function(namespaceURI,  qualifiedName, doctype){// raises:INVALID_CHARACTER_ERR,NAMESPACE_ERR,WRONG_DOCUMENT_ERR\n\t\tvar doc = new Document();\n\t\tdoc.doctype = doctype;\n\t\tif(doctype){\n\t\t\tdoc.appendChild(doctype);\n\t\t}\n\t\tdoc.implementation = this;\n\t\tdoc.childNodes = new NodeList();\n\t\tif(qualifiedName){\n\t\t\tvar root = doc.createElementNS(namespaceURI,qualifiedName);\n\t\t\tdoc.appendChild(root);\n\t\t}\n\t\treturn doc;\n\t},\n\t// Introduced in DOM Level 2:\n\tcreateDocumentType:function(qualifiedName, publicId, systemId){// raises:INVALID_CHARACTER_ERR,NAMESPACE_ERR\n\t\tvar node = new DocumentType();\n\t\tnode.name = qualifiedName;\n\t\tnode.nodeName = qualifiedName;\n\t\tnode.publicId = publicId;\n\t\tnode.systemId = systemId;\n\t\t// Introduced in DOM Level 2:\n\t\t//readonly attribute DOMString        internalSubset;\n\t\t\n\t\t//TODO:..\n\t\t//  readonly attribute NamedNodeMap     entities;\n\t\t//  readonly attribute NamedNodeMap     notations;\n\t\treturn node;\n\t}\n};\n\n\n/**\n * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/core.html#ID-1950641247\n */\n\nfunction Node() {\n};\n\nNode.prototype = {\n\tfirstChild : null,\n\tlastChild : null,\n\tpreviousSibling : null,\n\tnextSibling : null,\n\tattributes : null,\n\tparentNode : null,\n\tchildNodes : null,\n\townerDocument : null,\n\tnodeValue : null,\n\tnamespaceURI : null,\n\tprefix : null,\n\tlocalName : null,\n\t// Modified in DOM Level 2:\n\tinsertBefore:function(newChild, refChild){//raises \n\t\treturn _insertBefore(this,newChild,refChild);\n\t},\n\treplaceChild:function(newChild, oldChild){//raises \n\t\tthis.insertBefore(newChild,oldChild);\n\t\tif(oldChild){\n\t\t\tthis.removeChild(oldChild);\n\t\t}\n\t},\n\tremoveChild:function(oldChild){\n\t\treturn _removeChild(this,oldChild);\n\t},\n\tappendChild:function(newChild){\n\t\treturn this.insertBefore(newChild,null);\n\t},\n\thasChildNodes:function(){\n\t\treturn this.firstChild != null;\n\t},\n\tcloneNode:function(deep){\n\t\treturn cloneNode(this.ownerDocument||this,this,deep);\n\t},\n\t// Modified in DOM Level 2:\n\tnormalize:function(){\n\t\tvar child = this.firstChild;\n\t\twhile(child){\n\t\t\tvar next = child.nextSibling;\n\t\t\tif(next && next.nodeType == TEXT_NODE && child.nodeType == TEXT_NODE){\n\t\t\t\tthis.removeChild(next);\n\t\t\t\tchild.appendData(next.data);\n\t\t\t}else{\n\t\t\t\tchild.normalize();\n\t\t\t\tchild = next;\n\t\t\t}\n\t\t}\n\t},\n  \t// Introduced in DOM Level 2:\n\tisSupported:function(feature, version){\n\t\treturn this.ownerDocument.implementation.hasFeature(feature,version);\n\t},\n    // Introduced in DOM Level 2:\n    hasAttributes:function(){\n    \treturn this.attributes.length>0;\n    },\n    lookupPrefix:function(namespaceURI){\n    \tvar el = this;\n    \twhile(el){\n    \t\tvar map = el._nsMap;\n    \t\t//console.dir(map)\n    \t\tif(map){\n    \t\t\tfor(var n in map){\n    \t\t\t\tif(map[n] == namespaceURI){\n    \t\t\t\t\treturn n;\n    \t\t\t\t}\n    \t\t\t}\n    \t\t}\n    \t\tel = el.nodeType == 2?el.ownerDocument : el.parentNode;\n    \t}\n    \treturn null;\n    },\n    // Introduced in DOM Level 3:\n    lookupNamespaceURI:function(prefix){\n    \tvar el = this;\n    \twhile(el){\n    \t\tvar map = el._nsMap;\n    \t\t//console.dir(map)\n    \t\tif(map){\n    \t\t\tif(prefix in map){\n    \t\t\t\treturn map[prefix] ;\n    \t\t\t}\n    \t\t}\n    \t\tel = el.nodeType == 2?el.ownerDocument : el.parentNode;\n    \t}\n    \treturn null;\n    },\n    // Introduced in DOM Level 3:\n    isDefaultNamespace:function(namespaceURI){\n    \tvar prefix = this.lookupPrefix(namespaceURI);\n    \treturn prefix == null;\n    }\n};\n\n\nfunction _xmlEncoder(c){\n\treturn c == '<' && '&lt;' ||\n         c == '>' && '&gt;' ||\n         c == '&' && '&amp;' ||\n         c == '\"' && '&quot;' ||\n         '&#'+c.charCodeAt()+';'\n}\n\n\ncopy(NodeType,Node);\ncopy(NodeType,Node.prototype);\n\n/**\n * @param callback return true for continue,false for break\n * @return boolean true: break visit;\n */\nfunction _visitNode(node,callback){\n\tif(callback(node)){\n\t\treturn true;\n\t}\n\tif(node = node.firstChild){\n\t\tdo{\n\t\t\tif(_visitNode(node,callback)){return true}\n        }while(node=node.nextSibling)\n    }\n}\n\n\n\nfunction Document(){\n}\nfunction _onAddAttribute(doc,el,newAttr){\n\tdoc && doc._inc++;\n\tvar ns = newAttr.namespaceURI ;\n\tif(ns == 'http://www.w3.org/2000/xmlns/'){\n\t\t//update namespace\n\t\tel._nsMap[newAttr.prefix?newAttr.localName:''] = newAttr.value\n\t}\n}\nfunction _onRemoveAttribute(doc,el,newAttr,remove){\n\tdoc && doc._inc++;\n\tvar ns = newAttr.namespaceURI ;\n\tif(ns == 'http://www.w3.org/2000/xmlns/'){\n\t\t//update namespace\n\t\tdelete el._nsMap[newAttr.prefix?newAttr.localName:'']\n\t}\n}\nfunction _onUpdateChild(doc,el,newChild){\n\tif(doc && doc._inc){\n\t\tdoc._inc++;\n\t\t//update childNodes\n\t\tvar cs = el.childNodes;\n\t\tif(newChild){\n\t\t\tcs[cs.length++] = newChild;\n\t\t}else{\n\t\t\t//console.log(1)\n\t\t\tvar child = el.firstChild;\n\t\t\tvar i = 0;\n\t\t\twhile(child){\n\t\t\t\tcs[i++] = child;\n\t\t\t\tchild =child.nextSibling;\n\t\t\t}\n\t\t\tcs.length = i;\n\t\t}\n\t}\n}\n\n/**\n * attributes;\n * children;\n * \n * writeable properties:\n * nodeValue,Attr:value,CharacterData:data\n * prefix\n */\nfunction _removeChild(parentNode,child){\n\tvar previous = child.previousSibling;\n\tvar next = child.nextSibling;\n\tif(previous){\n\t\tprevious.nextSibling = next;\n\t}else{\n\t\tparentNode.firstChild = next\n\t}\n\tif(next){\n\t\tnext.previousSibling = previous;\n\t}else{\n\t\tparentNode.lastChild = previous;\n\t}\n\t_onUpdateChild(parentNode.ownerDocument,parentNode);\n\treturn child;\n}\n/**\n * preformance key(refChild == null)\n */\nfunction _insertBefore(parentNode,newChild,nextChild){\n\tvar cp = newChild.parentNode;\n\tif(cp){\n\t\tcp.removeChild(newChild);//remove and update\n\t}\n\tif(newChild.nodeType === DOCUMENT_FRAGMENT_NODE){\n\t\tvar newFirst = newChild.firstChild;\n\t\tif (newFirst == null) {\n\t\t\treturn newChild;\n\t\t}\n\t\tvar newLast = newChild.lastChild;\n\t}else{\n\t\tnewFirst = newLast = newChild;\n\t}\n\tvar pre = nextChild ? nextChild.previousSibling : parentNode.lastChild;\n\n\tnewFirst.previousSibling = pre;\n\tnewLast.nextSibling = nextChild;\n\t\n\t\n\tif(pre){\n\t\tpre.nextSibling = newFirst;\n\t}else{\n\t\tparentNode.firstChild = newFirst;\n\t}\n\tif(nextChild == null){\n\t\tparentNode.lastChild = newLast;\n\t}else{\n\t\tnextChild.previousSibling = newLast;\n\t}\n\tdo{\n\t\tnewFirst.parentNode = parentNode;\n\t}while(newFirst !== newLast && (newFirst= newFirst.nextSibling))\n\t_onUpdateChild(parentNode.ownerDocument||parentNode,parentNode);\n\t//console.log(parentNode.lastChild.nextSibling == null)\n\tif (newChild.nodeType == DOCUMENT_FRAGMENT_NODE) {\n\t\tnewChild.firstChild = newChild.lastChild = null;\n\t}\n\treturn newChild;\n}\nfunction _appendSingleChild(parentNode,newChild){\n\tvar cp = newChild.parentNode;\n\tif(cp){\n\t\tvar pre = parentNode.lastChild;\n\t\tcp.removeChild(newChild);//remove and update\n\t\tvar pre = parentNode.lastChild;\n\t}\n\tvar pre = parentNode.lastChild;\n\tnewChild.parentNode = parentNode;\n\tnewChild.previousSibling = pre;\n\tnewChild.nextSibling = null;\n\tif(pre){\n\t\tpre.nextSibling = newChild;\n\t}else{\n\t\tparentNode.firstChild = newChild;\n\t}\n\tparentNode.lastChild = newChild;\n\t_onUpdateChild(parentNode.ownerDocument,parentNode,newChild);\n\treturn newChild;\n\t//console.log(\"__aa\",parentNode.lastChild.nextSibling == null)\n}\nDocument.prototype = {\n\t//implementation : null,\n\tnodeName :  '#document',\n\tnodeType :  DOCUMENT_NODE,\n\tdoctype :  null,\n\tdocumentElement :  null,\n\t_inc : 1,\n\t\n\tinsertBefore :  function(newChild, refChild){//raises \n\t\tif(newChild.nodeType == DOCUMENT_FRAGMENT_NODE){\n\t\t\tvar child = newChild.firstChild;\n\t\t\twhile(child){\n\t\t\t\tvar next = child.nextSibling;\n\t\t\t\tthis.insertBefore(child,refChild);\n\t\t\t\tchild = next;\n\t\t\t}\n\t\t\treturn newChild;\n\t\t}\n\t\tif(this.documentElement == null && newChild.nodeType == 1){\n\t\t\tthis.documentElement = newChild;\n\t\t}\n\t\t\n\t\treturn _insertBefore(this,newChild,refChild),(newChild.ownerDocument = this),newChild;\n\t},\n\tremoveChild :  function(oldChild){\n\t\tif(this.documentElement == oldChild){\n\t\t\tthis.documentElement = null;\n\t\t}\n\t\treturn _removeChild(this,oldChild);\n\t},\n\t// Introduced in DOM Level 2:\n\timportNode : function(importedNode,deep){\n\t\treturn importNode(this,importedNode,deep);\n\t},\n\t// Introduced in DOM Level 2:\n\tgetElementById :\tfunction(id){\n\t\tvar rtv = null;\n\t\t_visitNode(this.documentElement,function(node){\n\t\t\tif(node.nodeType == 1){\n\t\t\t\tif(node.getAttribute('id') == id){\n\t\t\t\t\trtv = node;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\treturn rtv;\n\t},\n\t\n\t//document factory method:\n\tcreateElement :\tfunction(tagName){\n\t\tvar node = new Element();\n\t\tnode.ownerDocument = this;\n\t\tnode.nodeName = tagName;\n\t\tnode.tagName = tagName;\n\t\tnode.childNodes = new NodeList();\n\t\tvar attrs\t= node.attributes = new NamedNodeMap();\n\t\tattrs._ownerElement = node;\n\t\treturn node;\n\t},\n\tcreateDocumentFragment :\tfunction(){\n\t\tvar node = new DocumentFragment();\n\t\tnode.ownerDocument = this;\n\t\tnode.childNodes = new NodeList();\n\t\treturn node;\n\t},\n\tcreateTextNode :\tfunction(data){\n\t\tvar node = new Text();\n\t\tnode.ownerDocument = this;\n\t\tnode.appendData(data)\n\t\treturn node;\n\t},\n\tcreateComment :\tfunction(data){\n\t\tvar node = new Comment();\n\t\tnode.ownerDocument = this;\n\t\tnode.appendData(data)\n\t\treturn node;\n\t},\n\tcreateCDATASection :\tfunction(data){\n\t\tvar node = new CDATASection();\n\t\tnode.ownerDocument = this;\n\t\tnode.appendData(data)\n\t\treturn node;\n\t},\n\tcreateProcessingInstruction :\tfunction(target,data){\n\t\tvar node = new ProcessingInstruction();\n\t\tnode.ownerDocument = this;\n\t\tnode.tagName = node.target = target;\n\t\tnode.nodeValue= node.data = data;\n\t\treturn node;\n\t},\n\tcreateAttribute :\tfunction(name){\n\t\tvar node = new Attr();\n\t\tnode.ownerDocument\t= this;\n\t\tnode.name = name;\n\t\tnode.nodeName\t= name;\n\t\tnode.localName = name;\n\t\tnode.specified = true;\n\t\treturn node;\n\t},\n\tcreateEntityReference :\tfunction(name){\n\t\tvar node = new EntityReference();\n\t\tnode.ownerDocument\t= this;\n\t\tnode.nodeName\t= name;\n\t\treturn node;\n\t},\n\t// Introduced in DOM Level 2:\n\tcreateElementNS :\tfunction(namespaceURI,qualifiedName){\n\t\tvar node = new Element();\n\t\tvar pl = qualifiedName.split(':');\n\t\tvar attrs\t= node.attributes = new NamedNodeMap();\n\t\tnode.childNodes = new NodeList();\n\t\tnode.ownerDocument = this;\n\t\tnode.nodeName = qualifiedName;\n\t\tnode.tagName = qualifiedName;\n\t\tnode.namespaceURI = namespaceURI;\n\t\tif(pl.length == 2){\n\t\t\tnode.prefix = pl[0];\n\t\t\tnode.localName = pl[1];\n\t\t}else{\n\t\t\t//el.prefix = null;\n\t\t\tnode.localName = qualifiedName;\n\t\t}\n\t\tattrs._ownerElement = node;\n\t\treturn node;\n\t},\n\t// Introduced in DOM Level 2:\n\tcreateAttributeNS :\tfunction(namespaceURI,qualifiedName){\n\t\tvar node = new Attr();\n\t\tvar pl = qualifiedName.split(':');\n\t\tnode.ownerDocument = this;\n\t\tnode.nodeName = qualifiedName;\n\t\tnode.name = qualifiedName;\n\t\tnode.namespaceURI = namespaceURI;\n\t\tnode.specified = true;\n\t\tif(pl.length == 2){\n\t\t\tnode.prefix = pl[0];\n\t\t\tnode.localName = pl[1];\n\t\t}else{\n\t\t\t//el.prefix = null;\n\t\t\tnode.localName = qualifiedName;\n\t\t}\n\t\treturn node;\n\t}\n};\n_extends(Document,Node);\n\n\nfunction Element() {\n\tthis._nsMap = {};\n};\nElement.prototype = {\n\tnodeType : ELEMENT_NODE,\n\thasAttribute : function(name){\n\t\treturn this.getAttributeNode(name)!=null;\n\t},\n\tgetAttribute : function(name){\n\t\tvar attr = this.getAttributeNode(name);\n\t\treturn attr && attr.value || '';\n\t},\n\tgetAttributeNode : function(name){\n\t\treturn this.attributes.getNamedItem(name);\n\t},\n\tsetAttribute : function(name, value){\n\t\tvar attr = this.ownerDocument.createAttribute(name);\n\t\tattr.value = attr.nodeValue = \"\" + value;\n\t\tthis.setAttributeNode(attr)\n\t},\n\tremoveAttribute : function(name){\n\t\tvar attr = this.getAttributeNode(name)\n\t\tattr && this.removeAttributeNode(attr);\n\t},\n\t\n\t//four real opeartion method\n\tappendChild:function(newChild){\n\t\tif(newChild.nodeType === DOCUMENT_FRAGMENT_NODE){\n\t\t\treturn this.insertBefore(newChild,null);\n\t\t}else{\n\t\t\treturn _appendSingleChild(this,newChild);\n\t\t}\n\t},\n\tsetAttributeNode : function(newAttr){\n\t\treturn this.attributes.setNamedItem(newAttr);\n\t},\n\tsetAttributeNodeNS : function(newAttr){\n\t\treturn this.attributes.setNamedItemNS(newAttr);\n\t},\n\tremoveAttributeNode : function(oldAttr){\n\t\treturn this.attributes.removeNamedItem(oldAttr.nodeName);\n\t},\n\t//get real attribute name,and remove it by removeAttributeNode\n\tremoveAttributeNS : function(namespaceURI, localName){\n\t\tvar old = this.getAttributeNodeNS(namespaceURI, localName);\n\t\told && this.removeAttributeNode(old);\n\t},\n\t\n\thasAttributeNS : function(namespaceURI, localName){\n\t\treturn this.getAttributeNodeNS(namespaceURI, localName)!=null;\n\t},\n\tgetAttributeNS : function(namespaceURI, localName){\n\t\tvar attr = this.getAttributeNodeNS(namespaceURI, localName);\n\t\treturn attr && attr.value || '';\n\t},\n\tsetAttributeNS : function(namespaceURI, qualifiedName, value){\n\t\tvar attr = this.ownerDocument.createAttributeNS(namespaceURI, qualifiedName);\n\t\tattr.value = attr.nodeValue = value;\n\t\tthis.setAttributeNode(attr)\n\t},\n\tgetAttributeNodeNS : function(namespaceURI, localName){\n\t\treturn this.attributes.getNamedItemNS(namespaceURI, localName);\n\t},\n\t\n\tgetElementsByTagName : function(tagName){\n\t\treturn new LiveNodeList(this,function(base){\n\t\t\tvar ls = [];\n\t\t\t_visitNode(base,function(node){\n\t\t\t\tif(node !== base && node.nodeType == ELEMENT_NODE && (tagName === '*' || node.tagName == tagName)){\n\t\t\t\t\tls.push(node);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn ls;\n\t\t});\n\t},\n\tgetElementsByTagNameNS : function(namespaceURI, localName){\n\t\treturn new LiveNodeList(this,function(base){\n\t\t\tvar ls = [];\n\t\t\t_visitNode(base,function(node){\n\t\t\t\tif(node !== base && node.nodeType === ELEMENT_NODE && node.namespaceURI === namespaceURI && (localName === '*' || node.localName == localName)){\n\t\t\t\t\tls.push(node);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn ls;\n\t\t});\n\t}\n};\nDocument.prototype.getElementsByTagName = Element.prototype.getElementsByTagName;\nDocument.prototype.getElementsByTagNameNS = Element.prototype.getElementsByTagNameNS;\n\n\n_extends(Element,Node);\nfunction Attr() {\n};\nAttr.prototype.nodeType = ATTRIBUTE_NODE;\n_extends(Attr,Node);\n\n\nfunction CharacterData() {\n};\nCharacterData.prototype = {\n\tdata : '',\n\tsubstringData : function(offset, count) {\n\t\treturn this.data.substring(offset, offset+count);\n\t},\n\tappendData: function(text) {\n\t\ttext = this.data+text;\n\t\tthis.nodeValue = this.data = text;\n\t\tthis.length = text.length;\n\t},\n\tinsertData: function(offset,text) {\n\t\tthis.replaceData(offset,0,text);\n\t\n\t},\n\tappendChild:function(newChild){\n\t\t//if(!(newChild instanceof CharacterData)){\n\t\t\tthrow new Error(ExceptionMessage[3])\n\t\t//}\n\t\treturn Node.prototype.appendChild.apply(this,arguments)\n\t},\n\tdeleteData: function(offset, count) {\n\t\tthis.replaceData(offset,count,\"\");\n\t},\n\treplaceData: function(offset, count, text) {\n\t\tvar start = this.data.substring(0,offset);\n\t\tvar end = this.data.substring(offset+count);\n\t\ttext = start + text + end;\n\t\tthis.nodeValue = this.data = text;\n\t\tthis.length = text.length;\n\t}\n}\n_extends(CharacterData,Node);\nfunction Text() {\n};\nText.prototype = {\n\tnodeName : \"#text\",\n\tnodeType : TEXT_NODE,\n\tsplitText : function(offset) {\n\t\tvar text = this.data;\n\t\tvar newText = text.substring(offset);\n\t\ttext = text.substring(0, offset);\n\t\tthis.data = this.nodeValue = text;\n\t\tthis.length = text.length;\n\t\tvar newNode = this.ownerDocument.createTextNode(newText);\n\t\tif(this.parentNode){\n\t\t\tthis.parentNode.insertBefore(newNode, this.nextSibling);\n\t\t}\n\t\treturn newNode;\n\t}\n}\n_extends(Text,CharacterData);\nfunction Comment() {\n};\nComment.prototype = {\n\tnodeName : \"#comment\",\n\tnodeType : COMMENT_NODE\n}\n_extends(Comment,CharacterData);\n\nfunction CDATASection() {\n};\nCDATASection.prototype = {\n\tnodeName : \"#cdata-section\",\n\tnodeType : CDATA_SECTION_NODE\n}\n_extends(CDATASection,CharacterData);\n\n\nfunction DocumentType() {\n};\nDocumentType.prototype.nodeType = DOCUMENT_TYPE_NODE;\n_extends(DocumentType,Node);\n\nfunction Notation() {\n};\nNotation.prototype.nodeType = NOTATION_NODE;\n_extends(Notation,Node);\n\nfunction Entity() {\n};\nEntity.prototype.nodeType = ENTITY_NODE;\n_extends(Entity,Node);\n\nfunction EntityReference() {\n};\nEntityReference.prototype.nodeType = ENTITY_REFERENCE_NODE;\n_extends(EntityReference,Node);\n\nfunction DocumentFragment() {\n};\nDocumentFragment.prototype.nodeName =\t\"#document-fragment\";\nDocumentFragment.prototype.nodeType =\tDOCUMENT_FRAGMENT_NODE;\n_extends(DocumentFragment,Node);\n\n\nfunction ProcessingInstruction() {\n}\nProcessingInstruction.prototype.nodeType = PROCESSING_INSTRUCTION_NODE;\n_extends(ProcessingInstruction,Node);\nfunction XMLSerializer(){}\nXMLSerializer.prototype.serializeToString = function(node){\n\tvar buf = [];\n\tserializeToString(node,buf);\n\treturn buf.join('');\n}\nNode.prototype.toString =function(){\n\treturn XMLSerializer.prototype.serializeToString(this);\n}\nfunction serializeToString(node,buf){\n\tswitch(node.nodeType){\n\tcase ELEMENT_NODE:\n\t\tvar attrs = node.attributes;\n\t\tvar len = attrs.length;\n\t\tvar child = node.firstChild;\n\t\tvar nodeName = node.tagName;\n\t\tvar isHTML = htmlns === node.namespaceURI\n\t\tbuf.push('<',nodeName);\n\t\tfor(var i=0;i<len;i++){\n\t\t\tserializeToString(attrs.item(i),buf,isHTML);\n\t\t}\n\t\tif(child || isHTML && !/^(?:meta|link|img|br|hr|input)$/i.test(nodeName)){\n\t\t\tbuf.push('>');\n\t\t\t//if is cdata child node\n\t\t\tif(isHTML && /^script$/i.test(nodeName)){\n\t\t\t\tif(child){\n\t\t\t\t\tbuf.push(child.data);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\twhile(child){\n\t\t\t\t\tserializeToString(child,buf);\n\t\t\t\t\tchild = child.nextSibling;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbuf.push('</',nodeName,'>');\n\t\t}else{\n\t\t\tbuf.push('/>');\n\t\t}\n\t\treturn;\n\tcase DOCUMENT_NODE:\n\tcase DOCUMENT_FRAGMENT_NODE:\n\t\tvar child = node.firstChild;\n\t\twhile(child){\n\t\t\tserializeToString(child,buf);\n\t\t\tchild = child.nextSibling;\n\t\t}\n\t\treturn;\n\tcase ATTRIBUTE_NODE:\n\t\treturn buf.push(' ',node.name,'=\"',node.value.replace(/[<&\"]/g,_xmlEncoder),'\"');\n\tcase TEXT_NODE:\n\t\treturn buf.push(node.data.replace(/[<&]/g,_xmlEncoder));\n\tcase CDATA_SECTION_NODE:\n\t\treturn buf.push( '<![CDATA[',node.data,']]>');\n\tcase COMMENT_NODE:\n\t\treturn buf.push( \"<!--\",node.data,\"-->\");\n\tcase DOCUMENT_TYPE_NODE:\n\t\tvar pubid = node.publicId;\n\t\tvar sysid = node.systemId;\n\t\tbuf.push('<!DOCTYPE ',node.name);\n\t\tif(pubid){\n\t\t\tbuf.push(' PUBLIC \"',pubid);\n\t\t\tif (sysid && sysid!='.') {\n\t\t\t\tbuf.push( '\" \"',sysid);\n\t\t\t}\n\t\t\tbuf.push('\">');\n\t\t}else if(sysid && sysid!='.'){\n\t\t\tbuf.push(' SYSTEM \"',sysid,'\">');\n\t\t}else{\n\t\t\tvar sub = node.internalSubset;\n\t\t\tif(sub){\n\t\t\t\tbuf.push(\" [\",sub,\"]\");\n\t\t\t}\n\t\t\tbuf.push(\">\");\n\t\t}\n\t\treturn;\n\tcase PROCESSING_INSTRUCTION_NODE:\n\t\treturn buf.push( \"<?\",node.target,\" \",node.data,\"?>\");\n\tcase ENTITY_REFERENCE_NODE:\n\t\treturn buf.push( '&',node.nodeName,';');\n\t//case ENTITY_NODE:\n\t//case NOTATION_NODE:\n\tdefault:\n\t\tbuf.push('??',node.nodeName);\n\t}\n}\nfunction importNode(doc,node,deep){\n\tvar node2;\n\tswitch (node.nodeType) {\n\tcase ELEMENT_NODE:\n\t\tnode2 = node.cloneNode(false);\n\t\tnode2.ownerDocument = doc;\n\t\t//var attrs = node2.attributes;\n\t\t//var len = attrs.length;\n\t\t//for(var i=0;i<len;i++){\n\t\t\t//node2.setAttributeNodeNS(importNode(doc,attrs.item(i),deep));\n\t\t//}\n\tcase DOCUMENT_FRAGMENT_NODE:\n\t\tbreak;\n\tcase ATTRIBUTE_NODE:\n\t\tdeep = true;\n\t\tbreak;\n\t//case ENTITY_REFERENCE_NODE:\n\t//case PROCESSING_INSTRUCTION_NODE:\n\t////case TEXT_NODE:\n\t//case CDATA_SECTION_NODE:\n\t//case COMMENT_NODE:\n\t//\tdeep = false;\n\t//\tbreak;\n\t//case DOCUMENT_NODE:\n\t//case DOCUMENT_TYPE_NODE:\n\t//cannot be imported.\n\t//case ENTITY_NODE:\n\t//case NOTATION_NODE\n\t//can not hit in level3\n\t//default:throw e;\n\t}\n\tif(!node2){\n\t\tnode2 = node.cloneNode(false);//false\n\t}\n\tnode2.ownerDocument = doc;\n\tnode2.parentNode = null;\n\tif(deep){\n\t\tvar child = node.firstChild;\n\t\twhile(child){\n\t\t\tnode2.appendChild(importNode(doc,child,deep));\n\t\t\tchild = child.nextSibling;\n\t\t}\n\t}\n\treturn node2;\n}\n//\n//var _relationMap = {firstChild:1,lastChild:1,previousSibling:1,nextSibling:1,\n//\t\t\t\t\tattributes:1,childNodes:1,parentNode:1,documentElement:1,doctype,};\nfunction cloneNode(doc,node,deep){\n\tvar node2 = new node.constructor();\n\tfor(var n in node){\n\t\tvar v = node[n];\n\t\tif(typeof v != 'object' ){\n\t\t\tif(v != node2[n]){\n\t\t\t\tnode2[n] = v;\n\t\t\t}\n\t\t}\n\t}\n\tif(node.childNodes){\n\t\tnode2.childNodes = new NodeList();\n\t}\n\tnode2.ownerDocument = doc;\n\tswitch (node2.nodeType) {\n\tcase ELEMENT_NODE:\n\t\tvar attrs\t= node.attributes;\n\t\tvar attrs2\t= node2.attributes = new NamedNodeMap();\n\t\tvar len = attrs.length\n\t\tattrs2._ownerElement = node2;\n\t\tfor(var i=0;i<len;i++){\n\t\t\tnode2.setAttributeNode(cloneNode(doc,attrs.item(i),true));\n\t\t}\n\t\tbreak;;\n\tcase ATTRIBUTE_NODE:\n\t\tdeep = true;\n\t}\n\tif(deep){\n\t\tvar child = node.firstChild;\n\t\twhile(child){\n\t\t\tnode2.appendChild(cloneNode(doc,child,deep));\n\t\t\tchild = child.nextSibling;\n\t\t}\n\t}\n\treturn node2;\n}\n\nfunction __set__(object,key,value){\n\tobject[key] = value\n}\n//do dynamic\ntry{\n\tif(Object.defineProperty){\n\t\tObject.defineProperty(LiveNodeList.prototype,'length',{\n\t\t\tget:function(){\n\t\t\t\t_updateLiveList(this);\n\t\t\t\treturn this.$$length;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(Node.prototype,'textContent',{\n\t\t\tget:function(){\n\t\t\t\treturn getTextContent(this);\n\t\t\t},\n\t\t\tset:function(data){\n\t\t\t\tswitch(this.nodeType){\n\t\t\t\tcase 1:\n\t\t\t\tcase 11:\n\t\t\t\t\twhile(this.firstChild){\n\t\t\t\t\t\tthis.removeChild(this.firstChild);\n\t\t\t\t\t}\n\t\t\t\t\tif(data || String(data)){\n\t\t\t\t\t\tthis.appendChild(this.ownerDocument.createTextNode(data));\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t//TODO:\n\t\t\t\t\tthis.data = data;\n\t\t\t\t\tthis.value = value;\n\t\t\t\t\tthis.nodeValue = data;\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\t\n\t\tfunction getTextContent(node){\n\t\t\tswitch(node.nodeType){\n\t\t\tcase 1:\n\t\t\tcase 11:\n\t\t\t\tvar buf = [];\n\t\t\t\tnode = node.firstChild;\n\t\t\t\twhile(node){\n\t\t\t\t\tif(node.nodeType!==7 && node.nodeType !==8){\n\t\t\t\t\t\tbuf.push(getTextContent(node));\n\t\t\t\t\t}\n\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t}\n\t\t\t\treturn buf.join('');\n\t\t\tdefault:\n\t\t\t\treturn node.nodeValue;\n\t\t\t}\n\t\t}\n\t\t__set__ = function(object,key,value){\n\t\t\t//console.log(value)\n\t\t\tobject['$$'+key] = value\n\t\t}\n\t}\n}catch(e){//ie8\n}\n\nif(typeof require == 'function'){\n\texports.DOMImplementation = DOMImplementation;\n\texports.XMLSerializer = XMLSerializer;\n}\n","pre":true},"modules/devkit-core/src/clientapi/native/timestep.js":{"path":"modules/devkit-core/src/clientapi/native/timestep.js","friendlyPath":".timestep","directory":"modules/devkit-core/src/clientapi/native/","filename":"timestep.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import device');\njsio('import lib.PubSub as PubSub');\n\nvar hasNativeViews = GLOBAL.NATIVE && NATIVE.timestep && NATIVE.timestep.View;\n\nvar VIEW_TYPES = {\n\tDEFAULT: 0,\n\tIMAGE_VIEW: 1\n};\n\nfunction installNativeView() {\n\t// extend the timestep View class\n\tjsio('import .timestep.NativeView');\n\ttimestep.NativeView.install();\n\n\tjsio('import ui.View as View');\n\tView.setDefaultViewBacking(NATIVE.timestep.View);\n\n\t// extend the timestep ViewBacking class\n\tjsio('import .timestep.NativeViewBacking');\n\ttimestep.NativeViewBacking.install();\n\n\tjsio('import .timestep.NativeImageView');\n\ttimestep.NativeImageView.install();\n\n\tvar animate = device.importUI('animate');\n\tvar ViewAnimator = animate.getViewAnimator();\n\t// use accelerated native view animators\n\tanimate.setViewAnimator(NATIVE.timestep.Animator);\n\t// native view animators inherit from PubSub (Emitter) to match JS\n\tmerge(NATIVE.timestep.Animator.prototype, PubSub.prototype);\n\t// native view animators need to add themselves to animate groups in JS\n\tNATIVE.timestep.Animator.prototype._addToGroup = ViewAnimator.prototype._addToGroup;\n\t// native view animators need to remove themselves from animate groups in JS\n\tNATIVE.timestep.Animator.prototype._removeFromGroup = ViewAnimator.prototype._removeFromGroup;\n\n\t// add some properties to View and ImageView to defer to native rendering\n\tjsio('import ui.View as View');\n\tView.prototype.__type = VIEW_TYPES.DEFAULT;\n\n\tjsio('import ui.ImageView as ImageView');\n\tImageView.prototype.__type = VIEW_TYPES.IMAGE_VIEW;\n\tImageView.prototype.render.HAS_NATIVE_IMPL = true;\n\n\tlogger.LOG&&console.log(\"LOG\",\".timestep\",\"USING NATIVE VIEWS\");\n}\n\nlogger.LOG&&console.log(\"LOG\",\".timestep\",typeof GLOBAL.CONFIG, GLOBAL.CONFIG && CONFIG.disableNativeViews);\n\nif (GLOBAL.CONFIG && CONFIG.disableNativeViews || !hasNativeViews) {\n\tlogger.LOG&&console.log(\"LOG\",\".timestep\",\"USING JS VIEWS\");\n\texports.install = function () {};\n} else {\n\texports.install = installNativeView;\n}\n","pre":true},"modules/devkit-core/src/clientapi/native/timestep/NativeView.js":{"path":"modules/devkit-core/src/clientapi/native/timestep/NativeView.js","friendlyPath":".timestep.NativeView","directory":"modules/devkit-core/src/clientapi/native/timestep/","filename":"NativeView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n// monkey patch the View prototype (object composition)\n\njsio('from ui.filter import Filter');\n\nexports.install = function () {\n\tjsio('import ui.View as View');\n\n\tvar proto = View.prototype;\n\n\tproto.setFilter = function (filter) {\n\t\tthis.removeFilter();\n\t\tthis._filter = filter;\n\t\tfilter.setView(this);\n\t\tfilter.update();\n\t};\n\n\tproto.removeFilter = function () {\n\t\tif (this._filter) {\n\t\t\tthis._filter.removeView(this);\n\t\t\tthis._filter = null;\n\t\t\tthis.__view.filterType = 0;\n\t\t\tthis.__view.filterColor = 'rgba(0,0,0,0)';\n\t\t}\n\t};\n};\n","pre":true},"modules/devkit-core/src/clientapi/native/timestep/NativeViewBacking.js":{"path":"modules/devkit-core/src/clientapi/native/timestep/NativeViewBacking.js","friendlyPath":".timestep.NativeViewBacking","directory":"modules/devkit-core/src/clientapi/native/timestep/","filename":"NativeViewBacking.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n// ensure that the ViewBacking update and copy methods\n// are present on the native View prototype\nexports.install = function () {\n\tjsio('import device');\n\tjsio('import ui.backend.BaseBacking as BaseBacking');\n\n\tvar ViewBacking = device.importUI('ViewBacking');\n\n\tvar proto = NATIVE.timestep.View.prototype;\n\n\tif (proto) {\n\n\t\tvar srcProto = ViewBacking.prototype;\n\n\t\tproto.__proto__ = BaseBacking.prototype;\n\n\t\t// legacy\n\t\tproto.__firstRender = true;\n\n\t\tif (!proto.copy) {\n\t\t\tproto.copy = srcProto.copy;\n\t\t}\n\n\t\tif (!proto.localizePoint && proto.localizePt) {\n\t\t\tproto.localizePoint = proto.localizePt;\n\t\t}\n\t}\n};\n","pre":true},"modules/devkit-core/src/clientapi/native/timestep/NativeImageView.js":{"path":"modules/devkit-core/src/clientapi/native/timestep/NativeImageView.js","friendlyPath":".timestep.NativeImageView","directory":"modules/devkit-core/src/clientapi/native/timestep/","filename":"NativeImageView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nexports.install = function () {\n\tjsio('import ui.ImageView as ImageView');\n\n\tvar proto = ImageView.prototype;\n\tvar setImage = proto.setImage;\n\n\tproto.setImage = function (img, opts) {\n\t\tif (opts && opts.forceReload && typeof img == 'string') {\n\t\t\tNATIVE.gl.deleteTexture(img);\n\t\t}\n\t\tvar retVal = setImage.apply(this, arguments);\n\t\t\n\t\tif (this._img) {\n\t\t\tNATIVE.timestep.setImageOnImageView(this.__view, this._img.getMap());\n\t\t}\n\t\t\n\t\treturn retVal\n\t}\n}\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/ImageView.js":{"path":"modules/devkit-core/modules/timestep/src/ui/ImageView.js","friendlyPath":"ui.ImageView","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"ImageView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.ImageView;\n * Import the ImageView from the Canvas/DOM rendering backend.\n *\n * @doc http://doc.gameclosure.com/api/ui-imageview.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/imageview.md\n */\n\njsio('import device');\nexports = device.importUI('ImageView');\n","pre":true},"modules/devkit-core/src/clientapi/index.js":{"path":"modules/devkit-core/src/clientapi/index.js","friendlyPath":"devkit","directory":"modules/devkit-core/src/clientapi/","filename":"index.js","src":"/** @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n// Import this before importing GC\n// _api.client.init sets up the GC object for the client apis\n\n/* globals CONFIG, Class, bind, logger, merge */\n\njsio('import lib.PubSub');\njsio('import lib.Callback');\njsio('import ui.Engine');\njsio('import ui.View');\njsio('import ui.StackView');\n\njsio('import device');\nvar FontRenderer = device.get('FontRenderer');\n\nif (!GLOBAL.CONFIG) { GLOBAL.CONFIG = {}; }\nif (!GLOBAL.DEBUG) { GLOBAL.DEBUG = false; }\n\nexports.ClientAPI=__class__;exports.ClientAPI=exports.ClientAPI(function exports_ClientAPI(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function () {\n\n  var ua = navigator.userAgent;\n  this.isNative = /TeaLeaf/.test(ua);\n  if (this.isNative) {\n    this.isIOS = /iPhone OS/.test(ua);\n    this.isAndroid = /Android/.test(ua);\n  } else if (/(iPod|iPhone|iPad)/i.test(ua)) {\n    this.isMobileBrowser = true;\n    this.isIOS = true;\n    this.isUIWebView = !/Safari/.test(ua);\n  } else if (/Android/.test(ua)) {\n    this.isMobileBrowser = true;\n    this.isAndroid = true;\n  } else {\n    this.isDesktop = true;\n    this.isFacebook = GLOBAL.CONFIG.isFacebookApp;\n  }\n\n  this.isKik = /Kik\\/\\d/.test(ua);\n\n  this.init = function (opts) {\n    window.addEventListener('pageshow', bind(this, '_onShow'), false);\n    window.addEventListener('pagehide', bind(this, '_onHide'), false);\n\n    if (this.isKik && GLOBAL.cards && cards.browser) {\n      cards.browser.on('foreground', bind(this, '_onShow'));\n      cards.browser.on('background', bind(this, '_onHide'));\n    }\n\n    this.isOnline = navigator.onLine;\n\n    window.addEventListener('online', bind(this, function () {\n      if (!this.isOnline) {\n        this.isOnline = true;\n        this.publish('OnlineStateChanged', true);\n      }\n    }), false);\n\n    window.addEventListener('offline', bind(this, function () {\n      if (this.isOnline) {\n        this.isOnline = false;\n        this.publish('OnlineStateChanged', false);\n      }\n    }), false);\n\n    // var uri = new URI(window.location);\n    // var campaign = uri.query('campaign') || \"NO CAMPAIGN\";\n    //\n    // XXX: The following lines cause a DOMException in some browsers\n    // because we're using a <base> tag, which doesn't resolve the URL relative correctly.\n    //get rid of it in case the game uses something\n    // if (window.history && window.history.replaceState) {\n    //  history.replaceState(null, null, uri.toString().replace(\"?campaign=\" + campaign, \"\"));\n    // }\n    //\n    // if (!localStorage.getItem(\"campaignID\")) {\n    //  localStorage.setItem(\"campaignID\", campaign)\n    // }\n\n    if (this.env == 'browser') { setTimeout(bind(this, '_onShow'), 0); }\n\n    if (CONFIG.version) {\n      logger.LOG&&console.log(\"LOG\",\"devkit\",'Version', CONFIG.version);\n    }\n  };\n\n  this.Application = ui.StackView;\n\n  PluginManager=__class__;var PluginManager=PluginManager(function PluginManager(){return this.init&&this.init.apply(this,arguments)},function () {\n    this.init = function () {\n      this._plugins = {};\n    }\n\n    this.register = function (name, plugin) {\n      this._plugins[name] = plugin;\n    }\n\n    this.getPlugin = function (name) {\n      return this._plugins[name];\n    }\n  });\n\n  this.plugins = new PluginManager();\n\n  jsio('import .UI');\n  this.ui = new UI();\n\n\n  // this.track({\n  //  name: \"campaignID\",\n  //  category: \"campaign\",\n  //  subcategory: \"id\",\n  //  data: campaign\n  // });\n\n  var spritesheets;\n  try {\n    if (GLOBAL.CACHE) {\n      spritesheets = JSON.parse(GLOBAL.CACHE['spritesheets/map.json']);\n    }\n  } catch (e) {\n    logger.WARN&&console.warn(\"WARN\",\"devkit\",\"spritesheet map failed to parse\", e);\n  }\n\n  var soundMap;\n  try {\n    if (GLOBAL.CACHE) {\n      soundMap = JSON.parse(GLOBAL.CACHE['resources/sound-map.json']);\n    }\n  } catch (e) {\n    logger.WARN&&console.warn(\"WARN\",\"devkit\",\"sound map failed to parse\", e);\n  }\n\n  jsio('import ui.resource.loader');\n  this.resources = ui.resource.loader;\n  this.resources.addSheets(spritesheets);\n  this.resources.addAudioMap(soundMap);\n\n  jsio('import AudioManager');\n\n  this._onHide = function () {\n    // signal to the app that the window is going away\n    this.app && this.app.onPause && this.app.onPause();\n\n    this.publish('Hide');\n    this.publish('AfterHide');\n\n    if (this.tracker) {\n      this.tracker.endSession();\n    }\n  };\n\n  this._onShow = function () {\n    this.app && this.app.onResume && this.app.onResume();\n\n    this.publish('Show');\n    this.publish('AfterShow');\n  };\n\n  this.buildApp = function (entry) {\n    jsio('import src.Application as Application');\n\n    Application.prototype.__root = true;\n    this.app = new Application();\n    this.buildEngine(merge({view: this.app}, this.app._settings));\n\n    this.emit('app', this.app);\n  };\n\n  this.buildEngine = function (opts) {\n    if (!opts) { opts = {}; }\n    if (!opts.entry) { opts.entry = 'launchUI'; }\n\n    var view = opts.view;\n    if (!view) {\n      throw \"a timestep.Engine must be created with a root view\";\n    }\n\n    if (!(view instanceof ui.View)) {\n      throw \"src/Application.js must export a Class that inherits from ui.View\";\n    }\n\n    view.subscribe('onLoadError', this, '_onAppLoadError');\n\n    var launch;\n    if (typeof view[opts.entry] == 'function') {\n      launch = bind(view, opts.entry);\n    }\n\n    view.view = view; // legacy, deprecated\n    view.engine = new ui.Engine(opts);\n    view.engine.show();\n    view.engine.startLoop();\n\n    view.initUI && view.initUI();\n\n    FontRenderer.init();\n\n    var settings = view._settings || {};\n    var preload = settings.preload;\n    var autoHide = CONFIG.splash && (CONFIG.splash.autoHide !== false);\n    if (preload && preload.length) {\n      var cb = new lib.Callback();\n      for (var i = 0, group; group = preload[i]; ++i) {\n        this.resources.preload(group, cb.chain());\n      }\n\n      // note that hidePreloader takes a null cb argument to avoid\n      // forwarding the preloader result as the callback\n      if (autoHide) { cb.run(this, 'hidePreloader', null); }\n      if (launch) { cb.run(launch); }\n    } else {\n      if (autoHide) { this.hidePreloader(); }\n      launch && launch();\n    }\n  };\n\n  this._onAppLoadError = function (error) {\n    logger.ERROR&&console.error(\"ERROR\",\"devkit\",'encountered error when creating src Application: ', JSON.stringify(error));\n    var splash = CONFIG.splash;\n    if (splash && splash.onAppLoadError) {\n      splash.onAppLoadError(error);\n    }\n  };\n\n  this.hideSplash =\n  this.hidePreloader = function (cb) {\n    var splash = CONFIG.splash;\n    if (splash && splash.hide && !splash.hidden) {\n      splash.hide(cb);\n      splash.hidden = true;\n    } else {\n      cb && cb();\n    }\n  };\n});\n","pre":true},"modules/devkit-core/src/clientapi/UI.js":{"path":"modules/devkit-core/src/clientapi/UI.js","friendlyPath":".UI","directory":"modules/devkit-core/src/clientapi/","filename":"UI.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import device');\njsio('import ui.widget.Spinner as Spinner');\n\nvar config = window.CONFIG;\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_src_clientapi_UI=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_src_clientapi_UI(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_src_clientapi_UI(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis._spinnerCounter = 0;\n\n\tjsio('import device');\n\n\tvar baseScale;\n\tif (navigator.displayMetrics) {\n\t\tbaseScale = navigator.displayMetrics.densityDpi / 160;\n\t} else if (!CONFIG.scaleDPR && device.isMobileBrowser) {\n\t\tbaseScale = 1;\n\t} else {\n\t\tbaseScale = window.devicePixelRatio || 1;\n\t}\n\n\tthis._scale = baseScale;\n\n\tthis.setTargetDensity = function (target) {\n\t\tswitch (target) {\n\t\t\tcase 'high':\n\t\t\t\tthis._scale = baseScale * 0.5;\n\t\t\t\tbreak;\n\t\t\tcase 'medium':\n\t\t\t\tthis._scale = baseScale * 0.75;\n\t\t\t\tbreak;\n\t\t\tcase 'low':\n\t\t\tdefault:\n\t\t\t\tthis._scale = baseScale;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tlogger.LOG&&console.log(\"LOG\",\".UI\",'scale:', this._scale);\n\t}\n\n\tthis.getScale = function () {\n\t\treturn this._scale;\n\t}\n\n\tthis.getIntValue = function (val) {\n\t\treturn Math.round(val * this._scale) / this._scale;\n\t}\n\n\tthis.showSpinner = function () {\n\t\tif (this._spinnerCounter) {\n\t\t\t++this._spinnerCounter;\n\t\t\treturn;\n\t\t}\n\n\t\tvar parent = GC.app.view;\n\t\tif (!parent) { return; }\n\n\t\t++this._spinnerCounter;\n\n\t\tif (!this._spinner) {\n\t\t\tvar dim = device.screen.devicePixelRatio * 50;\n\t\t\tthis._spinner = new Spinner({\n\t\t\t\twidth: dim,\n\t\t\t\theight: dim,\n\t\t\t\tx: parent.style.width / 2 - dim / 2,\n\t\t\t\ty: parent.style.height / 2 - dim / 2,\n\t\t\t\tparent: parent\n\t\t\t});\n\t\t} else {\n\t\t\tparent.addSubview(this._spinner);\n\t\t}\n\t}\n\n\tthis.hideSpinner = function () {\n\t\t--this._spinnerCounter;\n\t\tif (this._spinnerCounter <= 0) {\n\t\t\tthis._spinnerCounter = 0;\n\n\t\t\tthis._spinner && this._spinner.removeFromSuperview();\n\t\t}\n\t}\n});\n\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/widget/Spinner.js":{"path":"modules/devkit-core/modules/timestep/src/ui/widget/Spinner.js","friendlyPath":"ui.widget.Spinner","directory":"modules/devkit-core/modules/timestep/src/ui/widget/","filename":"Spinner.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.widget.Spinner;\n */\njsio('import ui.View as View');\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_widget_Spinner=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_widget_Spinner(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_modules_devkit_core_modules_timestep_src_ui_widget_Spinner(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n\n  var defaults = {\n    cycles: 0.5,\n    radius: 10,\n    spokes: 20,\n    thickness: 2,\n    trail: 10,\n    color: '#ffffff',\n    backgroundColor: 'rgba(0, 0, 0, 0.5)',\n    layout: 'box'\n  };\n  \n  this.tag = 'Spinner';\n  this._t = 0;\n  \n  this.init = function (opts) {\n    this._opts = merge(opts, defaults);\n    \n    this._step = 2 * Math.PI / this._opts.spokes;\n    \n    supr(this, 'init', [this._opts]);\n  };\n  \n  this.tick = function (dt) {\n    this._t += dt;\n    \n    var r = (this._t / 1000 % (1 / this._opts.cycles)) * Math.PI;\n    \n    var oldR = this._r;\n    this._r = r - (r % this._step);\n    \n    if (oldR != r) {\n      this.needsRepaint();\n    }\n  }\n  \n  this.render = function (ctx) {\n    ctx.fillStyle = this._opts.backgroundColor;\n    var alpha = ctx.globalAlpha;\n\n    var w = this.style.width,\n        h = this.style.height,\n        radius = this._opts.radius,\n        trail = this._opts.trail,\n        thickness = this._opts.thickness,\n        x, y, i, j;\n    \n    for (y = 0; y < radius; ++y) {\n      j = y + 1;\n      x = Math.round(radius - Math.sqrt(2 * j * radius - j * j));\n      ctx.fillRect(x, y, w - 2 * x, 1);\n    }\n    \n    y = h - radius;\n    ctx.fillRect(0, radius, w, y - radius);\n    \n    for (i = 0; i < radius; ++i) {\n      j = radius - i;\n      x = Math.round(radius - Math.sqrt(2 * j * radius - j * j));\n      ctx.fillRect(x, y + i, w - 2 * x, 1);\n    }\n    \n    ctx.fillStyle = this._opts.color;\n    ctx.translate(w / 2, h / 2);\n    w /= 2;\n    ctx.rotate(this._r);\n    \n    for (i = 0; i < this._opts.spokes; ++i) {\n      ctx.rotate(this._step);\n      ctx.globalAlpha = alpha * Math.max(0.1, (i - trail) / trail);\n      ctx.fillRect(10, -thickness / 2, w - 15, thickness);\n    }\n  }\n});\n","pre":true},"src/Application.js":{"path":"src/Application.js","friendlyPath":"src.Application","directory":"src/","filename":"Application.js","baseMod":"src","basePath":"/Users/marcelo.hashimoto/Desktop/gamedev/ElementalMatch3/src","src":"/*\n * The main application file, your game code begins here.\n */\n\n// devkit imports\njsio('import device');\njsio('import ui.StackView as StackView');\n// user imports\njsio('import src.TitleScreen as TitleScreen');\njsio('import src.GameScreen as GameScreen');\njsio('import src.util as util');\n\n// import src.soundcontroller as soundcontroller;\n\n/* Your application inherits from GC.Application, which is\n * exported and instantiated when the game is run.\n */\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_src_Application=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_src_Application(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_src_Application(){return this.init&&this.init.apply(this,arguments)},GC.Application, function () {\n\n /* Run after the engine is created and the scene graph is in\n  * place, but before the resources have been loaded.\n  */\n  this.initUI = function () {\n    var titlescreen = new TitleScreen(),\n        gamescreen = new GameScreen();\n\n    this.view.style.backgroundColor = '#000000';\n\n    util.scaleRootView(this, 750, 1334);\n\n    // Add a new StackView to the root of the scene graph\n    // create everything at size 320x480, then scale so to\n    // fit horizontally\n    var rootView = new StackView({\n      superview: this,\n      x: 0,\n      y: 0,\n      width: 750,\n      height: 1334,\n      clip: true\n    });\n\n    rootView.push(titlescreen);\n\n   /* Listen for an event dispatched by the title screen when\n    * the start button has been pressed. Hide the title screen,\n    * show the game screen, then dispatch a custom event to the\n    * game screen to start the game.\n    */\n    titlescreen.on('titlescreen:start', function () {\n      rootView.push(gamescreen);\n      gamescreen.emit('app:start');\n    });\n\n   /* When the game screen has signalled that the game is over,\n    * show the title screen so that the user may play the game again.\n    */\n    gamescreen.on('gamescreen:end', function () {\n\n      gamescreen.scores.push(gamescreen.score);\n\n      titlescreen.scoreView.setText(\"Your Final Score: \" + gamescreen.score);\n\n      rootView.pop();\n    });\n  };\n\n /* Executed after the asset resources have been loaded.\n  * If there is a splash screen, it's removed.\n  */\n  this.launchUI = function () {};\n});","pre":true},"src/TitleScreen.js":{"path":"src/TitleScreen.js","friendlyPath":"src.TitleScreen","directory":"src/","filename":"TitleScreen.js","src":"jsio('import ui.View');\njsio('import ui.ImageView');\njsio('import ui.TextView');\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_src_TitleScreen=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_src_TitleScreen(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_src_TitleScreen(){return this.init&&this.init.apply(this,arguments)},ui.ImageView, function (supr) {\n  this.init = function (opts) {\n    opts = merge(opts, {\n      x: 0,\n      y: 0,\n      image: \"resources/images/ui/titlescreen.png\"\n    });\n\n    supr(this, 'init', [opts]);\n\n    this.addTitle();\n\n    var startbutton = new ui.View({\n      superview: this,\n      x: 30,\n      y: 600,\n      width: 450,\n      height: 150\n    });\n\n    startbutton.on('InputSelect', bind(this, function () {\n      this.emit('titlescreen:start');\n    }));\n  };\n\n  this.addTitle = function() {\n      this.titleView = new ui.TextView({\n        superview: this,\n        x: 5,\n        y: 0,\n        width: 740,\n        height: 150,\n        size: 70,\n        text: \"Element Match-3\",\n        horizontalAlign: \"center\",\n        color: \"red\",\n        autoFontSize: true,\n        autoSize: true\n      });\n\n      this.scoreView = new ui.TextView({\n        superview: this,\n        x: 5,\n        y: 0,\n        width: 740,\n        height: 1000,\n        size: 60,\n        text: \"Can you get a good score in 120 seconds?\",\n        horizontalAlign: \"center\",\n        color: \"green\",\n        wrap: true,\n        autoFontSize: true,\n        autoSize: true\n      });\n    };\n});","pre":true},"modules/devkit-core/modules/timestep/src/ui/TextView.js":{"path":"modules/devkit-core/modules/timestep/src/ui/TextView.js","friendlyPath":"ui.TextView","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"TextView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.TextView;\n * Import the Canvas/DOM implementation of TextView.\n *\n * @doc http://doc.gameclosure.com/api/ui-text.html#class-ui.textview\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/text.md\n */\n\njsio('import device');\n\nexports = device.importUI('TextView');\n","pre":true},"src/GameScreen.js":{"path":"src/GameScreen.js","friendlyPath":"src.GameScreen","directory":"src/","filename":"GameScreen.js","src":"jsio('import animate');\njsio('import ui.View');\njsio('import ui.ImageView');\njsio('import ui.TextView');\njsio('import ui.resource.Image as Image');\njsio('import src.Gem as Gem');\n\nvar x_offset = 32, //variable to set matrix of gem X's offset\n\ty_offset = 415, //variable to set matrix of gem Y's offset\n\tgem_margin = 5, //variable to set margin between gems\n\tboard_size = 7; //variable to set how many gems exists inside. (7x7)\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_src_GameScreen=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_src_GameScreen(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_src_GameScreen(){return this.init&&this.init.apply(this,arguments)},ui.ImageView, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(opts, {\n\t\t\tsuperview: this,\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\timage: \"resources/images/ui/background.png\"\n\t\t});\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis.build();\n\t};\n\n\tthis.build = function () {\n\t\tvar game = this;\n\n\t\tthis.on('app:start', function() {\n\t\t\tstartGame.call(game);\n\t\t});\n\n\t\tthis.buildSubviews(); //To initialize the headers, scoreboard and clock and select cursor\n\n\t\tthis._gems = this.buildGemMatrix(); //The matrix of gems that will be showed\n\n\t\tthis.interval = 100; //Tick interval, to show \"real-time\" gaming\n\n\t\tthis.selected_gem = null; //Variable to show a select cursor in a gem\n\t\tthis.input_disabled = false; //Variable to prevent a move while gem streaking\n\n\t\tbindGemEvents.call(this);\n\t};\n\n\tthis.buildSubviews = function() {\n\n\t\tthis.header = new ui.ImageView({\n\t      \tsuperview: this,\n\t        x: 125,\n\t        y: 1100,\n\t        image: \"resources/images/ui/header.png\",\n\t        width: 500,\n\t        height: 230\n\t    });\n\n\t\tthis._clock = new ui.TextView({\n\t\t\tsuperview: this,\n\t\t\tx: 165,\n\t\t\ty: 1200,\n\t\t\twidth: 420,\n\t\t\theight: 100,\n\t\t\tsize: 65,\n\t\t\thorizontalAlign: \"center\",\n\t\t\twrap: false,\n\t\t\tcolor: '#FFFFEE'\n\t\t});\n\n\t\tthis.scoreheader = new ui.ImageView({\n\t      \tsuperview: this,\n\t        x: 200,\n\t        y: 0,\n\t        image: \"resources/images/ui/header.png\",\n\t        width: 350,\n\t        height: 230\n\t    });\n\n\t\tthis._score = new ui.TextView({\n\t\t\tsuperview: this,\n\t\t\tx: 200,\n\t\t\ty: 50,\n\t\t\twidth: 350,\n\t\t\theight: 200,\n\t\t\tsize: 65,\n\t\t\thorizontalAlign: \"center\",\n\t\t\twrap: false,\n\t\t\tcolor: '#FFFFEE'\n\t\t});\n\n\t\tthis.selected_view = new ui.ImageView({\n\t\t\tsuperview: this,\n\t\t\timage: \"resources/images/cursors/selected.png\",\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\twidth: 101,\n\t\t\theight: 101,\n\t\t\tvisible: false\n\t\t});\n\t};\n\n\tthis.buildGemMatrix = function() {\n\t\tvar gems = [];\n\n\t\tfor (var row = 0; row < board_size; row++) {\n\t\t\tgems.push([]); //pushing a gem view into the matrix by row, and then by column\n\n\t\t\tfor (var col = 0; col < board_size; col++) {\n\t\t\t\t//method to prevent streaks longer than 2 being generated on initialization\n\n\t\t\t\tvar forbidden_types = [];\n\n\t\t\t\tif (col - 2 > -1) {\n\t\t\t\t\tif (gems[row][col - 1].gemtype === gems[row][col - 2].gemtype) {\n\t\t\t\t\t\tforbidden_types.push(gems[row][col - 1].gemtype);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (row - 2 > -1) {\n\t\t\t\t\tif (gems[row - 1][col].gemtype === gems[row - 2][col].gemtype) {\n\t\t\t\t\t\tforbidden_types.push(gems[row - 1][col].gemtype);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t//this verifies adjacents-directed gems (i.e. the next direct gem close to current one)\n\t\t\t\t//next to current gem and assure that they aren't equal to current gem.\n\n\t\t\t\tvar gem = new Gem({ row: row, col: col, forbidden_types: forbidden_types });\n\n\t\t\t\tgem.style.y = y_offset + row * (gem.style.height + gem_margin);\n\t\t\t\tgem.style.x = x_offset + col * (gem.style.width + gem_margin);\n\n\t\t\t\t//this adjusts where to put the gem in user interface\n\n\t\t\t\tthis.addSubview(gem); //adding the gem to interface\n\n\t\t\t\tgems[row].push(gem); //adding gem to matrix of gems to detect moves to clear gems\n\t\t\t}\n\t\t}\n\n\t\treturn gems;\n\t};\n});\n\nfunction startGame() {\n\tvar game = this;\n\n\tthis.score = 0;\n\tthis.score_multiplier = 1;\n\tthis.cleared_gems = 0;\n\n\tthis.game_length = 120000;\n\tthis.game_time = this.game_length;\n\n\tthis.game_timer = setInterval(function() {\n\t\ttick.call(game);\n\t}, this.interval);\n\n}\n\n//fucntion that verifies end of game each 0.1 second\nfunction tick() {\n\tif (this.game_time > 0) {\n\t\tvar time_ratio = this.game_time / this.game_length;\n\n\t\tif (time_ratio <= .125) {\n\t\t\tthis._clock.updateOpts({ color: 'red' });\n\t\t\tthis._clock.updateOpts({ size: 80 });\n\t\t} else {\n\t\t\tthis._clock.updateOpts({ color: 'white' });\n\t\t\tthis._clock.updateOpts({ size: 65 });\n\t\t}\n\n\t\tthis._clock.setText(\"TIME REMAINING: \" + Math.ceil(this.game_time/1000).toString());\n\t\tthis.game_time -= this.interval;\n\n\t\tthis._score.setText(this.score);\n\t} else {\n\t\tendGame.call(this);\n\t}\n}\n\nfunction endGame() {\n\tclearInterval(this.game_timer);\n\tthis.game_time = this.game_length;\n\tthis.emit('gamescreen:end');\n}\n\nfunction bindGemEvents() {\n\tvar that = this;\n\n\tthis._gems.forEach(function(row) {\n\t\trow.forEach(function(gem) {\n\t\t\tgem.on('gem:clicked', function() {\n\t\t\t\thandleGemClick.call(that, gem);\n\t\t\t});\n\t\t});\n\t});\n}\n\nfunction bindSomeGemEvents(gems_to_bind) {\n\tvar that = this;\n\n\tgems_to_bind.forEach(function(gem) {\n\t\tgem.on('gem:clicked', function() {\n\t\t\thandleGemClick.call(that, gem);\n\t\t});\n\t});\n}\n//verifies what to do when a gem is selected. If there already is a gem select,\n//see if adjacent or not and if it will be valid move or not.\nfunction handleGemClick(gem) {\n\tvar game = this;\n\n\tif (this.input_disabled === false) {\n\t\tif (this.selected_gem !== null || !this.selected_view.style.visible === false) {\n\t\t\tdiff_y = gem.row - this.selected_gem.row,\n\t\t\tdiff_x = gem.col - this.selected_gem.col;\n\n\t\t\tif (gem === this.selected_gem) {\n\t\t\t\tdeselectGem.call(this);\n\t\t\t} else if (Math.abs(diff_x) > 1 || Math.abs(diff_y) > 1 || (Math.abs(diff_x) === 1 && Math.abs(diff_y) === 1)) {\n\t\t\t\tselectGem.call(this, gem);\n\t\t\t} else {\n\t\t\t\tattemptMove.call(this, gem);\n\t\t\t}\n\n\t\t} else {\n\t\t\tselectGem.call(this, gem);\n\t\t}\n\t}\n}\n//user interaction when deselecting a gem\nfunction deselectGem() {\n\tthis.selected_gem = null;\n\tthis.selected_view.style.visible = false;\n}\n//user interaction when selecting a gem\nfunction selectGem(gem) {\n\tthis.selected_gem = gem;\n\tthis.selected_view.style.y = y_offset + this.selected_gem.row * (this.selected_gem.style.height + gem_margin) - 4;\n\tthis.selected_view.style.x = x_offset + this.selected_gem.col * (this.selected_gem.style.width + gem_margin) - 4;\n\tthis.selected_view.style.visible = true;\n}\n//function to verify a move attempt. If it's valid (they are adjacent gems), validate the move and proceed to\n//clean the gems paired and look for future gems chain;\n//if not, deselect gem\nfunction attemptMove(gem) {\n\tvar game = this;\n\n\tvar move_y = gem.row - this.selected_gem.row,\n\t\tmove_x = gem.col - this.selected_gem.col,\n\t\tmove = [move_y, move_x];\n\n\tvar valid_move = validMove.call(this, this.selected_gem, move);\n\tif (valid_move === false) { valid_move = validMove.call(this, gem, [-move_y, -move_x]); }\n\n\tif (valid_move === true) {\n\t\tperformMove.call(this, this.selected_gem, gem);\n\t\tvar gems_to_destroy = findGemStreaks.call(this);\n\t\tclearGems.call(this, gems_to_destroy);\n\n\t\tthis.input_disabled = true; //disables a user input to clear gems\n\t\tthis.selected_gem = null;\n\t\tthis.selected_view.style.visible = false;\n\t} else {\n\t\tthis.selected_gem = null;\n\t\tthis.selected_view.style.visible = false;\n\t}\n}\n//finding gem streaks: row search first, then columns to return a coordinate [x,y] to function clearGems\nfunction findGemStreaks() {\n\tvar gems = this._gems;\n\tvar gems_to_destroy = [];\n\tvar row_index = 0;\n\n\t//search through rows, grabbing horizontal streaks 3 or longer\n\tgems.forEach(function(row) {\n\t\tvar col_index = 0;\n\t\tvar consecutive = 0;\n\n\t\trow.forEach(function(gem) {\n\t\t\tif (col_index > 0) {\n\t\t\t\tif (gem.gemtype === gems[row_index][col_index - 1].gemtype) {\n\t\t\t\t\tconsecutive++;\n\n\t\t\t\t\tif (consecutive === 2) {\n\t\t\t\t\t\tgems_to_destroy.push(gems[row_index][col_index - 1]);\n\t\t\t\t\t\tgems_to_destroy.push(gems[row_index][col_index - 2]);\n\t\t\t\t\t\tgems_to_destroy.push(gem);\n\t\t\t\t\t} else if (consecutive > 2) {\n\t\t\t\t\t\tgems_to_destroy.push(gem);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconsecutive = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\tcol_index++;\n\t\t});\n\n\t\trow_index++;\n\t});\n\n\t//search through columns, grabbing vertical streaks 3 or longer\n\t//(and only including gems not already added above)\n\tfor (var col = 0; col < board_size; col++) {\n\t\tvar consecutive = 0;\n\n\t\tfor (var row = 0; row < board_size; row++) {\n\t\t\tvar gem = gems[row][col];\n\n\t\t\tif (row > 0) {\n\t\t\t\tif (gem.gemtype === gems[row - 1][col].gemtype) {\n\t\t\t\t\tconsecutive++;\n\n\t\t\t\t\tif (consecutive === 2) {\n\t\t\t\t\t\tif (gems_to_destroy.indexOf(gems[row - 1][col]) === -1) {\n\t\t\t\t\t\t\tgems_to_destroy.push(gems[row - 1][col]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (gems_to_destroy.indexOf(gems[row - 2][col]) === -1) {\n\t\t\t\t\t\t\tgems_to_destroy.push(gems[row - 2][col]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (gems_to_destroy.indexOf(gem) === -1) {\n\t\t\t\t\t\t\tgems_to_destroy.push(gem);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (consecutive > 2) {\n\t\t\t\t\t\tif (gems_to_destroy.indexOf(gem) === -1) {\n\t\t\t\t\t\t\tgems_to_destroy.push(gem);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconsecutive = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn gems_to_destroy;\n}\n\nfunction clearGems(gems_to_destroy) {\n\tvar game = this;\n\n\tthis.cleared_gems += gems_to_destroy.length;\n\t//adds a point system when gem streaking\n\tif (gems_to_destroy.length === 3) {\n\t\tthis.score_multiplier = 1;\n\t} else if (gems_to_destroy.length > 3) {\n\t\tthis.score_multiplier += gems_to_destroy.length - 3;\n\t}\n\n\tvar points = this.score_multiplier * gems_to_destroy.length * 20;\n\tthis.score += points;\n\n\tif (points !== 0) {\n\t\tvar points_view = new ui.TextView({\n\t\t\tsuperview: this,\n\t\t\tx: 200,\n\t\t\ty: 300,\n\t\t\twidth: 350,\n\t\t\theight: 150,\n\t\t\thorizontalAlign: \"center\",\n\t\t\tsize: points,\n\t\t\ttext: \"COMBO! +\" + points,\n\t\t\tcolor: \"white\"\n\t\t});\n\n\t\tthis.addSubview(points_view);\n\n\t\tvar points_animation = setInterval(function() {\n\t\t\tpoints_view.style.y -= 4.5;\n\t\t}, 50);\n\n\t\tsetTimeout(function() {\n\t\t\tgame.removeSubview(points_view);\n\t\t\tclearInterval(points_animation);\n\t\t}, 1000);\n\t}\n\t//verify the gems to remove and adds a little animation to clear them.\n\tif (gems_to_destroy.length > 0) {\n\t\tvar game = this;\n\t\tvar num_timers_finished = 0;\n\n\t\tgems_to_destroy.forEach(function(gem) {\n\t\t\tvar ticker = 0;\n\n\t\t\tvar shrink_animation = setInterval(function() {\n\n\t\t\t\tticker++;\n\n\t\t\t\tif (ticker < 5) {\n\t\t\t\t\tgem.gem.setImage(\"resources/images/particles/\"+ gem.gemtype+\"_gleam.png\");\n\t\t\t\t} else if (ticker < 10) {\n\t\t\t\t\tgem.gem.setImage(\"resources/images/particles/\"+ gem.gemtype+\"_round.png\");\n\t\t\t\t} else {\n\t\t\t\t\tgame._gems[gem.row][gem.col] = null;\n\t\t\t\t\tgame.removeSubview(gem);\n\n\t\t\t\t\tnum_timers_finished++;\n\t\t\t\t\tclearInterval(shrink_animation);\n\t\t\t\t}\n\t\t\t}, 20)\n\t\t});\n\n\t\tvar animation_wait_timer = setInterval(function() {\n\t\t\tif (num_timers_finished === gems_to_destroy.length) {\n\t\t\t\tfillHole.call(game);\n\t\t\t\tclearInterval(animation_wait_timer);\n\t\t\t}\n\t\t}, 30);\n\t} else {\n\t\t//when finishing to remove gems, enable user input again\n\t\tthis.input_disabled = false;\n\t}\n}\n//when removing a gem, there will be a hole, both in user interface and inside gem matrix\n//that will be filled by falling gems from top.\nfunction fillHole() {\n\tvar game = this;\n\tvar gems = this._gems;\n\n\t//From second-to-bottom until the top row, look for holes beneath created by gem remove.\n\t//If there is a hole, step down a gem column until finding another gem beneath.\n\tfor (var row = board_size - 2; row > -1; row--) {\n\t\tfor (var col = 0; col < board_size; col++) {\n\t\t\tif (gems[row][col] !== null) {\n\t\t\t\tvar gem = gems[row][col];\n\n\t\t\t\tvar step_down = 1;\n\n\t\t\t\twhile (row + step_down < board_size && gems[row + step_down][col] === null) {\n\t\t\t\t\tfallExistingGem.call(game, gem, [row + step_down, col]);\n\n\t\t\t\t\tstep_down++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tdropNew.call(this);\n}\n//With holes on the top of stepped down columns, we proceed to fill the top of these stepped down columns\nfunction dropNew() {\n\tvar game = this;\n\tvar gems = this._gems;\n\tvar new_gems = [];\n\n\t//From the first column until the last one, search for a empty space with a gem beneath created by a stepped down column to fill holes.\n\t//If there is an empty space, fill them from this space until the top of the column\n\t//(because above this space, there will be empty spaces too) with new gems\n\n\tfor (var col = 0; col < board_size; col++) {\n\t\tvar num_gems;\n\n\t\tfor (var row = board_size - 1; row > -1; row--) {\n\t\t\tif (gems[row][col] === null) {\n\t\t\t\tnum_gems = row + 1;\n\n\t\t\t\tfor (var i = row; i > -1; i--) {\n\t\t\t\t\tvar gem = new Gem({ row: i, col: col, forbidden_types: [] });\n\n\t\t\t\t\tgem.style.y = y_offset + i * (gem.style.height + gem_margin);\n\t\t\t\t\tgem.style.x = x_offset + col * (gem.style.width + gem_margin);\n\n\t\t\t\t\tgems[i][col] = gem;\n\t\t\t\t\tnew_gems.push(gem);\n\n\t\t\t\t\tgame.addSubview(gem);\n\t\t\t\t\t//This will animate a Gem falling and placing on top of the stepped down column.\n\t\t\t\t\tgem.fallIn(y_offset + i * (gem.style.height + gem_margin));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tbindSomeGemEvents.call(game, new_gems);\n\n\t//This timeout will loop until there are no remaining streaks.\n\t//It serves to wait while replacing cleared gems to then continue the gem streaking.\n\tsetTimeout(function() {\n\t\tclearGems.call(game, findGemStreaks.call(game));\n\t}, 250);\n}\n//Swapping the gems, just like a function swap() used in algorithms, to start a move.\nfunction performMove(selected_gem, affected_gem) {\n\tthis._gems[selected_gem.row][selected_gem.col] = affected_gem;\n\tthis._gems[affected_gem.row][affected_gem.col] = selected_gem;\n\n\tvar temp_row = selected_gem.row;\n\tvar temp_col = selected_gem.col;\n\tvar temp_y = selected_gem.style.y;\n\tvar temp_x = selected_gem.style.x;\n\n\tselected_gem.row = affected_gem.row;\n\tselected_gem.col = affected_gem.col;\n\tselected_gem.style.y = affected_gem.style.y;\n\tselected_gem.style.x = affected_gem.style.x;\n\n\taffected_gem.row = temp_row;\n\taffected_gem.col = temp_col;\n\taffected_gem.style.y = temp_y;\n\taffected_gem.style.x = temp_x;\n}\n//Used to move a existing gem, to fill the hole.\nfunction fallExistingGem(gem, destination) {\n\tthis._gems[gem.row][gem.col] = null;\n\tthis._gems[destination[0]][destination[1]] = gem;\n\tgem.row = destination[0];\n\tgem.col = destination[1];\n\n\tvar diff_y = y_offset + gem.row * (gem.style.height + gem_margin) - gem.style.y;\n\n\tgem.style.y = y_offset + gem.row * (gem.style.height + gem_margin);\n\tgem.style.x = x_offset + gem.col * (gem.style.width + gem_margin);\n\n\tgem.fallIn(diff_y);\n}\n//Function to validate a move, verifying if there are at least a triplet of gems.\nfunction validMove(gem, move) {\n\tvar valid_gems = this._gems;\n\tvar starting_row = gem.row; //starting row of gem after move\n\tvar starting_column = gem.col; //starting col of gem after move\n\tvar typeOfGem = gem.gemtype;\n\t//move = [[-x||0],[-y||0]]. If they are 0, we know if they are horizontally or vertically adjacents.\n\tif (move[1] === 0) {\n\t\t//vertical move\n\t\tif (starting_row + 3 * move[0] < board_size && starting_row + 3 * move[0] > -1) {\n\t\t\tif (typeOfGem === valid_gems[starting_row + 2 * move[0]][starting_column].gemtype && typeOfGem === valid_gems[starting_row + 3 * move[0]][starting_column].gemtype) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\tif (starting_column + 2 < board_size) {\n\t\t\tif (typeOfGem === valid_gems[starting_row + move[0]][starting_column + 1].gemtype && typeOfGem === valid_gems[starting_row + move[0]][starting_column + 2].gemtype) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\tif (starting_column - 2 > -1) {\n\t\t\tif (typeOfGem === valid_gems[starting_row + move[0]][starting_column - 1].gemtype && typeOfGem === valid_gems[starting_row + move[0]][starting_column - 2].gemtype) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\tif (starting_column + 1 < board_size && starting_column - 1 > -1) {\n\t\t\tif (typeOfGem === valid_gems[starting_row + move[0]][starting_column - 1].gemtype && typeOfGem === valid_gems[starting_row + move[0]][starting_column + 1].gemtype) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t} else {\n\t\t//horizontal move\n\t\tif (starting_column + 3 * move[1] < board_size && starting_column + 3 * move[1] > -1) {\n\t\t\tif (typeOfGem === valid_gems[starting_row][starting_column + 2 * move[1]].gemtype && typeOfGem === valid_gems[starting_row][starting_column + 3 * move[1]].gemtype) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\tif (starting_row + 2 < board_size) {\n\t\t\tif (typeOfGem === valid_gems[starting_row + 1][starting_column + move[1]].gemtype && typeOfGem === valid_gems[starting_row + 2][starting_column + move[1]].gemtype) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\tif (starting_row - 2 > -1) {\n\t\t\tif (typeOfGem === valid_gems[starting_row - 1][starting_column + move[1]].gemtype && typeOfGem === valid_gems[starting_row - 2][starting_column + move[1]].gemtype) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\tif (starting_row + 1 < board_size && starting_row - 1 > -1) {\n\t\t\tif (typeOfGem === valid_gems[starting_row - 1][starting_column + move[1]].gemtype && typeOfGem === valid_gems[starting_row + 1][starting_column + move[1]].gemtype) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n}","pre":true},"src/Gem.js":{"path":"src/Gem.js","friendlyPath":"src.Gem","directory":"src/","filename":"Gem.js","src":"jsio('import animate');\njsio('import ui.View');\njsio('import ui.ImageView');\njsio('import ui.TextView');\njsio('import ui.resource.Image as Image');\n\nvar gem_size = 94;\n\nvar Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_src_Gem=__class__;exports=Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_src_Gem(function Users_marcelo_hashimoto_Desktop_gamedev_ElementalMatch3_src_Gem(){return this.init&&this.init.apply(this,arguments)},ui.ImageView, function (supr) {\n\n\tthis.init = function (options) {\n\t\toptions = merge(options, {\n\t\t\twidth:\tgem_size,\n\t\t\theight: gem_size\n\t\t});\n\n\t\tsupr(this, 'init', [options]);\n\n\t\tthis.row = options.row;\n\t\tthis.col = options.col;\n\n\t\tthis.forbidden_types = options.forbidden_types;\n\n\t\tthis.active = false;\n\t\tthis.isselected = false;\n\n\t\tthis.build();\n\t};\n\n\tthis.pickGemType = function() {\n\t\tvar gemtypes = [\"gem_01\", \"gem_02\", \"gem_03\", \"gem_04\", \"gem_05\"];\n\t\tvar num_forbidden = this.forbidden_types.length;\n\n\t\tif (this.forbidden_types.length > 0) {\n\t\t\tthis.forbidden_types.forEach(function(type) {\n\t\t\t\tgemtypes.splice(gemtypes.indexOf(type), 1);\n\t\t\t});\n\t\t}\n\n\t\treturn gemtypes[parseInt((5 - num_forbidden) * Math.random())];\n\t};\n\n\tthis.build = function () {\n\t\tthis.gemtype = this.pickGemType();\n\n\t\tvar gemimage = new Image({ url: \"resources/images/gems/\" + this.gemtype + \".png\" });\n\n\t\tthis.gem = new ui.ImageView({\n\t\t\tsuperview: this,\n\t\t\timage: gemimage,\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\twidth: gem_size,\n\t\t\theight: gem_size\n\t\t});\n\n\t\tthis._inputview = new ui.View({\n\t\t\tsuperview: this,\n\t\t\tclip: false,\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\twidth: gem_size,\n\t\t\theight: gem_size\n\t\t});\n\n\t\tthis._animator = animate(this.gem);\n\n\t\tthis._inputview.on('InputSelect', bind(this, function() {\n\t\t\tthis.emit('gem:clicked');\n\t\t}));\n\t};\n\n\tthis.fallIn = function(position) {\n\t\tthis.gem.style.y = -position;\n\t\tthis._animator.now({ y: 0 }, 150, animate.linear);\n\t}\n});\n","pre":true},"src/util.js":{"path":"src/util.js","friendlyPath":"src.util","directory":"src/","filename":"util.js","src":"jsio('import device');\njsio('import ui.View');\n\nexports.scaleRootView = function (app, W, H) {\n\tvar view = app.view;\n\tvar scale = Math.min(view.style.width / W, view.style.height / H);\n\tvar width = view.style.width * scale;\n\tvar height = view.style.height * scale;\n\n\tapp.view = new ui.View({\n\t\tsuperview: view,\n\t\tscale: scale,\n\t\twidth: W,\n\t\theight: H,\n\t\tx: (device.screen.width - W * scale) / 2,\n\t\ty: (device.screen.height - H * scale) / 2,\n\t\tclip: true,\n\t});\n}","pre":true},"modules/devkit-core/node_modules/jsio/packages/util/syntax.js":{"path":"modules/devkit-core/node_modules/jsio/packages/util/syntax.js","friendlyPath":"util.syntax","directory":"modules/devkit-core/node_modules/jsio/packages/util/","filename":"syntax.js","src":"jsio('import .esprima');\n\nfunction validate(code, filename) {\n  try {\n    var syntax = esprima.parse(code, { tolerant: true, loc: true });\n    var errors = syntax.errors;\n    if (errors.length > 0) {\n      logErrors(filename, code, errors);\n    }\n  } catch (e) {\n    logErrors(filename, code, [e]);\n  }\n}\n\nfunction padString(str, pad) {\n  str = str + '';\n  while (str.length < pad) {\n    str = ' ' + str;\n  }\n  return str;\n}\n\nfunction logColor(color, str) {\n  if (console.group) {\n    str = '%c' + str;\n    console.log(str, 'color:' + color);\n  } else {\n    console.log(str);\n  }\n}\n\nfunction logErrors(filename, code, errors) {\n  var title = \"Syntax Error (\" + filename + \"):\";\n  if (console.group) {\n    console.group(\"%c\" + title, \"color: red; text-decoration: underline\");\n  } else {\n    console.error(\"Syntax Error:\");\n  }\n\n  var linesBefore = 3;\n  var linesAfter = 3;\n  var lines = code.split('\\n');\n  for (var i = 0; i < errors.length; i += 1) {\n    var e = errors[i];\n    var pad = ('' + (e.lineNumber + linesAfter)).length;\n    printLines(pad, lines, e.lineNumber - linesBefore, e.lineNumber - 1);\n    logColor(\"red\", padString(e.lineNumber, pad) + ' ' + lines[e.lineNumber - 1]);\n\n    logColor(\"blue\", new Array(pad + e.column + 1).join('') + '^');\n\n    printLines(pad, lines, e.lineNumber + 1, e.lineNumber + 1 + linesAfter);\n\n    logColor(\"red\", \"Line \" + e.lineNumber + \": \" + e.description);\n  }\n\n  console.groupEnd && console.groupEnd();\n}\n\n\nvar printLines = console.group\n  ? function (pad, lines, from, to) {\n      for (var j = from; j <= to; ++j) {\n        console.log('%c' + padString(j, pad) + ' %c' + lines[j - 1], 'color: gray', 'color: auto');\n      }\n    }\n  : function (pad, lines, from, to) {\n      for (var j = from; j <= to; ++j) {\n        console.log(padString(j, pad), lines[j - 1]);\n      }\n    };\n\nexports = validate;\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/util/esprima.js":{"path":"modules/devkit-core/node_modules/jsio/packages/util/esprima.js","friendlyPath":".esprima","directory":"modules/devkit-core/node_modules/jsio/packages/util/","filename":"esprima.js","src":"/*\n  Copyright (c) jQuery Foundation, Inc. and Contributors, All Rights Reserved.\n\n  Redistribution and use in source and binary forms, with or without\n  modification, are permitted provided that the following conditions are met:\n\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n    * Redistributions in binary form must reproduce the above copyright\n      notice, this list of conditions and the following disclaimer in the\n      documentation and/or other materials provided with the distribution.\n\n  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n  ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> BE LIABLE FOR ANY\n  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n  THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n(function (root, factory) {\n    'use strict';\n\n    // Universal Module Definition (UMD) to support AMD, CommonJS/Node.js,\n    // Rhino, and plain browser loading.\n\n    /* istanbul ignore next */\n    if (typeof define === 'function' && define.amd) {\n        define(['exports'], factory);\n    } else if (typeof exports !== 'undefined') {\n        factory(exports);\n    } else {\n        factory((root.esprima = {}));\n    }\n}(this, function (exports) {\n    'use strict';\n\n    var Token,\n        TokenName,\n        FnExprTokens,\n        Syntax,\n        PlaceHolders,\n        Messages,\n        Regex,\n        source,\n        strict,\n        sourceType,\n        index,\n        lineNumber,\n        lineStart,\n        hasLineTerminator,\n        lastIndex,\n        lastLineNumber,\n        lastLineStart,\n        startIndex,\n        startLineNumber,\n        startLineStart,\n        scanning,\n        length,\n        lookahead,\n        state,\n        extra,\n        isBindingElement,\n        isAssignmentTarget,\n        firstCoverInitializedNameError;\n\n    Token = {\n        BooleanLiteral: 1,\n        EOF: 2,\n        Identifier: 3,\n        Keyword: 4,\n        NullLiteral: 5,\n        NumericLiteral: 6,\n        Punctuator: 7,\n        StringLiteral: 8,\n        RegularExpression: 9,\n        Template: 10\n    };\n\n    TokenName = {};\n    TokenName[Token.BooleanLiteral] = 'Boolean';\n    TokenName[Token.EOF] = '<end>';\n    TokenName[Token.Identifier] = 'Identifier';\n    TokenName[Token.Keyword] = 'Keyword';\n    TokenName[Token.NullLiteral] = 'Null';\n    TokenName[Token.NumericLiteral] = 'Numeric';\n    TokenName[Token.Punctuator] = 'Punctuator';\n    TokenName[Token.StringLiteral] = 'String';\n    TokenName[Token.RegularExpression] = 'RegularExpression';\n    TokenName[Token.Template] = 'Template';\n\n    // A function following one of those tokens is an expression.\n    FnExprTokens = ['(', '{', '[', 'in', 'typeof', 'instanceof', 'new',\n                    'return', 'case', 'delete', 'throw', 'void',\n                    // assignment operators\n                    '=', '+=', '-=', '*=', '/=', '%=', '<<=', '>>=', '>>>=',\n                    '&=', '|=', '^=', ',',\n                    // binary/unary operators\n                    '+', '-', '*', '/', '%', '++', '--', '<<', '>>', '>>>', '&',\n                    '|', '^', '!', '~', '&&', '||', '?', ':', '===', '==', '>=',\n                    '<=', '<', '>', '!=', '!=='];\n\n    Syntax = {\n        AssignmentExpression: 'AssignmentExpression',\n        AssignmentPattern: 'AssignmentPattern',\n        ArrayExpression: 'ArrayExpression',\n        ArrayPattern: 'ArrayPattern',\n        ArrowFunctionExpression: 'ArrowFunctionExpression',\n        BlockStatement: 'BlockStatement',\n        BinaryExpression: 'BinaryExpression',\n        BreakStatement: 'BreakStatement',\n        CallExpression: 'CallExpression',\n        CatchClause: 'CatchClause',\n        ClassBody: 'ClassBody',\n        ClassDeclaration: 'ClassDeclaration',\n        ClassExpression: 'ClassExpression',\n        ConditionalExpression: 'ConditionalExpression',\n        ContinueStatement: 'ContinueStatement',\n        DoWhileStatement: 'DoWhileStatement',\n        DebuggerStatement: 'DebuggerStatement',\n        EmptyStatement: 'EmptyStatement',\n        ExportAllDeclaration: 'ExportAllDeclaration',\n        ExportDefaultDeclaration: 'ExportDefaultDeclaration',\n        ExportNamedDeclaration: 'ExportNamedDeclaration',\n        ExportSpecifier: 'ExportSpecifier',\n        ExpressionStatement: 'ExpressionStatement',\n        ForStatement: 'ForStatement',\n        ForOfStatement: 'ForOfStatement',\n        ForInStatement: 'ForInStatement',\n        FunctionDeclaration: 'FunctionDeclaration',\n        FunctionExpression: 'FunctionExpression',\n        Identifier: 'Identifier',\n        IfStatement: 'IfStatement',\n        ImportDeclaration: 'ImportDeclaration',\n        ImportDefaultSpecifier: 'ImportDefaultSpecifier',\n        ImportNamespaceSpecifier: 'ImportNamespaceSpecifier',\n        ImportSpecifier: 'ImportSpecifier',\n        Literal: 'Literal',\n        LabeledStatement: 'LabeledStatement',\n        LogicalExpression: 'LogicalExpression',\n        MemberExpression: 'MemberExpression',\n        MethodDefinition: 'MethodDefinition',\n        NewExpression: 'NewExpression',\n        ObjectExpression: 'ObjectExpression',\n        ObjectPattern: 'ObjectPattern',\n        Program: 'Program',\n        Property: 'Property',\n        RestElement: 'RestElement',\n        ReturnStatement: 'ReturnStatement',\n        SequenceExpression: 'SequenceExpression',\n        SpreadElement: 'SpreadElement',\n        Super: 'Super',\n        SwitchCase: 'SwitchCase',\n        SwitchStatement: 'SwitchStatement',\n        TaggedTemplateExpression: 'TaggedTemplateExpression',\n        TemplateElement: 'TemplateElement',\n        TemplateLiteral: 'TemplateLiteral',\n        ThisExpression: 'ThisExpression',\n        ThrowStatement: 'ThrowStatement',\n        TryStatement: 'TryStatement',\n        UnaryExpression: 'UnaryExpression',\n        UpdateExpression: 'UpdateExpression',\n        VariableDeclaration: 'VariableDeclaration',\n        VariableDeclarator: 'VariableDeclarator',\n        WhileStatement: 'WhileStatement',\n        WithStatement: 'WithStatement',\n        YieldExpression: 'YieldExpression'\n    };\n\n    PlaceHolders = {\n        ArrowParameterPlaceHolder: 'ArrowParameterPlaceHolder'\n    };\n\n    // Error messages should be identical to V8.\n    Messages = {\n        UnexpectedToken: 'Unexpected token %0',\n        UnexpectedNumber: 'Unexpected number',\n        UnexpectedString: 'Unexpected string',\n        UnexpectedIdentifier: 'Unexpected identifier',\n        UnexpectedReserved: 'Unexpected reserved word',\n        UnexpectedTemplate: 'Unexpected quasi %0',\n        UnexpectedEOS: 'Unexpected end of input',\n        NewlineAfterThrow: 'Illegal newline after throw',\n        InvalidRegExp: 'Invalid regular expression',\n        UnterminatedRegExp: 'Invalid regular expression: missing /',\n        InvalidLHSInAssignment: 'Invalid left-hand side in assignment',\n        InvalidLHSInForIn: 'Invalid left-hand side in for-in',\n        InvalidLHSInForLoop: 'Invalid left-hand side in for-loop',\n        MultipleDefaultsInSwitch: 'More than one default clause in switch statement',\n        NoCatchOrFinally: 'Missing catch or finally after try',\n        UnknownLabel: 'Undefined label \\'%0\\'',\n        Redeclaration: '%0 \\'%1\\' has already been declared',\n        IllegalContinue: 'Illegal continue statement',\n        IllegalBreak: 'Illegal break statement',\n        IllegalReturn: 'Illegal return statement',\n        IllegalYield: 'Unexpected token yield',\n        StrictModeWith: 'Strict mode code may not include a with statement',\n        StrictCatchVariable: 'Catch variable may not be eval or arguments in strict mode',\n        StrictVarName: 'Variable name may not be eval or arguments in strict mode',\n        StrictParamName: 'Parameter name eval or arguments is not allowed in strict mode',\n        StrictParamDupe: 'Strict mode function may not have duplicate parameter names',\n        StrictFunctionName: 'Function name may not be eval or arguments in strict mode',\n        StrictOctalLiteral: 'Octal literals are not allowed in strict mode.',\n        StrictDelete: 'Delete of an unqualified identifier in strict mode.',\n        StrictLHSAssignment: 'Assignment to eval or arguments is not allowed in strict mode',\n        StrictLHSPostfix: 'Postfix increment/decrement may not have eval or arguments operand in strict mode',\n        StrictLHSPrefix: 'Prefix increment/decrement may not have eval or arguments operand in strict mode',\n        StrictReservedWord: 'Use of future reserved word in strict mode',\n        TemplateOctalLiteral: 'Octal literals are not allowed in template strings.',\n        ParameterAfterRestParameter: 'Rest parameter must be last formal parameter',\n        DefaultRestParameter: 'Unexpected token =',\n        ObjectPatternAsRestParameter: 'Unexpected token {',\n        DuplicateProtoProperty: 'Duplicate __proto__ fields are not allowed in object literals',\n        ConstructorSpecialMethod: 'Class constructor may not be an accessor',\n        DuplicateConstructor: 'A class may only have one constructor',\n        StaticPrototype: 'Classes may not have static property named prototype',\n        MissingFromClause: 'Unexpected token',\n        NoAsAfterImportNamespace: 'Unexpected token',\n        InvalidModuleSpecifier: 'Unexpected token',\n        IllegalImportDeclaration: 'Unexpected token',\n        IllegalExportDeclaration: 'Unexpected token',\n        DuplicateBinding: 'Duplicate binding %0'\n    };\n\n    // See also tools/generate-unicode-regex.py.\n    Regex = {\n        NonAsciiIdentifierStart: new RegExp('[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]'),\n        NonAsciiIdentifierPart: new RegExp('[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]')\n    };\n\n    // Ensure the condition is true, otherwise throw an error.\n    // This is only to have a better contract semantic, i.e. another safety net\n    // to catch a logic error. The condition shall be fulfilled in normal case.\n    // Do NOT use this to enforce a certain condition on any user input.\n\n    function assert(condition, message) {\n        /* istanbul ignore if */\n        if (!condition) {\n            throw new Error('ASSERT: ' + message);\n        }\n    }\n\n    function isDecimalDigit(ch) {\n        return (ch >= 0x30 && ch <= 0x39);   // 0..9\n    }\n\n    function isHexDigit(ch) {\n        return '0123456789abcdefABCDEF'.indexOf(ch) >= 0;\n    }\n\n    function isOctalDigit(ch) {\n        return '01234567'.indexOf(ch) >= 0;\n    }\n\n    function octalToDecimal(ch) {\n        // \\0 is not octal escape sequence\n        var octal = (ch !== '0'), code = '01234567'.indexOf(ch);\n\n        if (index < length && isOctalDigit(source[index])) {\n            octal = true;\n            code = code * 8 + '01234567'.indexOf(source[index++]);\n\n            // 3 digits are only allowed when string starts\n            // with 0, 1, 2, 3\n            if ('0123'.indexOf(ch) >= 0 &&\n                    index < length &&\n                    isOctalDigit(source[index])) {\n                code = code * 8 + '01234567'.indexOf(source[index++]);\n            }\n        }\n\n        return {\n            code: code,\n            octal: octal\n        };\n    }\n\n    // 7.2 White Space\n\n    function isWhiteSpace(ch) {\n        return (ch === 0x20) || (ch === 0x09) || (ch === 0x0B) || (ch === 0x0C) || (ch === 0xA0) ||\n            (ch >= 0x1680 && [0x1680, 0x180E, 0x2000, 0x2001, 0x2002, 0x2003, 0x2004, 0x2005, 0x2006, 0x2007, 0x2008, 0x2009, 0x200A, 0x202F, 0x205F, 0x3000, 0xFEFF].indexOf(ch) >= 0);\n    }\n\n    // 7.3 Line Terminators\n\n    function isLineTerminator(ch) {\n        return (ch === 0x0A) || (ch === 0x0D) || (ch === 0x2028) || (ch === 0x2029);\n    }\n\n    // 7.6 Identifier Names and Identifiers\n\n    function isIdentifierStart(ch) {\n        return (ch === 0x24) || (ch === 0x5F) ||  // $ (dollar) and _ (underscore)\n            (ch >= 0x41 && ch <= 0x5A) ||         // A..Z\n            (ch >= 0x61 && ch <= 0x7A) ||         // a..z\n            (ch === 0x5C) ||                      // \\ (backslash)\n            ((ch >= 0x80) && Regex.NonAsciiIdentifierStart.test(String.fromCharCode(ch)));\n    }\n\n    function isIdentifierPart(ch) {\n        return (ch === 0x24) || (ch === 0x5F) ||  // $ (dollar) and _ (underscore)\n            (ch >= 0x41 && ch <= 0x5A) ||         // A..Z\n            (ch >= 0x61 && ch <= 0x7A) ||         // a..z\n            (ch >= 0x30 && ch <= 0x39) ||         // 0..9\n            (ch === 0x5C) ||                      // \\ (backslash)\n            ((ch >= 0x80) && Regex.NonAsciiIdentifierPart.test(String.fromCharCode(ch)));\n    }\n\n    // 7.6.1.2 Future Reserved Words\n\n    function isFutureReservedWord(id) {\n        switch (id) {\n        case 'enum':\n        case 'export':\n        case 'import':\n        case 'super':\n            return true;\n        default:\n            return false;\n        }\n    }\n\n    // 11.6.2.2 Future Reserved Words\n\n    function isStrictModeReservedWord(id) {\n        switch (id) {\n        case 'implements':\n        case 'interface':\n        case 'package':\n        case 'private':\n        case 'protected':\n        case 'public':\n        case 'static':\n        case 'yield':\n        case 'let':\n            return true;\n        default:\n            return false;\n        }\n    }\n\n    function isRestrictedWord(id) {\n        return id === 'eval' || id === 'arguments';\n    }\n\n    // 7.6.1.1 Keywords\n\n    function isKeyword(id) {\n\n        // 'const' is specialized as Keyword in V8.\n        // 'yield' and 'let' are for compatibility with SpiderMonkey and ES.next.\n        // Some others are from future reserved words.\n\n        switch (id.length) {\n        case 2:\n            return (id === 'if') || (id === 'in') || (id === 'do');\n        case 3:\n            return (id === 'var') || (id === 'for') || (id === 'new') ||\n                (id === 'try') || (id === 'let');\n        case 4:\n            return (id === 'this') || (id === 'else') || (id === 'case') ||\n                (id === 'void') || (id === 'with') || (id === 'enum');\n        case 5:\n            return (id === 'while') || (id === 'break') || (id === 'catch') ||\n                (id === 'throw') || (id === 'const') || (id === 'yield') ||\n                (id === 'class') || (id === 'super');\n        case 6:\n            return (id === 'return') || (id === 'typeof') || (id === 'delete') ||\n                (id === 'switch') || (id === 'export') || (id === 'import');\n        case 7:\n            return (id === 'default') || (id === 'finally') || (id === 'extends');\n        case 8:\n            return (id === 'function') || (id === 'continue') || (id === 'debugger');\n        case 10:\n            return (id === 'instanceof');\n        default:\n            return false;\n        }\n    }\n\n    // 7.4 Comments\n\n    function addComment(type, value, start, end, loc) {\n        var comment;\n\n        assert(typeof start === 'number', 'Comment must have valid position');\n\n        state.lastCommentStart = start;\n\n        comment = {\n            type: type,\n            value: value\n        };\n        if (extra.range) {\n            comment.range = [start, end];\n        }\n        if (extra.loc) {\n            comment.loc = loc;\n        }\n        extra.comments.push(comment);\n        if (extra.attachComment) {\n            extra.leadingComments.push(comment);\n            extra.trailingComments.push(comment);\n        }\n    }\n\n    function skipSingleLineComment(offset) {\n        var start, loc, ch, comment;\n\n        start = index - offset;\n        loc = {\n            start: {\n                line: lineNumber,\n                column: index - lineStart - offset\n            }\n        };\n\n        while (index < length) {\n            ch = source.charCodeAt(index);\n            ++index;\n            if (isLineTerminator(ch)) {\n                hasLineTerminator = true;\n                if (extra.comments) {\n                    comment = source.slice(start + offset, index - 1);\n                    loc.end = {\n                        line: lineNumber,\n                        column: index - lineStart - 1\n                    };\n                    addComment('Line', comment, start, index - 1, loc);\n                }\n                if (ch === 13 && source.charCodeAt(index) === 10) {\n                    ++index;\n                }\n                ++lineNumber;\n                lineStart = index;\n                return;\n            }\n        }\n\n        if (extra.comments) {\n            comment = source.slice(start + offset, index);\n            loc.end = {\n                line: lineNumber,\n                column: index - lineStart\n            };\n            addComment('Line', comment, start, index, loc);\n        }\n    }\n\n    function skipMultiLineComment() {\n        var start, loc, ch, comment;\n\n        if (extra.comments) {\n            start = index - 2;\n            loc = {\n                start: {\n                    line: lineNumber,\n                    column: index - lineStart - 2\n                }\n            };\n        }\n\n        while (index < length) {\n            ch = source.charCodeAt(index);\n            if (isLineTerminator(ch)) {\n                if (ch === 0x0D && source.charCodeAt(index + 1) === 0x0A) {\n                    ++index;\n                }\n                hasLineTerminator = true;\n                ++lineNumber;\n                ++index;\n                lineStart = index;\n            } else if (ch === 0x2A) {\n                // Block comment ends with '*/'.\n                if (source.charCodeAt(index + 1) === 0x2F) {\n                    ++index;\n                    ++index;\n                    if (extra.comments) {\n                        comment = source.slice(start + 2, index - 2);\n                        loc.end = {\n                            line: lineNumber,\n                            column: index - lineStart\n                        };\n                        addComment('Block', comment, start, index, loc);\n                    }\n                    return;\n                }\n                ++index;\n            } else {\n                ++index;\n            }\n        }\n\n        // Ran off the end of the file - the whole thing is a comment\n        if (extra.comments) {\n            loc.end = {\n                line: lineNumber,\n                column: index - lineStart\n            };\n            comment = source.slice(start + 2, index);\n            addComment('Block', comment, start, index, loc);\n        }\n        tolerateUnexpectedToken();\n    }\n\n    function skipComment() {\n        var ch, start;\n        hasLineTerminator = false;\n\n        start = (index === 0);\n        while (index < length) {\n            ch = source.charCodeAt(index);\n\n            if (isWhiteSpace(ch)) {\n                ++index;\n            } else if (isLineTerminator(ch)) {\n                hasLineTerminator = true;\n                ++index;\n                if (ch === 0x0D && source.charCodeAt(index) === 0x0A) {\n                    ++index;\n                }\n                ++lineNumber;\n                lineStart = index;\n                start = true;\n            } else if (ch === 0x2F) { // U+002F is '/'\n                ch = source.charCodeAt(index + 1);\n                if (ch === 0x2F) {\n                    ++index;\n                    ++index;\n                    skipSingleLineComment(2);\n                    start = true;\n                } else if (ch === 0x2A) {  // U+002A is '*'\n                    ++index;\n                    ++index;\n                    skipMultiLineComment();\n                } else {\n                    break;\n                }\n            } else if (start && ch === 0x2D) { // U+002D is '-'\n                // U+003E is '>'\n                if ((source.charCodeAt(index + 1) === 0x2D) && (source.charCodeAt(index + 2) === 0x3E)) {\n                    // '-->' is a single-line comment\n                    index += 3;\n                    skipSingleLineComment(3);\n                } else {\n                    break;\n                }\n            } else if (ch === 0x3C) { // U+003C is '<'\n                if (source.slice(index + 1, index + 4) === '!--') {\n                    ++index; // `<`\n                    ++index; // `!`\n                    ++index; // `-`\n                    ++index; // `-`\n                    skipSingleLineComment(4);\n                } else {\n                    break;\n                }\n            } else {\n                break;\n            }\n        }\n    }\n\n    function scanHexEscape(prefix) {\n        var i, len, ch, code = 0;\n\n        len = (prefix === 'u') ? 4 : 2;\n        for (i = 0; i < len; ++i) {\n            if (index < length && isHexDigit(source[index])) {\n                ch = source[index++];\n                code = code * 16 + '0123456789abcdef'.indexOf(ch.toLowerCase());\n            } else {\n                return '';\n            }\n        }\n        return String.fromCharCode(code);\n    }\n\n    function scanUnicodeCodePointEscape() {\n        var ch, code, cu1, cu2;\n\n        ch = source[index];\n        code = 0;\n\n        // At least, one hex digit is required.\n        if (ch === '}') {\n            throwUnexpectedToken();\n        }\n\n        while (index < length) {\n            ch = source[index++];\n            if (!isHexDigit(ch)) {\n                break;\n            }\n            code = code * 16 + '0123456789abcdef'.indexOf(ch.toLowerCase());\n        }\n\n        if (code > 0x10FFFF || ch !== '}') {\n            throwUnexpectedToken();\n        }\n\n        // UTF-16 Encoding\n        if (code <= 0xFFFF) {\n            return String.fromCharCode(code);\n        }\n        cu1 = ((code - 0x10000) >> 10) + 0xD800;\n        cu2 = ((code - 0x10000) & 1023) + 0xDC00;\n        return String.fromCharCode(cu1, cu2);\n    }\n\n    function getEscapedIdentifier() {\n        var ch, id;\n\n        ch = source.charCodeAt(index++);\n        id = String.fromCharCode(ch);\n\n        // '\\u' (U+005C, U+0075) denotes an escaped character.\n        if (ch === 0x5C) {\n            if (source.charCodeAt(index) !== 0x75) {\n                throwUnexpectedToken();\n            }\n            ++index;\n            ch = scanHexEscape('u');\n            if (!ch || ch === '\\\\' || !isIdentifierStart(ch.charCodeAt(0))) {\n                throwUnexpectedToken();\n            }\n            id = ch;\n        }\n\n        while (index < length) {\n            ch = source.charCodeAt(index);\n            if (!isIdentifierPart(ch)) {\n                break;\n            }\n            ++index;\n            id += String.fromCharCode(ch);\n\n            // '\\u' (U+005C, U+0075) denotes an escaped character.\n            if (ch === 0x5C) {\n                id = id.substr(0, id.length - 1);\n                if (source.charCodeAt(index) !== 0x75) {\n                    throwUnexpectedToken();\n                }\n                ++index;\n                ch = scanHexEscape('u');\n                if (!ch || ch === '\\\\' || !isIdentifierPart(ch.charCodeAt(0))) {\n                    throwUnexpectedToken();\n                }\n                id += ch;\n            }\n        }\n\n        return id;\n    }\n\n    function getIdentifier() {\n        var start, ch;\n\n        start = index++;\n        while (index < length) {\n            ch = source.charCodeAt(index);\n            if (ch === 0x5C) {\n                // Blackslash (U+005C) marks Unicode escape sequence.\n                index = start;\n                return getEscapedIdentifier();\n            }\n            if (isIdentifierPart(ch)) {\n                ++index;\n            } else {\n                break;\n            }\n        }\n\n        return source.slice(start, index);\n    }\n\n    function scanIdentifier() {\n        var start, id, type;\n\n        start = index;\n\n        // Backslash (U+005C) starts an escaped character.\n        id = (source.charCodeAt(index) === 0x5C) ? getEscapedIdentifier() : getIdentifier();\n\n        // There is no keyword or literal with only one character.\n        // Thus, it must be an identifier.\n        if (id.length === 1) {\n            type = Token.Identifier;\n        } else if (isKeyword(id)) {\n            type = Token.Keyword;\n        } else if (id === 'null') {\n            type = Token.NullLiteral;\n        } else if (id === 'true' || id === 'false') {\n            type = Token.BooleanLiteral;\n        } else {\n            type = Token.Identifier;\n        }\n\n        return {\n            type: type,\n            value: id,\n            lineNumber: lineNumber,\n            lineStart: lineStart,\n            start: start,\n            end: index\n        };\n    }\n\n\n    // 7.7 Punctuators\n\n    function scanPunctuator() {\n        var token, str;\n\n        token = {\n            type: Token.Punctuator,\n            value: '',\n            lineNumber: lineNumber,\n            lineStart: lineStart,\n            start: index,\n            end: index\n        };\n\n        // Check for most common single-character punctuators.\n        str = source[index];\n        switch (str) {\n\n        case '(':\n            if (extra.tokenize) {\n                extra.openParenToken = extra.tokens.length;\n            }\n            ++index;\n            break;\n\n        case '{':\n            if (extra.tokenize) {\n                extra.openCurlyToken = extra.tokens.length;\n            }\n            state.curlyStack.push('{');\n            ++index;\n            break;\n\n        case '.':\n            ++index;\n            if (source[index] === '.' && source[index + 1] === '.') {\n                // Spread operator: ...\n                index += 2;\n                str = '...';\n            }\n            break;\n\n        case '}':\n            ++index;\n            state.curlyStack.pop();\n            break;\n        case ')':\n        case ';':\n        case ',':\n        case '[':\n        case ']':\n        case ':':\n        case '?':\n        case '~':\n            ++index;\n            break;\n\n        default:\n            // 4-character punctuator.\n            str = source.substr(index, 4);\n            if (str === '>>>=') {\n                index += 4;\n            } else {\n\n                // 3-character punctuators.\n                str = str.substr(0, 3);\n                if (str === '===' || str === '!==' || str === '>>>' ||\n                    str === '<<=' || str === '>>=') {\n                    index += 3;\n                } else {\n\n                    // 2-character punctuators.\n                    str = str.substr(0, 2);\n                    if (str === '&&' || str === '||' || str === '==' || str === '!=' ||\n                        str === '+=' || str === '-=' || str === '*=' || str === '/=' ||\n                        str === '++' || str === '--' || str === '<<' || str === '>>' ||\n                        str === '&=' || str === '|=' || str === '^=' || str === '%=' ||\n                        str === '<=' || str === '>=' || str === '=>') {\n                        index += 2;\n                    } else {\n\n                        // 1-character punctuators.\n                        str = source[index];\n                        if ('<>=!+-*%&|^/'.indexOf(str) >= 0) {\n                            ++index;\n                        }\n                    }\n                }\n            }\n        }\n\n        if (index === token.start) {\n            throwUnexpectedToken();\n        }\n\n        token.end = index;\n        token.value = str;\n        return token;\n    }\n\n    // 7.8.3 Numeric Literals\n\n    function scanHexLiteral(start) {\n        var number = '';\n\n        while (index < length) {\n            if (!isHexDigit(source[index])) {\n                break;\n            }\n            number += source[index++];\n        }\n\n        if (number.length === 0) {\n            throwUnexpectedToken();\n        }\n\n        if (isIdentifierStart(source.charCodeAt(index))) {\n            throwUnexpectedToken();\n        }\n\n        return {\n            type: Token.NumericLiteral,\n            value: parseInt('0x' + number, 16),\n            lineNumber: lineNumber,\n            lineStart: lineStart,\n            start: start,\n            end: index\n        };\n    }\n\n    function scanBinaryLiteral(start) {\n        var ch, number;\n\n        number = '';\n\n        while (index < length) {\n            ch = source[index];\n            if (ch !== '0' && ch !== '1') {\n                break;\n            }\n            number += source[index++];\n        }\n\n        if (number.length === 0) {\n            // only 0b or 0B\n            throwUnexpectedToken();\n        }\n\n        if (index < length) {\n            ch = source.charCodeAt(index);\n            /* istanbul ignore else */\n            if (isIdentifierStart(ch) || isDecimalDigit(ch)) {\n                throwUnexpectedToken();\n            }\n        }\n\n        return {\n            type: Token.NumericLiteral,\n            value: parseInt(number, 2),\n            lineNumber: lineNumber,\n            lineStart: lineStart,\n            start: start,\n            end: index\n        };\n    }\n\n    function scanOctalLiteral(prefix, start) {\n        var number, octal;\n\n        if (isOctalDigit(prefix)) {\n            octal = true;\n            number = '0' + source[index++];\n        } else {\n            octal = false;\n            ++index;\n            number = '';\n        }\n\n        while (index < length) {\n            if (!isOctalDigit(source[index])) {\n                break;\n            }\n            number += source[index++];\n        }\n\n        if (!octal && number.length === 0) {\n            // only 0o or 0O\n            throwUnexpectedToken();\n        }\n\n        if (isIdentifierStart(source.charCodeAt(index)) || isDecimalDigit(source.charCodeAt(index))) {\n            throwUnexpectedToken();\n        }\n\n        return {\n            type: Token.NumericLiteral,\n            value: parseInt(number, 8),\n            octal: octal,\n            lineNumber: lineNumber,\n            lineStart: lineStart,\n            start: start,\n            end: index\n        };\n    }\n\n    function isImplicitOctalLiteral() {\n        var i, ch;\n\n        // Implicit octal, unless there is a non-octal digit.\n        // (Annex B.1.1 on Numeric Literals)\n        for (i = index + 1; i < length; ++i) {\n            ch = source[i];\n            if (ch === '8' || ch === '9') {\n                return false;\n            }\n            if (!isOctalDigit(ch)) {\n                return true;\n            }\n        }\n\n        return true;\n    }\n\n    function scanNumericLiteral() {\n        var number, start, ch;\n\n        ch = source[index];\n        assert(isDecimalDigit(ch.charCodeAt(0)) || (ch === '.'),\n            'Numeric literal must start with a decimal digit or a decimal point');\n\n        start = index;\n        number = '';\n        if (ch !== '.') {\n            number = source[index++];\n            ch = source[index];\n\n            // Hex number starts with '0x'.\n            // Octal number starts with '0'.\n            // Octal number in ES6 starts with '0o'.\n            // Binary number in ES6 starts with '0b'.\n            if (number === '0') {\n                if (ch === 'x' || ch === 'X') {\n                    ++index;\n                    return scanHexLiteral(start);\n                }\n                if (ch === 'b' || ch === 'B') {\n                    ++index;\n                    return scanBinaryLiteral(start);\n                }\n                if (ch === 'o' || ch === 'O') {\n                    return scanOctalLiteral(ch, start);\n                }\n\n                if (isOctalDigit(ch)) {\n                    if (isImplicitOctalLiteral()) {\n                        return scanOctalLiteral(ch, start);\n                    }\n                }\n            }\n\n            while (isDecimalDigit(source.charCodeAt(index))) {\n                number += source[index++];\n            }\n            ch = source[index];\n        }\n\n        if (ch === '.') {\n            number += source[index++];\n            while (isDecimalDigit(source.charCodeAt(index))) {\n                number += source[index++];\n            }\n            ch = source[index];\n        }\n\n        if (ch === 'e' || ch === 'E') {\n            number += source[index++];\n\n            ch = source[index];\n            if (ch === '+' || ch === '-') {\n                number += source[index++];\n            }\n            if (isDecimalDigit(source.charCodeAt(index))) {\n                while (isDecimalDigit(source.charCodeAt(index))) {\n                    number += source[index++];\n                }\n            } else {\n                throwUnexpectedToken();\n            }\n        }\n\n        if (isIdentifierStart(source.charCodeAt(index))) {\n            throwUnexpectedToken();\n        }\n\n        return {\n            type: Token.NumericLiteral,\n            value: parseFloat(number),\n            lineNumber: lineNumber,\n            lineStart: lineStart,\n            start: start,\n            end: index\n        };\n    }\n\n    // 7.8.4 String Literals\n\n    function scanStringLiteral() {\n        var str = '', quote, start, ch, unescaped, octToDec, octal = false;\n\n        quote = source[index];\n        assert((quote === '\\'' || quote === '\"'),\n            'String literal must starts with a quote');\n\n        start = index;\n        ++index;\n\n        while (index < length) {\n            ch = source[index++];\n\n            if (ch === quote) {\n                quote = '';\n                break;\n            } else if (ch === '\\\\') {\n                ch = source[index++];\n                if (!ch || !isLineTerminator(ch.charCodeAt(0))) {\n                    switch (ch) {\n                    case 'u':\n                    case 'x':\n                        if (source[index] === '{') {\n                            ++index;\n                            str += scanUnicodeCodePointEscape();\n                        } else {\n                            unescaped = scanHexEscape(ch);\n                            if (!unescaped) {\n                                throw throwUnexpectedToken();\n                            }\n                            str += unescaped;\n                        }\n                        break;\n                    case 'n':\n                        str += '\\n';\n                        break;\n                    case 'r':\n                        str += '\\r';\n                        break;\n                    case 't':\n                        str += '\\t';\n                        break;\n                    case 'b':\n                        str += '\\b';\n                        break;\n                    case 'f':\n                        str += '\\f';\n                        break;\n                    case 'v':\n                        str += '\\x0B';\n                        break;\n                    case '8':\n                    case '9':\n                        throw throwUnexpectedToken();\n\n                    default:\n                        if (isOctalDigit(ch)) {\n                            octToDec = octalToDecimal(ch);\n\n                            octal = octToDec.octal || octal;\n                            str += String.fromCharCode(octToDec.code);\n                        } else {\n                            str += ch;\n                        }\n                        break;\n                    }\n                } else {\n                    ++lineNumber;\n                    if (ch === '\\r' && source[index] === '\\n') {\n                        ++index;\n                    }\n                    lineStart = index;\n                }\n            } else if (isLineTerminator(ch.charCodeAt(0))) {\n                break;\n            } else {\n                str += ch;\n            }\n        }\n\n        if (quote !== '') {\n            throwUnexpectedToken();\n        }\n\n        return {\n            type: Token.StringLiteral,\n            value: str,\n            octal: octal,\n            lineNumber: startLineNumber,\n            lineStart: startLineStart,\n            start: start,\n            end: index\n        };\n    }\n\n    function scanTemplate() {\n        var cooked = '', ch, start, rawOffset, terminated, head, tail, restore, unescaped;\n\n        terminated = false;\n        tail = false;\n        start = index;\n        head = (source[index] === '`');\n        rawOffset = 2;\n\n        ++index;\n\n        while (index < length) {\n            ch = source[index++];\n            if (ch === '`') {\n                rawOffset = 1;\n                tail = true;\n                terminated = true;\n                break;\n            } else if (ch === '$') {\n                if (source[index] === '{') {\n                    state.curlyStack.push('${');\n                    ++index;\n                    terminated = true;\n                    break;\n                }\n                cooked += ch;\n            } else if (ch === '\\\\') {\n                ch = source[index++];\n                if (!isLineTerminator(ch.charCodeAt(0))) {\n                    switch (ch) {\n                    case 'n':\n                        cooked += '\\n';\n                        break;\n                    case 'r':\n                        cooked += '\\r';\n                        break;\n                    case 't':\n                        cooked += '\\t';\n                        break;\n                    case 'u':\n                    case 'x':\n                        if (source[index] === '{') {\n                            ++index;\n                            cooked += scanUnicodeCodePointEscape();\n                        } else {\n                            restore = index;\n                            unescaped = scanHexEscape(ch);\n                            if (unescaped) {\n                                cooked += unescaped;\n                            } else {\n                                index = restore;\n                                cooked += ch;\n                            }\n                        }\n                        break;\n                    case 'b':\n                        cooked += '\\b';\n                        break;\n                    case 'f':\n                        cooked += '\\f';\n                        break;\n                    case 'v':\n                        cooked += '\\v';\n                        break;\n\n                    default:\n                        if (ch === '0') {\n                            if (isDecimalDigit(source.charCodeAt(index))) {\n                                // Illegal: \\01 \\02 and so on\n                                throwError(Messages.TemplateOctalLiteral);\n                            }\n                            cooked += '\\0';\n                        } else if (isOctalDigit(ch)) {\n                            // Illegal: \\1 \\2\n                            throwError(Messages.TemplateOctalLiteral);\n                        } else {\n                            cooked += ch;\n                        }\n                        break;\n                    }\n                } else {\n                    ++lineNumber;\n                    if (ch === '\\r' && source[index] === '\\n') {\n                        ++index;\n                    }\n                    lineStart = index;\n                }\n            } else if (isLineTerminator(ch.charCodeAt(0))) {\n                ++lineNumber;\n                if (ch === '\\r' && source[index] === '\\n') {\n                    ++index;\n                }\n                lineStart = index;\n                cooked += '\\n';\n            } else {\n                cooked += ch;\n            }\n        }\n\n        if (!terminated) {\n            throwUnexpectedToken();\n        }\n\n        if (!head) {\n            state.curlyStack.pop();\n        }\n\n        return {\n            type: Token.Template,\n            value: {\n                cooked: cooked,\n                raw: source.slice(start + 1, index - rawOffset)\n            },\n            head: head,\n            tail: tail,\n            lineNumber: lineNumber,\n            lineStart: lineStart,\n            start: start,\n            end: index\n        };\n    }\n\n    function testRegExp(pattern, flags) {\n        // The BMP character to use as a replacement for astral symbols when\n        // translating an ES6 \"u\"-flagged pattern to an ES5-compatible\n        // approximation.\n        // Note: replacing with '\\uFFFF' enables false positives in unlikely\n        // scenarios. For example, `[\\u{1044f}-\\u{10440}]` is an invalid\n        // pattern that would not be detected by this substitution.\n        var astralSubstitute = '\\uFFFF',\n            tmp = pattern;\n\n        if (flags.indexOf('u') >= 0) {\n            tmp = tmp\n                // Replace every Unicode escape sequence with the equivalent\n                // BMP character or a constant ASCII code point in the case of\n                // astral symbols. (See the above note on `astralSubstitute`\n                // for more information.)\n                .replace(/\\\\u\\{([0-9a-fA-F]+)\\}|\\\\u([a-fA-F0-9]{4})/g, function ($0, $1, $2) {\n                    var codePoint = parseInt($1 || $2, 16);\n                    if (codePoint > 0x10FFFF) {\n                        throwUnexpectedToken(null, Messages.InvalidRegExp);\n                    }\n                    if (codePoint <= 0xFFFF) {\n                        return String.fromCharCode(codePoint);\n                    }\n                    return astralSubstitute;\n                })\n                // Replace each paired surrogate with a single ASCII symbol to\n                // avoid throwing on regular expressions that are only valid in\n                // combination with the \"u\" flag.\n                .replace(\n                    /[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g,\n                    astralSubstitute\n                );\n        }\n\n        // First, detect invalid regular expressions.\n        try {\n            RegExp(tmp);\n        } catch (e) {\n            throwUnexpectedToken(null, Messages.InvalidRegExp);\n        }\n\n        // Return a regular expression object for this pattern-flag pair, or\n        // `null` in case the current environment doesn't support the flags it\n        // uses.\n        try {\n            return new RegExp(pattern, flags);\n        } catch (exception) {\n            return null;\n        }\n    }\n\n    function scanRegExpBody() {\n        var ch, str, classMarker, terminated, body;\n\n        ch = source[index];\n        assert(ch === '/', 'Regular expression literal must start with a slash');\n        str = source[index++];\n\n        classMarker = false;\n        terminated = false;\n        while (index < length) {\n            ch = source[index++];\n            str += ch;\n            if (ch === '\\\\') {\n                ch = source[index++];\n                // ECMA-262 7.8.5\n                if (isLineTerminator(ch.charCodeAt(0))) {\n                    throwUnexpectedToken(null, Messages.UnterminatedRegExp);\n                }\n                str += ch;\n            } else if (isLineTerminator(ch.charCodeAt(0))) {\n                throwUnexpectedToken(null, Messages.UnterminatedRegExp);\n            } else if (classMarker) {\n                if (ch === ']') {\n                    classMarker = false;\n                }\n            } else {\n                if (ch === '/') {\n                    terminated = true;\n                    break;\n                } else if (ch === '[') {\n                    classMarker = true;\n                }\n            }\n        }\n\n        if (!terminated) {\n            throwUnexpectedToken(null, Messages.UnterminatedRegExp);\n        }\n\n        // Exclude leading and trailing slash.\n        body = str.substr(1, str.length - 2);\n        return {\n            value: body,\n            literal: str\n        };\n    }\n\n    function scanRegExpFlags() {\n        var ch, str, flags, restore;\n\n        str = '';\n        flags = '';\n        while (index < length) {\n            ch = source[index];\n            if (!isIdentifierPart(ch.charCodeAt(0))) {\n                break;\n            }\n\n            ++index;\n            if (ch === '\\\\' && index < length) {\n                ch = source[index];\n                if (ch === 'u') {\n                    ++index;\n                    restore = index;\n                    ch = scanHexEscape('u');\n                    if (ch) {\n                        flags += ch;\n                        for (str += '\\\\u'; restore < index; ++restore) {\n                            str += source[restore];\n                        }\n                    } else {\n                        index = restore;\n                        flags += 'u';\n                        str += '\\\\u';\n                    }\n                    tolerateUnexpectedToken();\n                } else {\n                    str += '\\\\';\n                    tolerateUnexpectedToken();\n                }\n            } else {\n                flags += ch;\n                str += ch;\n            }\n        }\n\n        return {\n            value: flags,\n            literal: str\n        };\n    }\n\n    function scanRegExp() {\n        scanning = true;\n        var start, body, flags, value;\n\n        lookahead = null;\n        skipComment();\n        start = index;\n\n        body = scanRegExpBody();\n        flags = scanRegExpFlags();\n        value = testRegExp(body.value, flags.value);\n        scanning = false;\n        if (extra.tokenize) {\n            return {\n                type: Token.RegularExpression,\n                value: value,\n                regex: {\n                    pattern: body.value,\n                    flags: flags.value\n                },\n                lineNumber: lineNumber,\n                lineStart: lineStart,\n                start: start,\n                end: index\n            };\n        }\n\n        return {\n            literal: body.literal + flags.literal,\n            value: value,\n            regex: {\n                pattern: body.value,\n                flags: flags.value\n            },\n            start: start,\n            end: index\n        };\n    }\n\n    function collectRegex() {\n        var pos, loc, regex, token;\n\n        skipComment();\n\n        pos = index;\n        loc = {\n            start: {\n                line: lineNumber,\n                column: index - lineStart\n            }\n        };\n\n        regex = scanRegExp();\n\n        loc.end = {\n            line: lineNumber,\n            column: index - lineStart\n        };\n\n        /* istanbul ignore next */\n        if (!extra.tokenize) {\n            // Pop the previous token, which is likely '/' or '/='\n            if (extra.tokens.length > 0) {\n                token = extra.tokens[extra.tokens.length - 1];\n                if (token.range[0] === pos && token.type === 'Punctuator') {\n                    if (token.value === '/' || token.value === '/=') {\n                        extra.tokens.pop();\n                    }\n                }\n            }\n\n            extra.tokens.push({\n                type: 'RegularExpression',\n                value: regex.literal,\n                regex: regex.regex,\n                range: [pos, index],\n                loc: loc\n            });\n        }\n\n        return regex;\n    }\n\n    function isIdentifierName(token) {\n        return token.type === Token.Identifier ||\n            token.type === Token.Keyword ||\n            token.type === Token.BooleanLiteral ||\n            token.type === Token.NullLiteral;\n    }\n\n    function advanceSlash() {\n        var prevToken,\n            checkToken;\n        // Using the following algorithm:\n        // https://github.com/mozilla/sweet.js/wiki/design\n        prevToken = extra.tokens[extra.tokens.length - 1];\n        if (!prevToken) {\n            // Nothing before that: it cannot be a division.\n            return collectRegex();\n        }\n        if (prevToken.type === 'Punctuator') {\n            if (prevToken.value === ']') {\n                return scanPunctuator();\n            }\n            if (prevToken.value === ')') {\n                checkToken = extra.tokens[extra.openParenToken - 1];\n                if (checkToken &&\n                        checkToken.type === 'Keyword' &&\n                        (checkToken.value === 'if' ||\n                         checkToken.value === 'while' ||\n                         checkToken.value === 'for' ||\n                         checkToken.value === 'with')) {\n                    return collectRegex();\n                }\n                return scanPunctuator();\n            }\n            if (prevToken.value === '}') {\n                // Dividing a function by anything makes little sense,\n                // but we have to check for that.\n                if (extra.tokens[extra.openCurlyToken - 3] &&\n                        extra.tokens[extra.openCurlyToken - 3].type === 'Keyword') {\n                    // Anonymous function.\n                    checkToken = extra.tokens[extra.openCurlyToken - 4];\n                    if (!checkToken) {\n                        return scanPunctuator();\n                    }\n                } else if (extra.tokens[extra.openCurlyToken - 4] &&\n                        extra.tokens[extra.openCurlyToken - 4].type === 'Keyword') {\n                    // Named function.\n                    checkToken = extra.tokens[extra.openCurlyToken - 5];\n                    if (!checkToken) {\n                        return collectRegex();\n                    }\n                } else {\n                    return scanPunctuator();\n                }\n                // checkToken determines whether the function is\n                // a declaration or an expression.\n                if (FnExprTokens.indexOf(checkToken.value) >= 0) {\n                    // It is an expression.\n                    return scanPunctuator();\n                }\n                // It is a declaration.\n                return collectRegex();\n            }\n            return collectRegex();\n        }\n        if (prevToken.type === 'Keyword' && prevToken.value !== 'this') {\n            return collectRegex();\n        }\n        return scanPunctuator();\n    }\n\n    function advance() {\n        var ch, token;\n\n        if (index >= length) {\n            return {\n                type: Token.EOF,\n                lineNumber: lineNumber,\n                lineStart: lineStart,\n                start: index,\n                end: index\n            };\n        }\n\n        ch = source.charCodeAt(index);\n\n        if (isIdentifierStart(ch)) {\n            token = scanIdentifier();\n            if (strict && isStrictModeReservedWord(token.value)) {\n                token.type = Token.Keyword;\n            }\n            return token;\n        }\n\n        // Very common: ( and ) and ;\n        if (ch === 0x28 || ch === 0x29 || ch === 0x3B) {\n            return scanPunctuator();\n        }\n\n        // String literal starts with single quote (U+0027) or double quote (U+0022).\n        if (ch === 0x27 || ch === 0x22) {\n            return scanStringLiteral();\n        }\n\n        // Dot (.) U+002E can also start a floating-point number, hence the need\n        // to check the next character.\n        if (ch === 0x2E) {\n            if (isDecimalDigit(source.charCodeAt(index + 1))) {\n                return scanNumericLiteral();\n            }\n            return scanPunctuator();\n        }\n\n        if (isDecimalDigit(ch)) {\n            return scanNumericLiteral();\n        }\n\n        // Slash (/) U+002F can also start a regex.\n        if (extra.tokenize && ch === 0x2F) {\n            return advanceSlash();\n        }\n\n        // Template literals start with ` (U+0060) for template head\n        // or } (U+007D) for template middle or template tail.\n        if (ch === 0x60 || (ch === 0x7D && state.curlyStack[state.curlyStack.length - 1] === '${')) {\n            return scanTemplate();\n        }\n\n        return scanPunctuator();\n    }\n\n    function collectToken() {\n        var loc, token, value, entry;\n\n        loc = {\n            start: {\n                line: lineNumber,\n                column: index - lineStart\n            }\n        };\n\n        token = advance();\n        loc.end = {\n            line: lineNumber,\n            column: index - lineStart\n        };\n\n        if (token.type !== Token.EOF) {\n            value = source.slice(token.start, token.end);\n            entry = {\n                type: TokenName[token.type],\n                value: value,\n                range: [token.start, token.end],\n                loc: loc\n            };\n            if (token.regex) {\n                entry.regex = {\n                    pattern: token.regex.pattern,\n                    flags: token.regex.flags\n                };\n            }\n            extra.tokens.push(entry);\n        }\n\n        return token;\n    }\n\n    function lex() {\n        var token;\n        scanning = true;\n\n        lastIndex = index;\n        lastLineNumber = lineNumber;\n        lastLineStart = lineStart;\n\n        skipComment();\n\n        token = lookahead;\n\n        startIndex = index;\n        startLineNumber = lineNumber;\n        startLineStart = lineStart;\n\n        lookahead = (typeof extra.tokens !== 'undefined') ? collectToken() : advance();\n        scanning = false;\n        return token;\n    }\n\n    function peek() {\n        scanning = true;\n\n        skipComment();\n\n        lastIndex = index;\n        lastLineNumber = lineNumber;\n        lastLineStart = lineStart;\n\n        startIndex = index;\n        startLineNumber = lineNumber;\n        startLineStart = lineStart;\n\n        lookahead = (typeof extra.tokens !== 'undefined') ? collectToken() : advance();\n        scanning = false;\n    }\n\n    function Position() {\n        this.line = startLineNumber;\n        this.column = startIndex - startLineStart;\n    }\n\n    function SourceLocation() {\n        this.start = new Position();\n        this.end = null;\n    }\n\n    function WrappingSourceLocation(startToken) {\n        this.start = {\n            line: startToken.lineNumber,\n            column: startToken.start - startToken.lineStart\n        };\n        this.end = null;\n    }\n\n    function Node() {\n        if (extra.range) {\n            this.range = [startIndex, 0];\n        }\n        if (extra.loc) {\n            this.loc = new SourceLocation();\n        }\n    }\n\n    function WrappingNode(startToken) {\n        if (extra.range) {\n            this.range = [startToken.start, 0];\n        }\n        if (extra.loc) {\n            this.loc = new WrappingSourceLocation(startToken);\n        }\n    }\n\n    WrappingNode.prototype = Node.prototype = {\n\n        processComment: function () {\n            var lastChild,\n                leadingComments,\n                trailingComments,\n                bottomRight = extra.bottomRightStack,\n                i,\n                comment,\n                last = bottomRight[bottomRight.length - 1];\n\n            if (this.type === Syntax.Program) {\n                if (this.body.length > 0) {\n                    return;\n                }\n            }\n\n            if (extra.trailingComments.length > 0) {\n                trailingComments = [];\n                for (i = extra.trailingComments.length - 1; i >= 0; --i) {\n                    comment = extra.trailingComments[i];\n                    if (comment.range[0] >= this.range[1]) {\n                        trailingComments.unshift(comment);\n                        extra.trailingComments.splice(i, 1);\n                    }\n                }\n                extra.trailingComments = [];\n            } else {\n                if (last && last.trailingComments && last.trailingComments[0].range[0] >= this.range[1]) {\n                    trailingComments = last.trailingComments;\n                    delete last.trailingComments;\n                }\n            }\n\n            // Eating the stack.\n            while (last && last.range[0] >= this.range[0]) {\n                lastChild = bottomRight.pop();\n                last = bottomRight[bottomRight.length - 1];\n            }\n\n            if (lastChild) {\n                if (lastChild.leadingComments) {\n                    leadingComments = [];\n                    for (i = lastChild.leadingComments.length - 1; i >= 0; --i) {\n                        comment = lastChild.leadingComments[i];\n                        if (comment.range[1] <= this.range[0]) {\n                            leadingComments.unshift(comment);\n                            lastChild.leadingComments.splice(i, 1);\n                        }\n                    }\n\n                    if (!lastChild.leadingComments.length) {\n                        lastChild.leadingComments = undefined;\n                    }\n                }\n            } else if (extra.leadingComments.length > 0) {\n                leadingComments = [];\n                for (i = extra.leadingComments.length - 1; i >= 0; --i) {\n                    comment = extra.leadingComments[i];\n                    if (comment.range[1] <= this.range[0]) {\n                        leadingComments.unshift(comment);\n                        extra.leadingComments.splice(i, 1);\n                    }\n                }\n            }\n\n\n            if (leadingComments && leadingComments.length > 0) {\n                this.leadingComments = leadingComments;\n            }\n            if (trailingComments && trailingComments.length > 0) {\n                this.trailingComments = trailingComments;\n            }\n\n            bottomRight.push(this);\n        },\n\n        finish: function () {\n            if (extra.range) {\n                this.range[1] = lastIndex;\n            }\n            if (extra.loc) {\n                this.loc.end = {\n                    line: lastLineNumber,\n                    column: lastIndex - lastLineStart\n                };\n                if (extra.source) {\n                    this.loc.source = extra.source;\n                }\n            }\n\n            if (extra.attachComment) {\n                this.processComment();\n            }\n        },\n\n        finishArrayExpression: function (elements) {\n            this.type = Syntax.ArrayExpression;\n            this.elements = elements;\n            this.finish();\n            return this;\n        },\n\n        finishArrayPattern: function (elements) {\n            this.type = Syntax.ArrayPattern;\n            this.elements = elements;\n            this.finish();\n            return this;\n        },\n\n        finishArrowFunctionExpression: function (params, defaults, body, expression) {\n            this.type = Syntax.ArrowFunctionExpression;\n            this.id = null;\n            this.params = params;\n            this.defaults = defaults;\n            this.body = body;\n            this.generator = false;\n            this.expression = expression;\n            this.finish();\n            return this;\n        },\n\n        finishAssignmentExpression: function (operator, left, right) {\n            this.type = Syntax.AssignmentExpression;\n            this.operator = operator;\n            this.left = left;\n            this.right = right;\n            this.finish();\n            return this;\n        },\n\n        finishAssignmentPattern: function (left, right) {\n            this.type = Syntax.AssignmentPattern;\n            this.left = left;\n            this.right = right;\n            this.finish();\n            return this;\n        },\n\n        finishBinaryExpression: function (operator, left, right) {\n            this.type = (operator === '||' || operator === '&&') ? Syntax.LogicalExpression : Syntax.BinaryExpression;\n            this.operator = operator;\n            this.left = left;\n            this.right = right;\n            this.finish();\n            return this;\n        },\n\n        finishBlockStatement: function (body) {\n            this.type = Syntax.BlockStatement;\n            this.body = body;\n            this.finish();\n            return this;\n        },\n\n        finishBreakStatement: function (label) {\n            this.type = Syntax.BreakStatement;\n            this.label = label;\n            this.finish();\n            return this;\n        },\n\n        finishCallExpression: function (callee, args) {\n            this.type = Syntax.CallExpression;\n            this.callee = callee;\n            this.arguments = args;\n            this.finish();\n            return this;\n        },\n\n        finishCatchClause: function (param, body) {\n            this.type = Syntax.CatchClause;\n            this.param = param;\n            this.body = body;\n            this.finish();\n            return this;\n        },\n\n        finishClassBody: function (body) {\n            this.type = Syntax.ClassBody;\n            this.body = body;\n            this.finish();\n            return this;\n        },\n\n        finishClassDeclaration: function (id, superClass, body) {\n            this.type = Syntax.ClassDeclaration;\n            this.id = id;\n            this.superClass = superClass;\n            this.body = body;\n            this.finish();\n            return this;\n        },\n\n        finishClassExpression: function (id, superClass, body) {\n            this.type = Syntax.ClassExpression;\n            this.id = id;\n            this.superClass = superClass;\n            this.body = body;\n            this.finish();\n            return this;\n        },\n\n        finishConditionalExpression: function (test, consequent, alternate) {\n            this.type = Syntax.ConditionalExpression;\n            this.test = test;\n            this.consequent = consequent;\n            this.alternate = alternate;\n            this.finish();\n            return this;\n        },\n\n        finishContinueStatement: function (label) {\n            this.type = Syntax.ContinueStatement;\n            this.label = label;\n            this.finish();\n            return this;\n        },\n\n        finishDebuggerStatement: function () {\n            this.type = Syntax.DebuggerStatement;\n            this.finish();\n            return this;\n        },\n\n        finishDoWhileStatement: function (body, test) {\n            this.type = Syntax.DoWhileStatement;\n            this.body = body;\n            this.test = test;\n            this.finish();\n            return this;\n        },\n\n        finishEmptyStatement: function () {\n            this.type = Syntax.EmptyStatement;\n            this.finish();\n            return this;\n        },\n\n        finishExpressionStatement: function (expression) {\n            this.type = Syntax.ExpressionStatement;\n            this.expression = expression;\n            this.finish();\n            return this;\n        },\n\n        finishForStatement: function (init, test, update, body) {\n            this.type = Syntax.ForStatement;\n            this.init = init;\n            this.test = test;\n            this.update = update;\n            this.body = body;\n            this.finish();\n            return this;\n        },\n\n        finishForOfStatement: function (left, right, body) {\n            this.type = Syntax.ForOfStatement;\n            this.left = left;\n            this.right = right;\n            this.body = body;\n            this.finish();\n            return this;\n        },\n\n        finishForInStatement: function (left, right, body) {\n            this.type = Syntax.ForInStatement;\n            this.left = left;\n            this.right = right;\n            this.body = body;\n            this.each = false;\n            this.finish();\n            return this;\n        },\n\n        finishFunctionDeclaration: function (id, params, defaults, body, generator) {\n            this.type = Syntax.FunctionDeclaration;\n            this.id = id;\n            this.params = params;\n            this.defaults = defaults;\n            this.body = body;\n            this.generator = generator;\n            this.expression = false;\n            this.finish();\n            return this;\n        },\n\n        finishFunctionExpression: function (id, params, defaults, body, generator) {\n            this.type = Syntax.FunctionExpression;\n            this.id = id;\n            this.params = params;\n            this.defaults = defaults;\n            this.body = body;\n            this.generator = generator;\n            this.expression = false;\n            this.finish();\n            return this;\n        },\n\n        finishIdentifier: function (name) {\n            this.type = Syntax.Identifier;\n            this.name = name;\n            this.finish();\n            return this;\n        },\n\n        finishIfStatement: function (test, consequent, alternate) {\n            this.type = Syntax.IfStatement;\n            this.test = test;\n            this.consequent = consequent;\n            this.alternate = alternate;\n            this.finish();\n            return this;\n        },\n\n        finishLabeledStatement: function (label, body) {\n            this.type = Syntax.LabeledStatement;\n            this.label = label;\n            this.body = body;\n            this.finish();\n            return this;\n        },\n\n        finishLiteral: function (token) {\n            this.type = Syntax.Literal;\n            this.value = token.value;\n            this.raw = source.slice(token.start, token.end);\n            if (token.regex) {\n                this.regex = token.regex;\n            }\n            this.finish();\n            return this;\n        },\n\n        finishMemberExpression: function (accessor, object, property) {\n            this.type = Syntax.MemberExpression;\n            this.computed = accessor === '[';\n            this.object = object;\n            this.property = property;\n            this.finish();\n            return this;\n        },\n\n        finishNewExpression: function (callee, args) {\n            this.type = Syntax.NewExpression;\n            this.callee = callee;\n            this.arguments = args;\n            this.finish();\n            return this;\n        },\n\n        finishObjectExpression: function (properties) {\n            this.type = Syntax.ObjectExpression;\n            this.properties = properties;\n            this.finish();\n            return this;\n        },\n\n        finishObjectPattern: function (properties) {\n            this.type = Syntax.ObjectPattern;\n            this.properties = properties;\n            this.finish();\n            return this;\n        },\n\n        finishPostfixExpression: function (operator, argument) {\n            this.type = Syntax.UpdateExpression;\n            this.operator = operator;\n            this.argument = argument;\n            this.prefix = false;\n            this.finish();\n            return this;\n        },\n\n        finishProgram: function (body) {\n            this.type = Syntax.Program;\n            this.body = body;\n            if (sourceType === 'module') {\n                // very restrictive for now\n                this.sourceType = sourceType;\n            }\n            this.finish();\n            return this;\n        },\n\n        finishProperty: function (kind, key, computed, value, method, shorthand) {\n            this.type = Syntax.Property;\n            this.key = key;\n            this.computed = computed;\n            this.value = value;\n            this.kind = kind;\n            this.method = method;\n            this.shorthand = shorthand;\n            this.finish();\n            return this;\n        },\n\n        finishRestElement: function (argument) {\n            this.type = Syntax.RestElement;\n            this.argument = argument;\n            this.finish();\n            return this;\n        },\n\n        finishReturnStatement: function (argument) {\n            this.type = Syntax.ReturnStatement;\n            this.argument = argument;\n            this.finish();\n            return this;\n        },\n\n        finishSequenceExpression: function (expressions) {\n            this.type = Syntax.SequenceExpression;\n            this.expressions = expressions;\n            this.finish();\n            return this;\n        },\n\n        finishSpreadElement: function (argument) {\n            this.type = Syntax.SpreadElement;\n            this.argument = argument;\n            this.finish();\n            return this;\n        },\n\n        finishSwitchCase: function (test, consequent) {\n            this.type = Syntax.SwitchCase;\n            this.test = test;\n            this.consequent = consequent;\n            this.finish();\n            return this;\n        },\n\n        finishSuper: function () {\n            this.type = Syntax.Super;\n            this.finish();\n            return this;\n        },\n\n        finishSwitchStatement: function (discriminant, cases) {\n            this.type = Syntax.SwitchStatement;\n            this.discriminant = discriminant;\n            this.cases = cases;\n            this.finish();\n            return this;\n        },\n\n        finishTaggedTemplateExpression: function (tag, quasi) {\n            this.type = Syntax.TaggedTemplateExpression;\n            this.tag = tag;\n            this.quasi = quasi;\n            this.finish();\n            return this;\n        },\n\n        finishTemplateElement: function (value, tail) {\n            this.type = Syntax.TemplateElement;\n            this.value = value;\n            this.tail = tail;\n            this.finish();\n            return this;\n        },\n\n        finishTemplateLiteral: function (quasis, expressions) {\n            this.type = Syntax.TemplateLiteral;\n            this.quasis = quasis;\n            this.expressions = expressions;\n            this.finish();\n            return this;\n        },\n\n        finishThisExpression: function () {\n            this.type = Syntax.ThisExpression;\n            this.finish();\n            return this;\n        },\n\n        finishThrowStatement: function (argument) {\n            this.type = Syntax.ThrowStatement;\n            this.argument = argument;\n            this.finish();\n            return this;\n        },\n\n        finishTryStatement: function (block, handler, finalizer) {\n            this.type = Syntax.TryStatement;\n            this.block = block;\n            this.guardedHandlers = [];\n            this.handlers = handler ? [ handler ] : [];\n            this.handler = handler;\n            this.finalizer = finalizer;\n            this.finish();\n            return this;\n        },\n\n        finishUnaryExpression: function (operator, argument) {\n            this.type = (operator === '++' || operator === '--') ? Syntax.UpdateExpression : Syntax.UnaryExpression;\n            this.operator = operator;\n            this.argument = argument;\n            this.prefix = true;\n            this.finish();\n            return this;\n        },\n\n        finishVariableDeclaration: function (declarations) {\n            this.type = Syntax.VariableDeclaration;\n            this.declarations = declarations;\n            this.kind = 'var';\n            this.finish();\n            return this;\n        },\n\n        finishLexicalDeclaration: function (declarations, kind) {\n            this.type = Syntax.VariableDeclaration;\n            this.declarations = declarations;\n            this.kind = kind;\n            this.finish();\n            return this;\n        },\n\n        finishVariableDeclarator: function (id, init) {\n            this.type = Syntax.VariableDeclarator;\n            this.id = id;\n            this.init = init;\n            this.finish();\n            return this;\n        },\n\n        finishWhileStatement: function (test, body) {\n            this.type = Syntax.WhileStatement;\n            this.test = test;\n            this.body = body;\n            this.finish();\n            return this;\n        },\n\n        finishWithStatement: function (object, body) {\n            this.type = Syntax.WithStatement;\n            this.object = object;\n            this.body = body;\n            this.finish();\n            return this;\n        },\n\n        finishExportSpecifier: function (local, exported) {\n            this.type = Syntax.ExportSpecifier;\n            this.exported = exported || local;\n            this.local = local;\n            this.finish();\n            return this;\n        },\n\n        finishImportDefaultSpecifier: function (local) {\n            this.type = Syntax.ImportDefaultSpecifier;\n            this.local = local;\n            this.finish();\n            return this;\n        },\n\n        finishImportNamespaceSpecifier: function (local) {\n            this.type = Syntax.ImportNamespaceSpecifier;\n            this.local = local;\n            this.finish();\n            return this;\n        },\n\n        finishExportNamedDeclaration: function (declaration, specifiers, src) {\n            this.type = Syntax.ExportNamedDeclaration;\n            this.declaration = declaration;\n            this.specifiers = specifiers;\n            this.source = src;\n            this.finish();\n            return this;\n        },\n\n        finishExportDefaultDeclaration: function (declaration) {\n            this.type = Syntax.ExportDefaultDeclaration;\n            this.declaration = declaration;\n            this.finish();\n            return this;\n        },\n\n        finishExportAllDeclaration: function (src) {\n            this.type = Syntax.ExportAllDeclaration;\n            this.source = src;\n            this.finish();\n            return this;\n        },\n\n        finishImportSpecifier: function (local, imported) {\n            this.type = Syntax.ImportSpecifier;\n            this.local = local || imported;\n            this.imported = imported;\n            this.finish();\n            return this;\n        },\n\n        finishImportDeclaration: function (specifiers, src) {\n            this.type = Syntax.ImportDeclaration;\n            this.specifiers = specifiers;\n            this.source = src;\n            this.finish();\n            return this;\n        },\n\n        finishYieldExpression: function (argument, delegate) {\n            this.type = Syntax.YieldExpression;\n            this.argument = argument;\n            this.delegate = delegate;\n            this.finish();\n            return this;\n        }\n    };\n\n\n    function recordError(error) {\n        var e, existing;\n\n        for (e = 0; e < extra.errors.length; e++) {\n            existing = extra.errors[e];\n            // Prevent duplicated error.\n            /* istanbul ignore next */\n            if (existing.index === error.index && existing.message === error.message) {\n                return;\n            }\n        }\n\n        extra.errors.push(error);\n    }\n\n    function createError(line, pos, description) {\n        var error = new Error('Line ' + line + ': ' + description);\n        error.index = pos;\n        error.lineNumber = line;\n        error.column = pos - (scanning ? lineStart : lastLineStart) + 1;\n        error.description = description;\n        return error;\n    }\n\n    // Throw an exception\n\n    function throwError(messageFormat) {\n        var args, msg;\n\n        args = Array.prototype.slice.call(arguments, 1);\n        msg = messageFormat.replace(/%(\\d)/g,\n            function (whole, idx) {\n                assert(idx < args.length, 'Message reference must be in range');\n                return args[idx];\n            }\n        );\n\n        throw createError(lastLineNumber, lastIndex, msg);\n    }\n\n    function tolerateError(messageFormat) {\n        var args, msg, error;\n\n        args = Array.prototype.slice.call(arguments, 1);\n        /* istanbul ignore next */\n        msg = messageFormat.replace(/%(\\d)/g,\n            function (whole, idx) {\n                assert(idx < args.length, 'Message reference must be in range');\n                return args[idx];\n            }\n        );\n\n        error = createError(lineNumber, lastIndex, msg);\n        if (extra.errors) {\n            recordError(error);\n        } else {\n            throw error;\n        }\n    }\n\n    // Throw an exception because of the token.\n\n    function unexpectedTokenError(token, message) {\n        var value, msg = message || Messages.UnexpectedToken;\n\n        if (token) {\n            if (!message) {\n                msg = (token.type === Token.EOF) ? Messages.UnexpectedEOS :\n                    (token.type === Token.Identifier) ? Messages.UnexpectedIdentifier :\n                    (token.type === Token.NumericLiteral) ? Messages.UnexpectedNumber :\n                    (token.type === Token.StringLiteral) ? Messages.UnexpectedString :\n                    (token.type === Token.Template) ? Messages.UnexpectedTemplate :\n                    Messages.UnexpectedToken;\n\n                if (token.type === Token.Keyword) {\n                    if (isFutureReservedWord(token.value)) {\n                        msg = Messages.UnexpectedReserved;\n                    } else if (strict && isStrictModeReservedWord(token.value)) {\n                        msg = Messages.StrictReservedWord;\n                    }\n                }\n            }\n\n            value = (token.type === Token.Template) ? token.value.raw : token.value;\n        } else {\n            value = 'ILLEGAL';\n        }\n\n        msg = msg.replace('%0', value);\n\n        return (token && typeof token.lineNumber === 'number') ?\n            createError(token.lineNumber, token.start, msg) :\n            createError(scanning ? lineNumber : lastLineNumber, scanning ? index : lastIndex, msg);\n    }\n\n    function throwUnexpectedToken(token, message) {\n        throw unexpectedTokenError(token, message);\n    }\n\n    function tolerateUnexpectedToken(token, message) {\n        var error = unexpectedTokenError(token, message);\n        if (extra.errors) {\n            recordError(error);\n        } else {\n            throw error;\n        }\n    }\n\n    // Expect the next token to match the specified punctuator.\n    // If not, an exception will be thrown.\n\n    function expect(value) {\n        var token = lex();\n        if (token.type !== Token.Punctuator || token.value !== value) {\n            throwUnexpectedToken(token);\n        }\n    }\n\n    /**\n     * @name expectCommaSeparator\n     * @description Quietly expect a comma when in tolerant mode, otherwise delegates\n     * to <code>expect(value)</code>\n     * @since 2.0\n     */\n    function expectCommaSeparator() {\n        var token;\n\n        if (extra.errors) {\n            token = lookahead;\n            if (token.type === Token.Punctuator && token.value === ',') {\n                lex();\n            } else if (token.type === Token.Punctuator && token.value === ';') {\n                lex();\n                tolerateUnexpectedToken(token);\n            } else {\n                tolerateUnexpectedToken(token, Messages.UnexpectedToken);\n            }\n        } else {\n            expect(',');\n        }\n    }\n\n    // Expect the next token to match the specified keyword.\n    // If not, an exception will be thrown.\n\n    function expectKeyword(keyword) {\n        var token = lex();\n        if (token.type !== Token.Keyword || token.value !== keyword) {\n            throwUnexpectedToken(token);\n        }\n    }\n\n    // Return true if the next token matches the specified punctuator.\n\n    function match(value) {\n        return lookahead.type === Token.Punctuator && lookahead.value === value;\n    }\n\n    // Return true if the next token matches the specified keyword\n\n    function matchKeyword(keyword) {\n        return lookahead.type === Token.Keyword && lookahead.value === keyword;\n    }\n\n    // Return true if the next token matches the specified contextual keyword\n    // (where an identifier is sometimes a keyword depending on the context)\n\n    function matchContextualKeyword(keyword) {\n        return lookahead.type === Token.Identifier && lookahead.value === keyword;\n    }\n\n    // Return true if the next token is an assignment operator\n\n    function matchAssign() {\n        var op;\n\n        if (lookahead.type !== Token.Punctuator) {\n            return false;\n        }\n        op = lookahead.value;\n        return op === '=' ||\n            op === '*=' ||\n            op === '/=' ||\n            op === '%=' ||\n            op === '+=' ||\n            op === '-=' ||\n            op === '<<=' ||\n            op === '>>=' ||\n            op === '>>>=' ||\n            op === '&=' ||\n            op === '^=' ||\n            op === '|=';\n    }\n\n    function consumeSemicolon() {\n        // Catch the very common case first: immediately a semicolon (U+003B).\n        if (source.charCodeAt(startIndex) === 0x3B || match(';')) {\n            lex();\n            return;\n        }\n\n        if (hasLineTerminator) {\n            return;\n        }\n\n        // FIXME(ikarienator): this is seemingly an issue in the previous location info convention.\n        lastIndex = startIndex;\n        lastLineNumber = startLineNumber;\n        lastLineStart = startLineStart;\n\n        if (lookahead.type !== Token.EOF && !match('}')) {\n            throwUnexpectedToken(lookahead);\n        }\n    }\n\n    // Cover grammar support.\n    //\n    // When an assignment expression position starts with an left parenthesis, the determination of the type\n    // of the syntax is to be deferred arbitrarily long until the end of the parentheses pair (plus a lookahead)\n    // or the first comma. This situation also defers the determination of all the expressions nested in the pair.\n    //\n    // There are three productions that can be parsed in a parentheses pair that needs to be determined\n    // after the outermost pair is closed. They are:\n    //\n    //   1. AssignmentExpression\n    //   2. BindingElements\n    //   3. AssignmentTargets\n    //\n    // In order to avoid exponential backtracking, we use two flags to denote if the production can be\n    // binding element or assignment target.\n    //\n    // The three productions have the relationship:\n    //\n    //   BindingElements  AssignmentTargets  AssignmentExpression\n    //\n    // with a single exception that CoverInitializedName when used directly in an Expression, generates\n    // an early error. Therefore, we need the third state, firstCoverInitializedNameError, to track the\n    // first usage of CoverInitializedName and report it when we reached the end of the parentheses pair.\n    //\n    // isolateCoverGrammar function runs the given parser function with a new cover grammar context, and it does not\n    // effect the current flags. This means the production the parser parses is only used as an expression. Therefore\n    // the CoverInitializedName check is conducted.\n    //\n    // inheritCoverGrammar function runs the given parse function with a new cover grammar context, and it propagates\n    // the flags outside of the parser. This means the production the parser parses is used as a part of a potential\n    // pattern. The CoverInitializedName check is deferred.\n    function isolateCoverGrammar(parser) {\n        var oldIsBindingElement = isBindingElement,\n            oldIsAssignmentTarget = isAssignmentTarget,\n            oldFirstCoverInitializedNameError = firstCoverInitializedNameError,\n            result;\n        isBindingElement = true;\n        isAssignmentTarget = true;\n        firstCoverInitializedNameError = null;\n        result = parser();\n        if (firstCoverInitializedNameError !== null) {\n            throwUnexpectedToken(firstCoverInitializedNameError);\n        }\n        isBindingElement = oldIsBindingElement;\n        isAssignmentTarget = oldIsAssignmentTarget;\n        firstCoverInitializedNameError = oldFirstCoverInitializedNameError;\n        return result;\n    }\n\n    function inheritCoverGrammar(parser) {\n        var oldIsBindingElement = isBindingElement,\n            oldIsAssignmentTarget = isAssignmentTarget,\n            oldFirstCoverInitializedNameError = firstCoverInitializedNameError,\n            result;\n        isBindingElement = true;\n        isAssignmentTarget = true;\n        firstCoverInitializedNameError = null;\n        result = parser();\n        isBindingElement = isBindingElement && oldIsBindingElement;\n        isAssignmentTarget = isAssignmentTarget && oldIsAssignmentTarget;\n        firstCoverInitializedNameError = oldFirstCoverInitializedNameError || firstCoverInitializedNameError;\n        return result;\n    }\n\n    function parseArrayPattern(params) {\n        var node = new Node(), elements = [], rest, restNode;\n        expect('[');\n\n        while (!match(']')) {\n            if (match(',')) {\n                lex();\n                elements.push(null);\n            } else {\n                if (match('...')) {\n                    restNode = new Node();\n                    lex();\n                    params.push(lookahead);\n                    rest = parseVariableIdentifier(params);\n                    elements.push(restNode.finishRestElement(rest));\n                    break;\n                } else {\n                    elements.push(parsePatternWithDefault(params));\n                }\n                if (!match(']')) {\n                    expect(',');\n                }\n            }\n\n        }\n\n        expect(']');\n\n        return node.finishArrayPattern(elements);\n    }\n\n    function parsePropertyPattern(params) {\n        var node = new Node(), key, keyToken, computed = match('['), init;\n        if (lookahead.type === Token.Identifier) {\n            keyToken = lookahead;\n            key = parseVariableIdentifier();\n            if (match('=')) {\n                params.push(keyToken);\n                lex();\n                init = parseAssignmentExpression();\n\n                return node.finishProperty(\n                    'init', key, false,\n                    new WrappingNode(keyToken).finishAssignmentPattern(key, init), false, false);\n            } else if (!match(':')) {\n                params.push(keyToken);\n                return node.finishProperty('init', key, false, key, false, true);\n            }\n        } else {\n            key = parseObjectPropertyKey(params);\n        }\n        expect(':');\n        init = parsePatternWithDefault(params);\n        return node.finishProperty('init', key, computed, init, false, false);\n    }\n\n    function parseObjectPattern(params) {\n        var node = new Node(), properties = [];\n\n        expect('{');\n\n        while (!match('}')) {\n            properties.push(parsePropertyPattern(params));\n            if (!match('}')) {\n                expect(',');\n            }\n        }\n\n        lex();\n\n        return node.finishObjectPattern(properties);\n    }\n\n    function parsePattern(params) {\n        var identifier;\n        if (lookahead.type === Token.Identifier) {\n            params.push(lookahead);\n            identifier = parseVariableIdentifier();\n            return identifier;\n        } else if (match('[')) {\n            return parseArrayPattern(params);\n        } else if (match('{')) {\n            return parseObjectPattern(params);\n        }\n        throwUnexpectedToken(lookahead);\n    }\n\n    function parsePatternWithDefault(params) {\n        var startToken = lookahead, pattern, right;\n        pattern = parsePattern(params);\n        if (match('=')) {\n            lex();\n            right = isolateCoverGrammar(parseAssignmentExpression);\n            pattern = new WrappingNode(startToken).finishAssignmentPattern(pattern, right);\n        }\n        return pattern;\n    }\n\n    // 11.1.4 Array Initialiser\n\n    function parseArrayInitialiser() {\n        var elements = [], node = new Node(), restSpread;\n\n        expect('[');\n\n        while (!match(']')) {\n            if (match(',')) {\n                lex();\n                elements.push(null);\n            } else if (match('...')) {\n                restSpread = new Node();\n                lex();\n                restSpread.finishSpreadElement(inheritCoverGrammar(parseAssignmentExpression));\n\n                if (!match(']')) {\n                    isAssignmentTarget = isBindingElement = false;\n                    expect(',');\n                }\n                elements.push(restSpread);\n            } else {\n                elements.push(inheritCoverGrammar(parseAssignmentExpression));\n\n                if (!match(']')) {\n                    expect(',');\n                }\n            }\n        }\n\n        lex();\n\n        return node.finishArrayExpression(elements);\n    }\n\n    // 11.1.5 Object Initialiser\n\n    function parsePropertyFunction(node, paramInfo, isGenerator) {\n        var previousStrict, body;\n\n        isAssignmentTarget = isBindingElement = false;\n\n        previousStrict = strict;\n        body = isolateCoverGrammar(parseFunctionSourceElements);\n\n        if (strict && paramInfo.firstRestricted) {\n            tolerateUnexpectedToken(paramInfo.firstRestricted, paramInfo.message);\n        }\n        if (strict && paramInfo.stricted) {\n            tolerateUnexpectedToken(paramInfo.stricted, paramInfo.message);\n        }\n\n        strict = previousStrict;\n        return node.finishFunctionExpression(null, paramInfo.params, paramInfo.defaults, body, isGenerator);\n    }\n\n    function parsePropertyMethodFunction() {\n        var params, method, node = new Node(),\n            previousAllowYield = state.allowYield;\n\n        state.allowYield = false;\n        params = parseParams();\n        state.allowYield = previousAllowYield;\n\n        state.allowYield = false;\n        method = parsePropertyFunction(node, params, false);\n        state.allowYield = previousAllowYield;\n\n        return method;\n    }\n\n    function parseObjectPropertyKey() {\n        var token, node = new Node(), expr;\n\n        token = lex();\n\n        // Note: This function is called only from parseObjectProperty(), where\n        // EOF and Punctuator tokens are already filtered out.\n\n        switch (token.type) {\n        case Token.StringLiteral:\n        case Token.NumericLiteral:\n            if (strict && token.octal) {\n                tolerateUnexpectedToken(token, Messages.StrictOctalLiteral);\n            }\n            return node.finishLiteral(token);\n        case Token.Identifier:\n        case Token.BooleanLiteral:\n        case Token.NullLiteral:\n        case Token.Keyword:\n            return node.finishIdentifier(token.value);\n        case Token.Punctuator:\n            if (token.value === '[') {\n                expr = isolateCoverGrammar(parseAssignmentExpression);\n                expect(']');\n                return expr;\n            }\n            break;\n        }\n        throwUnexpectedToken(token);\n    }\n\n    function lookaheadPropertyName() {\n        switch (lookahead.type) {\n        case Token.Identifier:\n        case Token.StringLiteral:\n        case Token.BooleanLiteral:\n        case Token.NullLiteral:\n        case Token.NumericLiteral:\n        case Token.Keyword:\n            return true;\n        case Token.Punctuator:\n            return lookahead.value === '[';\n        }\n        return false;\n    }\n\n    // This function is to try to parse a MethodDefinition as defined in 14.3. But in the case of object literals,\n    // it might be called at a position where there is in fact a short hand identifier pattern or a data property.\n    // This can only be determined after we consumed up to the left parentheses.\n    //\n    // In order to avoid back tracking, it returns `null` if the position is not a MethodDefinition and the caller\n    // is responsible to visit other options.\n    function tryParseMethodDefinition(token, key, computed, node) {\n        var value, options, methodNode, params,\n            previousAllowYield = state.allowYield;\n\n        if (token.type === Token.Identifier) {\n            // check for `get` and `set`;\n\n            if (token.value === 'get' && lookaheadPropertyName()) {\n                computed = match('[');\n                key = parseObjectPropertyKey();\n                methodNode = new Node();\n                expect('(');\n                expect(')');\n\n                state.allowYield = false;\n                value = parsePropertyFunction(methodNode, {\n                    params: [],\n                    defaults: [],\n                    stricted: null,\n                    firstRestricted: null,\n                    message: null\n                }, false);\n                state.allowYield = previousAllowYield;\n\n                return node.finishProperty('get', key, computed, value, false, false);\n            } else if (token.value === 'set' && lookaheadPropertyName()) {\n                computed = match('[');\n                key = parseObjectPropertyKey();\n                methodNode = new Node();\n                expect('(');\n\n                options = {\n                    params: [],\n                    defaultCount: 0,\n                    defaults: [],\n                    firstRestricted: null,\n                    paramSet: {}\n                };\n                if (match(')')) {\n                    tolerateUnexpectedToken(lookahead);\n                } else {\n                    state.allowYield = false;\n                    parseParam(options);\n                    state.allowYield = previousAllowYield;\n                    if (options.defaultCount === 0) {\n                        options.defaults = [];\n                    }\n                }\n                expect(')');\n\n                state.allowYield = false;\n                value = parsePropertyFunction(methodNode, options, false);\n                state.allowYield = previousAllowYield;\n\n                return node.finishProperty('set', key, computed, value, false, false);\n            }\n        } else if (token.type === Token.Punctuator && token.value === '*' && lookaheadPropertyName()) {\n            computed = match('[');\n            key = parseObjectPropertyKey();\n            methodNode = new Node();\n\n            state.allowYield = false;\n            params = parseParams();\n            state.allowYield = previousAllowYield;\n\n            state.allowYield = true;\n            value = parsePropertyFunction(methodNode, params, true);\n            state.allowYield = previousAllowYield;\n\n            return node.finishProperty('init', key, computed, value, true, false);\n        }\n\n        if (key && match('(')) {\n            value = parsePropertyMethodFunction();\n            return node.finishProperty('init', key, computed, value, true, false);\n        }\n\n        // Not a MethodDefinition.\n        return null;\n    }\n\n    function checkProto(key, computed, hasProto) {\n        if (computed === false && (key.type === Syntax.Identifier && key.name === '__proto__' ||\n            key.type === Syntax.Literal && key.value === '__proto__')) {\n            if (hasProto.value) {\n                tolerateError(Messages.DuplicateProtoProperty);\n            } else {\n                hasProto.value = true;\n            }\n        }\n    }\n\n    function parseObjectProperty(hasProto) {\n        var token = lookahead, node = new Node(), computed, key, maybeMethod, value;\n\n        computed = match('[');\n        if (match('*')) {\n            lex();\n        } else {\n            key = parseObjectPropertyKey();\n        }\n        maybeMethod = tryParseMethodDefinition(token, key, computed, node);\n\n        if (maybeMethod) {\n            checkProto(maybeMethod.key, maybeMethod.computed, hasProto);\n            // finished\n            return maybeMethod;\n        }\n\n        if (!key) {\n            throwUnexpectedToken(lookahead);\n        }\n\n        // init property or short hand property.\n        checkProto(key, computed, hasProto);\n\n        if (match(':')) {\n            lex();\n            value = inheritCoverGrammar(parseAssignmentExpression);\n            return node.finishProperty('init', key, computed, value, false, false);\n        }\n\n        if (token.type === Token.Identifier) {\n            if (match('=')) {\n                firstCoverInitializedNameError = lookahead;\n                lex();\n                value = isolateCoverGrammar(parseAssignmentExpression);\n                return node.finishProperty('init', key, computed,\n                    new WrappingNode(token).finishAssignmentPattern(key, value), false, true);\n            }\n            return node.finishProperty('init', key, computed, key, false, true);\n        }\n\n        throwUnexpectedToken(lookahead);\n    }\n\n    function parseObjectInitialiser() {\n        var properties = [], hasProto = {value: false}, node = new Node();\n\n        expect('{');\n\n        while (!match('}')) {\n            properties.push(parseObjectProperty(hasProto));\n\n            if (!match('}')) {\n                expectCommaSeparator();\n            }\n        }\n\n        expect('}');\n\n        return node.finishObjectExpression(properties);\n    }\n\n    function reinterpretExpressionAsPattern(expr) {\n        var i;\n        switch (expr.type) {\n        case Syntax.Identifier:\n        case Syntax.MemberExpression:\n        case Syntax.RestElement:\n        case Syntax.AssignmentPattern:\n            break;\n        case Syntax.SpreadElement:\n            expr.type = Syntax.RestElement;\n            reinterpretExpressionAsPattern(expr.argument);\n            break;\n        case Syntax.ArrayExpression:\n            expr.type = Syntax.ArrayPattern;\n            for (i = 0; i < expr.elements.length; i++) {\n                if (expr.elements[i] !== null) {\n                    reinterpretExpressionAsPattern(expr.elements[i]);\n                }\n            }\n            break;\n        case Syntax.ObjectExpression:\n            expr.type = Syntax.ObjectPattern;\n            for (i = 0; i < expr.properties.length; i++) {\n                reinterpretExpressionAsPattern(expr.properties[i].value);\n            }\n            break;\n        case Syntax.AssignmentExpression:\n            expr.type = Syntax.AssignmentPattern;\n            reinterpretExpressionAsPattern(expr.left);\n            break;\n        default:\n            // Allow other node type for tolerant parsing.\n            break;\n        }\n    }\n\n    function parseTemplateElement(option) {\n        var node, token;\n\n        if (lookahead.type !== Token.Template || (option.head && !lookahead.head)) {\n            throwUnexpectedToken();\n        }\n\n        node = new Node();\n        token = lex();\n\n        return node.finishTemplateElement({ raw: token.value.raw, cooked: token.value.cooked }, token.tail);\n    }\n\n    function parseTemplateLiteral() {\n        var quasi, quasis, expressions, node = new Node();\n\n        quasi = parseTemplateElement({ head: true });\n        quasis = [ quasi ];\n        expressions = [];\n\n        while (!quasi.tail) {\n            expressions.push(parseExpression());\n            quasi = parseTemplateElement({ head: false });\n            quasis.push(quasi);\n        }\n\n        return node.finishTemplateLiteral(quasis, expressions);\n    }\n\n    // 11.1.6 The Grouping Operator\n\n    function parseGroupExpression() {\n        var expr, expressions, startToken, i, params = [];\n\n        expect('(');\n\n        if (match(')')) {\n            lex();\n            if (!match('=>')) {\n                expect('=>');\n            }\n            return {\n                type: PlaceHolders.ArrowParameterPlaceHolder,\n                params: [],\n                rawParams: []\n            };\n        }\n\n        startToken = lookahead;\n        if (match('...')) {\n            expr = parseRestElement(params);\n            expect(')');\n            if (!match('=>')) {\n                expect('=>');\n            }\n            return {\n                type: PlaceHolders.ArrowParameterPlaceHolder,\n                params: [expr]\n            };\n        }\n\n        isBindingElement = true;\n        expr = inheritCoverGrammar(parseAssignmentExpression);\n\n        if (match(',')) {\n            isAssignmentTarget = false;\n            expressions = [expr];\n\n            while (startIndex < length) {\n                if (!match(',')) {\n                    break;\n                }\n                lex();\n\n                if (match('...')) {\n                    if (!isBindingElement) {\n                        throwUnexpectedToken(lookahead);\n                    }\n                    expressions.push(parseRestElement(params));\n                    expect(')');\n                    if (!match('=>')) {\n                        expect('=>');\n                    }\n                    isBindingElement = false;\n                    for (i = 0; i < expressions.length; i++) {\n                        reinterpretExpressionAsPattern(expressions[i]);\n                    }\n                    return {\n                        type: PlaceHolders.ArrowParameterPlaceHolder,\n                        params: expressions\n                    };\n                }\n\n                expressions.push(inheritCoverGrammar(parseAssignmentExpression));\n            }\n\n            expr = new WrappingNode(startToken).finishSequenceExpression(expressions);\n        }\n\n\n        expect(')');\n\n        if (match('=>')) {\n            if (!isBindingElement) {\n                throwUnexpectedToken(lookahead);\n            }\n\n            if (expr.type === Syntax.SequenceExpression) {\n                for (i = 0; i < expr.expressions.length; i++) {\n                    reinterpretExpressionAsPattern(expr.expressions[i]);\n                }\n            } else {\n                reinterpretExpressionAsPattern(expr);\n            }\n\n            expr = {\n                type: PlaceHolders.ArrowParameterPlaceHolder,\n                params: expr.type === Syntax.SequenceExpression ? expr.expressions : [expr]\n            };\n        }\n        isBindingElement = false;\n        return expr;\n    }\n\n\n    // 11.1 Primary Expressions\n\n    function parsePrimaryExpression() {\n        var type, token, expr, node;\n\n        if (match('(')) {\n            isBindingElement = false;\n            return inheritCoverGrammar(parseGroupExpression);\n        }\n\n        if (match('[')) {\n            return inheritCoverGrammar(parseArrayInitialiser);\n        }\n\n        if (match('{')) {\n            return inheritCoverGrammar(parseObjectInitialiser);\n        }\n\n        type = lookahead.type;\n        node = new Node();\n\n        if (type === Token.Identifier) {\n            expr = node.finishIdentifier(lex().value);\n        } else if (type === Token.StringLiteral || type === Token.NumericLiteral) {\n            isAssignmentTarget = isBindingElement = false;\n            if (strict && lookahead.octal) {\n                tolerateUnexpectedToken(lookahead, Messages.StrictOctalLiteral);\n            }\n            expr = node.finishLiteral(lex());\n        } else if (type === Token.Keyword) {\n            isAssignmentTarget = isBindingElement = false;\n            if (matchKeyword('function')) {\n                return parseFunctionExpression();\n            }\n            if (matchKeyword('this')) {\n                lex();\n                return node.finishThisExpression();\n            }\n            if (matchKeyword('class')) {\n                return parseClassExpression();\n            }\n            throwUnexpectedToken(lex());\n        } else if (type === Token.BooleanLiteral) {\n            isAssignmentTarget = isBindingElement = false;\n            token = lex();\n            token.value = (token.value === 'true');\n            expr = node.finishLiteral(token);\n        } else if (type === Token.NullLiteral) {\n            isAssignmentTarget = isBindingElement = false;\n            token = lex();\n            token.value = null;\n            expr = node.finishLiteral(token);\n        } else if (match('/') || match('/=')) {\n            isAssignmentTarget = isBindingElement = false;\n            index = startIndex;\n\n            if (typeof extra.tokens !== 'undefined') {\n                token = collectRegex();\n            } else {\n                token = scanRegExp();\n            }\n            lex();\n            expr = node.finishLiteral(token);\n        } else if (type === Token.Template) {\n            expr = parseTemplateLiteral();\n        } else {\n            throwUnexpectedToken(lex());\n        }\n\n        return expr;\n    }\n\n    // 11.2 Left-Hand-Side Expressions\n\n    function parseArguments() {\n        var args = [], expr;\n\n        expect('(');\n\n        if (!match(')')) {\n            while (startIndex < length) {\n                if (match('...')) {\n                    expr = new Node();\n                    lex();\n                    expr.finishSpreadElement(isolateCoverGrammar(parseAssignmentExpression));\n                } else {\n                    expr = isolateCoverGrammar(parseAssignmentExpression);\n                }\n                args.push(expr);\n                if (match(')')) {\n                    break;\n                }\n                expectCommaSeparator();\n            }\n        }\n\n        expect(')');\n\n        return args;\n    }\n\n    function parseNonComputedProperty() {\n        var token, node = new Node();\n\n        token = lex();\n\n        if (!isIdentifierName(token)) {\n            throwUnexpectedToken(token);\n        }\n\n        return node.finishIdentifier(token.value);\n    }\n\n    function parseNonComputedMember() {\n        expect('.');\n\n        return parseNonComputedProperty();\n    }\n\n    function parseComputedMember() {\n        var expr;\n\n        expect('[');\n\n        expr = isolateCoverGrammar(parseExpression);\n\n        expect(']');\n\n        return expr;\n    }\n\n    function parseNewExpression() {\n        var callee, args, node = new Node();\n\n        expectKeyword('new');\n        callee = isolateCoverGrammar(parseLeftHandSideExpression);\n        args = match('(') ? parseArguments() : [];\n\n        isAssignmentTarget = isBindingElement = false;\n\n        return node.finishNewExpression(callee, args);\n    }\n\n    function parseLeftHandSideExpressionAllowCall() {\n        var quasi, expr, args, property, startToken, previousAllowIn = state.allowIn;\n\n        startToken = lookahead;\n        state.allowIn = true;\n\n        if (matchKeyword('super') && state.inFunctionBody) {\n            expr = new Node();\n            lex();\n            expr = expr.finishSuper();\n            if (!match('(') && !match('.') && !match('[')) {\n                throwUnexpectedToken(lookahead);\n            }\n        } else {\n            expr = inheritCoverGrammar(matchKeyword('new') ? parseNewExpression : parsePrimaryExpression);\n        }\n\n        for (;;) {\n            if (match('.')) {\n                isBindingElement = false;\n                isAssignmentTarget = true;\n                property = parseNonComputedMember();\n                expr = new WrappingNode(startToken).finishMemberExpression('.', expr, property);\n            } else if (match('(')) {\n                isBindingElement = false;\n                isAssignmentTarget = false;\n                args = parseArguments();\n                expr = new WrappingNode(startToken).finishCallExpression(expr, args);\n            } else if (match('[')) {\n                isBindingElement = false;\n                isAssignmentTarget = true;\n                property = parseComputedMember();\n                expr = new WrappingNode(startToken).finishMemberExpression('[', expr, property);\n            } else if (lookahead.type === Token.Template && lookahead.head) {\n                quasi = parseTemplateLiteral();\n                expr = new WrappingNode(startToken).finishTaggedTemplateExpression(expr, quasi);\n            } else {\n                break;\n            }\n        }\n        state.allowIn = previousAllowIn;\n\n        return expr;\n    }\n\n    function parseLeftHandSideExpression() {\n        var quasi, expr, property, startToken;\n        assert(state.allowIn, 'callee of new expression always allow in keyword.');\n\n        startToken = lookahead;\n\n        if (matchKeyword('super') && state.inFunctionBody) {\n            expr = new Node();\n            lex();\n            expr = expr.finishSuper();\n            if (!match('[') && !match('.')) {\n                throwUnexpectedToken(lookahead);\n            }\n        } else {\n            expr = inheritCoverGrammar(matchKeyword('new') ? parseNewExpression : parsePrimaryExpression);\n        }\n\n        for (;;) {\n            if (match('[')) {\n                isBindingElement = false;\n                isAssignmentTarget = true;\n                property = parseComputedMember();\n                expr = new WrappingNode(startToken).finishMemberExpression('[', expr, property);\n            } else if (match('.')) {\n                isBindingElement = false;\n                isAssignmentTarget = true;\n                property = parseNonComputedMember();\n                expr = new WrappingNode(startToken).finishMemberExpression('.', expr, property);\n            } else if (lookahead.type === Token.Template && lookahead.head) {\n                quasi = parseTemplateLiteral();\n                expr = new WrappingNode(startToken).finishTaggedTemplateExpression(expr, quasi);\n            } else {\n                break;\n            }\n        }\n        return expr;\n    }\n\n    // 11.3 Postfix Expressions\n\n    function parsePostfixExpression() {\n        var expr, token, startToken = lookahead;\n\n        expr = inheritCoverGrammar(parseLeftHandSideExpressionAllowCall);\n\n        if (!hasLineTerminator && lookahead.type === Token.Punctuator) {\n            if (match('++') || match('--')) {\n                // 11.3.1, 11.3.2\n                if (strict && expr.type === Syntax.Identifier && isRestrictedWord(expr.name)) {\n                    tolerateError(Messages.StrictLHSPostfix);\n                }\n\n                if (!isAssignmentTarget) {\n                    tolerateError(Messages.InvalidLHSInAssignment);\n                }\n\n                isAssignmentTarget = isBindingElement = false;\n\n                token = lex();\n                expr = new WrappingNode(startToken).finishPostfixExpression(token.value, expr);\n            }\n        }\n\n        return expr;\n    }\n\n    // 11.4 Unary Operators\n\n    function parseUnaryExpression() {\n        var token, expr, startToken;\n\n        if (lookahead.type !== Token.Punctuator && lookahead.type !== Token.Keyword) {\n            expr = parsePostfixExpression();\n        } else if (match('++') || match('--')) {\n            startToken = lookahead;\n            token = lex();\n            expr = inheritCoverGrammar(parseUnaryExpression);\n            // 11.4.4, 11.4.5\n            if (strict && expr.type === Syntax.Identifier && isRestrictedWord(expr.name)) {\n                tolerateError(Messages.StrictLHSPrefix);\n            }\n\n            if (!isAssignmentTarget) {\n                tolerateError(Messages.InvalidLHSInAssignment);\n            }\n            expr = new WrappingNode(startToken).finishUnaryExpression(token.value, expr);\n            isAssignmentTarget = isBindingElement = false;\n        } else if (match('+') || match('-') || match('~') || match('!')) {\n            startToken = lookahead;\n            token = lex();\n            expr = inheritCoverGrammar(parseUnaryExpression);\n            expr = new WrappingNode(startToken).finishUnaryExpression(token.value, expr);\n            isAssignmentTarget = isBindingElement = false;\n        } else if (matchKeyword('delete') || matchKeyword('void') || matchKeyword('typeof')) {\n            startToken = lookahead;\n            token = lex();\n            expr = inheritCoverGrammar(parseUnaryExpression);\n            expr = new WrappingNode(startToken).finishUnaryExpression(token.value, expr);\n            if (strict && expr.operator === 'delete' && expr.argument.type === Syntax.Identifier) {\n                tolerateError(Messages.StrictDelete);\n            }\n            isAssignmentTarget = isBindingElement = false;\n        } else {\n            expr = parsePostfixExpression();\n        }\n\n        return expr;\n    }\n\n    function binaryPrecedence(token, allowIn) {\n        var prec = 0;\n\n        if (token.type !== Token.Punctuator && token.type !== Token.Keyword) {\n            return 0;\n        }\n\n        switch (token.value) {\n        case '||':\n            prec = 1;\n            break;\n\n        case '&&':\n            prec = 2;\n            break;\n\n        case '|':\n            prec = 3;\n            break;\n\n        case '^':\n            prec = 4;\n            break;\n\n        case '&':\n            prec = 5;\n            break;\n\n        case '==':\n        case '!=':\n        case '===':\n        case '!==':\n            prec = 6;\n            break;\n\n        case '<':\n        case '>':\n        case '<=':\n        case '>=':\n        case 'instanceof':\n            prec = 7;\n            break;\n\n        case 'in':\n            prec = allowIn ? 7 : 0;\n            break;\n\n        case '<<':\n        case '>>':\n        case '>>>':\n            prec = 8;\n            break;\n\n        case '+':\n        case '-':\n            prec = 9;\n            break;\n\n        case '*':\n        case '/':\n        case '%':\n            prec = 11;\n            break;\n\n        default:\n            break;\n        }\n\n        return prec;\n    }\n\n    // 11.5 Multiplicative Operators\n    // 11.6 Additive Operators\n    // 11.7 Bitwise Shift Operators\n    // 11.8 Relational Operators\n    // 11.9 Equality Operators\n    // 11.10 Binary Bitwise Operators\n    // 11.11 Binary Logical Operators\n\n    function parseBinaryExpression() {\n        var marker, markers, expr, token, prec, stack, right, operator, left, i;\n\n        marker = lookahead;\n        left = inheritCoverGrammar(parseUnaryExpression);\n\n        token = lookahead;\n        prec = binaryPrecedence(token, state.allowIn);\n        if (prec === 0) {\n            return left;\n        }\n        isAssignmentTarget = isBindingElement = false;\n        token.prec = prec;\n        lex();\n\n        markers = [marker, lookahead];\n        right = isolateCoverGrammar(parseUnaryExpression);\n\n        stack = [left, token, right];\n\n        while ((prec = binaryPrecedence(lookahead, state.allowIn)) > 0) {\n\n            // Reduce: make a binary expression from the three topmost entries.\n            while ((stack.length > 2) && (prec <= stack[stack.length - 2].prec)) {\n                right = stack.pop();\n                operator = stack.pop().value;\n                left = stack.pop();\n                markers.pop();\n                expr = new WrappingNode(markers[markers.length - 1]).finishBinaryExpression(operator, left, right);\n                stack.push(expr);\n            }\n\n            // Shift.\n            token = lex();\n            token.prec = prec;\n            stack.push(token);\n            markers.push(lookahead);\n            expr = isolateCoverGrammar(parseUnaryExpression);\n            stack.push(expr);\n        }\n\n        // Final reduce to clean-up the stack.\n        i = stack.length - 1;\n        expr = stack[i];\n        markers.pop();\n        while (i > 1) {\n            expr = new WrappingNode(markers.pop()).finishBinaryExpression(stack[i - 1].value, stack[i - 2], expr);\n            i -= 2;\n        }\n\n        return expr;\n    }\n\n\n    // 11.12 Conditional Operator\n\n    function parseConditionalExpression() {\n        var expr, previousAllowIn, consequent, alternate, startToken;\n\n        startToken = lookahead;\n\n        expr = inheritCoverGrammar(parseBinaryExpression);\n        if (match('?')) {\n            lex();\n            previousAllowIn = state.allowIn;\n            state.allowIn = true;\n            consequent = isolateCoverGrammar(parseAssignmentExpression);\n            state.allowIn = previousAllowIn;\n            expect(':');\n            alternate = isolateCoverGrammar(parseAssignmentExpression);\n\n            expr = new WrappingNode(startToken).finishConditionalExpression(expr, consequent, alternate);\n            isAssignmentTarget = isBindingElement = false;\n        }\n\n        return expr;\n    }\n\n    // [ES6] 14.2 Arrow Function\n\n    function parseConciseBody() {\n        if (match('{')) {\n            return parseFunctionSourceElements();\n        }\n        return isolateCoverGrammar(parseAssignmentExpression);\n    }\n\n    function checkPatternParam(options, param) {\n        var i;\n        switch (param.type) {\n        case Syntax.Identifier:\n            validateParam(options, param, param.name);\n            break;\n        case Syntax.RestElement:\n            checkPatternParam(options, param.argument);\n            break;\n        case Syntax.AssignmentPattern:\n            checkPatternParam(options, param.left);\n            break;\n        case Syntax.ArrayPattern:\n            for (i = 0; i < param.elements.length; i++) {\n                if (param.elements[i] !== null) {\n                    checkPatternParam(options, param.elements[i]);\n                }\n            }\n            break;\n        default:\n            assert(param.type === Syntax.ObjectPattern, 'Invalid type');\n            for (i = 0; i < param.properties.length; i++) {\n                checkPatternParam(options, param.properties[i].value);\n            }\n            break;\n        }\n    }\n    function reinterpretAsCoverFormalsList(expr) {\n        var i, len, param, params, defaults, defaultCount, options, token;\n\n        defaults = [];\n        defaultCount = 0;\n        params = [expr];\n\n        switch (expr.type) {\n        case Syntax.Identifier:\n            break;\n        case PlaceHolders.ArrowParameterPlaceHolder:\n            params = expr.params;\n            break;\n        default:\n            return null;\n        }\n\n        options = {\n            paramSet: {}\n        };\n\n        for (i = 0, len = params.length; i < len; i += 1) {\n            param = params[i];\n            switch (param.type) {\n            case Syntax.AssignmentPattern:\n                params[i] = param.left;\n                defaults.push(param.right);\n                ++defaultCount;\n                checkPatternParam(options, param.left);\n                break;\n            default:\n                checkPatternParam(options, param);\n                params[i] = param;\n                defaults.push(null);\n                break;\n            }\n        }\n\n        if (options.message === Messages.StrictParamDupe) {\n            token = strict ? options.stricted : options.firstRestricted;\n            throwUnexpectedToken(token, options.message);\n        }\n\n        if (defaultCount === 0) {\n            defaults = [];\n        }\n\n        return {\n            params: params,\n            defaults: defaults,\n            stricted: options.stricted,\n            firstRestricted: options.firstRestricted,\n            message: options.message\n        };\n    }\n\n    function parseArrowFunctionExpression(options, node) {\n        var previousStrict, body;\n\n        if (hasLineTerminator) {\n            tolerateUnexpectedToken(lookahead);\n        }\n        expect('=>');\n        previousStrict = strict;\n\n        body = parseConciseBody();\n\n        if (strict && options.firstRestricted) {\n            throwUnexpectedToken(options.firstRestricted, options.message);\n        }\n        if (strict && options.stricted) {\n            tolerateUnexpectedToken(options.stricted, options.message);\n        }\n\n        strict = previousStrict;\n\n        return node.finishArrowFunctionExpression(options.params, options.defaults, body, body.type !== Syntax.BlockStatement);\n    }\n\n    // [ES6] 14.4 Yield expression\n\n    function parseYieldExpression() {\n        var argument, expr, delegate;\n\n        expr = new Node();\n\n        if (!state.allowYield) {\n            tolerateUnexpectedToken(lookahead, Messages.IllegalYield);\n        }\n\n        expectKeyword('yield');\n\n        if (!hasLineTerminator) {\n            delegate = match('*');\n            if (delegate) {\n                lex();\n                argument = parseExpression();\n            } else {\n                if (!match(';') && !match('}') && lookahead.type !== Token.EOF) {\n                    argument = parseExpression();\n                }\n            }\n        }\n\n        return expr.finishYieldExpression(argument, delegate);\n    }\n\n    // 11.13 Assignment Operators\n\n    function parseAssignmentExpression() {\n        var token, expr, right, list, startToken;\n\n        startToken = lookahead;\n        token = lookahead;\n\n        if (matchKeyword('yield')) {\n            return parseYieldExpression();\n        }\n\n        expr = parseConditionalExpression();\n\n        if (expr.type === PlaceHolders.ArrowParameterPlaceHolder || match('=>')) {\n            isAssignmentTarget = isBindingElement = false;\n            list = reinterpretAsCoverFormalsList(expr);\n\n            if (list) {\n                firstCoverInitializedNameError = null;\n                return parseArrowFunctionExpression(list, new WrappingNode(startToken));\n            }\n\n            return expr;\n        }\n\n        if (matchAssign()) {\n            if (!isAssignmentTarget) {\n                tolerateError(Messages.InvalidLHSInAssignment);\n            }\n\n            // 11.13.1\n            if (strict && expr.type === Syntax.Identifier && isRestrictedWord(expr.name)) {\n                tolerateUnexpectedToken(token, Messages.StrictLHSAssignment);\n            }\n\n            if (!match('=')) {\n                isAssignmentTarget = isBindingElement = false;\n            } else {\n                reinterpretExpressionAsPattern(expr);\n            }\n\n            token = lex();\n            right = isolateCoverGrammar(parseAssignmentExpression);\n            expr = new WrappingNode(startToken).finishAssignmentExpression(token.value, expr, right);\n            firstCoverInitializedNameError = null;\n        }\n\n        return expr;\n    }\n\n    // 11.14 Comma Operator\n\n    function parseExpression() {\n        var expr, startToken = lookahead, expressions;\n\n        expr = isolateCoverGrammar(parseAssignmentExpression);\n\n        if (match(',')) {\n            expressions = [expr];\n\n            while (startIndex < length) {\n                if (!match(',')) {\n                    break;\n                }\n                lex();\n                expressions.push(isolateCoverGrammar(parseAssignmentExpression));\n            }\n\n            expr = new WrappingNode(startToken).finishSequenceExpression(expressions);\n        }\n\n        return expr;\n    }\n\n    // 12.1 Block\n\n    function parseStatementListItem() {\n        if (lookahead.type === Token.Keyword) {\n            switch (lookahead.value) {\n            case 'export':\n                if (sourceType !== 'module') {\n                    tolerateUnexpectedToken(lookahead, Messages.IllegalExportDeclaration);\n                }\n                return parseExportDeclaration();\n            case 'import':\n                if (sourceType !== 'module') {\n                    tolerateUnexpectedToken(lookahead, Messages.IllegalImportDeclaration);\n                }\n                return parseImportDeclaration();\n            case 'const':\n            case 'let':\n                return parseLexicalDeclaration({inFor: false});\n            case 'function':\n                return parseFunctionDeclaration(new Node());\n            case 'class':\n                return parseClassDeclaration();\n            }\n        }\n\n        return parseStatement();\n    }\n\n    function parseStatementList() {\n        var list = [];\n        while (startIndex < length) {\n            if (match('}')) {\n                break;\n            }\n            list.push(parseStatementListItem());\n        }\n\n        return list;\n    }\n\n    function parseBlock() {\n        var block, node = new Node();\n\n        expect('{');\n\n        block = parseStatementList();\n\n        expect('}');\n\n        return node.finishBlockStatement(block);\n    }\n\n    // 12.2 Variable Statement\n\n    function parseVariableIdentifier() {\n        var token, node = new Node();\n\n        token = lex();\n\n        if (token.type !== Token.Identifier) {\n            if (strict && token.type === Token.Keyword && isStrictModeReservedWord(token.value)) {\n                tolerateUnexpectedToken(token, Messages.StrictReservedWord);\n            } else {\n                throwUnexpectedToken(token);\n            }\n        }\n\n        return node.finishIdentifier(token.value);\n    }\n\n    function parseVariableDeclaration() {\n        var init = null, id, node = new Node(), params = [];\n\n        id = parsePattern(params);\n\n        // 12.2.1\n        if (strict && isRestrictedWord(id.name)) {\n            tolerateError(Messages.StrictVarName);\n        }\n\n        if (match('=')) {\n            lex();\n            init = isolateCoverGrammar(parseAssignmentExpression);\n        } else if (id.type !== Syntax.Identifier) {\n            expect('=');\n        }\n\n        return node.finishVariableDeclarator(id, init);\n    }\n\n    function parseVariableDeclarationList() {\n        var list = [];\n\n        do {\n            list.push(parseVariableDeclaration());\n            if (!match(',')) {\n                break;\n            }\n            lex();\n        } while (startIndex < length);\n\n        return list;\n    }\n\n    function parseVariableStatement(node) {\n        var declarations;\n\n        expectKeyword('var');\n\n        declarations = parseVariableDeclarationList();\n\n        consumeSemicolon();\n\n        return node.finishVariableDeclaration(declarations);\n    }\n\n    function parseLexicalBinding(kind, options) {\n        var init = null, id, node = new Node(), params = [];\n\n        id = parsePattern(params);\n\n        // 12.2.1\n        if (strict && id.type === Syntax.Identifier && isRestrictedWord(id.name)) {\n            tolerateError(Messages.StrictVarName);\n        }\n\n        if (kind === 'const') {\n            if (!matchKeyword('in') && !matchContextualKeyword('of')) {\n                expect('=');\n                init = isolateCoverGrammar(parseAssignmentExpression);\n            }\n        } else if ((!options.inFor && id.type !== Syntax.Identifier) || match('=')) {\n            expect('=');\n            init = isolateCoverGrammar(parseAssignmentExpression);\n        }\n\n        return node.finishVariableDeclarator(id, init);\n    }\n\n    function parseBindingList(kind, options) {\n        var list = [];\n\n        do {\n            list.push(parseLexicalBinding(kind, options));\n            if (!match(',')) {\n                break;\n            }\n            lex();\n        } while (startIndex < length);\n\n        return list;\n    }\n\n    function parseLexicalDeclaration(options) {\n        var kind, declarations, node = new Node();\n\n        kind = lex().value;\n        assert(kind === 'let' || kind === 'const', 'Lexical declaration must be either let or const');\n\n        declarations = parseBindingList(kind, options);\n\n        consumeSemicolon();\n\n        return node.finishLexicalDeclaration(declarations, kind);\n    }\n\n    function parseRestElement(params) {\n        var param, node = new Node();\n\n        lex();\n\n        if (match('{')) {\n            throwError(Messages.ObjectPatternAsRestParameter);\n        }\n\n        params.push(lookahead);\n\n        param = parseVariableIdentifier();\n\n        if (match('=')) {\n            throwError(Messages.DefaultRestParameter);\n        }\n\n        if (!match(')')) {\n            throwError(Messages.ParameterAfterRestParameter);\n        }\n\n        return node.finishRestElement(param);\n    }\n\n    // 12.3 Empty Statement\n\n    function parseEmptyStatement(node) {\n        expect(';');\n        return node.finishEmptyStatement();\n    }\n\n    // 12.4 Expression Statement\n\n    function parseExpressionStatement(node) {\n        var expr = parseExpression();\n        consumeSemicolon();\n        return node.finishExpressionStatement(expr);\n    }\n\n    // 12.5 If statement\n\n    function parseIfStatement(node) {\n        var test, consequent, alternate;\n\n        expectKeyword('if');\n\n        expect('(');\n\n        test = parseExpression();\n\n        expect(')');\n\n        consequent = parseStatement();\n\n        if (matchKeyword('else')) {\n            lex();\n            alternate = parseStatement();\n        } else {\n            alternate = null;\n        }\n\n        return node.finishIfStatement(test, consequent, alternate);\n    }\n\n    // 12.6 Iteration Statements\n\n    function parseDoWhileStatement(node) {\n        var body, test, oldInIteration;\n\n        expectKeyword('do');\n\n        oldInIteration = state.inIteration;\n        state.inIteration = true;\n\n        body = parseStatement();\n\n        state.inIteration = oldInIteration;\n\n        expectKeyword('while');\n\n        expect('(');\n\n        test = parseExpression();\n\n        expect(')');\n\n        if (match(';')) {\n            lex();\n        }\n\n        return node.finishDoWhileStatement(body, test);\n    }\n\n    function parseWhileStatement(node) {\n        var test, body, oldInIteration;\n\n        expectKeyword('while');\n\n        expect('(');\n\n        test = parseExpression();\n\n        expect(')');\n\n        oldInIteration = state.inIteration;\n        state.inIteration = true;\n\n        body = parseStatement();\n\n        state.inIteration = oldInIteration;\n\n        return node.finishWhileStatement(test, body);\n    }\n\n    function parseForStatement(node) {\n        var init, forIn, initSeq, initStartToken, test, update, left, right, kind, declarations,\n            body, oldInIteration, previousAllowIn = state.allowIn;\n\n        init = test = update = null;\n        forIn = true;\n\n        expectKeyword('for');\n\n        expect('(');\n\n        if (match(';')) {\n            lex();\n        } else {\n            if (matchKeyword('var')) {\n                init = new Node();\n                lex();\n\n                state.allowIn = false;\n                init = init.finishVariableDeclaration(parseVariableDeclarationList());\n                state.allowIn = previousAllowIn;\n\n                if (init.declarations.length === 1 && matchKeyword('in')) {\n                    lex();\n                    left = init;\n                    right = parseExpression();\n                    init = null;\n                } else if (init.declarations.length === 1 && init.declarations[0].init === null && matchContextualKeyword('of')) {\n                    lex();\n                    left = init;\n                    right = parseAssignmentExpression();\n                    init = null;\n                    forIn = false;\n                } else {\n                    expect(';');\n                }\n            } else if (matchKeyword('const') || matchKeyword('let')) {\n                init = new Node();\n                kind = lex().value;\n\n                state.allowIn = false;\n                declarations = parseBindingList(kind, {inFor: true});\n                state.allowIn = previousAllowIn;\n\n                if (declarations.length === 1 && declarations[0].init === null && matchKeyword('in')) {\n                    init = init.finishLexicalDeclaration(declarations, kind);\n                    lex();\n                    left = init;\n                    right = parseExpression();\n                    init = null;\n                } else if (declarations.length === 1 && declarations[0].init === null && matchContextualKeyword('of')) {\n                    init = init.finishLexicalDeclaration(declarations, kind);\n                    lex();\n                    left = init;\n                    right = parseAssignmentExpression();\n                    init = null;\n                    forIn = false;\n                } else {\n                    consumeSemicolon();\n                    init = init.finishLexicalDeclaration(declarations, kind);\n                }\n            } else {\n                initStartToken = lookahead;\n                state.allowIn = false;\n                init = inheritCoverGrammar(parseAssignmentExpression);\n                state.allowIn = previousAllowIn;\n\n                if (matchKeyword('in')) {\n                    if (!isAssignmentTarget) {\n                        tolerateError(Messages.InvalidLHSInForIn);\n                    }\n\n                    lex();\n                    reinterpretExpressionAsPattern(init);\n                    left = init;\n                    right = parseExpression();\n                    init = null;\n                } else if (matchContextualKeyword('of')) {\n                    if (!isAssignmentTarget) {\n                        tolerateError(Messages.InvalidLHSInForLoop);\n                    }\n\n                    lex();\n                    reinterpretExpressionAsPattern(init);\n                    left = init;\n                    right = parseAssignmentExpression();\n                    init = null;\n                    forIn = false;\n                } else {\n                    if (match(',')) {\n                        initSeq = [init];\n                        while (match(',')) {\n                            lex();\n                            initSeq.push(isolateCoverGrammar(parseAssignmentExpression));\n                        }\n                        init = new WrappingNode(initStartToken).finishSequenceExpression(initSeq);\n                    }\n                    expect(';');\n                }\n            }\n        }\n\n        if (typeof left === 'undefined') {\n\n            if (!match(';')) {\n                test = parseExpression();\n            }\n            expect(';');\n\n            if (!match(')')) {\n                update = parseExpression();\n            }\n        }\n\n        expect(')');\n\n        oldInIteration = state.inIteration;\n        state.inIteration = true;\n\n        body = isolateCoverGrammar(parseStatement);\n\n        state.inIteration = oldInIteration;\n\n        return (typeof left === 'undefined') ?\n                node.finishForStatement(init, test, update, body) :\n                forIn ? node.finishForInStatement(left, right, body) :\n                    node.finishForOfStatement(left, right, body);\n    }\n\n    // 12.7 The continue statement\n\n    function parseContinueStatement(node) {\n        var label = null, key;\n\n        expectKeyword('continue');\n\n        // Optimize the most common form: 'continue;'.\n        if (source.charCodeAt(startIndex) === 0x3B) {\n            lex();\n\n            if (!state.inIteration) {\n                throwError(Messages.IllegalContinue);\n            }\n\n            return node.finishContinueStatement(null);\n        }\n\n        if (hasLineTerminator) {\n            if (!state.inIteration) {\n                throwError(Messages.IllegalContinue);\n            }\n\n            return node.finishContinueStatement(null);\n        }\n\n        if (lookahead.type === Token.Identifier) {\n            label = parseVariableIdentifier();\n\n            key = '$' + label.name;\n            if (!Object.prototype.hasOwnProperty.call(state.labelSet, key)) {\n                throwError(Messages.UnknownLabel, label.name);\n            }\n        }\n\n        consumeSemicolon();\n\n        if (label === null && !state.inIteration) {\n            throwError(Messages.IllegalContinue);\n        }\n\n        return node.finishContinueStatement(label);\n    }\n\n    // 12.8 The break statement\n\n    function parseBreakStatement(node) {\n        var label = null, key;\n\n        expectKeyword('break');\n\n        // Catch the very common case first: immediately a semicolon (U+003B).\n        if (source.charCodeAt(lastIndex) === 0x3B) {\n            lex();\n\n            if (!(state.inIteration || state.inSwitch)) {\n                throwError(Messages.IllegalBreak);\n            }\n\n            return node.finishBreakStatement(null);\n        }\n\n        if (hasLineTerminator) {\n            if (!(state.inIteration || state.inSwitch)) {\n                throwError(Messages.IllegalBreak);\n            }\n\n            return node.finishBreakStatement(null);\n        }\n\n        if (lookahead.type === Token.Identifier) {\n            label = parseVariableIdentifier();\n\n            key = '$' + label.name;\n            if (!Object.prototype.hasOwnProperty.call(state.labelSet, key)) {\n                throwError(Messages.UnknownLabel, label.name);\n            }\n        }\n\n        consumeSemicolon();\n\n        if (label === null && !(state.inIteration || state.inSwitch)) {\n            throwError(Messages.IllegalBreak);\n        }\n\n        return node.finishBreakStatement(label);\n    }\n\n    // 12.9 The return statement\n\n    function parseReturnStatement(node) {\n        var argument = null;\n\n        expectKeyword('return');\n\n        if (!state.inFunctionBody) {\n            tolerateError(Messages.IllegalReturn);\n        }\n\n        // 'return' followed by a space and an identifier is very common.\n        if (source.charCodeAt(lastIndex) === 0x20) {\n            if (isIdentifierStart(source.charCodeAt(lastIndex + 1))) {\n                argument = parseExpression();\n                consumeSemicolon();\n                return node.finishReturnStatement(argument);\n            }\n        }\n\n        if (hasLineTerminator) {\n            // HACK\n            return node.finishReturnStatement(null);\n        }\n\n        if (!match(';')) {\n            if (!match('}') && lookahead.type !== Token.EOF) {\n                argument = parseExpression();\n            }\n        }\n\n        consumeSemicolon();\n\n        return node.finishReturnStatement(argument);\n    }\n\n    // 12.10 The with statement\n\n    function parseWithStatement(node) {\n        var object, body;\n\n        if (strict) {\n            tolerateError(Messages.StrictModeWith);\n        }\n\n        expectKeyword('with');\n\n        expect('(');\n\n        object = parseExpression();\n\n        expect(')');\n\n        body = parseStatement();\n\n        return node.finishWithStatement(object, body);\n    }\n\n    // 12.10 The swith statement\n\n    function parseSwitchCase() {\n        var test, consequent = [], statement, node = new Node();\n\n        if (matchKeyword('default')) {\n            lex();\n            test = null;\n        } else {\n            expectKeyword('case');\n            test = parseExpression();\n        }\n        expect(':');\n\n        while (startIndex < length) {\n            if (match('}') || matchKeyword('default') || matchKeyword('case')) {\n                break;\n            }\n            statement = parseStatementListItem();\n            consequent.push(statement);\n        }\n\n        return node.finishSwitchCase(test, consequent);\n    }\n\n    function parseSwitchStatement(node) {\n        var discriminant, cases, clause, oldInSwitch, defaultFound;\n\n        expectKeyword('switch');\n\n        expect('(');\n\n        discriminant = parseExpression();\n\n        expect(')');\n\n        expect('{');\n\n        cases = [];\n\n        if (match('}')) {\n            lex();\n            return node.finishSwitchStatement(discriminant, cases);\n        }\n\n        oldInSwitch = state.inSwitch;\n        state.inSwitch = true;\n        defaultFound = false;\n\n        while (startIndex < length) {\n            if (match('}')) {\n                break;\n            }\n            clause = parseSwitchCase();\n            if (clause.test === null) {\n                if (defaultFound) {\n                    throwError(Messages.MultipleDefaultsInSwitch);\n                }\n                defaultFound = true;\n            }\n            cases.push(clause);\n        }\n\n        state.inSwitch = oldInSwitch;\n\n        expect('}');\n\n        return node.finishSwitchStatement(discriminant, cases);\n    }\n\n    // 12.13 The throw statement\n\n    function parseThrowStatement(node) {\n        var argument;\n\n        expectKeyword('throw');\n\n        if (hasLineTerminator) {\n            throwError(Messages.NewlineAfterThrow);\n        }\n\n        argument = parseExpression();\n\n        consumeSemicolon();\n\n        return node.finishThrowStatement(argument);\n    }\n\n    // 12.14 The try statement\n\n    function parseCatchClause() {\n        var param, params = [], paramMap = {}, key, i, body, node = new Node();\n\n        expectKeyword('catch');\n\n        expect('(');\n        if (match(')')) {\n            throwUnexpectedToken(lookahead);\n        }\n\n        param = parsePattern(params);\n        for (i = 0; i < params.length; i++) {\n            key = '$' + params[i].value;\n            if (Object.prototype.hasOwnProperty.call(paramMap, key)) {\n                tolerateError(Messages.DuplicateBinding, params[i].value);\n            }\n            paramMap[key] = true;\n        }\n\n        // 12.14.1\n        if (strict && isRestrictedWord(param.name)) {\n            tolerateError(Messages.StrictCatchVariable);\n        }\n\n        expect(')');\n        body = parseBlock();\n        return node.finishCatchClause(param, body);\n    }\n\n    function parseTryStatement(node) {\n        var block, handler = null, finalizer = null;\n\n        expectKeyword('try');\n\n        block = parseBlock();\n\n        if (matchKeyword('catch')) {\n            handler = parseCatchClause();\n        }\n\n        if (matchKeyword('finally')) {\n            lex();\n            finalizer = parseBlock();\n        }\n\n        if (!handler && !finalizer) {\n            throwError(Messages.NoCatchOrFinally);\n        }\n\n        return node.finishTryStatement(block, handler, finalizer);\n    }\n\n    // 12.15 The debugger statement\n\n    function parseDebuggerStatement(node) {\n        expectKeyword('debugger');\n\n        consumeSemicolon();\n\n        return node.finishDebuggerStatement();\n    }\n\n    // 12 Statements\n\n    function parseStatement() {\n        var type = lookahead.type,\n            expr,\n            labeledBody,\n            key,\n            node;\n\n        if (type === Token.EOF) {\n            throwUnexpectedToken(lookahead);\n        }\n\n        if (type === Token.Punctuator && lookahead.value === '{') {\n            return parseBlock();\n        }\n        isAssignmentTarget = isBindingElement = true;\n        node = new Node();\n\n        if (type === Token.Punctuator) {\n            switch (lookahead.value) {\n            case ';':\n                return parseEmptyStatement(node);\n            case '(':\n                return parseExpressionStatement(node);\n            default:\n                break;\n            }\n        } else if (type === Token.Keyword) {\n            switch (lookahead.value) {\n            case 'break':\n                return parseBreakStatement(node);\n            case 'continue':\n                return parseContinueStatement(node);\n            case 'debugger':\n                return parseDebuggerStatement(node);\n            case 'do':\n                return parseDoWhileStatement(node);\n            case 'for':\n                return parseForStatement(node);\n            case 'function':\n                return parseFunctionDeclaration(node);\n            case 'if':\n                return parseIfStatement(node);\n            case 'return':\n                return parseReturnStatement(node);\n            case 'switch':\n                return parseSwitchStatement(node);\n            case 'throw':\n                return parseThrowStatement(node);\n            case 'try':\n                return parseTryStatement(node);\n            case 'var':\n                return parseVariableStatement(node);\n            case 'while':\n                return parseWhileStatement(node);\n            case 'with':\n                return parseWithStatement(node);\n            default:\n                break;\n            }\n        }\n\n        expr = parseExpression();\n\n        // 12.12 Labelled Statements\n        if ((expr.type === Syntax.Identifier) && match(':')) {\n            lex();\n\n            key = '$' + expr.name;\n            if (Object.prototype.hasOwnProperty.call(state.labelSet, key)) {\n                throwError(Messages.Redeclaration, 'Label', expr.name);\n            }\n\n            state.labelSet[key] = true;\n            labeledBody = parseStatement();\n            delete state.labelSet[key];\n            return node.finishLabeledStatement(expr, labeledBody);\n        }\n\n        consumeSemicolon();\n\n        return node.finishExpressionStatement(expr);\n    }\n\n    // 13 Function Definition\n\n    function parseFunctionSourceElements() {\n        var statement, body = [], token, directive, firstRestricted,\n            oldLabelSet, oldInIteration, oldInSwitch, oldInFunctionBody, oldParenthesisCount,\n            node = new Node();\n\n        expect('{');\n\n        while (startIndex < length) {\n            if (lookahead.type !== Token.StringLiteral) {\n                break;\n            }\n            token = lookahead;\n\n            statement = parseStatementListItem();\n            body.push(statement);\n            if (statement.expression.type !== Syntax.Literal) {\n                // this is not directive\n                break;\n            }\n            directive = source.slice(token.start + 1, token.end - 1);\n            if (directive === 'use strict') {\n                strict = true;\n                if (firstRestricted) {\n                    tolerateUnexpectedToken(firstRestricted, Messages.StrictOctalLiteral);\n                }\n            } else {\n                if (!firstRestricted && token.octal) {\n                    firstRestricted = token;\n                }\n            }\n        }\n\n        oldLabelSet = state.labelSet;\n        oldInIteration = state.inIteration;\n        oldInSwitch = state.inSwitch;\n        oldInFunctionBody = state.inFunctionBody;\n        oldParenthesisCount = state.parenthesizedCount;\n\n        state.labelSet = {};\n        state.inIteration = false;\n        state.inSwitch = false;\n        state.inFunctionBody = true;\n        state.parenthesizedCount = 0;\n\n        while (startIndex < length) {\n            if (match('}')) {\n                break;\n            }\n            body.push(parseStatementListItem());\n        }\n\n        expect('}');\n\n        state.labelSet = oldLabelSet;\n        state.inIteration = oldInIteration;\n        state.inSwitch = oldInSwitch;\n        state.inFunctionBody = oldInFunctionBody;\n        state.parenthesizedCount = oldParenthesisCount;\n\n        return node.finishBlockStatement(body);\n    }\n\n    function validateParam(options, param, name) {\n        var key = '$' + name;\n        if (strict) {\n            if (isRestrictedWord(name)) {\n                options.stricted = param;\n                options.message = Messages.StrictParamName;\n            }\n            if (Object.prototype.hasOwnProperty.call(options.paramSet, key)) {\n                options.stricted = param;\n                options.message = Messages.StrictParamDupe;\n            }\n        } else if (!options.firstRestricted) {\n            if (isRestrictedWord(name)) {\n                options.firstRestricted = param;\n                options.message = Messages.StrictParamName;\n            } else if (isStrictModeReservedWord(name)) {\n                options.firstRestricted = param;\n                options.message = Messages.StrictReservedWord;\n            } else if (Object.prototype.hasOwnProperty.call(options.paramSet, key)) {\n                options.stricted = param;\n                options.message = Messages.StrictParamDupe;\n            }\n        }\n        options.paramSet[key] = true;\n    }\n\n    function parseParam(options) {\n        var token, param, params = [], i, def;\n\n        token = lookahead;\n        if (token.value === '...') {\n            param = parseRestElement(params);\n            validateParam(options, param.argument, param.argument.name);\n            options.params.push(param);\n            options.defaults.push(null);\n            return false;\n        }\n\n        param = parsePatternWithDefault(params);\n        for (i = 0; i < params.length; i++) {\n            validateParam(options, params[i], params[i].value);\n        }\n\n        if (param.type === Syntax.AssignmentPattern) {\n            def = param.right;\n            param = param.left;\n            ++options.defaultCount;\n        }\n\n        options.params.push(param);\n        options.defaults.push(def);\n\n        return !match(')');\n    }\n\n    function parseParams(firstRestricted) {\n        var options;\n\n        options = {\n            params: [],\n            defaultCount: 0,\n            defaults: [],\n            firstRestricted: firstRestricted\n        };\n\n        expect('(');\n\n        if (!match(')')) {\n            options.paramSet = {};\n            while (startIndex < length) {\n                if (!parseParam(options)) {\n                    break;\n                }\n                expect(',');\n            }\n        }\n\n        expect(')');\n\n        if (options.defaultCount === 0) {\n            options.defaults = [];\n        }\n\n        return {\n            params: options.params,\n            defaults: options.defaults,\n            stricted: options.stricted,\n            firstRestricted: options.firstRestricted,\n            message: options.message\n        };\n    }\n\n    function parseFunctionDeclaration(node, identifierIsOptional) {\n        var id = null, params = [], defaults = [], body, token, stricted, tmp, firstRestricted, message, previousStrict,\n            isGenerator, previousAllowYield;\n\n        expectKeyword('function');\n\n        isGenerator = match('*');\n        if (isGenerator) {\n            lex();\n        }\n\n        if (!identifierIsOptional || !match('(')) {\n            token = lookahead;\n            id = parseVariableIdentifier();\n            if (strict) {\n                if (isRestrictedWord(token.value)) {\n                    tolerateUnexpectedToken(token, Messages.StrictFunctionName);\n                }\n            } else {\n                if (isRestrictedWord(token.value)) {\n                    firstRestricted = token;\n                    message = Messages.StrictFunctionName;\n                } else if (isStrictModeReservedWord(token.value)) {\n                    firstRestricted = token;\n                    message = Messages.StrictReservedWord;\n                }\n            }\n        }\n\n        previousAllowYield = state.allowYield;\n        state.allowYield = false;\n        tmp = parseParams(firstRestricted);\n        state.allowYield = previousAllowYield;\n\n        params = tmp.params;\n        defaults = tmp.defaults;\n        stricted = tmp.stricted;\n        firstRestricted = tmp.firstRestricted;\n        if (tmp.message) {\n            message = tmp.message;\n        }\n\n        previousAllowYield = state.allowYield;\n        previousStrict = strict;\n        state.allowYield = isGenerator;\n        body = parseFunctionSourceElements();\n        if (strict && firstRestricted) {\n            throwUnexpectedToken(firstRestricted, message);\n        }\n        if (strict && stricted) {\n            tolerateUnexpectedToken(stricted, message);\n        }\n        strict = previousStrict;\n        state.allowYield = previousAllowYield;\n\n        return node.finishFunctionDeclaration(id, params, defaults, body, isGenerator);\n    }\n\n    function parseFunctionExpression() {\n        var token, id = null, stricted, firstRestricted, message, tmp,\n            params = [], defaults = [], body, previousStrict, node = new Node(),\n            isGenerator, previousAllowYield;\n\n        expectKeyword('function');\n\n        isGenerator = match('*');\n        if (isGenerator) {\n            lex();\n        }\n\n        if (!match('(')) {\n            token = lookahead;\n            id = parseVariableIdentifier();\n            if (strict) {\n                if (isRestrictedWord(token.value)) {\n                    tolerateUnexpectedToken(token, Messages.StrictFunctionName);\n                }\n            } else {\n                if (isRestrictedWord(token.value)) {\n                    firstRestricted = token;\n                    message = Messages.StrictFunctionName;\n                } else if (isStrictModeReservedWord(token.value)) {\n                    firstRestricted = token;\n                    message = Messages.StrictReservedWord;\n                }\n            }\n        }\n\n        previousAllowYield = state.allowYield;\n        state.allowYield = false;\n        tmp = parseParams(firstRestricted);\n        state.allowYield = previousAllowYield;\n\n        params = tmp.params;\n        defaults = tmp.defaults;\n        stricted = tmp.stricted;\n        firstRestricted = tmp.firstRestricted;\n        if (tmp.message) {\n            message = tmp.message;\n        }\n\n        previousStrict = strict;\n        previousAllowYield = state.allowYield;\n        state.allowYield = isGenerator;\n        body = parseFunctionSourceElements();\n\n        if (strict && firstRestricted) {\n            throwUnexpectedToken(firstRestricted, message);\n        }\n        if (strict && stricted) {\n            tolerateUnexpectedToken(stricted, message);\n        }\n        strict = previousStrict;\n        state.allowYield = previousAllowYield;\n\n        return node.finishFunctionExpression(id, params, defaults, body, isGenerator);\n    }\n\n\n    function parseClassBody() {\n        var classBody, token, isStatic, hasConstructor = false, body, method, computed, key;\n\n        classBody = new Node();\n\n        expect('{');\n        body = [];\n        while (!match('}')) {\n            if (match(';')) {\n                lex();\n            } else {\n                method = new Node();\n                token = lookahead;\n                isStatic = false;\n                computed = match('[');\n                if (match('*')) {\n                    lex();\n                } else {\n                    key = parseObjectPropertyKey();\n                    if (key.name === 'static' && (lookaheadPropertyName() || match('*'))) {\n                        token = lookahead;\n                        isStatic = true;\n                        computed = match('[');\n                        if (match('*')) {\n                            lex();\n                        } else {\n                            key = parseObjectPropertyKey();\n                        }\n                    }\n                }\n                method = tryParseMethodDefinition(token, key, computed, method);\n                if (method) {\n                    method['static'] = isStatic;\n                    if (method.kind === 'init') {\n                        method.kind = 'method';\n                    }\n                    if (!isStatic) {\n                        if (!method.computed && (method.key.name || method.key.value.toString()) === 'constructor') {\n                            if (method.kind !== 'method' || !method.method || method.value.generator) {\n                                throwUnexpectedToken(token, Messages.ConstructorSpecialMethod);\n                            }\n                            if (hasConstructor) {\n                                throwUnexpectedToken(token, Messages.DuplicateConstructor);\n                            } else {\n                                hasConstructor = true;\n                            }\n                            method.kind = 'constructor';\n                        }\n                    } else {\n                        if (!method.computed && (method.key.name || method.key.value.toString()) === 'prototype') {\n                            throwUnexpectedToken(token, Messages.StaticPrototype);\n                        }\n                    }\n                    method.type = Syntax.MethodDefinition;\n                    delete method.method;\n                    delete method.shorthand;\n                    body.push(method);\n                } else {\n                    throwUnexpectedToken(lookahead);\n                }\n            }\n        }\n        lex();\n        return classBody.finishClassBody(body);\n    }\n\n    function parseClassDeclaration(identifierIsOptional) {\n        var id = null, superClass = null, classNode = new Node(), classBody, previousStrict = strict;\n        strict = true;\n\n        expectKeyword('class');\n\n        if (!identifierIsOptional || lookahead.type === Token.Identifier) {\n            id = parseVariableIdentifier();\n        }\n\n        if (matchKeyword('extends')) {\n            lex();\n            superClass = isolateCoverGrammar(parseLeftHandSideExpressionAllowCall);\n        }\n        classBody = parseClassBody();\n        strict = previousStrict;\n\n        return classNode.finishClassDeclaration(id, superClass, classBody);\n    }\n\n    function parseClassExpression() {\n        var id = null, superClass = null, classNode = new Node(), classBody, previousStrict = strict;\n        strict = true;\n\n        expectKeyword('class');\n\n        if (lookahead.type === Token.Identifier) {\n            id = parseVariableIdentifier();\n        }\n\n        if (matchKeyword('extends')) {\n            lex();\n            superClass = isolateCoverGrammar(parseLeftHandSideExpressionAllowCall);\n        }\n        classBody = parseClassBody();\n        strict = previousStrict;\n\n        return classNode.finishClassExpression(id, superClass, classBody);\n    }\n\n    // Modules grammar from:\n    // people.mozilla.org/~jorendorff/es6-draft.html\n\n    function parseModuleSpecifier() {\n        var node = new Node();\n\n        if (lookahead.type !== Token.StringLiteral) {\n            throwError(Messages.InvalidModuleSpecifier);\n        }\n        return node.finishLiteral(lex());\n    }\n\n    function parseExportSpecifier() {\n        var exported, local, node = new Node(), def;\n        if (matchKeyword('default')) {\n            // export {default} from 'something';\n            def = new Node();\n            lex();\n            local = def.finishIdentifier('default');\n        } else {\n            local = parseVariableIdentifier();\n        }\n        if (matchContextualKeyword('as')) {\n            lex();\n            exported = parseNonComputedProperty();\n        }\n        return node.finishExportSpecifier(local, exported);\n    }\n\n    function parseExportNamedDeclaration(node) {\n        var declaration = null,\n            isExportFromIdentifier,\n            src = null, specifiers = [];\n\n        // non-default export\n        if (lookahead.type === Token.Keyword) {\n            // covers:\n            // export var f = 1;\n            switch (lookahead.value) {\n                case 'let':\n                case 'const':\n                case 'var':\n                case 'class':\n                case 'function':\n                    declaration = parseStatementListItem();\n                    return node.finishExportNamedDeclaration(declaration, specifiers, null);\n            }\n        }\n\n        expect('{');\n        if (!match('}')) {\n            do {\n                isExportFromIdentifier = isExportFromIdentifier || matchKeyword('default');\n                specifiers.push(parseExportSpecifier());\n            } while (match(',') && lex());\n        }\n        expect('}');\n\n        if (matchContextualKeyword('from')) {\n            // covering:\n            // export {default} from 'foo';\n            // export {foo} from 'foo';\n            lex();\n            src = parseModuleSpecifier();\n            consumeSemicolon();\n        } else if (isExportFromIdentifier) {\n            // covering:\n            // export {default}; // missing fromClause\n            throwError(lookahead.value ?\n                    Messages.UnexpectedToken : Messages.MissingFromClause, lookahead.value);\n        } else {\n            // cover\n            // export {foo};\n            consumeSemicolon();\n        }\n        return node.finishExportNamedDeclaration(declaration, specifiers, src);\n    }\n\n    function parseExportDefaultDeclaration(node) {\n        var declaration = null,\n            expression = null;\n\n        // covers:\n        // export default ...\n        expectKeyword('default');\n\n        if (matchKeyword('function')) {\n            // covers:\n            // export default function foo () {}\n            // export default function () {}\n            declaration = parseFunctionDeclaration(new Node(), true);\n            return node.finishExportDefaultDeclaration(declaration);\n        }\n        if (matchKeyword('class')) {\n            declaration = parseClassDeclaration(true);\n            return node.finishExportDefaultDeclaration(declaration);\n        }\n\n        if (matchContextualKeyword('from')) {\n            throwError(Messages.UnexpectedToken, lookahead.value);\n        }\n\n        // covers:\n        // export default {};\n        // export default [];\n        // export default (1 + 2);\n        if (match('{')) {\n            expression = parseObjectInitialiser();\n        } else if (match('[')) {\n            expression = parseArrayInitialiser();\n        } else {\n            expression = parseAssignmentExpression();\n        }\n        consumeSemicolon();\n        return node.finishExportDefaultDeclaration(expression);\n    }\n\n    function parseExportAllDeclaration(node) {\n        var src;\n\n        // covers:\n        // export * from 'foo';\n        expect('*');\n        if (!matchContextualKeyword('from')) {\n            throwError(lookahead.value ?\n                    Messages.UnexpectedToken : Messages.MissingFromClause, lookahead.value);\n        }\n        lex();\n        src = parseModuleSpecifier();\n        consumeSemicolon();\n\n        return node.finishExportAllDeclaration(src);\n    }\n\n    function parseExportDeclaration() {\n        var node = new Node();\n        if (state.inFunctionBody) {\n            throwError(Messages.IllegalExportDeclaration);\n        }\n\n        expectKeyword('export');\n\n        if (matchKeyword('default')) {\n            return parseExportDefaultDeclaration(node);\n        }\n        if (match('*')) {\n            return parseExportAllDeclaration(node);\n        }\n        return parseExportNamedDeclaration(node);\n    }\n\n    function parseImportSpecifier() {\n        // import {<foo as bar>} ...;\n        var local, imported, node = new Node();\n\n        imported = parseNonComputedProperty();\n        if (matchContextualKeyword('as')) {\n            lex();\n            local = parseVariableIdentifier();\n        }\n\n        return node.finishImportSpecifier(local, imported);\n    }\n\n    function parseNamedImports() {\n        var specifiers = [];\n        // {foo, bar as bas}\n        expect('{');\n        if (!match('}')) {\n            do {\n                specifiers.push(parseImportSpecifier());\n            } while (match(',') && lex());\n        }\n        expect('}');\n        return specifiers;\n    }\n\n    function parseImportDefaultSpecifier() {\n        // import <foo> ...;\n        var local, node = new Node();\n\n        local = parseNonComputedProperty();\n\n        return node.finishImportDefaultSpecifier(local);\n    }\n\n    function parseImportNamespaceSpecifier() {\n        // import <* as foo> ...;\n        var local, node = new Node();\n\n        expect('*');\n        if (!matchContextualKeyword('as')) {\n            throwError(Messages.NoAsAfterImportNamespace);\n        }\n        lex();\n        local = parseNonComputedProperty();\n\n        return node.finishImportNamespaceSpecifier(local);\n    }\n\n    function parseImportDeclaration() {\n        var specifiers, src, node = new Node();\n\n        if (state.inFunctionBody) {\n            throwError(Messages.IllegalImportDeclaration);\n        }\n\n        expectKeyword('import');\n        specifiers = [];\n\n        if (lookahead.type === Token.StringLiteral) {\n            // covers:\n            // import 'foo';\n            src = parseModuleSpecifier();\n            consumeSemicolon();\n            return node.finishImportDeclaration(specifiers, src);\n        }\n\n        if (!matchKeyword('default') && isIdentifierName(lookahead)) {\n            // covers:\n            // import foo\n            // import foo, ...\n            specifiers.push(parseImportDefaultSpecifier());\n            if (match(',')) {\n                lex();\n            }\n        }\n        if (match('*')) {\n            // covers:\n            // import foo, * as foo\n            // import * as foo\n            specifiers.push(parseImportNamespaceSpecifier());\n        } else if (match('{')) {\n            // covers:\n            // import foo, {bar}\n            // import {bar}\n            specifiers = specifiers.concat(parseNamedImports());\n        }\n\n        if (!matchContextualKeyword('from')) {\n            throwError(lookahead.value ?\n                    Messages.UnexpectedToken : Messages.MissingFromClause, lookahead.value);\n        }\n        lex();\n        src = parseModuleSpecifier();\n        consumeSemicolon();\n\n        return node.finishImportDeclaration(specifiers, src);\n    }\n\n    // 14 Program\n\n    function parseScriptBody() {\n        var statement, body = [], token, directive, firstRestricted;\n\n        while (startIndex < length) {\n            token = lookahead;\n            if (token.type !== Token.StringLiteral) {\n                break;\n            }\n\n            statement = parseStatementListItem();\n            body.push(statement);\n            if (statement.expression.type !== Syntax.Literal) {\n                // this is not directive\n                break;\n            }\n            directive = source.slice(token.start + 1, token.end - 1);\n            if (directive === 'use strict') {\n                strict = true;\n                if (firstRestricted) {\n                    tolerateUnexpectedToken(firstRestricted, Messages.StrictOctalLiteral);\n                }\n            } else {\n                if (!firstRestricted && token.octal) {\n                    firstRestricted = token;\n                }\n            }\n        }\n\n        while (startIndex < length) {\n            statement = parseStatementListItem();\n            /* istanbul ignore if */\n            if (typeof statement === 'undefined') {\n                break;\n            }\n            body.push(statement);\n        }\n        return body;\n    }\n\n    function parseProgram() {\n        var body, node;\n\n        peek();\n        node = new Node();\n\n        body = parseScriptBody();\n        return node.finishProgram(body);\n    }\n\n    function filterTokenLocation() {\n        var i, entry, token, tokens = [];\n\n        for (i = 0; i < extra.tokens.length; ++i) {\n            entry = extra.tokens[i];\n            token = {\n                type: entry.type,\n                value: entry.value\n            };\n            if (entry.regex) {\n                token.regex = {\n                    pattern: entry.regex.pattern,\n                    flags: entry.regex.flags\n                };\n            }\n            if (extra.range) {\n                token.range = entry.range;\n            }\n            if (extra.loc) {\n                token.loc = entry.loc;\n            }\n            tokens.push(token);\n        }\n\n        extra.tokens = tokens;\n    }\n\n    function tokenize(code, options) {\n        var toString,\n            tokens;\n\n        toString = String;\n        if (typeof code !== 'string' && !(code instanceof String)) {\n            code = toString(code);\n        }\n\n        source = code;\n        index = 0;\n        lineNumber = (source.length > 0) ? 1 : 0;\n        lineStart = 0;\n        startIndex = index;\n        startLineNumber = lineNumber;\n        startLineStart = lineStart;\n        length = source.length;\n        lookahead = null;\n        state = {\n            allowIn: true,\n            allowYield: false,\n            labelSet: {},\n            inFunctionBody: false,\n            inIteration: false,\n            inSwitch: false,\n            lastCommentStart: -1,\n            curlyStack: []\n        };\n\n        extra = {};\n\n        // Options matching.\n        options = options || {};\n\n        // Of course we collect tokens here.\n        options.tokens = true;\n        extra.tokens = [];\n        extra.tokenize = true;\n        // The following two fields are necessary to compute the Regex tokens.\n        extra.openParenToken = -1;\n        extra.openCurlyToken = -1;\n\n        extra.range = (typeof options.range === 'boolean') && options.range;\n        extra.loc = (typeof options.loc === 'boolean') && options.loc;\n\n        if (typeof options.comment === 'boolean' && options.comment) {\n            extra.comments = [];\n        }\n        if (typeof options.tolerant === 'boolean' && options.tolerant) {\n            extra.errors = [];\n        }\n\n        try {\n            peek();\n            if (lookahead.type === Token.EOF) {\n                return extra.tokens;\n            }\n\n            lex();\n            while (lookahead.type !== Token.EOF) {\n                try {\n                    lex();\n                } catch (lexError) {\n                    if (extra.errors) {\n                        recordError(lexError);\n                        // We have to break on the first error\n                        // to avoid infinite loops.\n                        break;\n                    } else {\n                        throw lexError;\n                    }\n                }\n            }\n\n            filterTokenLocation();\n            tokens = extra.tokens;\n            if (typeof extra.comments !== 'undefined') {\n                tokens.comments = extra.comments;\n            }\n            if (typeof extra.errors !== 'undefined') {\n                tokens.errors = extra.errors;\n            }\n        } catch (e) {\n            throw e;\n        } finally {\n            extra = {};\n        }\n        return tokens;\n    }\n\n    function parse(code, options) {\n        var program, toString;\n\n        toString = String;\n        if (typeof code !== 'string' && !(code instanceof String)) {\n            code = toString(code);\n        }\n\n        source = code;\n        index = 0;\n        lineNumber = (source.length > 0) ? 1 : 0;\n        lineStart = 0;\n        startIndex = index;\n        startLineNumber = lineNumber;\n        startLineStart = lineStart;\n        length = source.length;\n        lookahead = null;\n        state = {\n            allowIn: true,\n            allowYield: false,\n            labelSet: {},\n            inFunctionBody: false,\n            inIteration: false,\n            inSwitch: false,\n            lastCommentStart: -1,\n            curlyStack: []\n        };\n        sourceType = 'script';\n        strict = false;\n\n        extra = {};\n        if (typeof options !== 'undefined') {\n            extra.range = (typeof options.range === 'boolean') && options.range;\n            extra.loc = (typeof options.loc === 'boolean') && options.loc;\n            extra.attachComment = (typeof options.attachComment === 'boolean') && options.attachComment;\n\n            if (extra.loc && options.source !== null && options.source !== undefined) {\n                extra.source = toString(options.source);\n            }\n\n            if (typeof options.tokens === 'boolean' && options.tokens) {\n                extra.tokens = [];\n            }\n            if (typeof options.comment === 'boolean' && options.comment) {\n                extra.comments = [];\n            }\n            if (typeof options.tolerant === 'boolean' && options.tolerant) {\n                extra.errors = [];\n            }\n            if (extra.attachComment) {\n                extra.range = true;\n                extra.comments = [];\n                extra.bottomRightStack = [];\n                extra.trailingComments = [];\n                extra.leadingComments = [];\n            }\n            if (options.sourceType === 'module') {\n                // very restrictive condition for now\n                sourceType = options.sourceType;\n                strict = true;\n            }\n        }\n\n        try {\n            program = parseProgram();\n            if (typeof extra.comments !== 'undefined') {\n                program.comments = extra.comments;\n            }\n            if (typeof extra.tokens !== 'undefined') {\n                filterTokenLocation();\n                program.tokens = extra.tokens;\n            }\n            if (typeof extra.errors !== 'undefined') {\n                program.errors = extra.errors;\n            }\n        } catch (e) {\n            throw e;\n        } finally {\n            extra = {};\n        }\n\n        return program;\n    }\n\n    // Sync with *.json manifests.\n    exports.version = '2.4.1';\n\n    exports.tokenize = tokenize;\n\n    exports.parse = parse;\n\n    // Deep copy.\n    /* istanbul ignore next */\n    exports.Syntax = (function () {\n        var name, types = {};\n\n        if (typeof Object.create === 'function') {\n            types = Object.create(null);\n        }\n\n        for (name in Syntax) {\n            if (Syntax.hasOwnProperty(name)) {\n                types[name] = Syntax[name];\n            }\n        }\n\n        if (typeof Object.freeze === 'function') {\n            Object.freeze(types);\n        }\n\n        return types;\n    }());\n\n}));\n/* vim: set sw=4 ts=4 et tw=80 : */\n","pre":true}});;